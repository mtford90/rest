!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var i=n(1),r=n(2),o=n(3),s=n(4),a=n(5);i._patchBind();var l={createApp:function(e,t){return t=t||{},t.name=e,new o(t)},log:n(27),lib:{log:a,Condition:n(6),Model:n(7),error:n(8),ModelEventType:s.ModelEventType,ModelInstance:n(9),extend:n(22),MappingOperation:n(10),events:n(11),ProxyEventEmitter:n(12),modelEvents:s,Collection:n(13),ReactiveFilter:r,utils:i,util:i,filterSet:n(14),observe:n(23),Filter:n(15),ManyToManyProxy:n(16),OneToManyProxy:n(17),OneToOneProxy:n(18),RelationshipProxy:n(19),Storage:n(21),Context:o},constants:{Deletion:{Cascade:"cascade",Nullify:"nullify"}},isArray:i.isArray,isString:i.isString,RelationshipType:n(20),ModelEventType:s.ModelEventType,InsertionPolicy:r.InsertionPolicy};"undefined"!=typeof window&&(window.siesta=l)},function(e,t,n){function i(e){return e=e||[],e.filter(function(e){return e})}function r(e,t){if(t=t||function(){},e&&e.length){var n=[],r=[],o=0;e.forEach(function(s,a){n[a]=!1,s(function(s,l){o++,s&&(r[a]=s),n[a]=l,o==e.length&&t(r.length?i(r):null,i(n),{results:n,errors:r})})})}else t()}function o(e,t){function n(n){n(function(n,l){n&&(s[a]=n),o[a]=l,e.length?(a++,r()):t(s.length?i(s):null,i(o),{results:o,errors:s})})}function r(){var t=e.shift();n(t)}if(t=t||function(){},e&&e.length){var o=[],s=[],a=0;r()}else t()}var s=n(23).Platform,a=n(24),l=n(31),c=n(8).InternalSiestaError,u=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},h=Array.isArray,d=function(e){return"string"==typeof e||e instanceof String};u(e.exports,{argsarray:l,next:function(e){s.performMicrotaskCheckpoint(),setTimeout(e)},extend:u,guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),assert:function(e,t,n){if(!e)throw t=t||"Assertion failed",n=n||{},new c(t,n)},pluck:function(e,t){return e.map(function(e){return e[t]})},thenBy:function(){function e(e){return e.thenBy=t,e}function t(t){var n=this;return e(function(e,i){return n(e,i)||t(e,i)})}return e}(),_patchBind:function(){var e=Function.prototype.apply.bind(Function.prototype.bind);Object.defineProperty(Function.prototype,"bind",{value:function(t){var n=e(this,arguments);return Object.defineProperty(n,"__siesta_bound_object",{value:t,writable:!0,configurable:!0,enumerable:!1}),n}})},Promise:a,promise:function(e,t){return e=e||function(){},new a(function(n,i){var r=l(function(t){var r=t[0],o=t.slice(1);r?i(r):n(o[0]);var s=e.__siesta_bound_object||e;e.apply(s,t)});t(r)})},defer:function(){var e,t,n=new a(function(n,i){e=n,t=i});return n.resolve=e,n.reject=t,n},subProperties:function(e,t,n){h(n)||(n=Array.prototype.slice.call(arguments,2));for(var i=0;i<n.length;i++)!function(n){var i={set:!1,name:n,property:n};d(n)||u(i,n);var r={get:function(){return t[i.property]},enumerable:!0,configurable:!0};i.set&&(r.set=function(e){t[i.property]=e}),Object.defineProperty(e,i.name,r)}(n[i])},capitaliseFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},extendFromOpts:function(e,t,n,i){if(i=void 0==i?!0:i){var r=Object.keys(n),o=Object.keys(t),s=o.filter(function(e){return-1==r.indexOf(e)});if(s.length)throw Error("Unknown options: "+s.toString())}Object.keys(n).forEach(function(e){var i=n[e];"function"==typeof i&&(n[e]=i(t[e]),delete t[e])}),u(n,t),u(e,n)},isString:d,isArray:h,prettyPrint:function(e){return JSON.stringify(e,null,4)},flattenArray:function(e){return e.reduce(function(e,t){return h(t)?e=e.concat(t):e.push(t),e},[])},unflattenArray:function(e,t){for(var n=0,i=[],r=0;r<t.length;r++)if(h(t[r])){var o=[];i[r]=o;for(var s=0;s<t[r].length;s++)o.push(e[n]),n++}else i[r]=e[n],n++;return i}}),u(e.exports,{compact:i,parallel:r,series:o});var f=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,p=/,/,v=/^\s*(_?)(.+?)\1\s*$/,m=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;u(e.exports,{paramNames:function(e){var t,n,i=[];return t=e.toString().replace(m,""),n=t.match(f),n[1].split(p).forEach(function(e){e.replace(v,function(e,t,n){i.push(n)})}),i}})},function(e,t,n){function i(e){var t=this;o.call(this),s.call(this),u.extend(this,{insertionPolicy:i.InsertionPolicy.Back,initialised:!1}),Object.defineProperty(this,"filter",{get:function(){return this._filter},set:function(e){e?(this._filter=e,this.results=c([],e.model)):(this._filter=null,this.results=null)},configurable:!1,enumerable:!0}),e&&u.extend(this,{_filter:e,results:c([],e.model)}),Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){var e=t._filter;return e?e.model:void 0}},collection:{get:function(){return t.model.collectionName}}})}var r=n(5)("filter:reactive"),o=(n(15),n(32).EventEmitter),s=n(25),a=n(4),l=n(8).InternalSiestaError,c=n(14),u=n(1);i.prototype=Object.create(o.prototype),u.extend(i.prototype,s.prototype),u.extend(i,{InsertionPolicy:{Front:"Front",Back:"Back"}}),u.extend(i.prototype,{init:function(e,t){if(this._filter){var n=this._constructNotificationName(),i=function(e){this._handleNotif(e)}.bind(this);return this.handler=i,this.model.context.events.on(n,i),u.promise(e,function(e){!this.initialised||t?this._filter.execute(function(t,n){t?e(t):e(null,this._applyResults(n))}.bind(this)):e(null,this.results)}.bind(this))}throw new l("No _filter defined")},_applyResults:function(e){return this.results=e,this.initialised=!0,this.results},insert:function(e){var t=this.results.mutableCopy();if(this.insertionPolicy==i.InsertionPolicy.Back)var n=t.push(e);else n=t.unshift(e);return this.results=t.asModelFilterSet(this.model),n},update:function(e){return this.init(e,!0)},_handleNotif:function(e){if(e.type==a.ModelEventType.New){var t=e["new"];if(this._filter.objectMatchesFilter(t)){r("New object matches",t);var n=this.insert(t);this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this})}else r("New object does not match",t)}else if(e.type==a.ModelEventType.Set){t=e.obj;var i=this.results.indexOf(t),o=i>-1,s=this._filter.objectMatchesFilter(t);if(s&&!o)r("Updated object now matches!",t),n=this.insert(t),this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this});else if(!s&&o){r("Updated object no longer matches!",t),h=this.results.mutableCopy();var u=h.splice(i,1);this.results=h.asModelFilterSet(this.model),this.emit(a.ModelEventType.Splice,{index:i,obj:this,"new":t,type:a.ModelEventType.Splice,removed:u})}else s||o?s&&o&&(r("Matches but already contains",t),this.emit(e.type,e)):r("Does not contain, but doesnt match so not inserting",t)}else{if(e.type!=a.ModelEventType.Remove)throw new l('Unknown change type "'+e.type.toString()+'"');t=e.obj;var h=this.results.mutableCopy();i=h.indexOf(t),i>-1?(r("Removing object",t),u=h.splice(i,1),this.results=c(h,this.model),this.emit(a.ModelEventType.Splice,{index:i,obj:this,type:a.ModelEventType.Splice,removed:u})):r("No modelEvents neccessary.",t)}this.results=c(this._filter._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&this.model.context.events.removeListener(this._constructNotificationName(),this.handler),this.results=null,this.handler=null},_registerEventHandler:function(e,t,n){var i=o.prototype.removeListener;return"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(t){e.call(this,a.ModelEventType[t],n)}.bind(this)):e.call(this,t,n),this._link({on:this.on.bind(this),once:this.once.bind(this),update:this.update.bind(this),insert:this.insert.bind(this)},function(){"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(e){i.call(this,a.ModelEventType[e],n)}.bind(this)):i.call(this,t,n)})},on:function(e,t){return this._registerEventHandler(o.prototype.on,e,t)},once:function(e,t){return this._registerEventHandler(o.prototype.once,e,t)}}),e.exports=i},function(e,t,n){function i(e){this._storage=new h(this,e)}function r(e){if(this.collections={},this.cache=new a,e=e||{},this.name=e.name,e.storage&&i.call(this,e.storage),!this.name)throw new Error("Must provide name to context");this.events=o();var t=this.events.removeListener.bind(this.events);l.extend(this,{on:this.events.on.bind(this.events),off:t,removeListener:t,once:this.events.once.bind(this.events),removeAllListeners:this.events.removeAllListeners.bind(this.events),notify:l.next,digest:l.next,emit:l.next,registerComparator:d.registerComparator.bind(d),save:function(e){return l.promise(e,function(e){this._storage?this._storage.save(e):e()}.bind(this))}});var n,r,s=500;Object.defineProperties(this,{storage:{get:function(){return!!this._storage},set:function(e){e?this._storage=new h(this):delete this._storage}},dirty:{get:function(){var e=this._storage;if(e){{e._unsavedObjectsByCollection}return!!Object.keys(e.unsavedObjectsByCollection).length}return!1},enumerable:!0},autosaveInterval:{get:function(){return s},set:function(e){s=e,n&&(this.autosave=!1,this.autosave=!0)}},autosave:{get:function(){return!!n},set:function(e){e?n||(n=setInterval(function(){r||(r=!0,this._storage.save(function(e){e||this.events.emit("saved"),r=!1}.bind(this)))}.bind(this),this.autosaveInterval)):n&&(clearInterval(n),n=null)}},collectionNames:{get:function(){return Object.keys(this.collections)}}}),this.autosave=e.autosave,e.autosaveInterval&&(this.autosaveInterval=e.autosaveInterval)}var o=n(11),s=n(4),a=n(26),l=n(1),c=n(7),u=n(8),h=n(21),d=n(15),f=n(13);r.prototype={collection:function(e,t){t=t||{},t.context=this;var n=new f(e,t);if(this[e]){var i='A collection with name "'+e+'" already exists, or that name is not allowed';throw console.error(i,this[e]),Error(i)}return this[e]=n,n},broadcast:function(e){s.emit(this,e)},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},l.promise(n,function(t){var n,i=[];for(var r in e)if(e.hasOwnProperty(r)){var o=this.collections[r];o?!function(e,t){i.push(function(n){e.graph(t,function(t,i){if(!t){var r={};r[e.name]=i}n(t,r)})})}(o,e[r]):n='No such collection "'+r+'"'}n?t(u(n,{data:e,invalidCollectionName:r})):l.series(i,function(e,n){n=e?null:n.reduce(function(e,t){return l.extend(e,t)},{}),t(e,n)})}.bind(this))},count:function(){return this.cache.count()},get:function(e,t){return l.promise(t,function(t){t(null,this.cache._localCache()[e])}.bind(this))},removeAll:function(e){return l.promise(e,function(e){l.Promise.all(this.collectionNames.map(function(e){var t=this.collections[e];return t.removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))},_ensureInstalled:function(e){e=e||function(){};var t=this.collectionNames.reduce(function(e,t){var n=this.collections[t];return e=e.concat(n.models)}.bind(this),[]);console.log("installing models",t),c.install(t,e)},_pushTask:function(e){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[],this.execute=function(){this.tasks.forEach(function(e){e()}),this.tasks=[]}.bind(this)}),this.queuedTasks.tasks.push(e)},reset:function(e,t){delete this.queuedTasks,this.cache.reset();var n=this.collectionNames;n.forEach(function(e){this[e]=void 0}.bind(this)),this.removeAllListeners(),this._storage?(t=void 0===t?!0:t,t?this._storage._reset(e,new PouchDB("siesta",{auto_compaction:!0,adapter:"memory"})):e()):e()},context:function(e){var t=new r(e),n=this.collectionNames,i={};return n.forEach(function(e){var n=t.collection(e),r=this.collections[e];i[e]=n;var o=r._rawModels;Object.keys(o).forEach(function(e){var t=l.extend({},o[e]);t.name=e;var i=t.relationships;i&&Object.keys(i).forEach(function(e){var t=l.extend({},i[e]);t.model&&t.model instanceof c&&(t.model=t.model.name),i[e]=t}),n.model(t)})}.bind(this)),t}},e.exports=r},function(e,t,n){function i(e){this._opts=e||{},Object.keys(e).forEach(function(t){this[t]=e[t]}.bind(this))}function r(e,t,n,i){var r="Siesta",o=e.collections[t],s=o[n];if(!o)throw new a('No such collection "'+t+'"');if(!s)throw new a('No such model "'+n+'"');var l=i.obj._emitEvents;if(l&&"new"in i&&"old"in i&&(l=i["new"]instanceof Date&&i.old instanceof Date?i["new"].getTime()!=i.old.getTime():i["new"]!=i.old),l){e.events.emit(r,i);var c=t+":"+n,u=i.localId;e.events.emit(t,i),e.events.emit(c,i),e.events.emit(u,i),s.id&&i.obj[s.id]&&e.events.emit(t+":"+n+":"+i.obj[s.id],i)}}function o(e){if(!e.model)throw new a("Must pass a model");if(!e.collection)throw new a("Must pass a collection");if(!e.localId)throw new a("Must pass a local identifier");if(!e.obj)throw new a("Must pass the object")}function s(e,t){o(t);var n=t.collection,s=t.model,a=new i(t);return r(e,n,s,a),a}var a=n(8).InternalSiestaError,l=(n(5)("events"),n(23).ArrayObserver),c=n(1).extend,u={Set:"set",Splice:"splice",New:"new",Remove:"remove"};i.prototype._dump=function(e){var t={};return t.collection="string"==typeof this.collection?this.collection:this.collection._dump(),t.model="string"==typeof this.model?this.model:this.model.name,t.localId=this.localId,t.field=this.field,t.type=this.type,this.index&&(t.index=this.index),this.added&&(t.added=this.added.map(function(e){return e._dump()})),this.removed&&(t.removed=this.removed.map(function(e){return e._dump()})),this.old&&(t.old=this.old),this["new"]&&(t["new"]=this["new"]),e?util.prettyPrint(t):t},c(t,{ModelEvent:i,emit:s,validateEventOpts:o,ModelEventType:u,wrapArray:function(e,t,n){e.observer||(e.observer=new l(e),e.observer.open(function(i){var r=n._attributeNames.indexOf(t)>-1;r&&i.forEach(function(i){s(n.context,{collection:n.collectionName,model:n.model.name,localId:n.localId,index:i.index,removed:i.removed,added:i.addedCount?e.slice(i.index,i.index+i.addedCount):[],type:u.Splice,field:t,obj:n})})}))}})},function(e,t,n){var i=n(27),r=n(31);e.exports=function(e){var t=i("siesta:"+e),n=r(function(e){t.call(t,e)});return Object.defineProperty(n,"enabled",{get:function(){return i.enabled(e)}}),n}},function(e,t,n){function i(e,t){(void 0===t||null===t)&&(this.lazy=!0),this._fn=e||function(e){e()},this.reset()}var r=n(1),o=n(24),s=n(31);i.all=s(function(e){return new i(e)}),i.prototype={_execute:function(){if(!this.executed){var e=r.pluck(this.dependent,"_promise");o.all(e).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()})}},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){this._promise=new o(function(e,t){this.reject=t,this.resolve=e,this.fn=function(){this.executed=!0;var n=0,i=[],o=[];if(r.isArray(this._fn)){var s=function(){n==this._fn.length&&(o.length?t(o):e(i))}.bind(this);this._fn.forEach(function(e,t){e.then(function(e){i[t]=e,n++,s()}.bind(this))["catch"](function(e){o[t]=e,n++,s()}.bind(this))})}else this._fn(function(n,i){n?t(n):e(i)}.bind(this))}.bind(this)}.bind(this)),this.lazy||this._execute(),this.executed=!1,this.dependent=[]}},e.exports=i},function(e,t,n){(function(t){function i(e){var t=this;this._rawOpts=c.extend({},e||{}),this._opts=e?c.extend({},e):{},c.extendFromOpts(this,e,{methods:{},attributes:[],collection:null,id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,serialise:null,serialiseField:null,serialisableFields:null,remove:null,parseAttribute:null},!1),this.parseAttribute||(this.parseAttribute=function(e,t){return t}),this.attributes=i._processAttributes(this.attributes),this._factory=new b(this),this._instance=this._factory._instance.bind(this._factory),c.extend(this,{_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]}),Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(t.relationships)},enumerable:!0},_attributeNames:{get:function(){var e=[];return t.id&&e.push(t.id),t.attributes.forEach(function(t){e.push(t.name)}),e},enumerable:!0,configurable:!0},installed:{get:function(){return t._relationshipsInstalled&&t._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return t.children.reduce(function(e,t){return Array.prototype.concat.call(e,t.descendants)}.bind(t),c.extend([],t.children))},enumerable:!0},dirty:{get:function(){if(this.context.storage){var e=this.context._storage._unsavedObjectsByCollection,t=(e[this.collectionName]||{})[this.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0},context:{get:function(){return this.collection.context}}});var n=this.collectionName+":"+this.name,r={filter:this.filter.bind(this)};f.call(this,this.context,n,r),this.installRelationships(),this.installReverseRelationships(),this._indexIsInstalled=new d(function(e){this.context.storage?this.context._storage.ensureIndexInstalled(this,function(t){e(t)}):e()}.bind(this)),this._modelLoadedFromStorage=new d(function(e){var t=this.context.storage;t?this.context._storage.loadModel({model:this},function(t){e(t)}):e()}.bind(this)),this._storageEnabled=new d([this._indexIsInstalled,this._modelLoadedFromStorage])}var r=n(5)("model"),o=n(8).InternalSiestaError,s=n(20),a=n(15),l=n(10),c=(n(9),n(1)),u=n(31),h=n(8),d=(n(22),n(4),n(6)),f=n(12),p=(c.Promise,n(24)),v=n(28),m=n(2),b=n(29);c.extend(i,{_processAttributes:function(e){return e.reduce(function(e,t){return e.push("string"==typeof t?{name:t}:t),e},[])},install:function(e,t){return t=t||function(){},new p(function(n,i){var r=e.map(function(e){return e._storageEnabled});d.all.apply(d,r).then(function(){e.forEach(function(e){e._installReversePlaceholders()}),t(),n()})["catch"](function(e){i(e)})})}}),i.prototype=Object.create(f.prototype),c.extend(i.prototype,{installStatics:function(e){return e&&Object.keys(e).forEach(function(t){this[t]?r('Static method with name "'+t+'" already exists. Ignoring it.'):this[t]=e[t].bind(this)}.bind(this)),e},_validateRelationshipType:function(e){if(e.type||(e.type=this.singleton?s.OneToOne:s.OneToMany),this.singleton&&e.type==s.ManyToMany)throw new Error("Singleton model cannot use ManyToMany relationship.");if(Object.keys(s).indexOf(e.type)<0)throw new Error("Relationship type "+e.type+" does not exist")},_getReverseModel:function(e){var t;if(t=e instanceof i?e:this.collection[e],!t){var n=e.split(".");if(2==n.length){var r=n[0];e=n[1];var o=this.context.collections[r];o&&(t=o[e])}}return t},_getReverseModelOrPlaceholder:function(e,t){var n=this._getReverseModel(t);return n||new v({name:t,ref:this,forwardName:e})},installRelationships:function(){if(this._relationshipsInstalled)throw new o('Relationships for "'+this.name+'" have already been installed');var e=null;for(var t in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(t)){var n=this._opts.relationships[t],i=!n.isReverse;if(i&&(r(this.name+": configuring relationship "+t,n),!(e=this._validateRelationshipType(n)))){var s=n.model;if(!s)return"Must pass model";var a=this._getReverseModelOrPlaceholder(t,s);c.extend(n,{reverseModel:a,forwardModel:this,forwardName:t,reverseName:n.reverse||"reverse_"+t,isReverse:!1}),delete n.model,delete n.reverse}}return e||(this._relationshipsInstalled=!0),e},_installReverse:function(e){var t=c.extend({},e);t.isReverse=!0;var n=t.reverseModel,i=n.isPlaceholder;if(i){var r=t.reverseModel.name;n=this._getReverseModel(r),n&&(t.reverseModel=n,e.reverseModel=n)}if(n){var o=t.reverseName,a=t.forwardModel;if(n!=this||n==a){if(n.singleton){if(t.type==s.ManyToMany)throw new Error("Singleton model cannot be related via reverse ManyToMany");if(t.type==s.OneToMany)throw new Error("Singleton model cannot be related via reverse OneToMany")}if(n.relationships[o]){var l=n.relationships[o].forwardModel.isAncestorOf(this),u=n.relationships[o].forwardModel.isDescendantOf(this);if(!l&&!u&&!i)throw new Error('Reverse relationship "'+o+'" already exists on model "'+n.name+'"')}n.relationships[o]=t}var h=(this.context.cache._localCacheByType[n.collectionName]||{})[n.name]||{};Object.keys(h).forEach(function(e){var n=h[e];this._factory._installRelationship(t,n)}.bind(this))}},_installReversePlaceholders:function(){for(var e in this.relationships)if(this.relationships.hasOwnProperty(e)){var t=this.relationships[e];t.reverseModel.isPlaceholder&&this._installReverse(t)}},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new o('Reverse relationships for "'+this.name+'" have already been installed.');for(var e in this.relationships)this.relationships.hasOwnProperty(e)&&this._installReverse(this.relationships[e]);this._reverseRelationshipsInstalled=!0},_filter:function(e){return new a(this,e||{})},filter:function(e,n){var i,r=c.promise(n,function(t){this.context._ensureInstalled(function(){return this.singleton?(i=this._filter({__ignoreInstalled:!0}),void i.execute(function(n,r){n?t(n):(e=c.extend({},e),e.__ignoreInstalled=!0,r.length?(i=this._filter(e),i.execute(t)):this.graph({},function(n){n?t(n):(i=this._filter(e),i.execute(t))}.bind(this)))}.bind(this))):(i=this._filter(e),i.execute(t))}.bind(this))}.bind(this)),o=new c.Promise(function(e,n){r.then(u(function(n){t(function(){e.apply(null,n)})}),u(function(e){t(function(){n.apply(null,e)})}))});return this._link({then:o.then.bind(o),"catch":o["catch"].bind(o),on:u(function(t){var n=new m(this._filter(e));n.init(),n.on.apply(n,t)}.bind(this))})},_reactiveFilter:function(e){return new m(new a(this,e||{}))},one:function(e,t){return"function"==typeof e&&(t=e,e={}),c.promise(t,function(t){this.filter(e,function(e,n){e?t(e):n.length>1?t(h("More than one instance returned when executing get filter!")):(n=n.length?n[0]:null,t(null,n))})}.bind(this))},all:function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};var n={};return e.__order&&(n.__order=e.__order),this.filter(e,t)},_attributeDefinitionWithName:function(e){for(var t=0;t<this.attributes.length;t++){var n=this.attributes[t];if(n.name==e)return n}},_graph:function(e,t,n){var i=function(){var i=t.override;i&&(t.objects=c.isArray(i)?i:[i]),delete t.override,c.isArray(e)?this._mapBulk(e,t,n):this._mapBulk([e],t,function(t,i){var r;i&&i.length&&(r=i[0]),t=t?c.isArray(e)?t:c.isArray(t)?t[0]:t:null,n(t,r)})}.bind(this);i()},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},c.promise(n,function(n){this.context._ensureInstalled(function(i){i?n(i):this._graph(e,t,n)}.bind(this))}.bind(this))},_mapBulk:function(e,t,n){c.extend(t,{model:this,data:e});var i=new l(t);i.start(function(e,t){e?n&&n(e):n(null,t||[])})},_countCache:function(){var e=this.context.cache._localCacheByType[this.collectionName]||{},t=e[this.name]||{};return Object.keys(t).reduce(function(e,t){return e[t]={},e},{})},count:function(e){return c.promise(e,function(e){this.context._ensureInstalled(function(){e(null,Object.keys(this._countCache()).length)}.bind(this))}.bind(this))},_dump:function(e){var t={};return t.name=this.name,t.attributes=this.attributes,t.id=this.id,t.collection=this.collectionName,t.relationships=this.relationships.map(function(e){return e.isForward?e.forwardName:e.reverseName}),e?c.prettyPrint(t):t},toString:function(){return"Model["+this.name+"]"},removeAll:function(e){return c.promise(e,function(e){this.all().then(function(t){t.remove(),e()})["catch"](e)}.bind(this))}}),c.extend(i.prototype,{child:function(e,t){"string"==typeof e?t.name=e:t=name,c.extend(t,{attributes:Array.prototype.concat.call(t.attributes||[],this._opts.attributes),relationships:c.extend(t.relationships||{},this._opts.relationships),methods:c.extend(c.extend({},this._opts.methods)||{},t.methods),statics:c.extend(c.extend({},this._opts.statics)||{},t.statics),properties:c.extend(c.extend({},this._opts.properties)||{},t.properties),id:t.id||this._opts.id,init:t.init||this._opts.init,remove:t.remove||this._opts.remove,serialise:t.serialise||this._opts.serialise,serialiseField:t.serialiseField||this._opts.serialiseField,parseAttribute:t.parseAttribute||this._opts.parseAttribute}),this._opts.serialisableFields&&(t.serialisableFields=Array.prototype.concat.apply(t.serialisableFields||[],this._opts.serialisableFields));var n=this.collection.model(t.name,t);return n.parent=this,this.children.push(n),n},isChildOf:function(e){return this.parent==e},isParentOf:function(e){return this.children.indexOf(e)>-1},isDescendantOf:function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},isAncestorOf:function(e){return this.descendants.indexOf(e)>-1},hasAttributeNamed:function(e){return this._attributeNames.indexOf(e)>-1}}),e.exports=i}).call(t,n(33).setImmediate)},function(e){function t(e,t,n){Error.call(this,e,t,n),this.message=e,this.context=t,n&&Error.captureStackTrace&&Error.captureStackTrace(this,n)}function n(e){return"object"==typeof e?"error"in e&&"ok"in e&&"reason"in e:!1}t.prototype=Object.create(Error.prototype),t.prototype.name="InternalSiestaError",t.prototype.constructor=t,e.exports=function(e,t){if(n(e))return e;var i={reason:e,error:!0,ok:!1};for(var r in t||{})t.hasOwnProperty(r)&&(i[r]=t[r]);return i.toString=function(){return JSON.stringify(this)},i},e.exports.InternalSiestaError=t},function(e,t,n){function i(e){if(!e)throw new Error("wtf");var t=this;this.model=e,l.call(this,e.context),this.__proxies={},this._proxies=[],o.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]),Object.defineProperties(this,{_relationshipNames:{get:function(){var e=Object.keys(t.__proxies||{}).map(function(e){return t.__proxies[e]});return e.map(function(e){return e.isForward?e.forwardName:e.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){return this.context.storage?t.localId in this.context._storage._unsavedObjectsHash:void 0},enumerable:!0},event:{get:function(){return this.localId}},context:{get:function(){return this.model.context}}}),this.removed=!1,this._emitEvents=!1}function r(e,t){return t}var o=(n(5),n(1)),s=(n(8),n(4)),a=s.ModelEventType,l=n(12);i.prototype=Object.create(l.prototype),o.extend(i.prototype,{get:function(e){return o.promise(e,function(e){e(null,this)}.bind(this))},emit:function(e,t){"object"==typeof e?t=e:t.type=e,t=t||{},o.extend(t,{collection:this.collectionName,model:this.model.name,localId:this.localId,obj:this}),this.context.broadcast(t)},remove:function(e,t){return _.each(this._relationshipNames,function(e){this[e]=o.isArray(this[e])?[]:null}.bind(this)),t=null==t?!0:t,o.promise(e,function(e){this.context.cache.remove(this),this.removed=!0,t&&this.emit(s.ModelEventType.Remove,{old:this});var n=this.model.remove;if(n){var i=o.paramNames(n);if(i.length){var r=this;n.call(this,function(t){e(t,r)})}else n.call(this),e(null,this)}else e(null,this)}.bind(this))},restore:function(e){return o.promise(e,function(e){var t=function(t){t||this.emit(s.ModelEventType.New,{"new":this}),e(t,this)}.bind(this);if(this.removed){this.context.cache.insert(this),this.removed=!1;var n=this.model.init;if(n){var i=o.paramNames(n),r=!0;i.length>1?n.call(this,r,t):(n.call(this,r),t())}else t()}}.bind(this))}}),o.extend(i.prototype,{getAttributes:function(){return o.extend({},this.__values)},isInstanceOf:function(e){return this.model==e},isA:function(e){return this.model==e||this.model.isDescendantOf(e)}}),o.extend(i.prototype,{_dumpString:function(e){return JSON.stringify(this._dump(e,null,4))},_dump:function(){var e=o.extend({},this.__values);return e._rev=this._rev,e.localId=this.localId,e}}),o.extend(i.prototype,{_defaultSerialise:function(e){var t={},n=void 0!==e.includeNullAttributes?e.includeNullAttributes:!0,i=void 0!==e.includeNullRelationships?e.includeNullRelationships:!0,s=this.model.serialisableFields||this._attributeNames.concat.apply(this._attributeNames,this._relationshipNames).concat(this.id);return this._attributeNames.forEach(function(e){if(s.indexOf(e)>-1){var i,o=this.model._attributeDefinitionWithName(e)||{};if(o.serialise)i=o.serialise.bind(this);else{var a=this.model.serialiseField||r;i=a.bind(this,e)}var l=this[e];null===l?n&&(t[e]=i(l)):void 0!==l&&(t[e]=i(l))}}.bind(this)),this._relationshipNames.forEach(function(e){if(s.indexOf(e)>-1){var n=this[e],a=this.model.relationships[e];if(a&&!a.isReverse){var l;if(a.serialise)l=a.serialise.bind(this);else{var c=this.model.serialiseField;c||(o.isArray(n)?n=o.pluck(n,this.model.id):n&&(n=n[this.model.id])),c=c||r,l=c.bind(this,e)}null===n?i&&(t[e]=l(n)):o.isArray(n)?(i&&!n.length||n.length)&&(t[e]=l(n)):void 0!==n&&(t[e]=l(n))}}}.bind(this)),t},serialise:function(e){return e=e||{},this.model.serialise?this.model.serialise(this,e):this._defaultSerialise(e)}}),o.extend(i.prototype,{serialize:i.prototype.serialise}),o.extend(i.prototype,{_emitNew:function(){this.context.broadcast({collection:this.model.collectionName,model:this.model.name,localId:this.localId,"new":this,type:a.New,obj:this})}}),e.exports=i},function(e,t,n){function i(e){this.opts=e}function r(e){this._opts=e,s.extendFromOpts(this,e,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,fromStorage:!1}),s.extend(this,{errors:[],subTaskResults:{},_newObjects:[]}),this.model._installReversePlaceholders(),this.data=this.preprocessData()}var o=n(9),s=(n(5)("graph"),n(1));i.prototype.toString=function(){return JSON.stringify(this.opts,null,4)},s.extend(r.prototype,{mapAttributes:function(){for(var e=0;e<this.data.length;e++){var t=this.data[e],n=this.objects[e];if(t!=n&&n){var i=this.model._attributeNames;i.forEach(function(i){if(void 0!==t[i])if(this.disableevents)n.__values[i]=t[i];else try{n[i]=t[i]}catch(r){this.errors[e]=r}}.bind(this)),t._rev&&(n._rev=t._rev)}}},_map:function(){var e,t=this;this.mapAttributes();var n=Object.keys(t.subTaskResults);n.forEach(function(n){for(var i=t.subTaskResults[n],r=i.indexes,o=i.objects,a=t.getRelatedData(n).relatedData,l=s.unflattenArray(o,a),c=0;c<l.length;c++){var u=r[c],h=t.errors[u];if(e=h?h[n]:null,!e){var d=l[c],f=t.objects[u];f&&(e=f.__proxies[n].set(d,{disableevents:t.disableevents}),e&&(t.errors[u]||(t.errors[u]={}),t.errors[u][n]=e))}}})},_sortLookups:function(){for(var e=[],t=[],n=0;n<this.data.length;n++)if(!this.objects[n]){var i,r=this.data[n],s="string"==typeof r||"number"==typeof r||r instanceof String;r?s?(i={index:n,datum:{}},i.datum[this.model.id]=r,e.push(i)):r instanceof o?this.objects[n]=r:r.localId?t.push({index:n,datum:r}):r[this.model.id]?e.push({index:n,datum:r}):this.objects[n]=this._instance():this.objects[n]=null}return{remoteLookups:e,localLookups:t}},_performLocalLookups:function(e){for(var t=this.model.context.cache,n=s.pluck(s.pluck(e,"datum"),"localId"),i=t.getViaLocalId(n),r=0;r<n.length;r++){var o=i[r],a=n[r],l=e[r];o?this.objects[l.index]=o:(o=t.get({localId:a}),o||(o=this._instance({localId:a},!this.disableevents)),this.objects[l.index]=o)}},_performRemoteLookups:function(e){for(var t=this.model.context.cache,n=s.pluck(s.pluck(e,"datum"),this.model.id),i=t.getViaRemoteId(n,{model:this.model}),r=0;r<i.length;r++){var o=i[r],a=e[r];if(o)this.objects[a.index]=o;else{var l={},c=n[r];l[this.model.id]=c;var u={model:this.model};u[this.model.id]=c;var h=t.get(u);h?this.objects[a.index]=h:(this.objects[a.index]=this._instance(),this.objects[a.index][this.model.id]=c)}}},_lookup:function(){if(this.model.singleton)this._lookupSingleton();else{var e=this._sortLookups(),t=e.remoteLookups,n=e.localLookups;this._performLocalLookups(n),this._performRemoteLookups(t)}},_lookupSingleton:function(){var e,t=s.pluck(this.data,"localId");for(i=0;i<t.length;i++)if(t[i]){e={localId:t[i]};break}for(var n=this.model.context.cache.getSingleton(this.model)||this._instance(e),i=0;i<this.data.length;i++)this.objects[i]=n},_instance:function(){var e=this.model,t=e._instance.apply(e,arguments);return this._newObjects.push(t),t
},preprocessData:function(){var e=s.extend([],this.data);return e.map(function(e){if(e&&!s.isString(e)){var t=Object.keys(e);t.forEach(function(t){var n=this.model._relationshipNames.indexOf(t)>-1;if(n){var i=e[t];i instanceof o&&(e[t]={localId:i.localId})}}.bind(this))}return e}.bind(this))},start:function(e){var t=this.data;if(t.length){var n=this,i=[];this._lookup(),i.push(this._executeSubOperations.bind(this)),s.parallel(i,function(t){t&&console.error(t),n._map();var i=this.fromStorage,r=n._newObjects.reduce(function(t,n){var r=n.model.init;if(r){var o=s.paramNames(r);o.length>1?t.push(r.bind(n,i,e)):r.call(n,i)}return n._emitEvents=!0,n._emitNew(),t},[]);s.parallel(r,function(){e(n.errors.length?n.errors:null,n.objects)})}.bind(this))}else e(null,[])},getRelatedData:function(e){for(var t=[],n=[],i=0;i<this.data.length;i++){var r=this.data[i];if(r){var o=r[e];o&&(t.push(i),n.push(o))}}return{indexes:t,relatedData:n}},processErrorsFromTask:function(e,t,n){if(t.length)for(var i=this.getRelatedData(e).relatedData,r=s.unflattenArray(t,i),o=0;o<r.length;o++){var a=n[o],l=r[o],c=l;s.isArray(l)&&(c=l.reduce(function(e,t){return e||t},!1)),c&&(this.errors[a]||(this.errors[a]={}),this.errors[a][e]=l)}},_executeSubOperations:function(e){var t=this,n=Object.keys(this.model.relationships);if(n.length){var i=n.reduce(function(e,n){var i=t.model.relationships[n],o=i.forwardName==n?i.reverseModel:i.forwardModel;o.singleton&&!i.isReverse&&this.data.forEach(function(e){e[n]||(e[n]={})});var a=this.getRelatedData(n),l=a.indexes,c=a.relatedData;if(c.length)var u=s.flattenArray(c),h=new r({model:o,data:u,disableevents:t.disableevents,_ignoreInstalled:t._ignoreInstalled,fromStorage:this.fromStorage});if(h){var d;d=function(e){h.start(function(i,r){t.subTaskResults[n]={errors:i,objects:r,indexes:l},t.processErrorsFromTask(n,h.errors,l),e()})},e.push(d)}return e}.bind(this),[]);s.parallel(i,function(t){e(t)})}else e()}}),e.exports=r},function(e,t,n){var i=n(32).EventEmitter,r=(n(1),n(31),n(4),n(25),function(){var e=new i;e.setMaxListeners(100);var t=e.emit;return e.emit=function(n,i){try{t.call(e,n,i)}catch(r){console.error(r)}},e});e.exports=r},function(e,t,n){function i(e,t,n){if(!e)throw new Error("wtf");r.extend(this,{event:t,context:e,listeners:{}});var i={};i.on=this.on.bind(this),i.once=this.once.bind(this),o.call(this,r.extend(i,n||{}))}var r=(n(23).ArrayObserver,n(1)),o=(n(31),n(4),n(25));i.prototype=Object.create(o.prototype),r.extend(i.prototype,{on:function(e,t){if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var n=t;t=function(t){t=t||{},e?t.type==e&&n(t):n(t)};var i=this.listeners;e&&(i[e]||(i[e]=[]),i[e].push(t))}return this.context.events.on(this.event,t),this._handlerLink({fn:t,type:e,extend:this.proxyChainOpts})},once:function(e,t){var n=this.event;if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var i=t;t=function(r){r=r||{},e?r.type==e&&(this.context.events.removeListener(n,t),i(r)):i(r)}.bind(this)}return e?this.context.events.on(n,t):this.context.events.once(n,t)},_removeListener:function(e,t){if(t){var n=this.listeners[t],i=n.indexOf(e);n.splice(i,1)}return this.context.events.removeListener(this.event,e)},emit:function(e,t){"object"==typeof e?(t=e,e=null):(t=t||{},t.type=e),this.context.events.emit.call(this.context.events,this.event,t)},_removeAllListeners:function(e){(this.listeners[e]||[]).forEach(function(e){this.context.events.removeListener(this.event,e)}.bind(this)),this.listeners[e]=[]},removeAllListeners:function(e){if(e)this._removeAllListeners(e);else for(e in this.listeners)this.listeners.hasOwnProperty(e)&&this._removeAllListeners(e)}}),e.exports=i},function(e,t,n){function i(e,t){var n=this;if(!e)throw new Error("Collection must have a name");t=t||{},a.extendFromOpts(this,t,{context:null}),a.extend(this,{name:e,_rawModels:{},_models:{},_opts:t,installed:!1}),Object.defineProperties(this,{dirty:{get:function(){if(this.context.storage){var e=this.context._storage._unsavedObjectsByCollection,t=e[n.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},models:{get:function(){return Object.keys(this._models).map(function(e){return this._models[e]}.bind(this))}}}),this.context.collections[this.name]=this,s.call(this,this.context,this.name)}{var r=(n(5)("collection"),n(8).InternalSiestaError,n(7)),o=n(22),s=n(12),a=n(1),l=n(8),c=n(31);n(30)}i.prototype=Object.create(s.prototype),a.extend(i.prototype,{_model:function(e,t){if(e){this._rawModels[e]=t,t=o(!0,{},t),t.name=e,t.collection=this;var n=new r(t);return this._models[e]=n,this[e]=n,n}throw new Error("No name specified when creating mapping")},model:c(function(e){if(e.length){if(1==e.length){if(a.isArray(e[0]))return e[0].map(function(e){return this._model(e.name,e)}.bind(this));var t,n;return a.isString(e[0])?(t=e[0],n={}):(n=e[0],t=n.name),this._model(t,n)}return"string"==typeof e[0]?this._model(e[0],e[1]):e.map(function(e){return this._model(e.name,e)}.bind(this))}return null}),_dump:function(e){var t={};return t.installed=this.installed,t.docId=this._docId,t.name=this.name,e?a.prettyPrint(t):t},count:function(e){return a.promise(e,function(e){var t=Object.keys(this._models).map(function(e){var t=this._models[e];return t.count.bind(t)}.bind(this));a.parallel(t,function(t,n){var i;t||(i=n.reduce(function(e,t){return e+t},0)),e(t,i)})}.bind(this))},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},a.promise(n,function(t){var n,i=[];for(var r in e)if(e.hasOwnProperty(r)){var o=this._models[r];o?!function(e,t){i.push(function(n){e.graph(t,function(t,i){if(!t){var r={};r[e.name]=i}n(t,r)})})}(o,e[r]):n='No such model "'+r+'"'}n?t(l(n,{data:e,invalidModelName:r})):a.series(i,function(e,n){n=e?null:n.reduce(function(e,t){return a.extend(e,t||{})},{}),t(e,n)})}.bind(this))},removeAll:function(e){return a.promise(e,function(e){a.Promise.all(Object.keys(this._models).map(function(e){var t=this._models[e];return t.removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))}}),e.exports=i},function(e,t,n){function i(e){var t;return t="string"==typeof e||e instanceof String?y.concat(_):"number"==typeof e||e instanceof Number?m.concat(b):e.getOwnPropertyNames()}function r(e,t){t in e||Object.defineProperty(e,t,{get:function(){return l(h.pluck(e,t))},set:function(e){if(h.isArray(e)){if(this.length!=e.length)throw f({message:"Must be same length"});for(var n=0;n<e.length;n++)this[n][t]=e[n]}else for(n=0;n<this.length;n++)this[n][t]=e}})}function o(e){return e.then&&e["catch"]}function s(e,t){t in e||(e[t]=function(){var e=arguments,n=this.map(function(n){return n[t].apply(n,e)}),i=!1;return n.length&&(i=o(n[0])),i?d.all(n):l(n)})}function a(e,t){e=h.extend([],e);var n=t._attributeNames,i=t._relationshipNames,o=n.concat(i).concat(a);o.forEach(r.bind(r,e));var a=Object.keys(p.prototype);return a.forEach(s.bind(s,e)),u(e)}function l(e){if(e.length){var t=e[0],n=i(t);n.forEach(function(n){"function"==typeof t[n]?s(e,n,arguments):r(e,n)})}return u(e)}function c(){throw new Error("Cannot modify a filter set")}function u(e){return v.forEach(function(t){e[t]=c}),e.immutable=!0,e.mutableCopy=e.asArray=function(){var e=this.map(function(e){return e});return e.asFilterSet=function(){return l(this)},e.asModelFilterSet=function(e){return a(this,e)},e},e}var h=n(1),d=h.Promise,f=n(8),p=n(9),v=["push","sort","reverse","splice","shift","unshift"],m=["toString","toExponential","toFixed","toPrecision","valueOf"],b=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],y=["charAt","charCodeAt","concat","fromCharCode","indexOf","lastIndexOf","localeCompare","match","replace","search","slice","split","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toString","toUpperCase","trim","valueOf"],_=["length"];e.exports=a},function(e,t,n){function i(e,t){var n={};for(var i in t)t.hasOwnProperty(i)&&"__"==i.slice(0,2)&&(n[i.slice(2)]=t[i],delete t[i]);s.extend(this,{model:e,filter:t,opts:n}),n.order=n.order||[],s.isArray(n.order)||(n.order=[n.order])}function r(e){if(!e.invalid){var t=e.object;if(s.isArray(t))n=s.pluck(t,e.field);else var n=t[e.field];if(s.isArray(n)||s.isString(n))return n.indexOf(e.value)>-1}return!1}function o(e){var t,n=e.context.cache._localCacheByType,i=e.name,r=e.collectionName,o=n[r];return o&&(t=o[i]||{}),t}var s=(n(5)("filter"),n(1)),a=n(8),l=(n(9),n(14)),c={e:function(e){return e.object[e.field]==e.value},ne:function(e){return e.object[e.field]!=e.value},lt:function(e){return e.invalid?!1:e.object[e.field]<e.value},gt:function(e){return e.invalid?!1:e.object[e.field]>e.value},lte:function(e){return e.invalid?!1:e.object[e.field]<=e.value},gte:function(e){return e.invalid?!1:e.object[e.field]>=e.value},contains:r,"in":r};s.extend(i,{comparators:c,registerComparator:function(e,t){c[e]||(c[e]=t)}}),s.extend(i.prototype,{execute:function(e){return s.promise(e,function(e){this._executeInMemory(e)}.bind(this))},_dump:function(e){return e?"{}":{}},sortFunc:function(e){for(var t=function(e,t){return function(n,i){var r,o=n[t],s=i[t];return"string"==typeof o||o instanceof String&&"string"==typeof s||s instanceof String?r=e?o.localeCompare(s):s.localeCompare(o):(o instanceof Date&&(o=o.getTime()),s instanceof Date&&(s=s.getTime()),r=e?o-s:s-o),r}},n=s,i=0;i<e.length;i++){var r=e[i];n=n.thenBy(t(r.ascending,r.field))}return n==s?null:n},_sortResults:function(e){var t=this.opts.order;if(e&&t){var n=t.map(function(e){var t=e.split("-"),n=!0,i=null;return t.length>1?(i=t[1],n=!1):i=t[0],{field:i,ascending:n}}.bind(this)),i=this.sortFunc(n);e.immutable&&(e=e.mutableCopy()),i&&e.sort(i)}return e},_getCacheByLocalId:function(){return this.model.descendants.reduce(function(e,t){return s.extend(e,o(t))},s.extend({},o(this.model)))},_executeInMemory:function(e){for(var t,n=this._getCacheByLocalId(),i=Object.keys(n),r=this,o=[],s=0;s<i.length;s++){var c=i[s],u=n[c],h=r.objectMatchesFilter(u);if("string"==typeof h){t=a(h);break}h&&o.push(u)}o=this._sortResults(o),e(t,t?null:l(o,this.model))},clearOrdering:function(){this.opts.order=null},objectMatchesOrFilter:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if(this.objectMatchesBaseFilter(e,i))return!0}return!1},objectMatchesAndFilter:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];if(!this.objectMatchesBaseFilter(e,i))return!1}return!0},splitMatches:function(e,t,n){var r="e",o=t.split("."),a=o[o.length-1].split("__");if(2==a.length){var l=a[0];r=a[1]}else l=a[0];o[o.length-1]=l,o.slice(0,o.length-1).forEach(function(t){e=s.isArray(e)?s.pluck(e,t):e[t]});var c=void 0!=e;if(c){if(s.isArray(e));else var u=e[l],h=s.isArray(u)?!1:null===u||void 0===u;var d=i.comparators[r],f={object:e,field:l,value:n,invalid:h};return d?d(f):'No comparator registered for filter operation "'+r+'"'}return!1},objectMatches:function(e,t,n,i){if("$or"==t){var r=i.$or;if(s.isArray(r)||(r=Object.keys(r).map(function(e){var t={};return t[e]=r[e],t})),!this.objectMatchesOrFilter(e,r))return!1}else if("$and"==t){if(!this.objectMatchesAndFilter(e,i.$and))return!1}else{var o=this.splitMatches(e,t,n);if("boolean"!=typeof o)return o;if(!o)return!1}return!0},objectMatchesBaseFilter:function(e,t){for(var n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],o=t[r],s=this.objectMatches(e,r,o,t);if("boolean"!=typeof s)return s;if(!s)return!1}return!0},objectMatchesFilter:function(e){return this.objectMatchesBaseFilter(e,this.filter)}}),e.exports=i},function(e,t,n){function i(e){r.call(this,e),this.related=[],this.relatedCancelListeners={},this.isReverse&&(this.related=[])}var r=n(19),o=n(1),s=n(4),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;i.prototype=Object.create(r.prototype),o.extend(i.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e),i=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splice(i,1)})})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.makeChangesToRelatedWithoutObservations(function(){n.splice(0,0,t.object)})})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var i=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],r=n.removed;t.clearReverse(r),t.setReverseOfAdded(i);var o=t.getForwardModel();o.context.broadcast({collection:o.collectionName,model:o.name,localId:t.object.localId,field:t.getForwardName(),removed:r,added:i,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){return"[object Array]"!=Object.prototype.toString.call(e)?"Cannot assign scalar to many to many":null},set:function(e,t){this.checkInstalled();var n=this;if(e){var i;if(i=this.validate(e))return i;this.clearReverseRelated(t),n.setIdAndRelated(e,t),this.wrapArray(e),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){r.prototype.install.call(this,e),this.wrapArray(this.related),e["splice"+o.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this)},registerRemovalListener:function(e){this.relatedCancelListeners[e.localId]=e.on("*",function(){}.bind(this))}}),e.exports=i},function(e,t,n){function i(e){r.call(this,e),this.isReverse&&(this.related=[])}var r=n(19),o=n(1),s=n(4),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;i.prototype=Object.create(r.prototype),o.extend(i.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(null)})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(t.object)})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var i=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],r=n.removed;t.clearReverse(r),t.setReverseOfAdded(i);var o=t.getForwardModel();o.context.broadcast({collection:o.collectionName,model:o.name,localId:t.object.localId,field:t.getForwardName(),removed:r,added:i,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){var t=Object.prototype.toString.call(e);if(this.isForward){if("[object Array]"==t)return"Cannot assign array forward oneToMany ("+t+"): "+this.forwardName}else if("[object Array]"!=t)return"Cannot scalar to reverse oneToMany ("+t+"): "+this.reverseName;return null},set:function(e,t){this.checkInstalled();var n=this;if(e){var i;if(i=this.validate(e))return i;this.clearReverseRelated(t),n.setIdAndRelated(e,t),n.isReverse&&this.wrapArray(n.related),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){r.prototype.install.call(this,e),this.isReverse&&(e["splice"+o.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this),this.wrapArray(this.related))}}),e.exports=i},function(e,t,n){function i(e){r.call(this,e)}{var r=n(19),o=n(1);n(9)}i.prototype=Object.create(r.prototype),o.extend(i.prototype,{validate:function(e){return"[object Array]"==Object.prototype.toString.call(e)?"Cannot assign array to one to one relationship":null},set:function(e,t){if(this.checkInstalled(),e){var n;if(n=this.validate(e))return n;this.clearReverseRelated(t),this.setIdAndRelated(e,t),this.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),this.setIdAndRelated(e,t)},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))}}),e.exports=i},function(e,t,n){function i(e){var t=this;e=e||{},o.extend(this,{object:null,related:null}),Object.defineProperties(this,{isForward:{get:function(){return!t.isReverse},set:function(e){t.isReverse=!e},enumerable:!0}}),o.extendFromOpts(this,e,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null,serialise:null},!1),this.cancelListens={}}var r=n(8).InternalSiestaError,o=n(1),s=(n(15),n(5),n(4)),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;o.extend(i,{}),o.extend(i.prototype,{install:function(e){if(!e)throw new r("No object passed to relationship install");if(this.object)throw new r("Already installed.");this.object=e;var t=this,n=this.getForwardName();e.__proxies[n]||(Object.defineProperty(e,n,{get:function(){return t.related},set:function(e){t.set(e)},configurable:!0,enumerable:!0}),e.__proxies[n]=this,e._proxies.push(this))}}),o.extend(i.prototype,{set:function(){throw new r("Must subclass RelationshipProxy")},get:function(){throw new r("Must subclass RelationshipProxy")}}),o.extend(i.prototype,{proxyForInstance:function(e,t){var n,i=t?this.getReverseName():this.getForwardName(),s=t?this.reverseModel:this.forwardModel;if(o.isArray(e))n=e.map(function(e){return e.__proxies[i]});else{var a=e.__proxies,l=a[i];if(!l){var c='No proxy with name "'+i+'" on mapping '+s.name;throw new r(c)}n=l}return n},reverseProxyForInstance:function(e){return this.proxyForInstance(e,!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},setIdAndRelated:function(e,t){if(t=t||{},!t.disableevents)var n=this._getOldValueForSetChangeEvent();this.related=e?o.isArray(e)?e:e:null,t.disableevents||this.registerSetChange(e,n)},checkInstalled:function(){if(!this.object)throw new r("Proxy must be installed on an object before can use it.")},splicer:function(e){return e=e||{},function(t,n){if(e=e||{},!e.disableevents)var i=this._getAddedForSpliceChangeEvent(arguments),r=this._getRemovedForSpliceChangeEvent(t,n);var o=Array.prototype.slice.call(arguments,2),s=this.related.splice.bind(this.related,t,n).apply(this.related,o);return e.disableevents||this.registerSpliceChange(t,i,r),s}.bind(this)},clearReverseRelated:function(e){e=e||{};var t=this;if(this.related){var n=this.reverseProxyForInstance(this.related),i=o.isArray(n)?n:[n];i.forEach(function(n){if(o.isArray(n.related)){var i=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splicer(e)(i,1)})}else n.setIdAndRelated(null,e)})}},setIdAndRelatedReverse:function(e,t){var n=this,i=this.reverseProxyForInstance(e),r=o.isArray(i)?i:[i];r.forEach(function(e){o.isArray(e.related)?e.makeChangesToRelatedWithoutObservations(function(){e.splicer(t)(e.related.length,0,n.object)}):(e.clearReverseRelated(t),e.setIdAndRelated(n.object,t))})},makeChangesToRelatedWithoutObservations:function(e){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,e(),this.wrapArray(this.related)):e()},_getOldValueForSetChangeEvent:function(){var e=this.related;return o.isArray(e)&&!e.length&&(e=null),e},registerSetChange:function(e,t){var n=this.object;if(!n)throw new r("Proxy must have an object associated");var i=n.model,o=i.name,s=n.collectionName;i.context.broadcast({collection:s,model:o,localId:n.localId,field:this.getForwardName(),old:t,"new":e,type:c.Set,obj:n})},_getRemovedForSpliceChangeEvent:function(e,t){return this.related?this.related.slice(e,e+t):null},_getAddedForSpliceChangeEvent:function(e){var t=Array.prototype.slice.call(e,2);return t.length?t:[]},registerSpliceChange:function(e,t,n){var i=this.object.model,r=i.name,o=this.object.collectionName;i.context.broadcast({collection:o,model:r,localId:this.object.localId,field:this.getForwardName(),index:e,removed:n,added:t,type:c.Splice,obj:this.object})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var i=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],r=t.getForwardModel();r.context.broadcast({collection:r.collectionName,model:r.name,localId:t.object.localId,field:t.getForwardName(),removed:n.removed,added:i,type:c.Splice,obj:t.object})})};e.arrayObserver.open(n)}},splice:function(){this.splicer({}).apply(this,arguments)}}),e.exports=i},function(e){e.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},function(e,t,n){function i(e,t){if(!window.PouchDB)throw new Error('Cannot enable storage for app "'+n+'" as PouchDB is not present.');t=t||{};var n=e.name;this.context=e,this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},Object.defineProperties(this,{_unsavedObjects:{get:function(){return this.unsavedObjects}},_unsavedObjectsHash:{get:function(){return this.unsavedObjectsHash}},_unsavedObjectsByCollection:{get:function(){return this.unsavedObjectsByCollection}},_pouch:{get:function(){return this.pouch}}}),this.pouch=t.pouch||new PouchDB(n,{auto_compaction:!0})}var r=n(1),o=(n(8),n(5)("storage")),s=/_/g,a=/@/g;i.prototype={save:function(e){return r.promise(e,function(e){this.context._ensureInstalled(function(t){if(t)e(t);else{var n=this.unsavedObjects;this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},this.saveToPouch(n,e)}}.bind(this))}.bind(this))},saveToPouch:function(e,t){var n=[],i=e.map(this._serialise.bind(this));this.pouch.bulkDocs(i).then(function(i){for(var r=0;r<i.length;r++){var s=i[r],a=e[r];s.ok?a._rev=s.rev:409==s.status?n.push(a):o('Error saving object with localId="'+a.localId+'"',s)}n.length?this.saveConflicts(n,t):t()},function(e){t(e)})},saveConflicts:function(e,t){this.pouch.allDocs({keys:r.pluck(e,"localId")}).then(function(n){for(var i=0;i<n.rows.length;i++)e[i]._rev=n.rows[i].value.rev;this.saveToPouch(e,t)})["catch"](function(e){t(e)})},ensureIndexInstalled:function(e,t){function n(n){var i;n.ok||409==n.status&&(i=null,e.indexInstalled=!0),t(i)}this.pouch.put(this.constructIndexDesignDoc(e.collectionName,e.name)).then(n)["catch"](n)},loadModel:function(e,t){var n={},i=e.collectionName,o=e.modelName,s=e.model;s&&(i=s.collectionName,o=s.name);var a=this.fullyQualifiedModelName(i,o),l=this.context.collections[i][o];return l?void this.pouch.query(a).then(function(e){var i=e.rows,o=r.pluck(i,"value").map(function(e){return this._prepareDatum(e,l)}.bind(this));o.map(function(e){var t=e[l.id];t&&(n[t]?console.error("Duplicates detected in storage. You have encountered a serious bug. Please report this."):n[t]=e)}),l._graph(o,{_ignoreInstalled:!0,disableevents:!0,fromStorage:!0},function(e,n){e?console.error("Error loading models",e):(console.log("binding listener"),this._listener=this.listener.bind(this),s.on("*",this._listener)),t(e,n)}.bind(this))}.bind(this))["catch"](function(e){t(e)}):void t('No such model with name "'+o+'" in context.')},_prepareDatum:function(e,t){this._processMeta(e),delete e.collection,delete e.model,e.localId=e._id,delete e._id;var n={};Object.keys(e).forEach(function(t){n[t.replace(a,"_")]=e[t]});var i=t._relationshipNames;return i.forEach(function(e){var t=n[e];t&&(n[e]=siesta.isArray(t)?t.map(function(e){return{localId:e}}):{localId:t})}),n},_processMeta:function(e){var t=e.siesta_meta||this._initMeta();t.dateFields.forEach(function(t){var n=e[t];n instanceof Date||(e[t]=new Date(n))}),delete e.siesta_meta},_initMeta:function(){return{dateFields:[]}},_addMeta:function(e){e.siesta_meta=this._initMeta();for(var t in e)e.hasOwnProperty(t)&&e[t]instanceof Date&&(e.siesta_meta.dateFields.push(t),e[t]=e[t].getTime())},listener:function(e){var t=e.obj,n=t.localId;if(!t)throw new Error("No obj field in notification received by storage extension");if(!(n in this.unsavedObjectsHash)){this.unsavedObjectsHash[n]=t,this.unsavedObjects.push(t);var i=t.collectionName;this.unsavedObjectsByCollection[i]||(this.unsavedObjectsByCollection[i]={});var r=t.model.name;this.unsavedObjectsByCollection[i][r]||(this.unsavedObjectsByCollection[i][r]={}),this.unsavedObjectsByCollection[i][r][n]=t}},_reset:function(e,t){this._listener&&this.context.removeListener("Siesta",this._listener),this.unsavedObjects=[],this.unsavedObjectsHash={};var n=this.pouch;n.allDocs().then(function(n){var i=n.rows.map(function(e){return{_id:e.id,_rev:e.value.rev,_deleted:!0}});this.pouch.bulkDocs(i).then(function(){t&&(this.pouch=t),e()}.bind(this))["catch"](e)}.bind(this))["catch"](e)},_serialise:function(e){var t={},n=e.__values;t=r.extend(t,n),Object.keys(t).forEach(function(e){t[e.replace(s,"@")]=n[e]}),this._addMeta(t),t.collection=e.collectionName,t.model=e.modelName,t._id=e.localId,e.removed&&(t._deleted=!0);var i=e._rev;return i&&(t._rev=i),t=e._relationshipNames.reduce(function(t,n){var i=e[n];return siesta.isArray(i)?t[n]=r.pluck(i,"localId"):i&&(t[n]=i.localId),t},t)},constructIndexDesignDoc:function(e,t){var n=this.fullyQualifiedModelName(e,t),i={};return i[n]={map:function(e){"$1"==e.collection&&"$2"==e.model&&emit(e.collection+"."+e.model,e)}.toString().replace("$1",e).replace("$2",t)},{_id:"_design/"+n,views:i}},fullyQualifiedModelName:function(e,t){return e+"."+t}},e.exports=i},function(e){var t,n=Object.prototype.hasOwnProperty,i=Object.prototype.toString,r=function(e){"use strict";if(!e||"[object Object]"!==i.call(e)||e.nodeType||e.setInterval)return!1;var r=n.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!o)return!1;var s;for(s in e);return s===t||n.call(e,s)};e.exports=function o(){"use strict";var e,n,i,s,a,l,c=arguments[0],u=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},u=2):("object"!=typeof c&&"function"!=typeof c||c==t)&&(c={});h>u;++u)if(null!=(e=arguments[u]))for(n in e)i=c[n],s=e[n],c!==s&&(d&&s&&(r(s)||(a=Array.isArray(s)))?(a?(a=!1,l=i&&Array.isArray(i)?i:[]):l=i&&r(i)?i:{},c[n]=o(d,l,s)):s!==t&&(c[n]=s));return c}},function(module,exports,__webpack_require__){(function(global,module){!function(global){"use strict";function detectObjectObserve(){function e(e){t=e}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var t=[],n={},i=[];return Object.observe(n,e),Array.observe(i,e),n.id=1,n.id=2,delete n.id,i.push(1,2),i.length=0,Object.deliverChangeRecords(e),5!==t.length?!1:"add"!=t[0].type||"update"!=t[1].type||"delete"!=t[2].type||"splice"!=t[3].type||"splice"!=t[4].type?!1:(Object.unobserve(n,e),Array.unobserve(i,e),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if(navigator.getDeviceStorage)return!1;try{var e=new Function("","return true;");return e()}catch(t){return!1}}function isIndex(e){return+e===e>>>0&&""!==e}function toNumber(e){return+e}function dirtyCheck(e){for(var t=0;MAX_DIRTY_CHECK_CYCLES>t&&e.check_();)t++;return testingExposeCycleCount&&(global.dirtyCheckCycleCount=t),t>0}function objectIsEmpty(e){for(var t in e)return!1;return!0}function diffIsEmpty(e){return objectIsEmpty(e.added)&&objectIsEmpty(e.removed)&&objectIsEmpty(e.changed)}function diffObjectFromOldObject(e,t){var n={},i={},r={};for(var o in t){var s=e[o];(void 0===s||s!==t[o])&&(o in e?s!==t[o]&&(r[o]=s):i[o]=void 0)}for(var o in e)o in t||(n[o]=e[o]);return Array.isArray(e)&&e.length!==t.length&&(r.length=e.length),{added:n,removed:i,changed:r}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var e=0;e<eomTasks.length;e++)eomTasks[e]();return eomTasks.length=0,!0}function newObservedObject(){function e(e){t&&t.state_===OPENED&&!i&&t.check_(e)}var t,n,i=!1,r=!0;return{open:function(n){if(t)throw Error("ObservedObject in use");r||Object.deliverChangeRecords(e),t=n,r=!1},observe:function(t,i){n=t,i?Array.observe(n,e):Object.observe(n,e)},deliver:function(t){i=t,Object.deliverChangeRecords(e),i=!1},close:function(){t=void 0,Object.unobserve(n,e),observedObjectCache.push(this)}}}function getObservedObject(e,t,n){var i=observedObjectCache.pop()||newObservedObject();return i.open(e),i.observe(t,n),i}function newObservedSet(){function e(t,o){t&&(t===i&&(r[o]=!0),a.indexOf(t)<0&&(a.push(t),Object.observe(t,n)),e(Object.getPrototypeOf(t),o))}function t(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.object!==i||r[n.name]||"setPrototype"===n.type)return!1}return!0}function n(n){if(!t(n)){for(var i,r=0;r<s.length;r++)i=s[r],i.state_==OPENED&&i.iterateObjects_(e);for(var r=0;r<s.length;r++)i=s[r],i.state_==OPENED&&i.check_()}}var i,r,o=0,s=[],a=[],l={object:void 0,objects:a,open:function(t,n){i||(i=n,r={}),s.push(t),o++,t.iterateObjects_(e)},close:function(){if(o--,!(o>0)){for(var e=0;e<a.length;e++)Object.unobserve(a[e],n),Observer.unobservedCount++;s.length=0,a.length=0,i=void 0,r=void 0,observedSetCache.push(this)}}};return l}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(e){Observer._allObserversCount++,collectObservers&&allObservers.push(e)}function removeFromAll(){Observer._allObserversCount--}function ObjectObserver(e){Observer.call(this),this.value_=e,this.oldObject_=void 0}function ArrayObserver(e){if(!Array.isArray(e))throw Error("Provided object is not an Array");ObjectObserver.call(this,e)}function diffObjectFromChangeRecords(e,t,n){for(var i={},r={},o=0;o<t.length;o++){var s=t[o];expectedRecordTypes[s.type]?(s.name in n||(n[s.name]=s.oldValue),"update"!=s.type&&("add"!=s.type?s.name in i?(delete i[s.name],delete n[s.name]):r[s.name]=!0:s.name in r?delete r[s.name]:i[s.name]=!0)):(console.error("Unknown changeRecord type: "+s.type),console.error(s))}for(var a in i)i[a]=e[a];for(var a in r)r[a]=void 0;var l={};for(var a in n)if(!(a in i||a in r)){var c=e[a];n[a]!==c&&(l[a]=c)}return{added:i,removed:r,changed:l}}function newSplice(e,t,n){return{index:e,removed:t,addedCount:n}}function ArraySplice(){}function calcSplices(e,t,n,i,r,o){return arraySplice.calcSplices(e,t,n,i,r,o)}function intersect(e,t,n,i){return n>t||e>i?-1:t==n||i==e?0:n>e?i>t?t-n:i-n:t>i?i-e:t-e}function mergeSplice(e,t,n,i){for(var r=newSplice(t,n,i),o=!1,s=0,a=0;a<e.length;a++){var l=e[a];if(l.index+=s,!o){var c=intersect(r.index,r.index+r.removed.length,l.index,l.index+l.addedCount);if(c>=0){e.splice(a,1),a--,s-=l.addedCount-l.removed.length,r.addedCount+=l.addedCount-c;var u=r.removed.length+l.removed.length-c;if(r.addedCount||u){var n=l.removed;if(r.index<l.index){var h=r.removed.slice(0,l.index-r.index);Array.prototype.push.apply(h,n),n=h}if(r.index+r.removed.length>l.index+l.addedCount){var d=r.removed.slice(l.index+l.addedCount-r.index);Array.prototype.push.apply(n,d)}r.removed=n,l.index<r.index&&(r.index=l.index)}else o=!0}else if(r.index<l.index){o=!0,e.splice(a,0,r),a++;var f=r.addedCount-r.removed.length;l.index+=f,s+=f}}}o||e.push(r)}function createInitialSplices(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i];switch(r.type){case"splice":mergeSplice(n,r.index,r.removed.slice(),r.addedCount);break;case"add":case"update":case"delete":if(!isIndex(r.name))continue;var o=toNumber(r.name);if(0>o)continue;mergeSplice(n,o,[r.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(r))}}return n}function projectArraySplices(e,t){var n=[];return createInitialSplices(e,t).forEach(function(t){return 1==t.addedCount&&1==t.removed.length?void(t.removed[0]!==e[t.index]&&n.push(t)):void(n=n.concat(calcSplices(e,t.index,t.index+t.addedCount,t.removed,0,t.removed.length)))}),n}var testingExposeCycleCount=global.testingExposeCycleCount,hasObserve=detectObjectObserve(),hasEval=detectEval(),numberIsNaN=global.Number.isNaN||function(e){return"number"==typeof e&&global.isNaN(e)},createObject="__proto__"in{}?function(e){return e}:function(e){var t=e.__proto__;if(!t)return e;var n=Object.create(t);return Object.getOwnPropertyNames(e).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),n},identStart="[$_a-zA-Z]",identPart="[$_a-zA-Z0-9]",MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var e={pingPong:!0},t=!1;return Object.observe(e,function(){runEOMTasks(),t=!1}),function(n){eomTasks.push(n),t||(t=!0,e.pingPong=!e.pingPong)
}}():function(){return function(e){eomTasks.push(e)}}(),observedObjectCache=[],observedSetCache=[],lastObservedSet,UNOPENED=0,OPENED=1,CLOSED=2,nextObserverId=1;Observer.prototype={open:function(e,t){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=e,this.target_=t,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)},report_:function(e){try{this.callback_.apply(this.target_,e)}catch(t){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(t.stack||t))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(e){var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=e[n];return Array.isArray(e)&&(t.length=e.length),t},check_:function(e){var t,n;if(hasObserve){if(!e)return!1;n={},t=diffObjectFromChangeRecords(this.value_,e,n)}else n=this.oldObject_,t=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(t)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t.added||{},t.removed||{},t.changed||{},function(e){return n[e]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:!0,copyObject:function(e){return e.slice()},check_:function(e){var t;if(hasObserve){if(!e)return!1;t=projectArraySplices(this.value_,e)}else t=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return t&&t.length?(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t]),!0):!1}}),ArrayObserver.applySplices=function(e,t,n){n.forEach(function(n){for(var i=[n.index,n.removed.length],r=n.index;r<n.index+n.addedCount;)i.push(t[r]),r++;Array.prototype.splice.apply(e,i)})};var observerSentinel={},expectedRecordTypes={add:!0,update:!0,"delete":!0},EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;ArraySplice.prototype={calcEditDistances:function(e,t,n,i,r,o){for(var s=o-r+1,a=n-t+1,l=new Array(s),c=0;s>c;c++)l[c]=new Array(a),l[c][0]=c;for(var u=0;a>u;u++)l[0][u]=u;for(var c=1;s>c;c++)for(var u=1;a>u;u++)if(this.equals(e[t+u-1],i[r+c-1]))l[c][u]=l[c-1][u-1];else{var h=l[c-1][u]+1,d=l[c][u-1]+1;l[c][u]=d>h?h:d}return l},spliceOperationsFromEditDistances:function(e){for(var t=e.length-1,n=e[0].length-1,i=e[t][n],r=[];t>0||n>0;)if(0!=t)if(0!=n){var o,s=e[t-1][n-1],a=e[t-1][n],l=e[t][n-1];o=l>a?s>a?a:s:s>l?l:s,o==s?(s==i?r.push(EDIT_LEAVE):(r.push(EDIT_UPDATE),i=s),t--,n--):o==a?(r.push(EDIT_DELETE),t--,i=a):(r.push(EDIT_ADD),n--,i=l)}else r.push(EDIT_DELETE),t--;else r.push(EDIT_ADD),n--;return r.reverse(),r},calcSplices:function(e,t,n,i,r,o){var s=0,a=0,l=Math.min(n-t,o-r);if(0==t&&0==r&&(s=this.sharedPrefix(e,i,l)),n==e.length&&o==i.length&&(a=this.sharedSuffix(e,i,l-s)),t+=s,r+=s,n-=a,o-=a,n-t==0&&o-r==0)return[];if(t==n){for(var c=newSplice(t,[],0);o>r;)c.removed.push(i[r++]);return[c]}if(r==o)return[newSplice(t,[],n-t)];for(var u=this.spliceOperationsFromEditDistances(this.calcEditDistances(e,t,n,i,r,o)),c=void 0,h=[],d=t,f=r,p=0;p<u.length;p++)switch(u[p]){case EDIT_LEAVE:c&&(h.push(c),c=void 0),d++,f++;break;case EDIT_UPDATE:c||(c=newSplice(d,[],0)),c.addedCount++,d++,c.removed.push(i[f]),f++;break;case EDIT_ADD:c||(c=newSplice(d,[],0)),c.addedCount++,d++;break;case EDIT_DELETE:c||(c=newSplice(d,[],0)),c.removed.push(i[f]),f++}return c&&h.push(c),h},sharedPrefix:function(e,t,n){for(var i=0;n>i;i++)if(!this.equals(e[i],t[i]))return i;return n},sharedSuffix:function(e,t,n){for(var i=e.length,r=t.length,o=0;n>o&&this.equals(e[--i],t[--r]);)o++;return o},calculateSplices:function(e,t){return this.calcSplices(e,0,e.length,t,0,t.length)},equals:function(e,t){return e===t}};var arraySplice=new ArraySplice,expose=global;"undefined"!=typeof module&&module.exports&&(expose=exports=module.exports),expose=exports,expose.Observer=Observer,expose.Observer.runEOM_=runEOM,expose.Observer.observerSentinel_=observerSentinel,expose.Observer.hasObjectObserve=hasObserve,expose.ArrayObserver=ArrayObserver,expose.ArrayObserver.calculateSplices=function(e,t){return arraySplice.calculateSplices(e,t)},expose.Platform=global.Platform,expose.ArraySplice=ArraySplice,expose.ObjectObserver=ObjectObserver}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window)}).call(exports,function(){return this}(),__webpack_require__(35)(module))},function(e){function t(e){this.okCallbacks=[],this.errorCallbacks=[],this.resolved=null,this.rejected=null,this.isResolved=!1,this.isRejected=!1;var t=function(e){if(!this.resolved&&!this.rejected){this.resolved=e,this.isResolved=!0;for(var t=0;t<this.okCallbacks.length;t++){var n=this.okCallbacks[t];n(e)}}}.bind(this),n=function(e){if(!this.resolved&&!this.rejected){this.rejected=e,this.isRejected=!0;for(var t=0;t<this.errorCallbacks.length;t++){var n=this.errorCallbacks[t];n(e)}}}.bind(this);e&&e(t,n)}t.all=function(e){return new t(function(t,n){function i(){o+s==r&&(s?n(l):t(a))}var r=e.length;if(r){var o=0,s=0,a=[],l=[];e.forEach(function(e,t){e.then(function(e){a[t]=e,o++,i()},function(e){l[t]=e,s++,i()})})}else t([])})},t.prototype={then:function(e,t){return this.isResolved?e&&e(this.resolved):this.isRejected?t&&t(this.rejected):(e&&this.okCallbacks.push(e),t&&this.errorCallbacks.push(t)),this},"catch":function(e){return this.isRejected?e&&e(this.rejected):e&&this.errorCallbacks.push(e),this}},e.exports=t},function(e,t,n){function i(e){this.opts=e}var r=n(31);i.prototype={_handlerLink:function(e){var t;return t=function(){var n=e.type;e.fn&&this._removeListener(e.fn,n),t._parentLink&&t._parentLink()}.bind(this),Object.keys(this.opts).forEach(function(e){var n=this.opts[e];t[e]=r(function(e){var i=n.apply(n.__siesta_bound_object,e);return i._parentLink=t,i}.bind(this))}.bind(this)),t._parentLink=null,t},_link:function(e,t){var n=this;t=t||function(){};var i;return i=function(){t(),i._parentLink&&i._parentLink()}.bind(this),i.__siesta_isLink=!0,i.opts=e,i.clean=t,Object.keys(e).forEach(function(t){var o=e[t];i[t]=r(function(e){var t=o.apply(o.__siesta_bound_object,e);if(t&&t.__siesta_isLink)var r=t;else{r=n._link(i.opts);for(var s in t)t[s]instanceof Function&&(r[s]=t[s])}r._parentLink=i;for(s in i)i[s]instanceof Function&&(r[s]=i[s].bind(i));return r}.bind(this))}.bind(this)),i._parentLink=null,i}},e.exports=i},function(e,t,n){function i(){this.reset(),Object.defineProperty(this,"_localCacheByType",{get:function(){return this.local}})}var r=n(5)("cache"),o=n(8).InternalSiestaError,s=n(1);i.prototype={reset:function(){this.remote={},this.localById={},this.local={}},getViaLocalId:function(e){return s.isArray(e)?e.map(function(e){return this.localById[e]}.bind(this)):this.localById[e]},getViaRemoteId:function(e,t){var n=(this.remote[t.model.collectionName]||{})[t.model.name]||{};return s.isArray(e)?e.map(function(e){return n[e]}):n[e]},getSingleton:function(e){var t=e.name,n=e.collectionName,i=this.local[n];if(i){var r=i[t];if(r){var s=[];for(var a in r)r.hasOwnProperty(a)&&s.push(r[a]);if(s.length>1){var l="A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.";throw new o(l)}if(s.length)return s[0]}}return null},remoteInsert:function(e,t,n){if(!e){var i="Must pass an object when inserting to cache";throw r(i),new o(i)}var s=e.model.collectionName;if(!s)throw new o("Model has no collection",{model:e.model,obj:e});this.remote[s]||(this.remote[s]={});var a=e.model.name;if(!a)throw new o("Model has no type",{model:e.model,obj:e});this.remote[s][a]||(this.remote[s][a]={}),n&&(this.remote[s][a][n]=null);var l=this.remote[s][a][t];if(l){if(e!=l){var c="Object "+s.toString()+":"+a.toString()+"["+e.model.id+'="'+t+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild';throw r(c,{obj:e,cachedObject:l}),new o(c)}}else this.remote[s][a][t]=e,r("Remote cache insert: "+e._dump(!0))},get:function(e){r("get",e);var t,n,i,o=e.localId;if(o)return t=this.getViaLocalId(o),t?t:e.model?(n=e.model.id,i=e[n],r(n+"="+i),this.getViaRemoteId(i,e)):null;if(e.model){if(n=e.model.id,i=e[n])return this.getViaRemoteId(i,e);if(e.model.singleton)return this.getSingleton(e.model)}else r("Invalid opts to cache",{opts:e});return null},_remoteCache:function(){return this.remote},_localCache:function(){return this.localById},insert:function(e){var t=e.localId;if(t){var n=e.model.collectionName,i=e.model.name;if(this.localById[t]){if(this.localById[t]!=e){var s='Object with localId="'+t.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild';throw r(s),new o(s)}}else this.localById[t]=e,this.local[n]||(this.local[n]={}),this.local[n][i]||(this.local[n][i]={}),this.local[n][i][t]=e}var a=e.idField,l=e[a];l?this.remoteInsert(e,l):r('No remote id ("'+a+'") so wont be placing in the remote cache',e)},contains:function(e){var t={localId:e.localId},n=e.model;return n.id&&e[n.id]&&(t.model=n,t[n.id]=e[n.id]),!!this.get(t)},remove:function(e){if(this.contains(e)){var t=e.model.collectionName,n=e.model.name,i=e.localId;if(!n)throw o("No mapping name");if(!t)throw o("No collection name");if(!i)throw o("No localId");if(delete this.local[t][n][i],delete this.localById[i],e.model.id){var r=e[e.model.id];r&&delete this.remote[t][n][r]}}},count:function(){return Object.keys(this.localById).length}},e.exports=i},function(e,t,n){function i(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function r(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var i="color: "+this.color;e=[e[0],i,"color: inherit"].concat(Array.prototype.slice.call(e,1));var r=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(o=r))}),e.splice(o,0,i),e}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?l.removeItem("debug"):l.debug=e}catch(t){}}function a(){var e;try{e=l.debug}catch(t){}return e}t=e.exports=n(34),t.log=o,t.formatArgs=r,t.save=s,t.load=a,t.useColors=i;var l;l="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:window.localStorage,t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(a())},function(e,t,n){function i(e){r.extend(this,e||{}),this.isPlaceholder=!0}var r=n(1);e.exports=i},function(e,t,n){function i(e){this.model=e}var r=n(5)("model"),o=n(8).InternalSiestaError,s=n(20),a=(n(15),n(9)),l=n(1),c=l.guid,u=(n(22),n(4)),h=u.wrapArray,d=n(17),f=n(18),p=n(16),v=(n(2),u.ModelEventType);i.prototype={_getLocalId:function(e){var t;return t=e&&e.localId?e.localId:c()},_installAttributes:function(e,t){var n=this.model,i=n._attributeNames,r=i.indexOf(n.id);l.extend(e,{__values:l.extend(n.attributes.reduce(function(e,t){return void 0!==t["default"]&&(e[t.name]=t["default"]),e},{}),t||{})}),r>-1&&i.splice(r,1),i.forEach(function(t){var i=n._attributeDefinitionWithName(t);Object.defineProperty(e,t,{get:function(){var n=e.__values[t];return void 0===n?null:n},set:function(r){i.parse&&(r=i.parse.call(e,r)),n.parseAttribute&&(r=n.parseAttribute.call(e,t,r));var o=e.__values[t],s=this._propertyDependencies[t]||[];s=s.map(function(t){try{var n=this[t]}catch(i){throw console.error('Uncaught error during property access for model "'+e.model.name+'"',i),i}return{prop:t,old:n}}.bind(this)),e.__values[t]=r,s.forEach(function(t){var i=t.prop,r=this[i];n.context.broadcast({collection:n.collectionName,model:n.name,localId:e.localId,"new":r,old:t.old,type:v.Set,field:i,obj:e})}.bind(this));var a={collection:n.collectionName,model:n.name,localId:e.localId,"new":r,old:o,type:v.Set,field:t,obj:e};window.lastEmission=a,n.context.broadcast(a),l.isArray(r)&&h(r,t,e)},enumerable:!0,configurable:!0})})},_installMethods:function(e){var t=this.model;Object.keys(t.methods).forEach(function(n){void 0===e[n]?e[n]=t.methods[n].bind(e):r('A method with name "'+n+'" already exists. Ignoring it.')}.bind(this))},_installProperties:function(e){var t=Object.keys(this.model.properties),n={};t.forEach(function(t){var i=this.model.properties[t],o=i.dependencies||[];o.forEach(function(e){n[e]||(n[e]=[]),n[e].push(t)}),delete i.dependencies,void 0===e[t]?Object.defineProperty(e,t,i):r('A property/method with name "'+t+'" already exists. Ignoring it.')}.bind(this)),e._propertyDependencies=n},_installRemoteId:function(e){var t=this.model,n=t.context.cache,i=t.id;Object.defineProperty(e,i,{get:function(){return e.__values[t.id]||null},set:function(i){var r=e[t.id];e.__values[t.id]=i,t.context.broadcast({collection:t.collectionName,model:t.name,localId:e.localId,"new":i,old:r,type:v.Set,field:t.id,obj:e}),n.remoteInsert(e,i,r)},enumerable:!0,configurable:!0})},_installRelationship:function(e,t){var n,i=e.type;if(i==s.OneToMany)n=new d(e);else if(i==s.OneToOne)n=new f(e);else{if(i!=s.ManyToMany)throw new o("No such relationship type: "+i);n=new p(e)}n.install(t)},_installRelationshipProxies:function(e){var t=this.model;for(var n in t.relationships)if(t.relationships.hasOwnProperty(n)){var i=l.extend({},t.relationships[n]);this._installRelationship(i,e)}},_registerInstance:function(e,t){var n=this.model.context.cache;n.insert(e),t=void 0===t?!0:t,t&&e._emitNew()},_installLocalId:function(e,t){e.localId=this._getLocalId(t)},_instance:function(e,t){var n=new a(this.model);return this._installLocalId(n,e),this._installAttributes(n,e),this._installMethods(n),this._installProperties(n),this._installRemoteId(n),this._installRelationshipProxies(n),this._registerInstance(n,t),n}},e.exports=i},function(e,t,n){function i(e,t){(void 0===t||null===t)&&(this.lazy=!0),this._fn=e||function(e){e()},this.reset()}var r=n(1),o=n(24),s=n(31);i.all=s(function(e){return new i(e)}),i.prototype={_execute:function(){if(!this.executed){var e=r.pluck(this.dependent,"_promise");o.all(e).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()})}},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){this._promise=new o(function(e,t){this.reject=t,this.resolve=e,this.fn=function(){this.executed=!0;var n=0,i=[],o=[];if(r.isArray(this._fn)){var s=function(){n==this._fn.length&&(o.length?t(o):e(i))}.bind(this);this._fn.forEach(function(e,t){e.then(function(e){i[t]=e,n++,s()}.bind(this))["catch"](function(e){o[t]=e,n++,s()}.bind(this))})}else this._fn(function(n,i){n?t(n):e(i)}.bind(this))}.bind(this)}.bind(this)),this.lazy||this._execute(),this.executed=!1,this.dependent=[]}},e.exports=i},function(e){"use strict";function t(e){return function(){var t=arguments.length;if(t){for(var n=[],i=-1;++i<t;)n[i]=arguments[i];return e.call(this,n)}return e.call(this,[])}}e.exports=t},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!i(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,i,s,a,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],o(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,a=new Array(s-1),l=1;s>l;l++)a[l-1]=arguments[l];i.apply(this,a)}else if(r(i)){for(s=arguments.length,a=new Array(s-1),l=1;s>l;l++)a[l-1]=arguments[l];for(c=i.slice(),s=c.length,l=0;s>l;l++)c[l].apply(this,a)}return!0},t.prototype.addListener=function(e,i){var s;if(!n(i))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(i.listener)?i.listener:i),this._events[e]?r(this._events[e])?this._events[e].push(i):this._events[e]=[this._events[e],i]:this._events[e]=i,r(this._events[e])&&!this._events[e].warned){var s;s=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var r=!1;return i.listener=t,this.on(e,i),this},t.prototype.removeListener=function(e,t){var i,o,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,o=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(a=s;a-->0;)if(i[a]===t||i[a].listener&&i[a].listener===t){o=a;break}if(0>o)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],n(i))this.removeListener(e,i);else for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.listenerCount=function(e,t){var i;return i=e._events&&e._events[t]?n(e._events[t])?1:e._events[t].length:0}},function(e,t,n){(function(e,i){function r(e,t){this._id=e,this._clearFn=t}var o=n(36).nextTick,s=Function.prototype.apply,a=Array.prototype.slice,l={},c=0;t.setTimeout=function(){return new r(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new r(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},r.prototype.unref=r.prototype.ref=function(){},r.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,i=arguments.length<2?!1:a.call(arguments,1);return l[n]=!0,o(function(){l[n]&&(i?e.apply(null,i):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof i?i:function(e){delete l[e]}}).call(t,n(33).setImmediate,n(33).clearImmediate)},function(e,t,n){function i(){return t.colors[u++%t.colors.length]}function r(e){function n(){}function r(){var e=r,n=+new Date,o=n-(c||n);e.diff=o,e.prev=c,e.curr=n,c=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=i());var s=Array.prototype.slice.call(arguments);s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,i){if("%%"===n)return n;a++;var r=t.formatters[i];if("function"==typeof r){var o=s[a];n=r.call(e,o),s.splice(a,1),a--}return n}),"function"==typeof t.formatArgs&&(s=t.formatArgs.apply(e,s));var l=r.log||t.log||console.log.bind(console);l.apply(e,s)}n.enabled=!1,r.enabled=!0;var o=t.enabled(e)?r:n;return o.namespace=e,o}function o(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),i=n.length,r=0;i>r;r++)n[r]&&(e=n[r].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function s(){t.enable("")}function a(e){var n,i;for(n=0,i=t.skips.length;i>n;n++)if(t.skips[n].test(e))return!1;for(n=0,i=t.names.length;i>n;n++)if(t.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=r,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=n(37),t.names=[],t.skips=[],t.formatters={};var c,u=0},function(e){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e){function t(){if(!o){o=!0;for(var e,t=r.length;t;){e=r,r=[];for(var n=-1;++n<t;)e[n]();t=r.length}o=!1}}function n(){}var i=e.exports={},r=[],o=!1;i.nextTick=function(e){r.push(e),o||setTimeout(t,0)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e){function t(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),i=(t[2]||"ms").toLowerCase();switch(i){case"years":case"year":case"y":return n*c;case"days":case"day":case"d":return n*l;case"hours":case"hour":case"h":return n*a;case"minutes":case"minute":case"m":return n*s;case"seconds":case"second":case"s":return n*o;case"ms":return n}}}function n(e){return e>=l?Math.round(e/l)+"d":e>=a?Math.round(e/a)+"h":e>=s?Math.round(e/s)+"m":e>=o?Math.round(e/o)+"s":e+"ms"}function i(e){return r(e,l,"day")||r(e,a,"hour")||r(e,s,"minute")||r(e,o,"second")||e+" ms"}function r(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var o=1e3,s=60*o,a=60*s,l=24*a,c=365.25*l;e.exports=function(e,r){return r=r||{},"string"==typeof e?t(e):r["long"]?i(e):n(e)}}]);
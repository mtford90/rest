!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(1),i=n(2),o=n(3),s=n(4),a=n(5),l=n(6),c=n(7),u=n(8),h=n(9),d=n(10),f=n(11),p=n(12),v=n(13),m=n(14),b=n(15),y=n(16),g=n(17);r._patchBind();var _=function(e){return _.ext||(_.ext={}),r.extend(_.ext,e||{}),_};_.createApp=function(e){return new h(e)},r.extend(_,{RelationshipType:l,ModelEventType:v.ModelEventType,log:g.Level,InsertionPolicy:c.InsertionPolicy,_internal:{log:g,Condition:y,Model:o,error:s,ModelEventType:v.ModelEventType,ModelInstance:n(18),extend:n(22),MappingOperation:n(19),events:a,ProxyEventEmitter:n(20),modelEvents:v,Collection:i,utils:r,util:r,querySet:b,observe:n(23),Query:m,ManyToManyProxy:u,OneToManyProxy:f,OneToOneProxy:d,RelationshipProxy:p},isArray:r.isArray,isString:r.isString}),_.ext={},"undefined"!=typeof window&&(window.siesta=_),_.log=n(30),e.exports=_,function(){n(21)}()},function(e,t,n){function r(e){return e=e||[],e.filter(function(e){return e})}function i(e,t){if(t=t||function(){},e&&e.length){var n=[],i=[],o=0;e.forEach(function(s,a){n[a]=!1,s(function(s,l){o++,s&&(i[a]=s),n[a]=l,o==e.length&&t(i.length?r(i):null,r(n),{results:n,errors:i})})})}else t()}function o(e,t){function n(n){n(function(n,l){n&&(s[a]=n),o[a]=l,e.length?(a++,i()):t(s.length?r(s):null,r(o),{results:o,errors:s})})}function i(){var t=e.shift();n(t)}if(t=t||function(){},e&&e.length){var o=[],s=[],a=0;i()}else t()}var s=n(23).Platform,a=n(34),l=n(31),c=n(4).InternalSiestaError,u=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},h=Array.isArray,d=function(e){return"string"==typeof e||e instanceof String};u(e.exports,{argsarray:l,next:function(e){s.performMicrotaskCheckpoint(),setTimeout(e)},extend:u,guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),assert:function(e,t,n){if(!e)throw t=t||"Assertion failed",n=n||{},new c(t,n)},pluck:function(e,t){return e.map(function(e){return e[t]})},thenBy:function(){function e(e){return e.thenBy=t,e}function t(t){var n=this;return e(function(e,r){return n(e,r)||t(e,r)})}return e}(),_patchBind:function(){var e=Function.prototype.apply.bind(Function.prototype.bind);Object.defineProperty(Function.prototype,"bind",{value:function(t){var n=e(this,arguments);return Object.defineProperty(n,"__siesta_bound_object",{value:t,writable:!0,configurable:!0,enumerable:!1}),n}})},Promise:a,promise:function(e,t){return e=e||function(){},new a(function(n,r){var i=l(function(t){var i=t[0],o=t.slice(1);if(i)try{r(i)}catch(s){console.error("Uncaught error during promise rejection",s)}else try{n(o[0])}catch(s){try{r(s)}catch(s){console.error("Uncaught error during promise rejection",s)}}var a=e.__siesta_bound_object||e;e.apply(a,t)});t(i)})},defer:function(){var e,t,n=new a(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n},subProperties:function(e,t,n){h(n)||(n=Array.prototype.slice.call(arguments,2));for(var r=0;r<n.length;r++)!function(n){var r={set:!1,name:n,property:n};d(n)||u(r,n);var i={get:function(){return t[r.property]},enumerable:!0,configurable:!0};r.set&&(i.set=function(e){t[r.property]=e}),Object.defineProperty(e,r.name,i)}(n[r])},capitaliseFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},extendFromOpts:function(e,t,n,r){if(r=void 0==r?!0:r){var i=Object.keys(n),o=Object.keys(t),s=o.filter(function(e){return-1==i.indexOf(e)});if(s.length)throw Error("Unknown options: "+s.toString())}Object.keys(n).forEach(function(e){var r=n[e];"function"==typeof r&&(n[e]=r(t[e]),delete t[e])}),u(n,t),u(e,n)},isString:d,isArray:h,prettyPrint:function(e){return JSON.stringify(e,null,4)},flattenArray:function(e){return e.reduce(function(e,t){return h(t)?e=e.concat(t):e.push(t),e},[])},unflattenArray:function(e,t){for(var n=0,r=[],i=0;i<t.length;i++)if(h(t[i])){var o=[];r[i]=o;for(var s=0;s<t[i].length;s++)o.push(e[n]),n++}else r[i]=e[n],n++;return r}}),u(e.exports,{compact:r,parallel:i,series:o});var f=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,p=/,/,v=/^\s*(_?)(.+?)\1\s*$/,m=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;u(e.exports,{paramNames:function(e){var t,n,r=[];return t=e.toString().replace(m,""),n=t.match(f),n[1].split(p).forEach(function(e){e.replace(v,function(e,t,n){r.push(n)})}),r}})},function(e,t,n){function r(e,t){var n=this;if(!e)throw new Error("Collection must have a name");t=t||{},a.extendFromOpts(this,t,{app:null}),a.extend(this,{name:e,_rawModels:{},_models:{},_opts:t,installed:!1}),Object.defineProperties(this,{dirty:{get:function(){if(this.app.storageEnabled){var e=this.app.storage._unsavedObjectsByCollection,t=e[n.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},models:{get:function(){return Object.keys(this._models).map(function(e){return this._models[e]}.bind(this))}}}),this.app.collectionRegistry.register(this),this._makeAvailableOnRoot(),s.call(this,this.app,this.name)}{var i=(n(17)("collection"),n(24),n(4).InternalSiestaError,n(3)),o=n(22),s=n(20),a=n(1),l=n(4),c=n(31);n(25)}r.prototype=Object.create(s.prototype),a.extend(r.prototype,{_makeAvailableOnRoot:function(){siesta[this.name]=this},_model:function(e,t){if(e){this._rawModels[e]=t,t=o(!0,{},t),t.name=e,t.collection=this;var n=new i(t);return this._models[e]=n,this[e]=n,n}throw new Error("No name specified when creating mapping")},model:c(function(e){if(e.length){if(1==e.length){if(a.isArray(e[0]))return e[0].map(function(e){return this._model(e.name,e)}.bind(this));var t,n;return a.isString(e[0])?(t=e[0],n={}):(n=e[0],t=n.name),this._model(t,n)}return"string"==typeof e[0]?this._model(e[0],e[1]):e.map(function(e){return this._model(e.name,e)}.bind(this))}return null}),_dump:function(e){var t={};return t.installed=this.installed,t.docId=this._docId,t.name=this.name,e?a.prettyPrint(t):t},count:function(e){return a.promise(e,function(e){var t=Object.keys(this._models).map(function(e){var t=this._models[e];return t.count.bind(t)}.bind(this));a.parallel(t,function(t,n){var r;t||(r=n.reduce(function(e,t){return e+t},0)),e(t,r)})}.bind(this))},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},a.promise(n,function(t){var n,r=[];for(var i in e)if(e.hasOwnProperty(i)){var o=this._models[i];o?!function(e,t){r.push(function(n){e.graph(t,function(t,r){if(!t){var i={};i[e.name]=r}n(t,i)})})}(o,e[i]):n='No such model "'+i+'"'}n?t(l(n,{data:e,invalidModelName:i})):a.series(r,function(e,n){n=e?null:n.reduce(function(e,t){return a.extend(e,t||{})},{}),t(e,n)})}.bind(this))},removeAll:function(e){return a.promise(e,function(e){a.Promise.all(Object.keys(this._models).map(function(e){var t=this._models[e];return t.removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))}}),e.exports=r},function(e,t,n){(function(t){function r(e){var t=this;this._opts=e?c.extend({},e):{},c.extendFromOpts(this,e,{methods:{},attributes:[],collection:null,id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,serialise:null,serialiseField:null,serialisableFields:null,remove:null,parseAttribute:null},!1),this.parseAttribute||(this.parseAttribute=function(e,t){return t}),this.attributes=r._processAttributes(this.attributes),this._factory=new b(this),this._instance=this._factory._instance.bind(this._factory),c.extend(this,{_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]}),Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(t.relationships)},enumerable:!0},_attributeNames:{get:function(){var e=[];return t.id&&e.push(t.id),t.attributes.forEach(function(t){e.push(t.name)}),e},enumerable:!0,configurable:!0},installed:{get:function(){return t._relationshipsInstalled&&t._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return t.children.reduce(function(e,t){return Array.prototype.concat.call(e,t.descendants)}.bind(t),c.extend([],t.children))},enumerable:!0},dirty:{get:function(){if(this.app.storageEnabled){var e=this.app.storage._unsavedObjectsByCollection,t=(e[this.collectionName]||{})[this.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0},app:{get:function(){return this.collection.app}}});var n=this.collectionName+":"+this.name,i={query:this.query.bind(this)};f.call(this,this.collection.app,n,i),this.installRelationships(),this.installReverseRelationships(),this._indexIsInstalled=new d(function(e){this.app.storageEnabled?this.app.storage.ensureIndexInstalled(this,function(t){e(t)}):e()}.bind(this)),this._modelLoadedFromStorage=new d(function(e){this.app.storageEnabled?this.app.storage.loadModel({model:this},function(t){e(t)}):e()}.bind(this)),this._storageEnabled=new d([this._indexIsInstalled,this._modelLoadedFromStorage]),this._storageEnabled.then(function(){}.bind(this))["catch"](function(e){console.error("Could not enable storage for model "+this.name+":",e)}.bind(this))}var i=n(17)("model"),o=n(4).InternalSiestaError,s=n(6),a=n(14),l=n(19),c=(n(18),n(1)),u=n(31),h=n(4),d=(n(22),n(13),n(16)),f=n(20),p=c.Promise,v=n(26),m=n(7),b=n(27);c.extend(r,{_processAttributes:function(e){return e.reduce(function(e,t){return e.push("string"==typeof t?{name:t}:t),e},[])},install:function(e,t){return t=t||function(){},new p(function(n,r){d.all.apply(d,e.map(function(e){return e._storageEnabled})).then(function(){e.forEach(function(e){e._installReversePlaceholders()}),t(),n()})["catch"](function(e){r(e)})})}}),r.prototype=Object.create(f.prototype),c.extend(r.prototype,{installStatics:function(e){return e&&Object.keys(e).forEach(function(t){this[t]?i('Static method with name "'+t+'" already exists. Ignoring it.'):this[t]=e[t].bind(this)}.bind(this)),e},_validateRelationshipType:function(e){if(e.type||(e.type=this.singleton?s.OneToOne:s.OneToMany),this.singleton&&e.type==s.ManyToMany)throw new Error("Singleton model cannot use ManyToMany relationship.");if(Object.keys(s).indexOf(e.type)<0)throw new Error("Relationship type "+e.type+" does not exist")},_getReverseModel:function(e){var t;if(t=e instanceof r?e:this.collection[e],!t){var n=e.split(".");if(2==n.length){var i=n[0];e=n[1];var o=this.app.collectionRegistry[i];o&&(t=o[e])}}return t},_getReverseModelOrPlaceholder:function(e,t){var n=this._getReverseModel(t);return n||new v({name:t,ref:this,forwardName:e})},installRelationships:function(){if(this._relationshipsInstalled)throw new o('Relationships for "'+this.name+'" have already been installed');var e=null;for(var t in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(t)){var n=this._opts.relationships[t],r=!n.isReverse;if(r&&(i(this.name+": configuring relationship "+t,n),!(e=this._validateRelationshipType(n)))){var s=n.model;if(!s)return"Must pass model";var a=this._getReverseModelOrPlaceholder(t,s);c.extend(n,{reverseModel:a,forwardModel:this,forwardName:t,reverseName:n.reverse||"reverse_"+t,isReverse:!1}),delete n.model,delete n.reverse}}return e||(this._relationshipsInstalled=!0),e},_installReverse:function(e){var t=c.extend({},e);t.isReverse=!0;var n=t.reverseModel,r=n.isPlaceholder;if(r){var i=t.reverseModel.name;n=this._getReverseModel(i),n&&(t.reverseModel=n,e.reverseModel=n)}if(n){var o=t.reverseName,a=t.forwardModel;if(n!=this||n==a){if(n.singleton){if(t.type==s.ManyToMany)throw new Error("Singleton model cannot be related via reverse ManyToMany");if(t.type==s.OneToMany)throw new Error("Singleton model cannot be related via reverse OneToMany")}if(n.relationships[o]){var l=n.relationships[o].forwardModel.isAncestorOf(this),u=n.relationships[o].forwardModel.isDescendantOf(this);if(!l&&!u&&!r)throw new Error('Reverse relationship "'+o+'" already exists on model "'+n.name+'"')}n.relationships[o]=t}var h=(this.app.cache._localCacheByType[n.collectionName]||{})[n.name]||{};Object.keys(h).forEach(function(e){var n=h[e];this._factory._installRelationship(t,n)}.bind(this))}},_installReversePlaceholders:function(){for(var e in this.relationships)if(this.relationships.hasOwnProperty(e)){var t=this.relationships[e];t.reverseModel.isPlaceholder&&this._installReverse(t)}},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new o('Reverse relationships for "'+this.name+'" have already been installed.');for(var e in this.relationships)this.relationships.hasOwnProperty(e)&&this._installReverse(this.relationships[e]);this._reverseRelationshipsInstalled=!0},_query:function(e){return new a(this,e||{})},query:function(e,n){var r,i=c.promise(n,function(t){this.app._ensureInstalled(function(){return this.singleton?(r=this._query({__ignoreInstalled:!0}),void r.execute(function(n,i){n?t(n):(e=c.extend({},e),e.__ignoreInstalled=!0,i.length?(r=this._query(e),r.execute(t)):this.graph({},function(n){n?t(n):(r=this._query(e),r.execute(t))}.bind(this)))}.bind(this))):(r=this._query(e),r.execute(t))}.bind(this))}.bind(this)),o=new c.Promise(function(e,n){i.then(u(function(n){t(function(){e.apply(null,n)})}),u(function(e){t(function(){n.apply(null,e)})}))});return this._link({then:o.then.bind(o),"catch":o["catch"].bind(o),on:u(function(t){var n=new m(this._query(e));n.init(),n.on.apply(n,t)}.bind(this))})},_reactiveQuery:function(e){return new m(new a(this,e||{}))},one:function(e,t){return"function"==typeof e&&(t=e,e={}),c.promise(t,function(t){this.query(e,function(e,n){e?t(e):n.length>1?t(h("More than one instance returned when executing get query!")):(n=n.length?n[0]:null,t(null,n))})}.bind(this))},all:function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};var n={};return e.__order&&(n.__order=e.__order),this.query(e,t)},_attributeDefinitionWithName:function(e){for(var t=0;t<this.attributes.length;t++){var n=this.attributes[t];if(n.name==e)return n}},_graph:function(e,t,n){var r=function(){var r=t.override;r&&(t.objects=c.isArray(r)?r:[r]),delete t.override,c.isArray(e)?this._mapBulk(e,t,n):this._mapBulk([e],t,function(t,r){var i;r&&r.length&&(i=r[0]),t=t?c.isArray(e)?t:c.isArray(t)?t[0]:t:null,n(t,i)})}.bind(this);r()},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},c.promise(n,function(n){this.app._ensureInstalled(function(){this._graph(e,t,n)}.bind(this))}.bind(this))},_mapBulk:function(e,t,n){c.extend(t,{model:this,data:e});var r=new l(t);r.start(function(e,t){e?n&&n(e):n(null,t||[])})},_countCache:function(){var e=this.app.cache._localCacheByType[this.collectionName]||{},t=e[this.name]||{};return Object.keys(t).reduce(function(e,t){return e[t]={},e},{})},count:function(e){return c.promise(e,function(e){this.app._ensureInstalled(function(){e(null,Object.keys(this._countCache()).length)}.bind(this))}.bind(this))},_dump:function(e){var t={};return t.name=this.name,t.attributes=this.attributes,t.id=this.id,t.collection=this.collectionName,t.relationships=this.relationships.map(function(e){return e.isForward?e.forwardName:e.reverseName}),e?c.prettyPrint(t):t},toString:function(){return"Model["+this.name+"]"},removeAll:function(e){return c.promise(e,function(e){this.all().then(function(t){t.remove(),e()})["catch"](e)}.bind(this))}}),c.extend(r.prototype,{child:function(e,t){"string"==typeof e?t.name=e:t=name,c.extend(t,{attributes:Array.prototype.concat.call(t.attributes||[],this._opts.attributes),relationships:c.extend(t.relationships||{},this._opts.relationships),methods:c.extend(c.extend({},this._opts.methods)||{},t.methods),statics:c.extend(c.extend({},this._opts.statics)||{},t.statics),properties:c.extend(c.extend({},this._opts.properties)||{},t.properties),id:t.id||this._opts.id,init:t.init||this._opts.init,remove:t.remove||this._opts.remove,serialise:t.serialise||this._opts.serialise,serialiseField:t.serialiseField||this._opts.serialiseField,parseAttribute:t.parseAttribute||this._opts.parseAttribute}),this._opts.serialisableFields&&(t.serialisableFields=Array.prototype.concat.apply(t.serialisableFields||[],this._opts.serialisableFields));var n=this.collection.model(t.name,t);return n.parent=this,this.children.push(n),n},isChildOf:function(e){return this.parent==e},isParentOf:function(e){return this.children.indexOf(e)>-1},isDescendantOf:function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},isAncestorOf:function(e){return this.descendants.indexOf(e)>-1},hasAttributeNamed:function(e){return this._attributeNames.indexOf(e)>-1}}),e.exports=r}).call(t,n(32).setImmediate)},function(e){function t(e,t,n){Error.call(this,e,t,n),this.message=e,this.context=t,n&&Error.captureStackTrace&&Error.captureStackTrace(this,n)}function n(e){return"object"==typeof e?"error"in e&&"ok"in e&&"reason"in e:!1}t.prototype=Object.create(Error.prototype),t.prototype.name="InternalSiestaError",t.prototype.constructor=t,e.exports=function(e,t){if(n(e))return e;var r={reason:e,error:!0,ok:!1};for(var i in t||{})t.hasOwnProperty(i)&&(r[i]=t[i]);return r.toString=function(){return JSON.stringify(this)},r},e.exports.InternalSiestaError=t},function(e,t,n){var r=n(33).EventEmitter,i=(n(1),n(31),n(13),n(28),function(){var e=new r;e.setMaxListeners(100);var t=e.emit;return e.emit=function(n,r){try{t.call(e,n,r)}catch(i){console.error(i)}},e});e.exports=i},function(e){e.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},function(e,t,n){function r(e){var t=this;o.call(this),s.call(this),u.extend(this,{insertionPolicy:r.InsertionPolicy.Back,initialised:!1}),Object.defineProperty(this,"query",{get:function(){return this._query},set:function(e){e?(this._query=e,this.results=c([],e.model)):(this._query=null,this.results=null)},configurable:!1,enumerable:!0}),e&&u.extend(this,{_query:e,results:c([],e.model)}),Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){var e=t._query;return e?e.model:void 0}},collection:{get:function(){return t.model.collectionName}}})}var i=n(17)("query:reactive"),o=(n(14),n(33).EventEmitter),s=n(28),a=n(13),l=n(4).InternalSiestaError,c=n(15),u=n(1);r.prototype=Object.create(o.prototype),u.extend(r.prototype,s.prototype),u.extend(r,{InsertionPolicy:{Front:"Front",Back:"Back"}}),u.extend(r.prototype,{init:function(e,t){if(this._query){var n=this._constructNotificationName(),r=function(e){this._handleNotif(e)}.bind(this);return this.handler=r,this.model.app.events.on(n,r),u.promise(e,function(e){!this.initialised||t?this._query.execute(function(t,n){t?e(t):e(null,this._applyResults(n))}.bind(this)):e(null,this.results)}.bind(this))}throw new l("No _query defined")},_applyResults:function(e){return this.results=e,this.initialised=!0,this.results},insert:function(e){var t=this.results.mutableCopy();if(this.insertionPolicy==r.InsertionPolicy.Back)var n=t.push(e);else n=t.unshift(e);return this.results=t.asModelQuerySet(this.model),n},update:function(e){return this.init(e,!0)},_handleNotif:function(e){if(e.type==a.ModelEventType.New){var t=e["new"];if(this._query.objectMatchesQuery(t)){i("New object matches",t);var n=this.insert(t);this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this})}else i("New object does not match",t)}else if(e.type==a.ModelEventType.Set){t=e.obj;var r=this.results.indexOf(t),o=r>-1,s=this._query.objectMatchesQuery(t);if(s&&!o)i("Updated object now matches!",t),n=this.insert(t),this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this});else if(!s&&o){i("Updated object no longer matches!",t),h=this.results.mutableCopy();var u=h.splice(r,1);this.results=h.asModelQuerySet(this.model),this.emit(a.ModelEventType.Splice,{index:r,obj:this,"new":t,type:a.ModelEventType.Splice,removed:u})}else s||o?s&&o&&(i("Matches but already contains",t),this.emit(e.type,e)):i("Does not contain, but doesnt match so not inserting",t)}else{if(e.type!=a.ModelEventType.Remove)throw new l('Unknown change type "'+e.type.toString()+'"');t=e.obj;var h=this.results.mutableCopy();r=h.indexOf(t),r>-1?(i("Removing object",t),u=h.splice(r,1),this.results=c(h,this.model),this.emit(a.ModelEventType.Splice,{index:r,obj:this,type:a.ModelEventType.Splice,removed:u})):i("No modelEvents neccessary.",t)}this.results=c(this._query._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&this.model.app.events.removeListener(this._constructNotificationName(),this.handler),this.results=null,this.handler=null},_registerEventHandler:function(e,t,n){var r=o.prototype.removeListener;return"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(t){e.call(this,a.ModelEventType[t],n)}.bind(this)):e.call(this,t,n),this._link({on:this.on.bind(this),once:this.once.bind(this),update:this.update.bind(this),insert:this.insert.bind(this)},function(){"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(e){r.call(this,a.ModelEventType[e],n)}.bind(this)):r.call(this,t,n)})},on:function(e,t){return this._registerEventHandler(o.prototype.on,e,t)},once:function(e,t){return this._registerEventHandler(o.prototype.once,e,t)}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e),this.related=[],this.relatedCancelListeners={},this.isReverse&&(this.related=[])}var i=n(12),o=n(1),s=n(13),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;r.prototype=Object.create(i.prototype),o.extend(r.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e),r=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splice(r,1)})})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.makeChangesToRelatedWithoutObservations(function(){n.splice(0,0,t.object)})})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=n.removed;t.clearReverse(i),t.setReverseOfAdded(r);var o=t.getForwardModel();o.app.broadcast({collection:o.collectionName,model:o.name,localId:t.object.localId,field:t.getForwardName(),removed:i,added:r,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){return"[object Array]"!=Object.prototype.toString.call(e)?"Cannot assign scalar to many to many":null},set:function(e,t){this.checkInstalled();var n=this;if(e){var r;if(r=this.validate(e))return r;this.clearReverseRelated(t),n.setIdAndRelated(e,t),this.wrapArray(e),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){i.prototype.install.call(this,e),this.wrapArray(this.related),e["splice"+o.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this)},registerRemovalListener:function(e){this.relatedCancelListeners[e.localId]=e.on("*",function(){}.bind(this))}}),e.exports=r},function(e,t,n){function r(e){if(!e)throw new Error("App must have a name");this.collectionRegistry=new i,this.cache=new a,this.name=e;var t=new h(this);this.events=o();var n=this.events.removeListener.bind(this.events);l.extend(this,{on:this.events.on.bind(this.events),off:n,removeListener:n,once:this.events.once.bind(this.events),removeAllListeners:this.events.removeAllListeners.bind(this.events),notify:l.next,registerComparator:d.registerComparator.bind(d)}),this.storage=t,l.extend(this,{save:this.storage.save.bind(this.storage),setPouch:function(e){t.pouch=e}});var r,s,c,u=500;Object.defineProperties(this,{dirty:{get:function(){t._unsavedObjectsByCollection;return!!Object.keys(t.unsavedObjectsByCollection).length},enumerable:!0},autosaveInterval:{get:function(){return u},set:function(e){u=e,r&&(this.autosave=!1,this.autosave=!0)}},autosave:{get:function(){return!!r},set:function(e){e?r||(r=setInterval(function(){s||(s=!0,this.storage.save(function(e){e||this.events.emit("saved"),s=!1}.bind(this)))}.bind(this),this.autosaveInterval)):r&&(clearInterval(r),r=null)}},storageEnabled:{get:function(){return void 0!==c?c:!!this.storage},set:function(e){c=e},enumerable:!0}}),"undefined"==typeof PouchDB&&(this.storageEnabled=!1,console.warn("PouchDB is not present therefore storage is disabled."))}var i=n(24),o=n(5),s=n(13),a=n(29),l=n(1),c=n(3),u=n(4),h=n(21),d=n(14),f=n(2);r.prototype={collection:function(e,t){return t=t||{},t.app=this,new f(e,t)},broadcast:function(e){s.emit(this,e)},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},l.promise(n,function(t){var n,r=[];for(var i in e)if(e.hasOwnProperty(i)){var o=this.collectionRegistry[i];o?!function(e,t){r.push(function(n){e.graph(t,function(t,r){if(!t){var i={};i[e.name]=r}n(t,i)})})}(o,e[i]):n='No such collection "'+i+'"'}n?t(u(n,{data:e,invalidCollectionName:i})):l.series(r,function(e,n){n=e?null:n.reduce(function(e,t){return l.extend(e,t)},{}),t(e,n)})}.bind(this))},count:function(){return this.cache.count()},get:function(e,t){return l.promise(t,function(t){t(null,this.cache._localCache()[e])}.bind(this))},removeAll:function(e){return l.promise(e,function(e){l.Promise.all(this.collectionRegistry.collectionNames.map(function(e){return this.collectionRegistry[e].removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))},_ensureInstalled:function(e){e=e||function(){};var t=this.collectionRegistry.collectionNames,n=t.reduce(function(e,t){var n=this.collectionRegistry[t];return e=e.concat(n.models)}.bind(this),[]);c.install(n,e)},_pushTask:function(e){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[],this.execute=function(){this.tasks.forEach(function(e){e()}),this.tasks=[]}.bind(this)}),this.queuedTasks.tasks.push(e)},reset:function(e,t){delete this.queuedTasks,this.cache.reset(),this.collectionRegistry.reset();var n=this.collectionRegistry.collectionNames;n.reduce(function(e,t){var n=this.collectionRegistry[t];return Object.keys(n._models).forEach(function(t){var r=n[t];e.push(r._storageEnabled)}),e}.bind(this),[]),this.removeAllListeners(),this.storageEnabled?(t=void 0===t?!0:t,t?(this.storage._reset(e),this.setPouch(new PouchDB("siesta",{auto_compaction:!0,adapter:"memory"}))):e()):e()}},e.exports=r},function(e,t,n){function r(e){i.call(this,e)}{var i=n(12),o=n(1);n(18)}r.prototype=Object.create(i.prototype),o.extend(r.prototype,{validate:function(e){return"[object Array]"==Object.prototype.toString.call(e)?"Cannot assign array to one to one relationship":null},set:function(e,t){if(this.checkInstalled(),e){var n;if(n=this.validate(e))return n;this.clearReverseRelated(t),this.setIdAndRelated(e,t),this.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),this.setIdAndRelated(e,t)},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e),this.isReverse&&(this.related=[])}var i=n(12),o=n(1),s=n(13),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;r.prototype=Object.create(i.prototype),o.extend(r.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(null)})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(t.object)})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=n.removed;t.clearReverse(i),t.setReverseOfAdded(r);var o=t.getForwardModel();o.app.broadcast({collection:o.collectionName,model:o.name,localId:t.object.localId,field:t.getForwardName(),removed:i,added:r,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return o.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){var t=Object.prototype.toString.call(e);if(this.isForward){if("[object Array]"==t)return"Cannot assign array forward oneToMany ("+t+"): "+this.forwardName}else if("[object Array]"!=t)return"Cannot scalar to reverse oneToMany ("+t+"): "+this.reverseName;return null},set:function(e,t){this.checkInstalled();var n=this;if(e){var r;if(r=this.validate(e))return r;this.clearReverseRelated(t),n.setIdAndRelated(e,t),n.isReverse&&this.wrapArray(n.related),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){i.prototype.install.call(this,e),this.isReverse&&(e["splice"+o.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this),this.wrapArray(this.related))}}),e.exports=r},function(e,t,n){function r(e){var t=this;e=e||{},o.extend(this,{object:null,related:null}),Object.defineProperties(this,{isForward:{get:function(){return!t.isReverse},set:function(e){t.isReverse=!e},enumerable:!0}}),o.extendFromOpts(this,e,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null,serialise:null},!1),this.cancelListens={}}var i=n(4).InternalSiestaError,o=n(1),s=(n(14),n(17),n(13)),a=s.wrapArray,l=n(23).ArrayObserver,c=s.ModelEventType;o.extend(r,{}),o.extend(r.prototype,{install:function(e){if(!e)throw new i("No object passed to relationship install");if(this.object)throw new i("Already installed.");this.object=e;var t=this,n=this.getForwardName();e.__proxies[n]||(Object.defineProperty(e,n,{get:function(){return t.related},set:function(e){t.set(e)},configurable:!0,enumerable:!0}),e.__proxies[n]=this,e._proxies.push(this))}}),o.extend(r.prototype,{set:function(){throw new i("Must subclass RelationshipProxy")},get:function(){throw new i("Must subclass RelationshipProxy")}}),o.extend(r.prototype,{proxyForInstance:function(e,t){var n,r=t?this.getReverseName():this.getForwardName(),s=t?this.reverseModel:this.forwardModel;if(o.isArray(e))n=e.map(function(e){return e.__proxies[r]});else{var a=e.__proxies,l=a[r];if(!l){var c='No proxy with name "'+r+'" on mapping '+s.name;throw new i(c)}n=l}return n},reverseProxyForInstance:function(e){return this.proxyForInstance(e,!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},setIdAndRelated:function(e,t){if(t=t||{},!t.disableevents)var n=this._getOldValueForSetChangeEvent();this.related=e?o.isArray(e)?e:e:null,t.disableevents||this.registerSetChange(e,n)},checkInstalled:function(){if(!this.object)throw new i("Proxy must be installed on an object before can use it.")},splicer:function(e){return e=e||{},function(t,n){if(e=e||{},!e.disableevents)var r=this._getAddedForSpliceChangeEvent(arguments),i=this._getRemovedForSpliceChangeEvent(t,n);var o=Array.prototype.slice.call(arguments,2),s=this.related.splice.bind(this.related,t,n).apply(this.related,o);return e.disableevents||this.registerSpliceChange(t,r,i),s}.bind(this)},clearReverseRelated:function(e){e=e||{};var t=this;if(this.related){var n=this.reverseProxyForInstance(this.related),r=o.isArray(n)?n:[n];r.forEach(function(n){if(o.isArray(n.related)){var r=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splicer(e)(r,1)})}else n.setIdAndRelated(null,e)})}},setIdAndRelatedReverse:function(e,t){var n=this,r=this.reverseProxyForInstance(e),i=o.isArray(r)?r:[r];i.forEach(function(e){o.isArray(e.related)?e.makeChangesToRelatedWithoutObservations(function(){e.splicer(t)(e.related.length,0,n.object)}):(e.clearReverseRelated(t),e.setIdAndRelated(n.object,t))})},makeChangesToRelatedWithoutObservations:function(e){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,e(),this.wrapArray(this.related)):e()},_getOldValueForSetChangeEvent:function(){var e=this.related;return o.isArray(e)&&!e.length&&(e=null),e},registerSetChange:function(e,t){var n=this.object;
if(!n)throw new i("Proxy must have an object associated");var r=n.model,o=r.name,s=n.collectionName;r.app.broadcast({collection:s,model:o,localId:n.localId,field:this.getForwardName(),old:t,"new":e,type:c.Set,obj:n})},_getRemovedForSpliceChangeEvent:function(e,t){return this.related?this.related.slice(e,e+t):null},_getAddedForSpliceChangeEvent:function(e){var t=Array.prototype.slice.call(e,2);return t.length?t:[]},registerSpliceChange:function(e,t,n){var r=this.object.model,i=r.name,o=this.object.collectionName;r.app.broadcast({collection:o,model:i,localId:this.object.localId,field:this.getForwardName(),index:e,removed:n,added:t,type:c.Splice,obj:this.object})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=t.getForwardModel();i.app.broadcast({collection:i.collectionName,model:i.name,localId:t.object.localId,field:t.getForwardName(),removed:n.removed,added:r,type:c.Splice,obj:t.object})})};e.arrayObserver.open(n)}},splice:function(){this.splicer({}).apply(this,arguments)}}),e.exports=r},function(e,t,n){function r(e){this._opts=e||{},Object.keys(e).forEach(function(t){this[t]=e[t]}.bind(this))}function i(e,t,n,r){var i="Siesta",o=e.collectionRegistry[t],s=o[n];if(!o)throw new a('No such collection "'+t+'"');if(!s)throw new a('No such model "'+n+'"');var l=r.obj._emitEvents;if(l&&"new"in r&&"old"in r&&(l=r["new"]instanceof Date&&r.old instanceof Date?r["new"].getTime()!=r.old.getTime():r["new"]!=r.old),l){e.events.emit(i,r);var c=t+":"+n,u=r.localId;e.events.emit(t,r),e.events.emit(c,r),e.events.emit(u,r),s.id&&r.obj[s.id]&&e.events.emit(t+":"+n+":"+r.obj[s.id],r)}}function o(e){if(!e.model)throw new a("Must pass a model");if(!e.collection)throw new a("Must pass a collection");if(!e.localId)throw new a("Must pass a local identifier");if(!e.obj)throw new a("Must pass the object")}function s(e,t){o(t);var n=t.collection,s=t.model,a=new r(t);return i(e,n,s,a),a}var a=n(4).InternalSiestaError,l=(n(17)("events"),n(23).ArrayObserver),c=n(1).extend,u={Set:"set",Splice:"splice",New:"new",Remove:"remove"};r.prototype._dump=function(e){var t={};return t.collection="string"==typeof this.collection?this.collection:this.collection._dump(),t.model="string"==typeof this.model?this.model:this.model.name,t.localId=this.localId,t.field=this.field,t.type=this.type,this.index&&(t.index=this.index),this.added&&(t.added=this.added.map(function(e){return e._dump()})),this.removed&&(t.removed=this.removed.map(function(e){return e._dump()})),this.old&&(t.old=this.old),this["new"]&&(t["new"]=this["new"]),e?util.prettyPrint(t):t},c(t,{ModelEvent:r,emit:s,validateEventOpts:o,ModelEventType:u,wrapArray:function(e,t,n){e.observer||(e.observer=new l(e),e.observer.open(function(r){var i=n._attributeNames.indexOf(t)>-1;i&&r.forEach(function(r){s(n.app,{collection:n.collectionName,model:n.model.name,localId:n.localId,index:r.index,removed:r.removed,added:r.addedCount?e.slice(r.index,r.index+r.addedCount):[],type:u.Splice,field:t,obj:n})})}))}})},function(e,t,n){function r(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&"__"==r.slice(0,2)&&(n[r.slice(2)]=t[r],delete t[r]);l.extend(this,{model:e,query:t,opts:n}),n.order=n.order||[],l.isArray(n.order)||(n.order=[n.order])}function i(e){var t;return t=null===e?"null":void 0===e?"undefined":e instanceof u?e.localId:e.toString()}function o(e){if(!e.invalid){var t=e.object;if(l.isArray(t))n=l.pluck(t,e.field);else var n=t[e.field];if(l.isArray(n)||l.isString(n))return n.indexOf(e.value)>-1}return!1}function s(e){var t,n=e.app.cache._localCacheByType,r=e.name,i=e.collectionName,o=n[i];return o&&(t=o[r]||{}),t}var a=n(17)("query"),l=n(1),c=n(4),u=n(18),h=n(15),d={e:function(e){var t=e.object[e.field];return a.enabled&&a(e.field+": "+i(t)+" == "+i(e.value),{opts:e}),t==e.value},lt:function(e){return e.invalid?!1:e.object[e.field]<e.value},gt:function(e){return e.invalid?!1:e.object[e.field]>e.value},lte:function(e){return e.invalid?!1:e.object[e.field]<=e.value},gte:function(e){return e.invalid?!1:e.object[e.field]>=e.value},contains:o,"in":o};l.extend(r,{comparators:d,registerComparator:function(e,t){d[e]||(d[e]=t)}}),l.extend(r.prototype,{execute:function(e){return l.promise(e,function(e){this._executeInMemory(e)}.bind(this))},_dump:function(e){return e?"{}":{}},sortFunc:function(e){for(var t=function(e,t){return function(n,r){var i,o=n[t],s=r[t];return"string"==typeof o||o instanceof String&&"string"==typeof s||s instanceof String?i=e?o.localeCompare(s):s.localeCompare(o):(o instanceof Date&&(o=o.getTime()),s instanceof Date&&(s=s.getTime()),i=e?o-s:s-o),i}},n=l,r=0;r<e.length;r++){var i=e[r];n=n.thenBy(t(i.ascending,i.field))}return n==l?null:n},_sortResults:function(e){var t=this.opts.order;if(e&&t){var n=t.map(function(e){var t=e.split("-"),n=!0,r=null;return t.length>1?(r=t[1],n=!1):r=t[0],{field:r,ascending:n}}.bind(this)),r=this.sortFunc(n);e.immutable&&(e=e.mutableCopy()),r&&e.sort(r)}return e},_getCacheByLocalId:function(){return this.model.descendants.reduce(function(e,t){return l.extend(e,s(t))},l.extend({},s(this.model)))},_executeInMemory:function(e){for(var t,n=this._getCacheByLocalId(),r=Object.keys(n),i=this,o=[],s=0;s<r.length;s++){var l=r[s],u=n[l],d=i.objectMatchesQuery(u);if("string"==typeof d){t=c(d);break}d&&o.push(u)}o=this._sortResults(o),t&&a("Error executing query",t),e(t,t?null:h(o,this.model))},clearOrdering:function(){this.opts.order=null},objectMatchesOrQuery:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(this.objectMatchesBaseQuery(e,r))return!0}return!1},objectMatchesAndQuery:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(!this.objectMatchesBaseQuery(e,r))return!1}return!0},splitMatches:function(e,t,n){var i="e",o=t.split("."),s=o[o.length-1].split("__");if(2==s.length){var a=s[0];i=s[1]}else a=s[0];o[o.length-1]=a,o.slice(0,o.length-1).forEach(function(t){e=l.isArray(e)?l.pluck(e,t):e[t]});var c=void 0!=e;if(c){if(l.isArray(e));else var u=e[a],h=l.isArray(u)?!1:null===u||void 0===u;var d=r.comparators[i],f={object:e,field:a,value:n,invalid:h};return d?d(f):'No comparator registered for query operation "'+i+'"'}return!1},objectMatches:function(e,t,n,r){if("$or"==t){var i=r.$or;if(l.isArray(i)||(i=Object.keys(i).map(function(e){var t={};return t[e]=i[e],t})),!this.objectMatchesOrQuery(e,i))return!1}else if("$and"==t){if(!this.objectMatchesAndQuery(e,r.$and))return!1}else{var o=this.splitMatches(e,t,n);if("boolean"!=typeof o)return o;if(!o)return!1}return!0},objectMatchesBaseQuery:function(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],o=t[i],s=this.objectMatches(e,i,o,t);if("boolean"!=typeof s)return s;if(!s)return!1}return!0},objectMatchesQuery:function(e){return this.objectMatchesBaseQuery(e,this.query)}}),e.exports=r},function(e,t,n){function r(e){var t;return t="string"==typeof e||e instanceof String?y.concat(g):"number"==typeof e||e instanceof Number?m.concat(b):e.getOwnPropertyNames()}function i(e,t){t in e||Object.defineProperty(e,t,{get:function(){return l(h.pluck(e,t))},set:function(e){if(h.isArray(e)){if(this.length!=e.length)throw f({message:"Must be same length"});for(var n=0;n<e.length;n++)this[n][t]=e[n]}else for(n=0;n<this.length;n++)this[n][t]=e}})}function o(e){return e.then&&e["catch"]}function s(e,t){t in e||(e[t]=function(){var e=arguments,n=this.map(function(n){return n[t].apply(n,e)}),r=!1;return n.length&&(r=o(n[0])),r?d.all(n):l(n)})}function a(e,t){e=h.extend([],e);var n=t._attributeNames,r=t._relationshipNames,o=n.concat(r).concat(a);o.forEach(i.bind(i,e));var a=Object.keys(p.prototype);return a.forEach(s.bind(s,e)),u(e)}function l(e){if(e.length){var t=e[0],n=r(t);n.forEach(function(n){"function"==typeof t[n]?s(e,n,arguments):i(e,n)})}return u(e)}function c(){throw new Error("Cannot modify a query set")}function u(e){return v.forEach(function(t){e[t]=c}),e.immutable=!0,e.mutableCopy=e.asArray=function(){var e=this.map(function(e){return e});return e.asQuerySet=function(){return l(this)},e.asModelQuerySet=function(e){return a(this,e)},e},e}var h=n(1),d=h.Promise,f=n(4),p=n(18),v=["push","sort","reverse","splice","shift","unshift"],m=["toString","toExponential","toFixed","toPrecision","valueOf"],b=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],y=["charAt","charCodeAt","concat","fromCharCode","indexOf","lastIndexOf","localeCompare","match","replace","search","slice","split","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toString","toUpperCase","trim","valueOf"],g=["length"];e.exports=a},function(e,t,n){function r(e,t){(void 0===t||null===t)&&(t=!0),e=e||function(e){e()},this._promise=new i.Promise(function(t,n){this.reject=n,this.resolve=t,this.fn=function(){this.executed=!0;var r=0,o=[],s=[];if(i.isArray(e)){var a=function(){r==e.length&&(s.length?n(s):t(o))}.bind(this);e.forEach(function(e,t){e.then(function(e){o[t]=e,r++,a()})["catch"](function(e){s[t]=e,r++,a()})})}else e(function(e,r){e?n(e):t(r)}.bind(this))}}.bind(this)),t||this._execute(),this.executed=!1,this.dependent=[]}var i=n(1),o=n(31);r.all=o(function(e){return new r(e)}),r.prototype={_execute:function(){this.executed||(Promise.all(i.pluck(this.dependent,"_promise")).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()}))},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){}},e.exports=r},function(e,t,n){var r=n(30),i=n(31);e.exports=function(e){var t=r("siesta:"+e),n=i(function(e){t.call(t,e)});return Object.defineProperty(n,"enabled",{get:function(){return r.enabled(e)}}),n}},function(e,t,n){function r(e){if(!e)throw new Error("wtf");var t=this;this.model=e,l.call(this,e.app),this.__proxies={},this._proxies=[],o.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]),Object.defineProperties(this,{_relationshipNames:{get:function(){var e=Object.keys(t.__proxies||{}).map(function(e){return t.__proxies[e]});return e.map(function(e){return e.isForward?e.forwardName:e.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){return this.app.storageEnabled?t.localId in this.app.storage._unsavedObjectsHash:void 0},enumerable:!0},event:{get:function(){return this.localId}},app:{get:function(){return this.model.app}}}),this.removed=!1,this._emitEvents=!1}function i(e,t){return t}var o=(n(17),n(1)),s=(n(4),n(13)),a=s.ModelEventType,l=n(20);r.prototype=Object.create(l.prototype),o.extend(r.prototype,{get:function(e){return o.promise(e,function(e){e(null,this)}.bind(this))},emit:function(e,t){"object"==typeof e?t=e:t.type=e,t=t||{},o.extend(t,{collection:this.collectionName,model:this.model.name,localId:this.localId,obj:this}),this.app.broadcast(t)},remove:function(e,t){return _.each(this._relationshipNames,function(e){this[e]=o.isArray(this[e])?[]:null}.bind(this)),t=null==t?!0:t,o.promise(e,function(e){this.app.cache.remove(this),this.removed=!0,t&&this.emit(s.ModelEventType.Remove,{old:this});var n=this.model.remove;if(n){var r=o.paramNames(n);if(r.length){var i=this;n.call(this,function(t){e(t,i)})}else n.call(this),e(null,this)}else e(null,this)}.bind(this))},restore:function(e){return o.promise(e,function(e){var t=function(t){t||this.emit(s.ModelEventType.New,{"new":this}),e(t,this)}.bind(this);if(this.removed){this.app.cache.insert(this),this.removed=!1;var n=this.model.init;if(n){var r=o.paramNames(n),i=!0;r.length>1?n.call(this,i,t):(n.call(this,i),t())}else t()}}.bind(this))}}),o.extend(r.prototype,{getAttributes:function(){return o.extend({},this.__values)},isInstanceOf:function(e){return this.model==e},isA:function(e){return this.model==e||this.model.isDescendantOf(e)}}),o.extend(r.prototype,{_dumpString:function(e){return JSON.stringify(this._dump(e,null,4))},_dump:function(){var e=o.extend({},this.__values);return e._rev=this._rev,e.localId=this.localId,e}}),o.extend(r.prototype,{_defaultSerialise:function(e){var t={},n=void 0!==e.includeNullAttributes?e.includeNullAttributes:!0,r=void 0!==e.includeNullRelationships?e.includeNullRelationships:!0,s=this.model.serialisableFields||this._attributeNames.concat.apply(this._attributeNames,this._relationshipNames).concat(this.id);return this._attributeNames.forEach(function(e){if(s.indexOf(e)>-1){var r,o=this.model._attributeDefinitionWithName(e)||{};if(o.serialise)r=o.serialise.bind(this);else{var a=this.model.serialiseField||i;r=a.bind(this,e)}var l=this[e];null===l?n&&(t[e]=r(l)):void 0!==l&&(t[e]=r(l))}}.bind(this)),this._relationshipNames.forEach(function(e){if(s.indexOf(e)>-1){var n=this[e],a=this.model.relationships[e];if(a&&!a.isReverse){var l;if(a.serialise)l=a.serialise.bind(this);else{var c=this.model.serialiseField;c||(o.isArray(n)?n=o.pluck(n,this.model.id):n&&(n=n[this.model.id])),c=c||i,l=c.bind(this,e)}null===n?r&&(t[e]=l(n)):o.isArray(n)?(r&&!n.length||n.length)&&(t[e]=l(n)):void 0!==n&&(t[e]=l(n))}}}.bind(this)),t},serialise:function(e){return e=e||{},this.model.serialise?this.model.serialise(this,e):this._defaultSerialise(e)}}),o.extend(r.prototype,{_emitNew:function(){this.app.broadcast({collection:this.model.collectionName,model:this.model.name,localId:this.localId,"new":this,type:a.New,obj:this})}}),e.exports=r},function(e,t,n){function r(e){this.opts=e}function i(e){this._opts=e,s.extendFromOpts(this,e,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,fromStorage:!1}),s.extend(this,{errors:[],subTaskResults:{},_newObjects:[]}),this.model._installReversePlaceholders(),this.data=this.preprocessData()}var o=n(18),s=(n(17)("graph"),n(1));r.prototype.toString=function(){return JSON.stringify(this.opts,null,4)},s.extend(i.prototype,{mapAttributes:function(){for(var e=0;e<this.data.length;e++){var t=this.data[e],n=this.objects[e];if(t!=n&&n){var r=this.model._attributeNames;r.forEach(function(r){if(void 0!==t[r])if(this.disableevents)n.__values[r]=t[r];else try{n[r]=t[r]}catch(i){this.errors[e]=i}}.bind(this)),t._rev&&(n._rev=t._rev)}}},_map:function(){var e,t=this;this.mapAttributes();var n=Object.keys(t.subTaskResults);n.forEach(function(n){for(var r=t.subTaskResults[n],i=r.indexes,o=r.objects,a=t.getRelatedData(n).relatedData,l=s.unflattenArray(o,a),c=0;c<l.length;c++){var u=i[c],h=t.errors[u];if(e=h?h[n]:null,!e){var d=l[c],f=t.objects[u];f&&(e=f.__proxies[n].set(d,{disableevents:t.disableevents}),e&&(t.errors[u]||(t.errors[u]={}),t.errors[u][n]=e))}}})},_sortLookups:function(){for(var e=[],t=[],n=0;n<this.data.length;n++)if(!this.objects[n]){var r,i=this.data[n],s="string"==typeof i||"number"==typeof i||i instanceof String;i?s?(r={index:n,datum:{}},r.datum[this.model.id]=i,e.push(r)):i instanceof o?this.objects[n]=i:i.localId?t.push({index:n,datum:i}):i[this.model.id]?e.push({index:n,datum:i}):this.objects[n]=this._instance():this.objects[n]=null}return{remoteLookups:e,localLookups:t}},_performLocalLookups:function(e){for(var t=this.model.app.cache,n=s.pluck(s.pluck(e,"datum"),"localId"),r=t.getViaLocalId(n),i=0;i<n.length;i++){var o=r[i],a=n[i],l=e[i];o?this.objects[l.index]=o:(o=t.get({localId:a}),o||(o=this._instance({localId:a},!this.disableevents)),this.objects[l.index]=o)}},_performRemoteLookups:function(e){for(var t=this.model.app.cache,n=s.pluck(s.pluck(e,"datum"),this.model.id),r=t.getViaRemoteId(n,{model:this.model}),i=0;i<r.length;i++){var o=r[i],a=e[i];if(o)this.objects[a.index]=o;else{var l={},c=n[i];l[this.model.id]=c;var u={model:this.model};u[this.model.id]=c;var h=t.get(u);h?this.objects[a.index]=h:(this.objects[a.index]=this._instance(),this.objects[a.index][this.model.id]=c)}}},_lookup:function(){if(this.model.singleton)this._lookupSingleton();else{var e=this._sortLookups(),t=e.remoteLookups,n=e.localLookups;this._performLocalLookups(n),this._performRemoteLookups(t)}},_lookupSingleton:function(){var e,t=s.pluck(this.data,"localId");for(r=0;r<t.length;r++)if(t[r]){e={localId:t[r]};break}for(var n=this.model.app.cache.getSingleton(this.model)||this._instance(e),r=0;r<this.data.length;r++)this.objects[r]=n},_instance:function(){var e=this.model,t=e._instance.apply(e,arguments);return this._newObjects.push(t),t},preprocessData:function(){var e=s.extend([],this.data);return e.map(function(e){if(e&&!s.isString(e)){var t=Object.keys(e);t.forEach(function(t){var n=this.model._relationshipNames.indexOf(t)>-1;if(n){var r=e[t];r instanceof o&&(e[t]={localId:r.localId})}}.bind(this))}return e}.bind(this))},start:function(e){var t=this.data;if(t.length){var n=this,r=[];this._lookup(),r.push(this._executeSubOperations.bind(this)),s.parallel(r,function(t){t&&console.error(t),n._map();var r=this.fromStorage,i=n._newObjects.reduce(function(t,n){var i=n.model.init;if(i){var o=s.paramNames(i);o.length>1?t.push(i.bind(n,r,e)):i.call(n,r)}return n._emitEvents=!0,n._emitNew(),t},[]);s.parallel(i,function(){e(n.errors.length?n.errors:null,n.objects)})}.bind(this))}else e(null,[])},getRelatedData:function(e){for(var t=[],n=[],r=0;r<this.data.length;r++){var i=this.data[r];if(i){var o=i[e];o&&(t.push(r),n.push(o))}}return{indexes:t,relatedData:n}},processErrorsFromTask:function(e,t,n){if(t.length)for(var r=this.getRelatedData(e).relatedData,i=s.unflattenArray(t,r),o=0;o<i.length;o++){var a=n[o],l=i[o],c=l;s.isArray(l)&&(c=l.reduce(function(e,t){return e||t},!1)),c&&(this.errors[a]||(this.errors[a]={}),this.errors[a][e]=l)}},_executeSubOperations:function(e){var t=this,n=Object.keys(this.model.relationships);if(n.length){var r=n.reduce(function(e,n){var r=t.model.relationships[n],o=r.forwardName==n?r.reverseModel:r.forwardModel;o.singleton&&!r.isReverse&&this.data.forEach(function(e){e[n]||(e[n]={})});var a=this.getRelatedData(n),l=a.indexes,c=a.relatedData;if(c.length)var u=s.flattenArray(c),h=new i({model:o,data:u,disableevents:t.disableevents,_ignoreInstalled:t._ignoreInstalled,fromStorage:this.fromStorage});if(h){var d;d=function(e){h.start(function(r,i){t.subTaskResults[n]={errors:r,objects:i,indexes:l},t.processErrorsFromTask(n,h.errors,l),e()})},e.push(d)}return e}.bind(this),[]);s.parallel(r,function(t){e(t)})}else e()}}),e.exports=i},function(e,t,n){function r(e,t,n){if(!e)throw new Error("wtf");i.extend(this,{event:t,app:e,listeners:{}});var r={};r.on=this.on.bind(this),r.once=this.once.bind(this),o.call(this,i.extend(r,n||{}))}var i=(n(23).ArrayObserver,n(1)),o=(n(31),n(13),n(28));r.prototype=Object.create(o.prototype),i.extend(r.prototype,{on:function(e,t){if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var n=t;t=function(t){t=t||{},e?t.type==e&&n(t):n(t)};var r=this.listeners;e&&(r[e]||(r[e]=[]),r[e].push(t))}return this.app.events.on(this.event,t),this._handlerLink({fn:t,type:e,extend:this.proxyChainOpts})},once:function(e,t){var n=this.event;if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var r=t;t=function(i){i=i||{},e?i.type==e&&(this.app.events.removeListener(n,t),r(i)):r(i)}.bind(this)}return e?this.app.events.on(n,t):this.app.events.once(n,t)},_removeListener:function(e,t){if(t){var n=this.listeners[t],r=n.indexOf(e);n.splice(r,1)}return this.app.events.removeListener(this.event,e)},emit:function(e,t){"object"==typeof e?(t=e,e=null):(t=t||{},t.type=e),this.app.events.emit.call(this.app.events,this.event,t)},_removeAllListeners:function(e){(this.listeners[e]||[]).forEach(function(e){this.app.events.removeListener(this.event,e)}.bind(this)),this.listeners[e]=[]},removeAllListeners:function(e){if(e)this._removeAllListeners(e);else for(e in this.listeners)this.listeners.hasOwnProperty(e)&&this._removeAllListeners(e)}}),e.exports=r},function(e,t,n){function r(e){var t=e.name;this.app=e,this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},Object.defineProperties(this,{_unsavedObjects:{get:function(){return this.unsavedObjects}},_unsavedObjectsHash:{get:function(){return this.unsavedObjectsHash}},_unsavedObjectsByCollection:{get:function(){return this.unsavedObjectsByCollection}},_pouch:{get:function(){return this.pouch}}}),this.pouch=new PouchDB(t,{auto_compaction:!0})}var i=n(1),o=(n(4),n(17)("storage")),s=/_/g,a=/@/g;r.prototype={save:function(e){return i.promise(e,function(e){this.app._ensureInstalled(function(){var t=this.unsavedObjects;this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},this.saveToPouch(t,e)}.bind(this))}.bind(this))},saveToPouch:function(e,t){var n=[],r=e.map(this._serialise.bind(this));this.pouch.bulkDocs(r).then(function(r){for(var i=0;i<r.length;i++){var s=r[i],a=e[i];s.ok?a._rev=s.rev:409==s.status?n.push(a):o('Error saving object with localId="'+a.localId+'"',s)}n.length?this.saveConflicts(n,t):t()},function(e){t(e)})},saveConflicts:function(e,t){this.pouch.allDocs({keys:i.pluck(e,"localId")}).then(function(n){for(var r=0;r<n.rows.length;r++)e[r]._rev=n.rows[r].value.rev;this.saveToPouch(e,t)})["catch"](function(e){t(e)})},ensureIndexInstalled:function(e,t){function n(n){var r;n.ok||409==n.status&&(r=null,e.indexInstalled=!0),t(r)}this.pouch.put(this.constructIndexDesignDoc(e.collectionName,e.name)).then(n)["catch"](n)},loadModel:function(e,t){var n={},r=e.collectionName,o=e.modelName,s=e.model;s&&(r=s.collectionName,o=s.name);var a=this.fullyQualifiedModelName(r,o),l=this.app.collectionRegistry[r][o];this.pouch.query(a).then(function(e){var r=e.rows,o=i.pluck(r,"value").map(function(e){return this._prepareDatum(e,l)}.bind(this));o.map(function(e){var t=e[l.id];t&&(n[t]?console.error("Duplicates detected in storage. You have encountered a serious bug. Please report this."):n[t]=e)}),l._graph(o,{_ignoreInstalled:!0,disableevents:!0,fromStorage:!0},function(e,n){e?console.error("Error loading models",e):(this._listener=this.listener.bind(this),s.on("*",this._listener)),t(e,n)}.bind(this))}.bind(this))["catch"](function(e){t(e)})},_prepareDatum:function(e,t){this._processMeta(e),delete e.collection,delete e.model,e.localId=e._id,delete e._id;var n={};Object.keys(e).forEach(function(t){n[t.replace(a,"_")]=e[t]});var r=t._relationshipNames;return r.forEach(function(e){var t=n[e];t&&(n[e]=siesta.isArray(t)?t.map(function(e){return{localId:e}}):{localId:t})}),n},_processMeta:function(e){var t=e.siesta_meta||this._initMeta();t.dateFields.forEach(function(t){var n=e[t];n instanceof Date||(e[t]=new Date(n))}),delete e.siesta_meta},_initMeta:function(){return{dateFields:[]}},_addMeta:function(e){e.siesta_meta=this._initMeta();for(var t in e)e.hasOwnProperty(t)&&e[t]instanceof Date&&(e.siesta_meta.dateFields.push(t),e[t]=e[t].getTime())},listener:function(e){var t=e.obj,n=t.localId;if(!t)throw new Error("No obj field in notification received by storage extension");if(!(n in this.unsavedObjectsHash)){this.unsavedObjectsHash[n]=t,this.unsavedObjects.push(t);var r=t.collectionName;this.unsavedObjectsByCollection[r]||(this.unsavedObjectsByCollection[r]={});var i=t.model.name;this.unsavedObjectsByCollection[r][i]||(this.unsavedObjectsByCollection[r][i]={}),this.unsavedObjectsByCollection[r][i][n]=t}},_reset:function(e){this._listener&&this.app.removeListener("Siesta",this._listener),this.unsavedObjects=[],this.unsavedObjectsHash={},this.pouch.allDocs().then(function(t){var n=t.rows.map(function(e){return{_id:e.id,_rev:e.value.rev,_deleted:!0}});this.pouch.bulkDocs(n).then(function(){e()})["catch"](e)}.bind(this))["catch"](e)},_serialise:function(e){var t={},n=e.__values;t=i.extend(t,n),Object.keys(t).forEach(function(e){t[e.replace(s,"@")]=n[e]}),this._addMeta(t),t.collection=e.collectionName,t.model=e.modelName,t._id=e.localId,e.removed&&(t._deleted=!0);var r=e._rev;return r&&(t._rev=r),t=e._relationshipNames.reduce(function(t,n){var r=e[n];return siesta.isArray(r)?t[n]=i.pluck(r,"localId"):r&&(t[n]=r.localId),t},t)},constructIndexDesignDoc:function(e,t){var n=this.fullyQualifiedModelName(e,t),r={};return r[n]={map:function(e){"$1"==e.collection&&"$2"==e.model&&emit(e.collection+"."+e.model,e)}.toString().replace("$1",e).replace("$2",t)},{_id:"_design/"+n,views:r}},fullyQualifiedModelName:function(e,t){return e+"."+t}},e.exports=r},function(e){var t,n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,i=function(e){"use strict";if(!e||"[object Object]"!==r.call(e)||e.nodeType||e.setInterval)return!1;var i=n.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;var s;for(s in e);return s===t||n.call(e,s)};e.exports=function o(){"use strict";var e,n,r,s,a,l,c=arguments[0],u=1,h=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},u=2):("object"!=typeof c&&"function"!=typeof c||c==t)&&(c={});h>u;++u)if(null!=(e=arguments[u]))for(n in e)r=c[n],s=e[n],c!==s&&(d&&s&&(i(s)||(a=Array.isArray(s)))?(a?(a=!1,l=r&&Array.isArray(r)?r:[]):l=r&&i(r)?r:{},c[n]=o(d,l,s)):s!==t&&(c[n]=s));return c}},function(module,exports,__webpack_require__){(function(global,module){!function(global){"use strict";function detectObjectObserve(){function e(e){t=e}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var t=[],n={},r=[];return Object.observe(n,e),Array.observe(r,e),n.id=1,n.id=2,delete n.id,r.push(1,2),r.length=0,Object.deliverChangeRecords(e),5!==t.length?!1:"add"!=t[0].type||"update"!=t[1].type||"delete"!=t[2].type||"splice"!=t[3].type||"splice"!=t[4].type?!1:(Object.unobserve(n,e),Array.unobserve(r,e),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if(navigator.getDeviceStorage)return!1;try{var e=new Function("","return true;");return e()}catch(t){return!1}}function isIndex(e){return+e===e>>>0&&""!==e}function toNumber(e){return+e}function dirtyCheck(e){for(var t=0;MAX_DIRTY_CHECK_CYCLES>t&&e.check_();)t++;return testingExposeCycleCount&&(global.dirtyCheckCycleCount=t),t>0}function objectIsEmpty(e){for(var t in e)return!1;return!0}function diffIsEmpty(e){return objectIsEmpty(e.added)&&objectIsEmpty(e.removed)&&objectIsEmpty(e.changed)}function diffObjectFromOldObject(e,t){var n={},r={},i={};for(var o in t){var s=e[o];(void 0===s||s!==t[o])&&(o in e?s!==t[o]&&(i[o]=s):r[o]=void 0)}for(var o in e)o in t||(n[o]=e[o]);return Array.isArray(e)&&e.length!==t.length&&(i.length=e.length),{added:n,removed:r,changed:i}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var e=0;e<eomTasks.length;e++)eomTasks[e]();return eomTasks.length=0,!0}function newObservedObject(){function e(e){t&&t.state_===OPENED&&!r&&t.check_(e)}var t,n,r=!1,i=!0;return{open:function(n){if(t)throw Error("ObservedObject in use");i||Object.deliverChangeRecords(e),t=n,i=!1},observe:function(t,r){n=t,r?Array.observe(n,e):Object.observe(n,e)},deliver:function(t){r=t,Object.deliverChangeRecords(e),r=!1},close:function(){t=void 0,Object.unobserve(n,e),observedObjectCache.push(this)}}}function getObservedObject(e,t,n){var r=observedObjectCache.pop()||newObservedObject();return r.open(e),r.observe(t,n),r}function newObservedSet(){function e(t,o){t&&(t===r&&(i[o]=!0),a.indexOf(t)<0&&(a.push(t),Object.observe(t,n)),e(Object.getPrototypeOf(t),o))}function t(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.object!==r||i[n.name]||"setPrototype"===n.type)return!1}return!0}function n(n){if(!t(n)){for(var r,i=0;i<s.length;i++)r=s[i],r.state_==OPENED&&r.iterateObjects_(e);for(var i=0;i<s.length;i++)r=s[i],r.state_==OPENED&&r.check_()}}var r,i,o=0,s=[],a=[],l={object:void 0,objects:a,open:function(t,n){r||(r=n,i={}),s.push(t),o++,t.iterateObjects_(e)},close:function(){if(o--,!(o>0)){for(var e=0;e<a.length;e++)Object.unobserve(a[e],n),Observer.unobservedCount++;s.length=0,a.length=0,r=void 0,i=void 0,observedSetCache.push(this)}}};return l}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(e){Observer._allObserversCount++,collectObservers&&allObservers.push(e)}function removeFromAll(){Observer._allObserversCount--}function ObjectObserver(e){Observer.call(this),this.value_=e,this.oldObject_=void 0}function ArrayObserver(e){if(!Array.isArray(e))throw Error("Provided object is not an Array");ObjectObserver.call(this,e)}function diffObjectFromChangeRecords(e,t,n){for(var r={},i={},o=0;o<t.length;o++){var s=t[o];expectedRecordTypes[s.type]?(s.name in n||(n[s.name]=s.oldValue),"update"!=s.type&&("add"!=s.type?s.name in r?(delete r[s.name],delete n[s.name]):i[s.name]=!0:s.name in i?delete i[s.name]:r[s.name]=!0)):(console.error("Unknown changeRecord type: "+s.type),console.error(s))}for(var a in r)r[a]=e[a];for(var a in i)i[a]=void 0;var l={};for(var a in n)if(!(a in r||a in i)){var c=e[a];n[a]!==c&&(l[a]=c)}return{added:r,removed:i,changed:l}}function newSplice(e,t,n){return{index:e,removed:t,addedCount:n}}function ArraySplice(){}function calcSplices(e,t,n,r,i,o){return arraySplice.calcSplices(e,t,n,r,i,o)}function intersect(e,t,n,r){return n>t||e>r?-1:t==n||r==e?0:n>e?r>t?t-n:r-n:t>r?r-e:t-e}function mergeSplice(e,t,n,r){for(var i=newSplice(t,n,r),o=!1,s=0,a=0;a<e.length;a++){var l=e[a];if(l.index+=s,!o){var c=intersect(i.index,i.index+i.removed.length,l.index,l.index+l.addedCount);if(c>=0){e.splice(a,1),a--,s-=l.addedCount-l.removed.length,i.addedCount+=l.addedCount-c;var u=i.removed.length+l.removed.length-c;if(i.addedCount||u){var n=l.removed;if(i.index<l.index){var h=i.removed.slice(0,l.index-i.index);Array.prototype.push.apply(h,n),n=h}if(i.index+i.removed.length>l.index+l.addedCount){var d=i.removed.slice(l.index+l.addedCount-i.index);Array.prototype.push.apply(n,d)}i.removed=n,l.index<i.index&&(i.index=l.index)}else o=!0}else if(i.index<l.index){o=!0,e.splice(a,0,i),a++;var f=i.addedCount-i.removed.length;l.index+=f,s+=f}}}o||e.push(i)}function createInitialSplices(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r];switch(i.type){case"splice":mergeSplice(n,i.index,i.removed.slice(),i.addedCount);break;case"add":case"update":case"delete":if(!isIndex(i.name))continue;var o=toNumber(i.name);if(0>o)continue;mergeSplice(n,o,[i.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(i))}}return n}function projectArraySplices(e,t){var n=[];return createInitialSplices(e,t).forEach(function(t){return 1==t.addedCount&&1==t.removed.length?void(t.removed[0]!==e[t.index]&&n.push(t)):void(n=n.concat(calcSplices(e,t.index,t.index+t.addedCount,t.removed,0,t.removed.length)))}),n}var testingExposeCycleCount=global.testingExposeCycleCount,hasObserve=detectObjectObserve(),hasEval=detectEval(),numberIsNaN=global.Number.isNaN||function(e){return"number"==typeof e&&global.isNaN(e)},createObject="__proto__"in{}?function(e){return e}:function(e){var t=e.__proto__;if(!t)return e;var n=Object.create(t);return Object.getOwnPropertyNames(e).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),n},identStart="[$_a-zA-Z]",identPart="[$_a-zA-Z0-9]",MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var e={pingPong:!0},t=!1;return Object.observe(e,function(){runEOMTasks(),t=!1}),function(n){eomTasks.push(n),t||(t=!0,e.pingPong=!e.pingPong)}}():function(){return function(e){eomTasks.push(e)}}(),observedObjectCache=[],observedSetCache=[],lastObservedSet,UNOPENED=0,OPENED=1,CLOSED=2,nextObserverId=1;Observer.prototype={open:function(e,t){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=e,this.target_=t,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)
},report_:function(e){try{this.callback_.apply(this.target_,e)}catch(t){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(t.stack||t))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(e){var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=e[n];return Array.isArray(e)&&(t.length=e.length),t},check_:function(e){var t,n;if(hasObserve){if(!e)return!1;n={},t=diffObjectFromChangeRecords(this.value_,e,n)}else n=this.oldObject_,t=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(t)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t.added||{},t.removed||{},t.changed||{},function(e){return n[e]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:!0,copyObject:function(e){return e.slice()},check_:function(e){var t;if(hasObserve){if(!e)return!1;t=projectArraySplices(this.value_,e)}else t=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return t&&t.length?(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t]),!0):!1}}),ArrayObserver.applySplices=function(e,t,n){n.forEach(function(n){for(var r=[n.index,n.removed.length],i=n.index;i<n.index+n.addedCount;)r.push(t[i]),i++;Array.prototype.splice.apply(e,r)})};var observerSentinel={},expectedRecordTypes={add:!0,update:!0,"delete":!0},EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;ArraySplice.prototype={calcEditDistances:function(e,t,n,r,i,o){for(var s=o-i+1,a=n-t+1,l=new Array(s),c=0;s>c;c++)l[c]=new Array(a),l[c][0]=c;for(var u=0;a>u;u++)l[0][u]=u;for(var c=1;s>c;c++)for(var u=1;a>u;u++)if(this.equals(e[t+u-1],r[i+c-1]))l[c][u]=l[c-1][u-1];else{var h=l[c-1][u]+1,d=l[c][u-1]+1;l[c][u]=d>h?h:d}return l},spliceOperationsFromEditDistances:function(e){for(var t=e.length-1,n=e[0].length-1,r=e[t][n],i=[];t>0||n>0;)if(0!=t)if(0!=n){var o,s=e[t-1][n-1],a=e[t-1][n],l=e[t][n-1];o=l>a?s>a?a:s:s>l?l:s,o==s?(s==r?i.push(EDIT_LEAVE):(i.push(EDIT_UPDATE),r=s),t--,n--):o==a?(i.push(EDIT_DELETE),t--,r=a):(i.push(EDIT_ADD),n--,r=l)}else i.push(EDIT_DELETE),t--;else i.push(EDIT_ADD),n--;return i.reverse(),i},calcSplices:function(e,t,n,r,i,o){var s=0,a=0,l=Math.min(n-t,o-i);if(0==t&&0==i&&(s=this.sharedPrefix(e,r,l)),n==e.length&&o==r.length&&(a=this.sharedSuffix(e,r,l-s)),t+=s,i+=s,n-=a,o-=a,n-t==0&&o-i==0)return[];if(t==n){for(var c=newSplice(t,[],0);o>i;)c.removed.push(r[i++]);return[c]}if(i==o)return[newSplice(t,[],n-t)];for(var u=this.spliceOperationsFromEditDistances(this.calcEditDistances(e,t,n,r,i,o)),c=void 0,h=[],d=t,f=i,p=0;p<u.length;p++)switch(u[p]){case EDIT_LEAVE:c&&(h.push(c),c=void 0),d++,f++;break;case EDIT_UPDATE:c||(c=newSplice(d,[],0)),c.addedCount++,d++,c.removed.push(r[f]),f++;break;case EDIT_ADD:c||(c=newSplice(d,[],0)),c.addedCount++,d++;break;case EDIT_DELETE:c||(c=newSplice(d,[],0)),c.removed.push(r[f]),f++}return c&&h.push(c),h},sharedPrefix:function(e,t,n){for(var r=0;n>r;r++)if(!this.equals(e[r],t[r]))return r;return n},sharedSuffix:function(e,t,n){for(var r=e.length,i=t.length,o=0;n>o&&this.equals(e[--r],t[--i]);)o++;return o},calculateSplices:function(e,t){return this.calcSplices(e,0,e.length,t,0,t.length)},equals:function(e,t){return e===t}};var arraySplice=new ArraySplice,expose=global;"undefined"!=typeof module&&module.exports&&(expose=exports=module.exports),expose=exports,expose.Observer=Observer,expose.Observer.runEOM_=runEOM,expose.Observer.observerSentinel_=observerSentinel,expose.Observer.hasObjectObserve=hasObserve,expose.ArrayObserver=ArrayObserver,expose.ArrayObserver.calculateSplices=function(e,t){return arraySplice.calculateSplices(e,t)},expose.Platform=global.Platform,expose.ArraySplice=ArraySplice,expose.ObjectObserver=ObjectObserver}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window)}).call(exports,function(){return this}(),__webpack_require__(36)(module))},function(e,t,n){function r(){return this?void(this.collectionNames=[]):new r}var i=n(1);i.extend(r.prototype,{register:function(e){var t=e.name;this[t]=e,this.collectionNames.push(t)},reset:function(){var e=this;this.collectionNames.forEach(function(t){delete e[t]}),this.collectionNames=[]}}),e.exports=r},function(e,t,n){function r(e,t){(void 0===t||null===t)&&(t=!0),e=e||function(e){e()},this._promise=new i.Promise(function(t,n){this.reject=n,this.resolve=t,this.fn=function(){this.executed=!0;var r=0,o=[],s=[];if(i.isArray(e)){var a=function(){r==e.length&&(s.length?n(s):t(o))}.bind(this);e.forEach(function(e,t){e.then(function(e){o[t]=e,r++,a()})["catch"](function(e){s[t]=e,r++,a()})})}else e(function(e,r){e?n(e):t(r)}.bind(this))}}.bind(this)),t||this._execute(),this.executed=!1,this.dependent=[]}var i=n(1),o=n(31);r.all=o(function(e){return new r(e)}),r.prototype={_execute:function(){this.executed||(Promise.all(i.pluck(this.dependent,"_promise")).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()}))},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){}},e.exports=r},function(e,t,n){function r(e){i.extend(this,e||{}),this.isPlaceholder=!0}var i=n(1);e.exports=r},function(e,t,n){function r(e){this.model=e}var i=n(17)("model"),o=n(4).InternalSiestaError,s=n(6),a=(n(14),n(18)),l=n(1),c=l.guid,u=(n(22),n(13)),h=u.wrapArray,d=n(11),f=n(10),p=n(8),v=(n(7),u.ModelEventType);r.prototype={_getLocalId:function(e){var t;return t=e&&e.localId?e.localId:c()},_installAttributes:function(e,t){var n=this.model,r=n._attributeNames,i=r.indexOf(n.id);l.extend(e,{__values:l.extend(n.attributes.reduce(function(e,t){return void 0!==t["default"]&&(e[t.name]=t["default"]),e},{}),t||{})}),i>-1&&r.splice(i,1),r.forEach(function(t){var r=n._attributeDefinitionWithName(t);Object.defineProperty(e,t,{get:function(){var n=e.__values[t];return void 0===n?null:n},set:function(i){r.parse&&(i=r.parse.call(e,i)),n.parseAttribute&&(i=n.parseAttribute.call(e,t,i));var o=e.__values[t],s=this._propertyDependencies[t]||[];s=s.map(function(t){try{var n=this[t]}catch(r){throw console.error('Uncaught error during property access for model "'+e.model.name+'"',r),r}return{prop:t,old:n}}.bind(this)),e.__values[t]=i,s.forEach(function(t){var r=t.prop,i=this[r];n.app.broadcast({collection:n.collectionName,model:n.name,localId:e.localId,"new":i,old:t.old,type:v.Set,field:r,obj:e})}.bind(this));var a={collection:n.collectionName,model:n.name,localId:e.localId,"new":i,old:o,type:v.Set,field:t,obj:e};window.lastEmission=a,n.app.broadcast(a),l.isArray(i)&&h(i,t,e)},enumerable:!0,configurable:!0})})},_installMethods:function(e){var t=this.model;Object.keys(t.methods).forEach(function(n){void 0===e[n]?e[n]=t.methods[n].bind(e):i('A method with name "'+n+'" already exists. Ignoring it.')}.bind(this))},_installProperties:function(e){var t=Object.keys(this.model.properties),n={};t.forEach(function(t){var r=this.model.properties[t],o=r.dependencies||[];o.forEach(function(e){n[e]||(n[e]=[]),n[e].push(t)}),delete r.dependencies,void 0===e[t]?Object.defineProperty(e,t,r):i('A property/method with name "'+t+'" already exists. Ignoring it.')}.bind(this)),e._propertyDependencies=n},_installRemoteId:function(e){var t=this.model,n=t.app.cache,r=t.id;Object.defineProperty(e,r,{get:function(){return e.__values[t.id]||null},set:function(r){var i=e[t.id];e.__values[t.id]=r,t.app.broadcast({collection:t.collectionName,model:t.name,localId:e.localId,"new":r,old:i,type:v.Set,field:t.id,obj:e}),n.remoteInsert(e,r,i)},enumerable:!0,configurable:!0})},_installRelationship:function(e,t){var n,r=e.type;if(r==s.OneToMany)n=new d(e);else if(r==s.OneToOne)n=new f(e);else{if(r!=s.ManyToMany)throw new o("No such relationship type: "+r);n=new p(e)}n.install(t)},_installRelationshipProxies:function(e){var t=this.model;for(var n in t.relationships)if(t.relationships.hasOwnProperty(n)){var r=l.extend({},t.relationships[n]);this._installRelationship(r,e)}},_registerInstance:function(e,t){var n=this.model.app.cache;n.insert(e),t=void 0===t?!0:t,t&&e._emitNew()},_installLocalId:function(e,t){e.localId=this._getLocalId(t)},_instance:function(e,t){var n=new a(this.model);return this._installLocalId(n,e),this._installAttributes(n,e),this._installMethods(n),this._installProperties(n),this._installRemoteId(n),this._installRelationshipProxies(n),this._registerInstance(n,t),n}},e.exports=r},function(e,t,n){function r(e){this.opts=e}var i=n(31);r.prototype={_handlerLink:function(e){var t;return t=function(){var n=e.type;e.fn&&this._removeListener(e.fn,n),t._parentLink&&t._parentLink()}.bind(this),Object.keys(this.opts).forEach(function(e){var n=this.opts[e];t[e]=i(function(e){var r=n.apply(n.__siesta_bound_object,e);return r._parentLink=t,r}.bind(this))}.bind(this)),t._parentLink=null,t},_link:function(e,t){var n=this;t=t||function(){};var r;return r=function(){t(),r._parentLink&&r._parentLink()}.bind(this),r.__siesta_isLink=!0,r.opts=e,r.clean=t,Object.keys(e).forEach(function(t){var o=e[t];r[t]=i(function(e){var t=o.apply(o.__siesta_bound_object,e);if(t&&t.__siesta_isLink)var i=t;else{i=n._link(r.opts);for(var s in t)t[s]instanceof Function&&(i[s]=t[s])}i._parentLink=r;for(s in r)r[s]instanceof Function&&(i[s]=r[s].bind(r));return i}.bind(this))}.bind(this)),r._parentLink=null,r}},e.exports=r},function(e,t,n){function r(){this.reset(),Object.defineProperty(this,"_localCacheByType",{get:function(){return this.local}})}var i=n(17)("cache"),o=n(4).InternalSiestaError,s=n(1);r.prototype={reset:function(){this.remote={},this.localById={},this.local={}},getViaLocalId:function(e){return s.isArray(e)?e.map(function(e){return this.localById[e]}.bind(this)):this.localById[e]},getViaRemoteId:function(e,t){var n=(this.remote[t.model.collectionName]||{})[t.model.name]||{};return s.isArray(e)?e.map(function(e){return n[e]}):n[e]},getSingleton:function(e){var t=e.name,n=e.collectionName,r=this.local[n];if(r){var i=r[t];if(i){var s=[];for(var a in i)i.hasOwnProperty(a)&&s.push(i[a]);if(s.length>1){var l="A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.";throw new o(l)}if(s.length)return s[0]}}return null},remoteInsert:function(e,t,n){if(!e){var r="Must pass an object when inserting to cache";throw i(r),new o(r)}var s=e.model.collectionName;if(!s)throw new o("Model has no collection",{model:e.model,obj:e});this.remote[s]||(this.remote[s]={});var a=e.model.name;if(!a)throw new o("Model has no type",{model:e.model,obj:e});this.remote[s][a]||(this.remote[s][a]={}),n&&(this.remote[s][a][n]=null);var l=this.remote[s][a][t];if(l){if(e!=l){var c="Object "+s.toString()+":"+a.toString()+"["+e.model.id+'="'+t+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild';throw i(c,{obj:e,cachedObject:l}),new o(c)}}else this.remote[s][a][t]=e,i("Remote cache insert: "+e._dump(!0))},get:function(e){i("get",e);var t,n,r,o=e.localId;if(o)return t=this.getViaLocalId(o),t?t:e.model?(n=e.model.id,r=e[n],i(n+"="+r),this.getViaRemoteId(r,e)):null;if(e.model){if(n=e.model.id,r=e[n])return this.getViaRemoteId(r,e);if(e.model.singleton)return this.getSingleton(e.model)}else i("Invalid opts to cache",{opts:e});return null},_remoteCache:function(){return this.remote},_localCache:function(){return this.localById},insert:function(e){var t=e.localId;if(t){var n=e.model.collectionName,r=e.model.name;if(this.localById[t]){if(this.localById[t]!=e){var s='Object with localId="'+t.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild';throw i(s),new o(s)}}else this.localById[t]=e,this.local[n]||(this.local[n]={}),this.local[n][r]||(this.local[n][r]={}),this.local[n][r][t]=e}var a=e.idField,l=e[a];l?this.remoteInsert(e,l):i('No remote id ("'+a+'") so wont be placing in the remote cache',e)},contains:function(e){var t={localId:e.localId},n=e.model;return n.id&&e[n.id]&&(t.model=n,t[n.id]=e[n.id]),!!this.get(t)},remove:function(e){if(this.contains(e)){var t=e.model.collectionName,n=e.model.name,r=e.localId;if(!n)throw o("No mapping name");if(!t)throw o("No collection name");if(!r)throw o("No localId");if(delete this.local[t][n][r],delete this.localById[r],e.model.id){var i=e[e.model.id];i&&delete this.remote[t][n][i]}}},count:function(){return Object.keys(this.localById).length}},e.exports=r},function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,o=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r),e}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?l.removeItem("debug"):l.debug=e}catch(t){}}function a(){var e;try{e=l.debug}catch(t){}return e}t=e.exports=n(35),t.log=o,t.formatArgs=i,t.save=s,t.load=a,t.useColors=r;var l;l="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:window.localStorage,t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(a())},function(e){"use strict";function t(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}e.exports=t},function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var o=n(37).nextTick,s=Function.prototype.apply,a=Array.prototype.slice,l={},c=0;t.setTimeout=function(){return new i(s.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(s.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:a.call(arguments,1);return l[n]=!0,o(function(){l[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete l[e]}}).call(t,n(32).setImmediate,n(32).clearImmediate)},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function r(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,r,s,a,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(r=this._events[e],o(r))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,a=new Array(s-1),l=1;s>l;l++)a[l-1]=arguments[l];r.apply(this,a)}else if(i(r)){for(s=arguments.length,a=new Array(s-1),l=1;s>l;l++)a[l-1]=arguments[l];for(c=r.slice(),s=c.length,l=0;s>l;l++)c[l].apply(this,a)}return!0},t.prototype.addListener=function(e,r){var s;if(!n(r))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:r),this._events[e]?i(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,i(this._events[e])&&!this._events[e].warned){var s;s=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,s&&s>0&&this._events[e].length>s&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var i=!1;return r.listener=t,this.on(e,r),this},t.prototype.removeListener=function(e,t){var r,o,s,a;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],s=r.length,o=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(a=s;a-->0;)if(r[a]===t||r[a].listener&&r[a].listener===t){o=a;break}if(0>o)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],n(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?n(e._events[t])?1:e._events[t].length:0}},function(e,t){var n,n;(function(t){!function(t){e.exports=t()}(function(){return function e(t,r,i){function o(a,l){if(!r[a]){if(!t[a]){var c="function"==typeof n&&n;if(!l&&c)return n(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[a]={exports:{}};t[a][0].call(h.exports,function(e){var n=t[a][1][e];return o(n?n:e)},h,h.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof n&&n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t){"use strict";function n(){}t.exports=n},{}],2:[function(e,t){"use strict";function n(e){function t(e,t){function r(e){c[t]=e,++u===n&!l&&(l=!0,a.resolve(d,c))}o(e).then(r,function(e){l||(l=!0,a.reject(d,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var n=e.length,l=!1;if(!n)return o([]);for(var c=new Array(n),u=0,h=-1,d=new r(s);++h<n;)t(e[h],h);return d}var r=e("./promise"),i=e("./reject"),o=e("./resolve"),s=e("./INTERNAL"),a=e("./handlers");t.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":5,"./reject":8,"./resolve":9}],3:[function(e,t,n){"use strict";function r(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var i=e("./tryCatch"),o=e("./resolveThenable"),s=e("./states");n.resolve=function(e,t){var a=i(r,t);if("error"===a.status)return n.reject(e,a.value);var l=a.value;if(l)o.safely(e,l);else{e.state=s.FULFILLED,e.outcome=t;for(var c=-1,u=e.queue.length;++c<u;)e.queue[c].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s.REJECTED,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":10,"./states":11,"./tryCatch":12}],4:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all"),n.race=e("./race")},{"./all":2,"./promise":5,"./race":7,"./reject":8,"./resolve":9}],5:[function(e,t){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=s.PENDING,this.queue=[],this.outcome=void 0,e!==i&&o.safely(this,e)}var r=e("./unwrap"),i=e("./INTERNAL"),o=e("./resolveThenable"),s=e("./states"),a=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s.FULFILLED||"function"!=typeof t&&this.state===s.REJECTED)return this;var o=new n(i);if(this.state!==s.PENDING){var l=this.state===s.FULFILLED?e:t;r(o,l,this.outcome)}else this.queue.push(new a(o,e,t));return o}},{"./INTERNAL":1,"./queueItem":6,"./resolveThenable":10,"./states":11,"./unwrap":13}],6:[function(e,t){"use strict";function n(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var r=e("./handlers"),i=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){r.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)}},{"./handlers":3,"./unwrap":13}],7:[function(e,t){"use strict";function n(e){function t(e){o(e).then(function(e){l||(l=!0,a.resolve(u,e))},function(e){l||(l=!0,a.reject(u,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return i(new TypeError("must be an array"));var n=e.length,l=!1;if(!n)return o([]);for(var c=-1,u=new r(s);++c<n;)t(e[c]);return u}var r=e("./promise"),i=e("./reject"),o=e("./resolve"),s=e("./INTERNAL"),a=e("./handlers");t.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":5,"./reject":8,"./resolve":9}],8:[function(e,t){"use strict";function n(e){var t=new r(i);return o.reject(t,e)}var r=e("./promise"),i=e("./INTERNAL"),o=e("./handlers");t.exports=n},{"./INTERNAL":1,"./handlers":3,"./promise":5}],9:[function(e,t){"use strict";function n(e){if(e)return e instanceof r?e:o.resolve(new r(i),e);var t=typeof e;switch(t){case"boolean":return s;case"undefined":return l;case"object":return a;case"number":return c;case"string":return u}}var r=e("./promise"),i=e("./INTERNAL"),o=e("./handlers");t.exports=n;var s=o.resolve(new r(i),!1),a=o.resolve(new r(i),null),l=o.resolve(new r(i),void 0),c=o.resolve(new r(i),0),u=o.resolve(new r(i),"")},{"./INTERNAL":1,"./handlers":3,"./promise":5}],10:[function(e,t,n){"use strict";function r(e,t){function n(t){a||(a=!0,i.reject(e,t))}function r(t){a||(a=!0,i.resolve(e,t))}function s(){t(r,n)}var a=!1,l=o(s);"error"===l.status&&n(l.value)}var i=e("./handlers"),o=e("./tryCatch");n.safely=r},{"./handlers":3,"./tryCatch":12}],11:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],12:[function(e,t){"use strict";function n(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}t.exports=n},{}],13:[function(e,t){"use strict";function n(e,t,n){r(function(){var r;try{r=t(n)}catch(o){return i.reject(e,o)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)})}var r=e("immediate"),i=e("./handlers");t.exports=n},{"./handlers":3,immediate:15}],14:[function(){},{}],15:[function(e,t){"use strict";function n(){i=!0;for(var e,t,n=a.length;n;){for(t=a,a=[],e=-1;++e<n;)t[e]();n=a.length}i=!1}function r(e){1!==a.push(e)||i||o()}for(var i,o,s=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=[],l=-1,c=s.length;++l<c;)if(s[l]&&s[l].test&&s[l].test()){o=s[l].install(n);break}t.exports=r},{"./messageChannel":16,"./mutation.js":17,"./nextTick":14,"./stateChange":18,"./timeout":19}],16:[function(e,n,r){(function(e){"use strict";r.test=function(){return e.setImmediate?!1:"undefined"!=typeof e.MessageChannel},r.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(e,n,r){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;r.test=function(){return t},r.install=function(n){var r=0,i=new t(n),o=e.document.createTextNode("");return i.observe(o,{characterData:!0}),function(){o.data=r=++r%2}}}).call(this,"undefined"!=typeof t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],18:[function(e,n,r){(function(e){"use strict";r.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},r.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this,"undefined"!=typeof t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],19:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}]},{},[4])(4)})}).call(t,function(){return this}())},function(e,t,n){function r(){return t.colors[u++%t.colors.length]}function i(e){function n(){}function i(){var e=i,n=+new Date,o=n-(c||n);e.diff=o,e.prev=c,e.curr=n,c=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=r());var s=Array.prototype.slice.call(arguments);s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;a++;var i=t.formatters[r];if("function"==typeof i){var o=s[a];n=i.call(e,o),s.splice(a,1),a--}return n}),"function"==typeof t.formatArgs&&(s=t.formatArgs.apply(e,s));var l=i.log||t.log||console.log.bind(console);l.apply(e,s)}n.enabled=!1,i.enabled=!0;var o=t.enabled(e)?i:n;return o.namespace=e,o}function o(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;r>i;i++)n[i]&&(e=n[i].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function s(){t.enable("")}function a(e){var n,r;for(n=0,r=t.skips.length;r>n;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;r>n;n++)if(t.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=n(38),t.names=[],t.skips=[],t.formatters={};var c,u=0},function(e){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e){function t(){if(!o){o=!0;for(var e,t=i.length;t;){e=i,i=[];for(var n=-1;++n<t;)e[n]();t=i.length}o=!1}}function n(){}var r=e.exports={},i=[],o=!1;r.nextTick=function(e){i.push(e),o||setTimeout(t,0)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e){function t(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"y":return n*c;case"days":case"day":case"d":return n*l;case"hours":case"hour":case"h":return n*a;case"minutes":case"minute":case"m":return n*s;case"seconds":case"second":case"s":return n*o;case"ms":return n}}}function n(e){return e>=l?Math.round(e/l)+"d":e>=a?Math.round(e/a)+"h":e>=s?Math.round(e/s)+"m":e>=o?Math.round(e/o)+"s":e+"ms"}function r(e){return i(e,l,"day")||i(e,a,"hour")||i(e,s,"minute")||i(e,o,"second")||e+" ms"}function i(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var o=1e3,s=60*o,a=60*s,l=24*a,c=365.25*l;e.exports=function(e,i){return i=i||{},"string"==typeof e?t(e):i["long"]?r(e):n(e)}}]);
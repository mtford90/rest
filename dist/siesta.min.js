(function L(v,l,q){function n(f,d){if(!l[f]){if(!v[f]){var m="function"==typeof require&&require;if(!d&&m)return m(f,!0);if(k)return k(f,!0);m=Error("Cannot find module '"+f+"'");throw m.code="MODULE_NOT_FOUND",m;}m=l[f]={g:{}};v[f][0].call(m.g,function(b){var g=v[f][1][b];return n(g?g:b)},m,m.g,L,v,l,q)}return l[f].g}for(var k="function"==typeof require&&require,f=0;f<q.length;f++)n(q[f]);return n})({1:[function(h,v){function l(a){q.call(this,a);this.T="index"}var q=h("./reactiveQuery"),n=h("./log"),
k=h("./util"),f=h("./error"),r=h("./modelEvents"),d=f.F,m=h("./querySet"),b=f.$b(f.Components.rd),g=k.h;n.B("Query");l.prototype=Object.create(q.prototype);g.extend(l.prototype,{Kc:function(){var a=this.k,e=this.T;if(!a)throw new d("ArrangedReactiveQuery must be initialised");for(var c=0;c<a.length;c++)a[c][e]=c},Ud:function(){for(var a=this.k,e=[],c=[],p=[],t=0;t<a.length;t++){var b=a[t],d=b[this.T];void 0==d?p.push(b):d>a.length?c.push(b):e[d]?p.push(b):e[d]=b}c=g.gf(c,function(a){return a[this.T]}.bind(this));
for(t=0;t<c.length;t++)b=c[t],a=this.k.length-c.length+t,b[this.T]=a,e[a]=b;p=this.I.Nb(p);for(c=0;p.length;){for(b=p.shift();e[c];)c++;e[c]=b;b[this.T]=c}this.k=m(e,this.a)},ga:function(a){var e=k.defer(a);q.prototype.ga.call(this,function(a){a||(this.a.Ae(this.T)?(this.Ud(),this.I.ie()):a=b('Model "'+this.a.name+'" does not have an attribute named "'+this.T+'"'));e.finish(a,a?null:this.k)}.bind(this));return e.m},Ib:function(a){a.s!=this.T&&(q.prototype.Ib.call(this,a),this.Kc())},xb:function(a){var e=
this.k.length-1;if(!(0<=a&&a<=e))throw Error("Index "+a.toString()+" is out of bounds");},of:function(a,e){this.xb(a);this.xb(e);var c=this.k[a],p=this.k[e];if(!c)throw Error('No model at index "'+a.toString()+'"');if(!p)throw Error('No model at index "'+e.toString()+'"');this.k[e]=c;this.k[a]=p;c[this.T]=e;p[this.T]=a},dh:function(a,e){this.of(this.k.indexOf(a),this.k.indexOf(e))},move:function(a,e){this.xb(a);this.xb(e);var c=this.k.Ya();(function(a,c){if(c>=this.length)for(var e=c-this.length;e--+
1;)this.push(void 0)}).call(c,a,e);var p=c.splice(a,1)[0];this.j("change",this.k=c.lb(this.a),{index:a,f:[p],type:r.t.N,p:this,s:"results"});c.splice(e,0,p);this.j("change",this.k=c.lb(this.a),{index:e,G:[p],type:r.t.N,p:this,s:"results"});this.Kc()}});v.g=l},{"./error":11,"./log":14,"./modelEvents":18,"./querySet":21,"./reactiveQuery":22,"./util":25}],2:[function(h,v){function l(d){var m=this;this.a=d;q.mf(this,this.a,["collection","collectionName","_attributeNames",{name:"idField",ja:"id"},{name:"modelName",
ja:"name"}]);f.Ba.call(this);Object.defineProperties(this,{Oa:{get:function(){var b=n.map(Object.keys(m.W||{}),function(b){return m.W[b]});return n.map(b,function(b){return b.ta?b.ra:b.L})},enumerable:!0,configurable:!0},Yb:{get:function(){if(siesta.c.wa)return m.b in siesta.c.ca.ce},enumerable:!0},event:{get:function(){return this.b}}});this.f=!1}h("./log");var q=h("./util"),n=q.h;h("./error");var k=h("./modelEvents"),f=h("./events"),r=h("./cache");l.prototype=Object.create(f.Ba.prototype);n.extend(l.prototype,
{get:function(d){var m=q.defer(d);d=m.finish.bind(m);d(null,this);return m.m},j:function(d,m){"object"==typeof d?m=d:m.type=d;m=m||{};n.extend(m,{i:this.o,a:this.a.name,b:this.b,p:this});k.j(m)},remove:function(d,m){m=null==m?!0:m;var b=q.defer(d);d=b.finish.bind(b);r.remove(this);this.f=!0;m&&this.j(k.t.Db,{aa:this});var g=this.a.remove;if(g)if(q.lc(g).length){var a=this;g.call(this,function(e){d(e,a)})}else g.call(this),d(null,this);else d(null,this);return b.m},restore:function(d){var m=q.defer(d);
d=m.finish.bind(m);var b=function(a){a||this.j(k.t.Ab,{U:this});d(a,this)}.bind(this);if(this.f){r.Wa(this);this.f=!1;var g=this.a.ga;g?q.lc(g).length?g.call(this,b):(g.call(this),b()):b()}return m.m}});n.extend(l.prototype,{jg:function(){return n.extend({},this.X)},zg:function(d){return this.a==d},wg:function(d){return this.a==d||this.a.He(d)}});n.extend(l.prototype,{Y:function(d){return JSON.stringify(this.u(d,null,4))},u:function(){var d=n.extend({},this.X);d.pa=this.pa;d.b=this.b;return d}});
v.g=l},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":25}],3:[function(h,v){function l(b){q.call(this,b);this.$&&(this.n=[])}var q=h("./RelationshipProxy");h("./store");var n=h("./util"),k=n.h;h("./error");var f=h("./modelEvents");h("./modelInstance");var r=h("./events").M,d=h("../vendor/observe-js/src/observe").La,m=h("./modelEvents").t;l.prototype=Object.create(q.prototype);k.extend(l.prototype,{Ub:function(b){var g=this;k.l(b,function(a){g.Ka(a).R(null)})},pc:function(b){var g=
this;k.l(b,function(a){g.Ka(a).R(g.object)})},M:function(b){var g=this;r(b,this.L,this.object);b.S||(b.S=new d(b),b.S.open(function(a){a.forEach(function(a){var c=a.r?b.slice(a.index,a.index+a.r):[],p=a.f;g.Ub(p);g.pc(c);var t=g.ac();f.j({i:t.o,a:t.name,b:g.object.b,s:g.sa(),f:p,G:c,type:m.N,index:a.index,p:g.object})})}))},get:function(b){var g=n.defer(b);b=g.finish.bind(g);b(null,this.n);return g.m},xa:function(b){b=Object.prototype.toString.call(b);if(this.ta){if("[object Array]"==b)return"Cannot assign array forward oneToMany ("+
b+"): "+this.ra}else if("[object Array]"!=b)return"Cannot scalar to reverse oneToMany ("+b+"): "+this.L;return null},set:function(b,g){this.Tb();if(b){var a;if(a=this.xa(b))return a;this.qa(g);this.R(b,g);this.$&&this.M(this.n);this.oc(b,g)}else this.qa(g),this.R(b,g)},O:function(b){q.prototype.O.call(this,b);this.$&&(b["splice"+n.Sc(this.L)]=k.bind(this.splice,this),this.M(this.n))}});v.g=l},{"../vendor/observe-js/src/observe":41,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,
"./modelInstance":19,"./store":23,"./util":25}],4:[function(h,v){function l(f){q.call(this,f)}var q=h("./RelationshipProxy");h("./store");var n=h("./util"),k=n.h;h("./error");h("./modelEvents");h("./modelInstance");l.prototype=Object.create(q.prototype);k.extend(l.prototype,{xa:function(f){return"[object Array]"==Object.prototype.toString.call(f)?"Cannot assign array to one to one relationship":null},set:function(f,k){this.Tb();if(f){var d;if(d=this.xa(f))return d;this.qa(k);this.R(f,k);this.oc(f,
k)}else this.qa(k),this.R(f,k)},get:function(f){var k=n.defer(f);f=k.finish.bind(k);f(null,this.n);return k.m}});v.g=l},{"./RelationshipProxy":6,"./error":11,"./modelEvents":18,"./modelInstance":19,"./store":23,"./util":25}],5:[function(h,v){function l(a,e){var c={},p;for(p in e)e.hasOwnProperty(p)&&"__"==p.slice(0,2)&&(c[p.slice(2)]=e[p],delete e[p]);b.extend(this,{a:a,Ia:e,q:c});c.Ha=c.Ha||[];f.isArray(c.Ha)||(c.Ha=[c.Ha])}function q(a){var e=a.name;a=k.Od[a.o];var c;a&&(c=a[e]||{});return c}var n=
h("./log"),k=h("./cache"),f=h("./util"),r=h("./error"),d=h("./querySet"),m=r.$b(r.Components.Cd),b=f.h,g=n.B("Query");b.extend(l,{Vb:{eg:function(a){var e=a.object[a.s];g.trace&&g.trace(a.s+": "+(null===e?"null":void 0===e?"undefined":e.toString())+" == "+a.value.toString());return e==a.value},Hg:function(a){return a.Xa?!1:a.object[a.s]<a.value},ng:function(a){return a.Xa?!1:a.object[a.s]>a.value},Ig:function(a){return a.Xa?!1:a.object[a.s]<=a.value},og:function(a){return a.Xa?!1:a.object[a.s]>=a.value},
contains:function(a){return a.Xa?!1:-1<a.object[a.s].indexOf(a.value)}},Ve:function(a,e){this.Vb[a]||(this.Vb[a]=e)}});b.extend(l.prototype,{fa:function(a){var e=f.defer(a);a=e.finish.bind(e);this.Id(a);return e.m},u:function(a){return a?"{}":{}},hf:function(a){function e(a,t){return function(c,e){var p=c[t],b=e[t];"string"==typeof p||p instanceof String&&"string"==typeof b||b instanceof String?p=a?p.localeCompare(b):b.localeCompare(p):(p instanceof Date&&(p=p.getTime()),b instanceof Date&&(b=b.getTime()),
p=a?p-b:b-p);return p}}for(var c=f,p=0;p<a.length;p++)var t=a[p],c=c.nd(e(t.ee,t.s));return c==f?null:c},Nb:function(a){var e=this.q.Ha;a&&e&&(e=b.map(e,function(a){a=a.split("-");var e=!0,t=null;1<a.length?(t=a[1],e=!1):t=a[0];return{s:t,ee:e}}.bind(this)),e=this.hf(e),a.Ce&&(a=a.Ya()),e&&a.sort(e));return a},Md:function(){return b.reduce(this.a.Xb,function(a,e){return b.extend(a,q(e))},b.extend({},q(this.a)))},Id:function(a){var e=function(){for(var c=this.Md(),e=Object.keys(c),t=[],b,g=0;g<e.length;g++){var f=
c[e[g]],k=this.ic(f);if("string"==typeof k){b=m(k);break}else k&&t.push(f)}t=this.Nb(t);a(b,b?null:d(t,this.a))}.bind(this);this.q.tg?e():siesta.Gb(e)},ie:function(){this.q.Ha=null},Ne:function(a,e){for(var c in e)if(e.hasOwnProperty(c)&&this.hc(a,e[c]))return!0;return!1},Me:function(a,e){for(var c in e)if(e.hasOwnProperty(c)&&!this.hc(a,e[c]))return!1;return!0},kf:function(a,e,c){var p="e",t=e.split("."),g=t[t.length-1].split("__");2==g.length?(e=g[0],p=g[1]):e=g[0];t[t.length-1]=e;b.l(t.slice(0,
t.length-1),function(t){a=a[t]});t=a[e];return(g=l.Vb[p])?g({object:a,s:e,value:c,Xa:null===t||void 0===t}):'No comparator registered for query operation "'+p+'"'},Le:function(a,e,c,b){if("$or"==e){if(!this.Ne(a,b.$or))return!1}else if("$and"==e){if(!this.Me(a,b.$and))return!1}else{a=this.kf(a,e,c);if("boolean"!=typeof a)return a;if(!a)return!1}return!0},hc:function(a,e){for(var c=Object.keys(e),b=0;b<c.length;b++){var t=c[b],t=this.Le(a,t,e[t],e);if("boolean"!=typeof t)return t;if(!t)return!1}return!0},
ic:function(a){return this.hc(a,this.Ia)}});v.g=l},{"./cache":8,"./error":11,"./log":14,"./querySet":21,"./util":25}],6:[function(h,v){function l(b){var g=this;b=b||{};k.extend(this,{object:null,n:null});Object.defineProperties(this,{ta:{get:function(){return!g.$},set:function(a){g.$=!a},enumerable:!0}});n.Ta(this,b,{$a:null,Ua:null,ra:null,L:null,$:null});this.Rb={}}var q=h("./error").F;h("./store");var n=h("./util"),k=n.h;h("./query");h("./log");h("./cache");var f=h("./events").M,r=h("../vendor/observe-js/src/observe").La,
d=h("./modelEvents"),m=d.t;k.extend(l,{});k.extend(l.prototype,{O:function(b){if(b){if(this.object)throw new q("Already installed.");this.object=b;var g=this,a=this.sa();Object.defineProperty(b,a,{get:function(){return g.n},set:function(a){g.set(a)},configurable:!0,enumerable:!0});b.W||(b.W={});b.W[a]=this;b.Jc||(b.Jc=[]);b.Jc.push(this)}else throw new q("No object passed to relationship install");}});k.extend(l.prototype,{set:function(){throw new q("Must subclass RelationshipProxy");},get:function(){throw new q("Must subclass RelationshipProxy");
}});k.extend(l.prototype,{Te:function(b,g){var a=g?this.xe():this.sa(),e=g?this.$a:this.Ua;if(n.isArray(b))e=k.map(b,function(c){return c.W[a]});else{var c=b.W[a];if(!c)throw new q('No proxy with name "'+a+'" on mapping '+e.name);e=c}return e},Ka:function(b){return this.Te(b,!0)},xe:function(){return this.ta?this.L:this.ra},sa:function(){return this.ta?this.ra:this.L},ac:function(){return this.ta?this.Ua:this.$a},Tc:function(b){b=b.b;var g=this.Rb[b];g&&(g(),this.Rb[b]=null)},dd:function(b){this.Rb[b.b]=
b.sb(function(g){g.type==m.Db&&(n.isArray(this.n)?this.splice(this.n.indexOf(b),1):this.R(null),this.Tc(b))}.bind(this))},R:function(b,g){g=g||{};g.Z||this.Ye(b);var a=this.n;a&&this.Tc(a);b?n.isArray(b)?(this.n=b,b.forEach(function(a){this.dd(a)}.bind(this))):(this.n=b,this.dd(b)):this.n=null},Tb:function(){if(!this.object)throw new q("Proxy must be installed on an object before can use it.");},qc:function(b){b=b||{};return function(g,a){b=b||{};b.Z||this.Ze.apply(this,arguments);var e=Array.prototype.slice.call(arguments,
2);return k.C(this.n.splice,g,a).apply(this.n,e)}.bind(this)},qa:function(b){b=b||{};var g=this;if(this.n){var a=this.Ka(this.n),a=n.isArray(a)?a:[a];k.l(a,function(a){if(n.isArray(a.n)){var c=a.n.indexOf(g.object);a.tb(function(){a.qc(b)(c,1)})}else a.R(null,b)})}},oc:function(b,g){var a=this,e=this.Ka(b),e=n.isArray(e)?e:[e];k.l(e,function(c){n.isArray(c.n)?c.tb(function(){c.qc(g)(c.n.length,0,a.object)}):(c.qa(g),c.R(a.object,g))})},tb:function(b){this.n?(this.n.S.close(),this.n.S=null,b(),this.M(this.n)):
b()},Ye:function(b){var g=this.object;if(!g)throw new q("Proxy must have an object associated");var a=g.a.name,e=g.o,c=this.n;n.isArray(c)&&!c.length&&(c=null);d.j({i:e,a:a,b:g.b,s:this.sa(),aa:c,U:b,type:m.Ma,p:g})},Ze:function(b,g){var a=Array.prototype.slice.call(arguments,2);d.j({i:this.object.o,a:this.object.a.name,b:this.object.b,s:this.sa(),index:b,f:this.n?this.n.slice(b,b+g):null,G:a.length?a:[],type:m.N,p:this.object})},M:function(b){var g=this;f(b,this.L,this.object);b.S||(b.S=new r(b),
b.S.open(function(a){a.forEach(function(a){var c=g.ac();d.j({i:c.o,a:c.name,b:g.object.b,s:g.sa(),f:a.f,G:a.r?b.slice(a.index,a.index+a.r):[],type:m.N,p:g.object})})}))},splice:function(){this.qc({}).apply(this,arguments)}});v.g=l},{"../vendor/observe-js/src/observe":41,"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":20,"./store":23,"./util":25}],7:[function(h,v){v.g={eb:"OneToMany",Cb:"OneToOne",cb:"ManyToMany"}},{}],8:[function(h,v,l){function q(a){var e=a.name;if(a=
c[a.o])if(e=a[e]){a=[];for(var p in e)e.hasOwnProperty(p)&&a.push(e[p]);if(1<a.length)throw new b("A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.");if(a.length)return a[0]}return null}function n(c,b){var e=b.a.name,g=b.a.o;if(p[g]&&(e=p[g][e]))return(e=e[c])?a.debug&&a.debug("Remote cache hit: "+e.u(!0)):a.debug&&a.debug("Remote cache miss: "+
c),e;a.debug&&a.debug("Remote cache miss: "+c);return null}function k(c,e,g){if(c){var d=c.a.o;if(d){p[d]||(p[d]={});var m=c.a.name;if(m)if(p[d][m]||(p[d][m]={}),g&&(p[d][m][g]=null),g=p[d][m][e]){if(c!=g)throw e="Object "+d.toString()+":"+m.toString()+"["+c.a.id+'="'+e+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild',a.error(e,{p:c,Uf:g}),new b(e);a.debug.isEnabled&&a.debug("Object has already been inserted: "+c.u(!0))}else p[d][m][e]=
c,a.debug.isEnabled&&a.debug("Remote cache insert: "+c.u(!0)),a.trace.isEnabled&&a.trace("Remote cache now looks like: "+f(!0));else throw new b("Model has no type",{a:c.a,p:c});}else throw new b("Model has no collection",{a:c.a,p:c});}else throw a.error("Must pass an object when inserting to cache"),new b("Must pass an object when inserting to cache");}function f(a){var c={},e;for(e in p)if(p.hasOwnProperty(e)){var b={};c[e]=b;var d=p[e],m;for(m in d)if(d.hasOwnProperty(m)){var f={};b[m]=f;var k=
d[m],l;for(l in k)k.hasOwnProperty(l)&&k[l]&&(f[l]=k[l].u())}}return a?g.K((c,null,4)):c}function r(a){var c={},b;for(b in e)e.hasOwnProperty(b)&&(c[b]=e[b].u());return a?g.K((c,null,4)):c}function d(c){a.debug.isEnabled&&a.debug("get",c);var b,p;if(b=c.b){(p=e[b])?a.debug.isEnabled&&a.debug("Local cache hit: "+p.u(!0)):a.debug.isEnabled&&a.debug("Local cache miss: "+b);if(p)return p;if(c.a)return b=c.a.id,p=c[b],a.debug.isEnabled&&a.debug(b+"="+p),n(p,c)}else if(c.a){b=c.a.id;if(p=c[b])return n(p,
c);if(c.a.la)return q(c.a)}else a.warn("Invalid opts to cache",{q:c});return null}function m(a){var c={b:a.b},b=a.a;b.id&&a[b.id]&&(c.a=b,c[b.id]=a[b.id]);return!!d(c)}v=h("./log");var b=h("./error").F,g=h("./util"),a=v.B("Cache"),e={},c={},p={};l.Kf=function(){return p};l.If=function(){return e};Object.defineProperty(l,"_localCacheByType",{get:function(){return c}});l.get=d;l.Wa=function(p){var g=p.b;if(g){var d=p.a.o,m=p.a.name;a.debug.isEnabled&&a.debug("Local cache insert: "+p.Y());if(!e[g])e[g]=
p,a.trace.isEnabled&&a.trace("Local cache now looks like: "+r(!0)),c[d]||(c[d]={}),c[d][m]||(c[d][m]={}),c[d][m][g]=p;else if(e[g]!=p)throw p='Object with _id="'+g.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild',a.error(p),new b(p);}g=p.rg;(d=p[g])?k(p,d):a.debug.isEnabled&&a.debug('No remote id ("'+g+'") so wont be placing in the remote cache',p)};l.af=k;l.reset=function(){p={};e={};c={}};l.u=function(a){var c=
{Fg:r(),Rg:f()};return a?g.K((c,null,4)):c};l.contains=m;l.remove=function(a){if(m(a)){var g=a.a.o,d=a.a.name,f=a.b;if(!d)throw b("No mapping name");if(!g)throw b("No collection name");if(!f)throw b("No _id");delete c[g][d][f];delete e[f];a.a.id&&(a=a[a.a.id])&&delete p[g][d][a]}else throw new b("Object was not in cache.");};l.ye=q},{"./error":11,"./log":14,"./util":25}],9:[function(h,v){function l(a,c){var e=this;if(!a)throw Error("Collection must have a name");c=c||{};m.Ta(this,c,{Pa:""});b.extend(this,
{name:a,$d:{},oa:{},d:c,ha:!1});Object.defineProperties(this,{Yb:{get:function(){if(siesta.c.wa)return!!Object.keys(siesta.c.ca.Ob[e.name]||{}).length},enumerable:!0}});n.register(this);d.Ba.call(this,this.name)}var q=h("./log"),n=h("./collectionRegistry").da,k=h("./error").F,f=h("./model"),r=h("extend");h("../vendor/observe-js/src/observe");var d=h("./events"),m=h("./util"),b=m.h,g=h("./error"),a=g.$b(g.Components.yb);h("./cache");var e=["PUT","PATCH","POST","DELETE"],c=q.B("Collection");l.prototype=
Object.create(d.Ba.prototype);b.extend(l.prototype,{O:function(a){var e=m.defer(a),g=this;if(this.ha)throw new k('Collection "'+this.name+'" has already been installed');var d=[],f;for(f in this.oa)this.oa.hasOwnProperty(f)&&d.push(this.oa[f]);c.info.isEnabled&&c.info("There are "+d.length.toString()+" mappings to install");d.length?(a=b.map(d,function(a){return b.bind(a.O,a)}),m.async.ia(a,function(a){if(a)c.error("Failed to install collection",a);else{g.ha=!0;var p=[];b.l(d,function(a){c.info.isEnabled&&
c.info('Installing relationships for mapping with name "'+a.name+'"');(a=a.Ee())&&p.push(a)});p.length||b.l(d,function(a){c.info.isEnabled&&c.info('Installing reverse relationships for mapping with name "'+a.name+'"');(a=a.Fe())&&p.push(a)});1==p.length?a=p[0]:p.length&&(a=p)}g.Ec(a,e.finish.bind(e))})):g.Ec(null,e.finish.bind(e));return e.m},Ec:function(c,e){c&&(c=a("Errors were encountered whilst setting up the collection",{J:c}));c||(this.ha=!0,h("./index")[this.name]=this);e(c)},hb:function(a,
c){if(a){this.$d[a]=c;c=r(!0,{},c);c.name=a;c.i=this;var e=new f(c);this.oa[a]=e;return this[a]=e}throw Error("No name specified when creating mapping");},a:function(){if(this.ha)throw Error("Cannot create new models once the object graph is established!");var a=this;return arguments.length?1==arguments.length?m.isArray(arguments[0])?b.map(arguments[0],function(c){return a.hb(c.name,c)}):this.hb(arguments[0].name,arguments[0]):"string"==typeof arguments[0]?this.hb(arguments[0],arguments[1]):b.map(arguments,
function(c){return a.hb(c.name,c)}):null},ob:function(a){var c=[];if(siesta.c.Va){a.i=this;for(var b=siesta.c.H.be(a.method),g=[],d=[],m=0;m<b.length;m++){var f=b[m];-1<e.indexOf(f)?g.push(f):d.push(f)}g.length&&(b=r({},a),b.method=g,b=new siesta.c.H.Eb(b),siesta.c.H.ya.We(b),c.push(b));d.length&&(a=r({},a),a.method=d,a=new siesta.c.H.Fb(a),siesta.c.H.ya.Xe(a),c.push(a))}else throw Error("HTTP module not installed.");return c},u:function(a){var c={};c.ha=this.ha;c.dg=this.Ef;c.name=this.name;c.Pa=
this.Pa;return a?m.K(c):c},count:function(a){var c=m.defer(a);a=b.map(this.oa,function(a){return b.bind(a.count,a)});m.async.ia(a,function(a,e){var p;a||(p=b.reduce(e,function(a,c){return a+c},0));c.finish(a,p)});return c.m}});v.g=l},{"../vendor/observe-js/src/observe":41,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./index":13,"./log":14,"./model":17,"./util":25,extend:39}],10:[function(h,v,l){function q(){if(!this)return new q;this.Ea=[]}var n=h("./util").h;n.extend(q.prototype,
{register:function(k){var f=k.name;this[f]=k;this.Ea.push(f)},reset:function(){var k=this;n.l(this.Ea,function(f){delete k[f]});this.Ea=[]}});l.da=new q},{"./util":25}],11:[function(h,v){function l(f,d,m){this.message=f;(m=m||arguments.callee)&&Error.captureStackTrace&&Error.captureStackTrace(this,m)}function q(f,d,m){m=m||{};this.message=d;for(var b in m)m.hasOwnProperty(b)&&(this[b]=m[b])}l.prototype=Object.create(Error.prototype);l.prototype.name="InternalSiestaError";l.prototype.constructor=l;
var n={Df:0,zc:1},k={vf:"Mapping",tf:"HTTP",Bf:"ReactiveQuery",rd:"ArrangedReactiveQuery",yb:"Collection",Cd:"Query"},f={};f[n.zc]="No descriptor matched the HTTP response/request.";v.g={F:l,Dd:q,ud:n,xc:{zb:"message",sd:"code"},zb:f,Components:k,$b:function(f){if(f in k)return function(d,f){return new q(0,d,f)};throw new q;}}},{}],12:[function(h,v){function l(d){k.extend(this,{event:d,ua:{}})}var q=h("events").yc,n=h("../vendor/observe-js/src/observe").La,k=h("./util").h,f=h("./modelEvents"),r=new q;
k.extend(l.prototype,{sb:function(d,f){if("function"==typeof d)f=d,d=null;else{var b=f;f=function(a){a=a||{};d?a.type==d&&b(a):b(a)};var g=this.ua;d&&(g[d]||(g[d]=[]),g[d].push(f))}r.P(this.event,f);return function(){this.ae(f,d)}.bind(this)},Ie:function(d,f){var b=this.event;if("function"==typeof d)f=d,d=null;else{var g=f;f=function(a){a=a||{};d?a.type==d&&(r.removeListener(b,f),g(a)):g(a)}}return d?r.P(b,f):r.ub(b,f)},ae:function(d,f){if(f){var b=this.ua[f];b.splice(b.indexOf(d),1)}return r.removeListener(this.event,
d)},j:function(d,f){"object"==typeof d?f=d:(f=f||{},f.type=d);r.j.call(r,this.event,f)},Lc:function(d){(this.ua[d]||[]).forEach(function(d){r.removeListener(this.event,d)}.bind(this));this.ua[d]=[]},Ja:function(d){if(d)this.Lc(d);else for(d in this.ua)this.ua.hasOwnProperty(d)&&this.Lc(d)}});k.extend(l.prototype,{P:l.prototype.sb});k.extend(r,{Ba:l,M:function(d,m,b){d.fd||(d.fd=new n(d),d.fd.open(function(g){-1<b.Ca.indexOf(m)&&g.forEach(function(a){f.j({i:b.o,a:b.a.name,b:b.b,index:a.index,f:a.f,
G:a.r?d.slice(a.index,a.index+a.r):[],type:f.t.N,s:m,p:b})})}))}});v.g=r},{"../vendor/observe-js/src/observe":41,"./modelEvents":18,"./util":25,events:35}],13:[function(h,v){function l(a){l.c||(l.c={});p.extend(l.c,a||{});return l}var q=h("./util"),n=h("./collectionRegistry").da,k=h("./collection"),f=h("./cache"),r=h("./model"),d=h("./error"),m=h("./events"),b=h("./RelationshipType"),g=h("./reactiveQuery"),a=h("./modelEvents"),e=h("./Query"),c=h("./log"),p=q.h;Object.defineProperty(l,"q",{get:function(){return this.Zd||
window.mc||window.Af},set:function(a){this.Zd=a}});p.extend(l,{P:m.P.bind(m),Oe:m.removeListener.bind(m),ub:m.ub.bind(m),Ja:m.Ja.bind(m)});p.extend(l,{removeListener:l.Oe,addListener:l.P});p.extend(l,{Cf:b,t:a.t,log:c.A,bb:g.bb,ea:{log:c,xf:r,a:h("./model"),error:h("./error"),t:a.t,bh:h("./modelInstance"),extend:h("extend"),wf:h("./mappingOperation"),re:h("./events"),Tf:h("./cache"),Jg:a,da:h("./collectionRegistry").da,yb:k,hh:q,na:q,h:q.h,Ia:h("./query"),lf:h("./store")},h:q.h,async:q.async,isArray:q.isArray,
ec:q.ec});l.c={};var t=!1,y=!1;p.extend(l,{reset:function(a){y=t=!1;delete this.ka;f.reset();n.reset();m.Ja();l.c.Va&&l.c.H.ya.reset();l.c.wa?l.c.ca.Mc(a):a()},Sg:function(a){var c=q.defer(a);a=c.finish.bind(c);l.c.ca.Mc(function(){var c=[],b=n.Ea.reduce(function(a,b){var e=n[b].oa;c.push(b);Object.keys(e).forEach(function(c){var b=e[c];a.push(function(a){b.all(function(c,b){c||b.remove();a(c)})})});return a},[]);q.async.ld([p.C(q.async.ia,b)],a)});return c.m},i:function(a,c){return new k(a,c)},O:function(a){if(y||
t)throw new d.F("Already installing...");y=!0;var c=q.defer(a);a=c.finish.bind(c);var b=p.map(n.Ea,function(a){return function(c){n[a].O(c)}}),e=this;l.async.ld(b,function(c){c?a(c):l.c.wa?l.c.ca.Nd(function(c){c||(t=!0,e.ka&&e.ka.fa());a(c)}):(t=!0,e.ka&&e.ka.fa(),a())});return c.m},Yd:function(a){this.ka||(this.ka=new function(){this.uc=[];this.fa=function(){this.uc.forEach(function(a){a()});this.uc=[]}.bind(this)});this.ka.uc.push(a)},Gb:function(a){t?a():(y||this.O(function(a){a&&console.error("Error setting up siesta",
a);delete this.ka}.bind(this)),t?a():this.Yd(a))},Zg:function(a,b){c.B(a).md(b)},Lg:q.next,Ve:e.bind(e)});Object.defineProperties(l,{Gd:{get:function(){return!(y||t)}}});"undefined"!=typeof window&&(window.ah=l);v.g=l;h("../http");h("../storage")},{"../http":30,"../storage":40,"./Query":5,"./RelationshipType":7,"./cache":8,"./collection":9,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./mappingOperation":16,"./model":17,"./modelEvents":18,"./modelInstance":19,"./query":20,"./reactiveQuery":22,
"./store":23,"./util":25,extend:39}],14:[function(h,v){function l(f){if(!this)return new l(f);this.name=f;k[f]=l.A.warn;this.trace=q(this,n.bind(console.debug?console.debug:console.log,console),l.A.trace);this.debug=q(this,n.bind(console.debug?console.debug:console.log,console),l.A.debug);this.info=q(this,n.bind(console.info?console.info:console.log,console),l.A.info);this.log=q(this,n.bind(console.log,console),l.A.info);this.warn=q(this,n.bind(console.warn?console.warn:console.log,console),l.A.qd);
this.error=q(this,n.bind(console.error?console.error:console.log,console),l.A.error);this.Zc=q(this,n.bind(console.error?console.error:console.log,console),l.A.Zc)}function q(f,k,d){function m(b){f.hd(k,d,b,arguments)}Object.defineProperty(m,"isEnabled",{get:function(){return d>=f.Vc()},enumerable:!0,configurable:!0});m.se=k;m.Gg=f;m.Dg=d;return m}var n=h("./util").h,k={};l.A={trace:0,debug:1,info:2,qd:3,warn:3,error:4,Zc:5};l.za={};l.za[l.A.trace]="TRACE";l.za[l.A.debug]="DEBUG";l.za[l.A.info]="INFO ";
l.za[l.A.qd]="WARN ";l.za[l.A.error]="ERROR";l.cd=function(f){return this.za[f]};l.B=function(f){return new l(f)};l.prototype.Vc=function(){var f=k[this.name];return f?f:l.A.trace};l.prototype.md=function(f){k[this.name]=f};l.prototype.jc=function(f,k,d){this.hd(this[l.cd(f).trim().toLowerCase()].se,f,d,Array.prototype.slice.call(arguments,3,arguments.length),k)};l.prototype.hd=function(f,k,d,m,b){if((void 0!==b?b:this.Vc())<=k){f=n.C(f,l.cd(k)+" ["+this.name+"]: "+d);k=[];for(d=0;d<m.length;d++)k[d]=
m[d];k.splice(0,1);f.apply(f,k)}};v.g=l},{"./util":25}],15:[function(h,v){function l(b){q.call(this,b);this.n=[];this.$e={}}var q=h("./RelationshipProxy");h("./store");var n=h("./util"),k=n.h;h("./error");var f=h("./modelEvents"),r=h("./events").M;h("./modelInstance");var d=h("../vendor/observe-js/src/observe").La,m=h("./modelEvents").t;l.prototype=Object.create(q.prototype);k.extend(l.prototype,{Ub:function(b){var g=this;k.l(b,function(a){var b=g.Ka(a),c=b.n.indexOf(g.object);b.tb(function(){b.splice(c,
1)})})},pc:function(b){var g=this;k.l(b,function(a){var b=g.Ka(a);b.tb(function(){b.splice(0,0,g.object)})})},M:function(b){var g=this;r(b,this.L,this.object);b.S||(b.S=new d(b),b.S.open(function(a){a.forEach(function(a){var c=a.r?b.slice(a.index,a.index+a.r):[],p=a.f;g.Ub(p);g.pc(c);var t=g.ac();f.j({i:t.o,a:t.name,b:g.object.b,s:g.sa(),f:p,G:c,type:m.N,index:a.index,p:g.object})})}))},get:function(b){var g=n.defer(b);b=g.finish.bind(g);b(null,this.n);return g.m},xa:function(b){return"[object Array]"!=
Object.prototype.toString.call(b)?"Cannot assign scalar to many to many":null},set:function(b,g){this.Tb();if(b){var a;if(a=this.xa(b))return a;this.qa(g);this.R(b,g);this.M(b);this.oc(b,g)}else this.qa(g),this.R(b,g)},O:function(b){q.prototype.O.call(this,b);this.M(this.n);b["splice"+n.Sc(this.L)]=k.bind(this.splice,this)},Qg:function(b){this.$e[b.b]=b.sb(function(){}.bind(this))}});v.g=l},{"../vendor/observe-js/src/observe":41,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,
"./modelInstance":19,"./store":23,"./util":25}],16:[function(h,v){function l(b){this.d=b;r.Ta(this,b,{a:null,data:null,w:[],Z:!1,fb:!1,mb:!0});d.extend(this,{J:[],sc:{},Ic:[]})}var q=h("./store"),n=h("./modelInstance"),k=h("./log");h("./error");var f=h("./cache"),r=h("./util"),d=r.h,m=r.async;h("./modelEvents");var b=k.B("Mapping");b.md(k.A.trace);d.extend(l.prototype,{Je:function(){for(var b=0;b<this.data.length;b++){var a=this.data[b],e=this.w[b];a!=e&&e&&(d.l(this.a.Ca,function(c){void 0!==a[c]&&
(this.Z?e.X[c]=a[c]:e[c]=a[c])}.bind(this)),a.pa&&(e.pa=a.pa))}},Rd:function(){var b=this,a;this.Je();var e=d.keys(b.sc);d.l(e,function(c){for(var e=b.sc[c],t=e.rb,e=e.w,d=b.bc(c).relatedData,e=r.od(e,d),d=0;d<e.length;d++){var f=t[d],m=b.J[f];a=m?m[c]:null;if(!a){var m=e[d],k=b.w[f];k&&(a=k.W[c].set(m,{Z:b.Z}))&&(b.J[f]||(b.J[f]={}),b.J[f][c]=a)}}})},Pd:function(g){var a=r.defer(g);g=a.finish.bind(a);for(var e=this,c=[],p=[],t=0;t<this.data.length;t++)if(!this.w[t]){var m,k=this.data[t];m="string"==
typeof k||"number"==typeof k||k instanceof String;k?m?(m={index:t,Wb:{}},m.Wb[e.a.id]=k,c.push(m)):k instanceof n?this.w[t]=k:k.b?p.push({index:t,Wb:k}):k[e.a.id]?c.push({index:t,Wb:k}):this.w[t]=e.Da():this.w[t]=null}r.async.ia([function(a){var c=d.Q(d.Q(p,"datum"),"_id");c.length?q.ve(c,function(b,g){if(!b)for(var t=0;t<c.length;t++){var d=g[t],k=c[t],m=p[t];d||(d=f.get({b:k}))||(d=e.Da({b:k},!e.Z));e.w[m.index]=d}a(b)}):a()},function(a){var p=d.Q(d.Q(c,"datum"),e.a.id);p.length?(b.trace.isEnabled&&
b.trace("Looking up remoteIdentifiers: "+r.K(p)),q.we(p,e.a,function(g,d){if(!g){if(b.trace.isEnabled){var k={};for(t=0;t<d.length;t++)k[p[t]]=d[t]?d[t].b:null;b.trace("Results for remoteIdentifiers: "+r.K(k))}for(t=0;t<d.length;t++){var m=d[t],k=c[t];if(m)e.w[k.index]=m;else{var m=p[t],l={a:e.a};l[e.a.id]=m;(l=f.get(l))?e.w[k.index]=l:(e.w[k.index]=e.Da(),e.w[k.index][e.a.id]=m)}}}a(g)})):a()}],g);return a.m},Qd:function(b){var a=r.defer(b);b=a.finish.bind(a);for(var e=d.Q(this.data,"_id"),c,p=0;p<
e.length;p++)if(e[p]){c={b:e[p]};break}for(var e=f.ye(this.a)||this.Da(c),p=0;p<this.data.length;p++)this.w[p]=e;b();return a.m},Da:function(){var b=this.a,b=b.Da.apply(b,arguments);this.Ic.push(b);return b},start:function(b){if(this.data.length){var a=this,e=[];e.push(d.bind(this.a.la?this.Qd:this.Pd,this));e.push(d.bind(this.Jd,this));r.async.ia(e,function(){try{a.Rd();var c;c=a.mb?d.reduce(a.Ic,function(a,c){var e=c.a.ga;e&&(r.lc(e).length?a.push(d.bind(e,c,b)):e.call(c));return a},[]):[];m.ia(c,
function(){b(a.J.length?a.J:null,a.w)})}catch(e){console.error("caught error",e),b(e)}})}else b(null,[])},bc:function(b){for(var a=[],e=[],c=0;c<this.data.length;c++){var p=this.data[c];p&&p[b]&&(a.push(c),e.push(p[b]))}return{rb:a,relatedData:e}},Re:function(b,a,e){if(a.length){var c=this.bc(b).relatedData;a=r.od(a,c);for(c=0;c<a.length;c++){var p=e[c],t=a[c],f=t;r.isArray(t)&&(f=d.reduce(t,function(a,c){return a||c},!1));f&&(this.J[p]||(this.J[p]={}),this.J[p][b]=t)}}},Jd:function(b){var a=this,
e=d.keys(this.a.v);e.length?(e=d.reduce(e,function(c,b){var e=a.a.v[b],g=e.ra==b?e.$a:e.Ua;g.la&&!e.$&&this.data.forEach(function(a){a[b]||(a[b]={})});var e=this.bc(b),d=e.rb,e=e.relatedData;if(e.length)var e=r.ue(e),f=new l({a:g,data:e,Z:a.Z,fb:a.fb,mb:this.mb});f&&c.push(function(c){f.start(function(e,g){a.sc[b]={J:e,w:g,rb:d};a.Re(b,f.J,d);c()})});return c}.bind(this),[]),m.ia(e,function(a){b(a)})):b()}});v.g=l},{"./cache":8,"./error":11,"./log":14,"./modelEvents":18,"./modelInstance":19,"./store":23,
"./util":25}],17:[function(h,v){function l(a){var e=this;this.d=a?w.extend({},a):{};b.Ta(this,a,{methods:{},attributes:[],i:function(a){b.ec(a)&&(a=n[a]);return a},id:"id",v:[],name:null,rb:[],la:!1,rc:this.Ge.bind(this),Za:{},ga:null,remove:null});this.attributes=l.Wd(this.attributes);w.extend(this,{Jb:!1,Lb:!1,Mb:!1,children:[]});Object.defineProperties(this,{Oa:{get:function(){return Object.keys(e.v)},enumerable:!0},Ca:{get:function(){var a=[];e.id&&a.push(e.id);w.l(e.attributes,function(c){a.push(c.name)});
return a},enumerable:!0,configurable:!0},ha:{get:function(){return e.Jb&&e.Lb&&e.Mb},enumerable:!0,configurable:!0},Xb:{get:function(){return w.reduce(e.children,function(a,c){return Array.prototype.concat.call(a,c.Xb)}.bind(e),w.extend([],e.children))},enumerable:!0},Yb:{get:function(){if(siesta.c.wa)return!!Object.keys((siesta.c.ca.Ob[this.o]||{})[this.name]||{}).length},enumerable:!0},o:{get:function(){return this.i.name},enumerable:!0}});c.Ba.call(this,this.o+":"+this.name)}var q=h("./log"),n=
h("./collectionRegistry").da,k=h("./error").F,f=h("./RelationshipType"),r=h("./query"),d=h("./mappingOperation"),m=h("./modelInstance"),b=h("./util"),g=h("./cache");h("./store");var a=h("extend"),e=h("./modelEvents"),c=h("./events"),p=h("./events").M;h("./RelationshipProxy");var t=h("./OneToManyProxy"),y=h("./OneToOneProxy"),D=h("./manyToManyProxy"),B=h("./reactiveQuery"),x=h("./ArrangedReactiveQuery"),w=b.h,E=b.ze,C=e.t,z=q.B("Model");w.extend(l,{Wd:function(a){return w.reduce(a,function(a,c){"string"==
typeof c?a.push({name:c}):a.push(c);return a},[])}});l.prototype=Object.create(c.Ba.prototype);w.extend(l.prototype,{Ge:function(a){a&&w.l(Object.keys(a),function(c){this[c]?z.error('Static method with name "'+c+'" already exists. Ignoring it.'):this[c]=a[c].bind(this)}.bind(this));return a},Ee:function(){if(this.Lb)throw new k('Relationships for "'+this.name+'" have already been installed');if(this.d.v)for(var a in this.d.v)if(this.d.v.hasOwnProperty(a)){var c=this.d.v[a];if(!c.$){z.debug.isEnabled&&
z.debug(this.name+": configuring relationship "+a,c);c.type||(c.type=this.la?f.Cb:f.eb);if(this.la&&c.type==f.cb)return"Singleton model cannot use ManyToMany relationship.";if(c.type==f.eb||c.type==f.Cb||c.type==f.cb){var b=c.a;delete c.a;var e;if(b instanceof l)e=b;else{z.debug.isEnabled&&z.debug("reverseModelName",b);if(!this.i)throw new k("Model must have collection");var p=this.i;if(!p)throw new k("Collection "+this.o+" not registered");e=p[b]}if(!e&&(p=b.split("."),2==p.length)){e=p[0];b=p[1];
p=n[e];if(!p)return'Collection with name "'+e+'" does not exist.';e=p[b]}z.debug.isEnabled&&z.debug("reverseModel",e);if(e)c.$a=e,c.Ua=this,c.ra=a,c.L=c.reverse||"reverse_"+a,delete c.reverse,c.$=!1;else return'Model with name "'+b.toString()+'" does not exist'}else return"Relationship type "+c.type+" does not exist"}}this.Lb=!0;return null},Fe:function(){if(this.Mb)throw new k('Reverse relationships for "'+this.name+'" have already been installed.');for(var c in this.v)if(this.v.hasOwnProperty(c)){var b=
this.v[c],b=a(!0,{},b);b.$=!0;var e=b.$a,p=b.L;if(e.la){if(b.type==f.cb)return"Singleton model cannot be related via reverse ManyToMany";if(b.type==f.eb)return"Singleton model cannot be related via reverse OneToMany"}z.debug.isEnabled&&z.debug(this.name+": configuring  reverse relationship "+p);e.v[p]=b}this.Mb=!0},I:function(a){return a=new r(this,a||{})},Ia:function(a,c){if(this.la){var e=b.defer(c);c=e.finish.bind(e);this.I({Fd:!0}).fa(function(b,e){b?c(b):(a=w.extend({},a),a.Fd=!0,e.length?this.I(a).fa(c):
this.map({},function(b){b?c(b):this.I(a).fa(c)}.bind(this)))}.bind(this));return e.m}return this.I(a).fa(c)},Pg:function(a){return new B(new r(this,a||{}))},Pf:function(a){return new x(new r(this,a||{}))},gd:function(a,c){"function"==typeof a&&(c=a,a={});var e=b.defer(c);c=e.finish.bind(e);this.Ia(a,function(a,b){a?c(a):1<b.length?c("More than one instance returned when executing get query!"):(b=b.length?b[0]:null,c(null,b))});return e.m},all:function(a,c){"function"==typeof a&&(c=a,a={});a=a||{};
return this.Ia(a,c)},O:function(a){z.info.isEnabled&&z.info("Installing mapping "+this.name);var c=b.defer(a);a=c.finish.bind(c);if(this.Jb)throw new k('Model "'+this.name+'" has already been installed');this.Jb=!0;a();return c.m},map:function(a,c,e){"function"==typeof c&&(e=c);c=c||{};var p=b.defer(e);e=function(){var e=c.jc;e&&(b.isArray(e)?c.w=e:c.w=[e]);delete c.jc;b.isArray(a)?this.Gc(a,c,p.finish.bind(p)):this.Gc([a],c,function(a,c){var e;c&&c.length&&(e=c[0]);p.finish(a?b.isArray(a)?a[0]:a:
null,e)})}.bind(this);c.fb?e():siesta.Gb(e);return p.m},Gc:function(a,c,b){w.extend(c,{a:this,data:a});(new d(c)).start(function(a,c){a?b&&b(a):b(null,c||[])})},Hd:function(){return w.reduce(Object.keys((g.Od[this.o]||{})[this.name]||{}),function(a,c){a[c]={};return a},{})},count:function(a){var c=b.defer(a);a=c.finish.bind(c);var e=this.Hd();a(null,Object.keys(e).length);return c.m},Da:function(a,c){c=void 0===c?!0:c;if(this.ha){var d=this,l;l=a?a.b?a.b:E():E();var h=new m(this);z.info.isEnabled&&
z.info('New object created _id="'+l.toString()+'", type='+this.name,a);h.b=l;l={};h.X=l;var n=w.reduce(this.attributes,function(a,c){void 0!==c.le&&(a[c.name]=c.le);return a},{});w.extend(l,n);a&&w.extend(l,a);l=this.Ca;n=l.indexOf(this.id);-1<n&&l.splice(n,1);w.l(l,function(a){Object.defineProperty(h,a,{get:function(){var c=h.X[a];return void 0===c?null:c},set:function(c){var g=h.X[a],f=this.Xd[a],f=w.map(f,function(a){return{Se:a,aa:this[a]}}.bind(this));h.X[a]=c;f.forEach(function(a){var c=a.Se;
e.j({i:d.o,a:d.name,b:h.b,U:this[c],aa:a.aa,type:C.Ma,s:c,p:h})}.bind(this));g={i:d.o,a:d.name,b:h.b,U:c,aa:g,type:C.Ma,s:a,p:h};window.Cg=g;e.j(g);b.isArray(c)&&p(c,a,h)},enumerable:!0,configurable:!0})});w.l(Object.keys(this.methods),function(a){void 0===h[a]?h[a]=this.methods[a].bind(h):z.error('A method with name "'+a+'" already exists. Ignoring it.')}.bind(this));l=Object.keys(this.Za);var r={};w.l(l,function(a){var c=this.Za[a];(c.ne||[]).forEach(function(c){r[c]||(r[c]=[]);r[c].push(a)});delete c.ne;
void 0===h[a]?Object.defineProperty(h,a,c):z.error('A property/method with name "'+a+'" already exists. Ignoring it.')}.bind(this));h.Xd=r;Object.defineProperty(h,this.id,{get:function(){return h.X[d.id]||null},set:function(a){var c=h[d.id];h.X[d.id]=a;e.j({i:d.o,a:d.name,b:h.b,U:a,aa:c,type:C.Ma,s:d.id,p:h});g.af(h,a,c)},enumerable:!0,configurable:!0});for(var q in this.v){var v;if(this.v.hasOwnProperty(q))if(v=w.extend({},this.v[q]),l=v.type,delete v.type,l==f.eb)v=new t(v);else if(l==f.Cb)v=new y(v);
else if(l==f.cb)v=new D(v);else throw new k("No such relationship type: "+l);v.O(h)}g.Wa(h);c&&e.j({i:this.o,a:this.name,b:h.b,U:h,type:C.Ab,p:h});return h}throw new k("Model must be fully installed before creating any models");},u:function(a){var c={};c.name=this.name;c.attributes=this.attributes;c.id=this.id;c.i=this.o;c.v=w.map(this.v,function(a){return a.ta?a.ra:a.L});return a?b.K(c):c},toString:function(){return"Model["+this.name+"]"}});w.extend(l.prototype,{Wf:function(a,c){"string"==typeof a?
c.name=a:c=name;w.extend(c,{attributes:Array.prototype.concat.call(c.attributes||[],this.d.attributes),v:w.extend(c.v||{},this.d.v),methods:w.extend(w.extend({},this.d.methods)||{},c.methods),rc:w.extend(w.extend({},this.d.rc)||{},c.rc),Za:w.extend(w.extend({},this.d.Za)||{},c.Za),id:c.id||this.d.id,ga:c.ga||this.d.ga,remove:c.remove||this.d.remove});var b=this.i.a(c.name,c);b.parent=this;this.children.push(b);return b},yg:function(a){return this.parent==a},Ag:function(a){return-1<this.children.indexOf(a)},
He:function(a){for(var c=this.parent;c;){if(c==a)return!0;c=c.parent}return!1},xg:function(a){return-1<this.Xb.indexOf(a)},Ae:function(a){return-1<this.Ca.indexOf(a)}});w.extend(l.prototype,{Og:function(a){if(siesta.c.Va){var c=siesta.c.H.Bd;a=a||{};a.a=this;return new c(a)}}});v.g=l},{"./ArrangedReactiveQuery":1,"./OneToManyProxy":3,"./OneToOneProxy":4,"./RelationshipProxy":6,"./RelationshipType":7,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./manyToManyProxy":15,
"./mappingOperation":16,"./modelEvents":18,"./modelInstance":19,"./query":20,"./reactiveQuery":22,"./store":23,"./util":25,extend:39}],18:[function(h,v,l){function q(b){this.d=b||{};Object.keys(b).forEach(function(g){this[g]=b[g]}.bind(this))}function n(b){if(!b.a)throw new f("Must pass a model");if(!b.i)throw new f("Must pass a collection");if(!b.b)throw new f("Must pass a local identifier");if(!b.p)throw new f("Must pass the object");}var k=h("./events"),f=h("./error").F;v=h("./log");var r=h("./util").h.extend,
d=h("./collectionRegistry").da,m=v.B("ModelEvents");q.prototype.u=function(b){var g={};g.i="string"==typeof this.i?this.i:this.i.u();g.a="string"==typeof this.a?this.a:this.a.name;g.b=this.b;g.s=this.s;g.type=this.type;this.index&&(g.index=this.index);this.G&&(g.G=_.map(this.G,function(a){return a.u()}));this.f&&(g.f=_.map(this.f,function(a){return a.u()}));this.aa&&(g.aa=this.aa);this.U&&(g.U=this.U);return b?util.K(g):g};r(l,{yf:q,j:function(b){n(b);var g=b.i,a=b.a;b=new q(b);m.trace.isEnabled&&
m.trace('Sending notification "'+g+'" of type '+b.type);k.j(g,b);var e=g+":"+a;m.trace.isEnabled&&m.trace('Sending notification "'+e+'" of type '+b.type);k.j(e,b);m.trace.isEnabled&&m.trace('Sending notification "Siesta" of type '+b.type);k.j("Siesta",b);e=b.b;m.trace.isEnabled&&m.trace('Sending notification "'+e+'" of type '+b.type);k.j(e,b);e=d[g];if(!e)throw g='No such collection "'+g+'"',m.error(g,d),new f(g);e=e[a];if(!e)throw g='No such model "'+a+'"',m.error(g,d),new f(g);e.id&&b.p[e.id]&&
(g=g+":"+a+":"+b.p[e.id],m.trace.isEnabled&&m.trace('Sending notification "'+g+'" of type '+b.type),k.j(g,b));return b},ih:n,t:{Ma:"Set",N:"Splice",Ab:"New",Db:"Remove"}})},{"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./util":25}],19:[function(h,v){v.g=h(2)},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":25,"/Users/mtford/Playground/rest/core/ModelInstance.js":2}],20:[function(h,v){v.g=h(5)},{"./cache":8,"./error":11,"./log":14,"./querySet":21,
"./util":25,"/Users/mtford/Playground/rest/core/Query.js":5}],21:[function(h,v){function l(c,e){e in c||Object.defineProperty(c,e,{get:function(){return f(a.Q(c,e))},set:function(a){if(m.isArray(a)){if(this.length!=a.length)throw new b({message:"Must be same length"});for(var c=0;c<a.length;c++)this[c][e]=a[c]}else for(c=0;c<this.length;c++)this[c][e]=a}})}function q(a){return a.then&&a["catch"]}function n(a,c){c in a||(a[c]=function(){var a=arguments,b=this.map(function(b){return b[c].apply(b,a)}),
e=!1;b.length&&(e=q(b[0]));return e?siesta.mc.all(b):f(b)})}function k(c,b){c=a.extend([],c);b.Ca.concat(b.Oa).concat(e).forEach(a.C(l,c));var e=Object.keys(g.prototype);e.forEach(a.C(n,c));return d(c)}function f(a){if(a.length){var b=a[0];("string"==typeof b||b instanceof String?t.concat(y):"number"==typeof b||b instanceof Number?c.concat(p):b.getOwnPropertyNames()).forEach(function(c){"function"==typeof b[c]?n(a,c):l(a,c)})}return d(a)}function r(){throw Error("Cannot modify a query set");}function d(c){e.forEach(function(a){c[a]=
r});c.Ce=!0;c.Ya=c.Qf=function(){var c=a.map(this,function(a){return a});c.Rf=function(){return f(this)};c.lb=function(a){return k(this,a)};return c};return c}var m=h("./util"),b=h("./error").Dd,g=h("./ModelInstance"),a=h("./util").h,e="push sort reverse splice shift unshift".split(" "),c=["toString","toExponential","toFixed","toPrecision","valueOf"],p=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],t="charAt charCodeAt concat fromCharCode indexOf lastIndexOf localeCompare match replace search slice split substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim valueOf".split(" "),
y=["length"];v.g=k},{"./ModelInstance":2,"./error":11,"./util":25}],22:[function(h,v){function l(a){var e=this;n.call(this);b.extend(this,{I:a,k:d([],a.a),De:l.bb.wc,cc:!1});Object.defineProperties(this,{ug:{get:function(){return this.cc}},a:{get:function(){return e.I.a}},i:{get:function(){return e.a.o}}})}var q=h("./log");h("./query");var n=h("events").yc,k=h("./events"),f=h("./modelEvents"),r=h("./error").F,d=h("./querySet"),m=h("./util"),b=m.h,g=q.B("Query");l.prototype=Object.create(n.prototype);
b.extend(l,{bb:{sf:"Front",wc:"Back"}});b.extend(l.prototype,{ga:function(a){g.trace&&g.trace("init");var b=m.defer(a);a=b.finish.bind(b);this.cc?a(null,this.k):this.I.fa(function(c,b){if(c)a(c);else{this.k=b;if(!this.qb){var e=this.Cc(),d=function(a){this.Ib(a)}.bind(this);this.qb=d;k.P(e,d)}g.trace&&g.trace("Listening to "+e);this.cc=!0;a(null,this.k)}}.bind(this));return b.m},Wa:function(a){var b=this.k.Ya();a=this.De==l.bb.wc?b.push(a):b.unshift(a);this.k=b.lb(this.a);return a},Ib:function(a){g.trace&&
g.trace("_handleNotif",a);if(a.type==f.t.Ab){var b=a.U;if(this.I.ic(b)){g.trace&&g.trace("New object matches",b.Y());var c=this.Wa(b);this.j("change",this.k,{index:c,G:[b],type:f.t.N,p:this})}else g.trace&&g.trace("New object does not match",b.Y())}else if(a.type==f.t.Ma){var b=a.p,c=this.k.indexOf(b),p=-1<c,t=this.I.ic(b);t&&!p?(g.trace&&g.trace("Updated object now matches!",b.Y()),c=this.Wa(b),this.j("change",this.k,{index:c,G:[b],type:f.t.N,p:this})):!t&&p?(g.trace&&g.trace("Updated object no longer matches!",
b.Y()),p=this.k.Ya(),a=p.splice(c,1),this.k=p.lb(this.a),this.j("change",this.k,{index:c,p:this,U:b,type:f.t.N,f:a})):t||p?t&&p&&(g.trace&&g.trace("Matches but already contains",b.Y()),this.j("change",this.k,a)):g.trace&&g.trace("Does not contain, but doesnt match so not inserting",b.Y())}else if(a.type==f.t.Db)b=a.p,p=this.k.Ya(),c=p.indexOf(b),-1<c?(g.trace&&g.trace("Removing object",b.Y()),a=p.splice(c,1),this.k=d(p,this.a),this.j("change",this.k,{index:c,p:this,type:f.t.N,f:a})):g.trace&&g.trace("No modelEvents neccessary.",
b.Y());else throw new r('Unknown change type "'+a.type.toString()+'"');this.k=d(this.I.Nb(this.k),this.a)},Cc:function(){return this.a.o+":"+this.a.name},terminate:function(){this.qb&&k.removeListener(this.Cc(),this.qb);this.qb=this.k=null},sb:function(a){this.P("change",a);return function(){this.removeListener("change",a)}.bind(this)},Ie:function(a){this.ub("change",a)}});v.g=l},{"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":20,"./querySet":21,"./util":25,events:35}],23:[function(h,
v){function l(b,g){var a=f.defer(g);g=a.finish.bind(a);m.debug.isEnabled&&m.debug("get",b);var e;if(b.b)if(f.isArray(b.b))q(r.map(b.b,function(a){return{b:a}}),g);else if(e=d.get(b))m.debug.isEnabled&&m.debug("Had cached object",{q:b,p:e}),g&&g(null,e);else if(f.isArray(b.b))q(r.map(b.b,function(a){return{b:a}}),g);else{if(g)if(e=siesta.c.ca)e.lf.lg(b,g);else throw Error("Storage module not installed");}else if(b.a)if(f.isArray(b[b.a.id]))q(r.map(b[b.a.id],function(a){var c={};c[b.a.id]=a;c.a=b.a;
return c}),g);else if(e=d.get(b))m.debug.isEnabled&&m.debug("Had cached object",{q:b,p:e}),g&&g(null,e);else if(e=b.a,e.la)e.gd(g);else{var c=e.id,p=b[c],t={};if(t[c]=p)e.gd(t,function(a,c){a?g(a):c?g(null,c):g(null,null)});else throw new n('Invalid options given to store. Missing "'+c.toString()+'."');}else throw new n("Invalid options given to store",{q:b});return a.m}function q(b,d){var a=f.defer(d);d=a.finish.bind(a);var e=[],c=[];r.l(b,function(a){l(a,function(a,p){a?c.push(a):e.push(p);e.length+
c.length==b.length&&d&&(c.length?d(c):d(null,e))})});return a.m}var n=h("./error").F,k=h("./log"),f=h("./util"),r=f.h,d=h("./cache"),m=k.B("Store");v.g={get:l,mg:q,ve:function(b,g){var a=f.defer(g);g=a.finish.bind(a);var e=r.reduce(b,function(a,b){var e=d.get({b:b});e?a.Qa[b]=e:a.fc.push(b);return a},{Qa:{},fc:[]});(function(a){g&&(a?g(a):g(null,r.map(b,function(a){return e.Qa[a]})))})();return a.m},we:function(b,g,a){var e=f.defer(a);a=e.finish.bind(e);var c=r.reduce(b,function(a,c){var b={a:g};
b[g.id]=c;(b=d.get(b))?a.Qa[c]=b:a.fc.push(c);return a},{Qa:{},fc:[]});(function(e){a&&(e?a(e):a(null,r.map(b,function(a){return c.Qa[a]})))})();return e.m}}},{"./cache":8,"./error":11,"./log":14,"./util":25}],24:[function(h,v){function l(a,b,e){e=e||function(){};if(m.isArray(b))a.map(b,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},e);else{var d={};a.l(Object.keys(b),function(a,c){b[a](function(b){var e=Array.prototype.slice.call(arguments,
1);1>=e.length&&(e=e[0]);d[a]=e;c(b)})},function(a){e(a,d)})}}function q(a,b){if(a.map)return a.map(b);var e=[];r(a,function(a,c,d){e.push(b(a,c,d))});return e}function n(a,b,e,d){b=q(b,function(a,c){return{index:c,value:a}});if(d){var g=[];a(b,function(a,c){e(a.value,function(b,e){g[a.index]=e;c(b)})},function(a){d(a,g)})}else a(b,function(a,c){e(a.value,function(a){c(a)})})}function k(a,b,e){function d(){b(a[g],function(b){b?(e(b),e=function(){}):(g+=1,g>=a.length?e():d())})}e=e||function(){};if(!a.length)return e();
var g=0;d()}function f(a,b){if(a.forEach)a.forEach(b);else for(var e=0;e<a.length;e+=1)b(a[e],e,a)}function r(a,b,e){function g(b){b?(e(b),e=function(){}):(k+=1,k>=a.length&&e())}e=e||function(){};if(!a.length)return e();var k=0;f(a,function(a){b(a,d(g))})}function d(c){var b=!1;return function(){if(b)throw Error("Callback was already called.");b=!0;c.apply(a,arguments)}}var m=h("./misc"),b=h("./underscore"),g=function(a){return function(){return a.apply(null,[r].concat(Array.prototype.slice.call(arguments)))}}(n),
a,e=function(a){return function(){return a.apply(null,[k].concat(Array.prototype.slice.call(arguments)))}}(n);v.g={ld:function(a,d){d=d||function(){};if(m.isArray(a))e(a,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},d);else{var g={};k(b.keys(a),function(b,e){a[b](function(a){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);g[b]=c;e(a)})},function(a){d(a,g)})}},ia:function(a,b){l({map:g,l:r},a,b)}}},{"./misc":26,
"./underscore":27}],25:[function(h,v){var l=h("./underscore"),q=h("./async"),n=h("./misc");l.extend(v.g,{h:l,async:q});l.extend(v.g,n)},{"./async":24,"./misc":26,"./underscore":27}],26:[function(h,v){function l(a){return"string"==typeof a||a instanceof String}function q(a){return"[object Array]"===k.toString.call(a)}var n=h("../../vendor/observe-js/src/observe").Aa,k=h("./underscore"),f=h("./../error").F,r=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,d=/,/,m=/^\s*(_?)(.+?)\1\s*$/,b=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg,
g=Array.isArray||q;k.extend(v.g,{next:function(a){n.Qe();setTimeout(a)},Vf:function(a,b){return function(c){a&&a.apply(a,arguments);b&&(c?b.reject(c):b.resolve.apply(b,Array.prototype.slice.call(arguments,1)))}},ze:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),assert:function(a,b,c){if(!a)throw c=c||{},new f(b||"Assertion failed",c);},nd:function(){function a(a){a.nd=b;return a}
function b(c){var e=this;return a(function(a,b){return e(a,b)||c(a,b)})}return a}(),defer:function(a){var b;a=a||function(){};if(siesta.mc){b=siesta.mc.defer();var c=b.reject,d=b.resolve;k.extend(b,{reject:function(b){a(b);c.call(this,b)},resolve:function(c){a(null,c);d.call(this,c)},finish:function(b,e){a(b,e);b?c.call(this,b):d.call(this,e)}})}else b={m:void 0,reject:function(c){a(c)},resolve:function(c){a(null,c)},finish:function(c,b){a(c,b)}};return b},Wc:function(a,b,c){return Object.defineProperty(this,
a,{get:function(){return c?b[c]:b[a]},set:function(d){c?b[c]=d:b[a]=d},enumerable:!0,configurable:!0})},$f:function(a,b,c){return Object.defineProperty(this,a,{get:function(){return c?b[c]:b[a]},enumerable:!0,configurable:!0})},mf:function(a,b,c){g(c)||(c=Array.prototype.slice.call(arguments,2));for(var d=0;d<c.length;d++)(function(c){var d={set:!1,name:c,ja:c};l(c)||k.extend(d,c);c={get:function(){return b[d.ja]},enumerable:!0,configurable:!0};d.set&&(c.set=function(a){b[d.ja]=a});Object.defineProperty(a,
d.name,c)})(c[d])},Sc:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},Ta:function(a,b,c,d){if(void 0==d||d){var g=Object.keys(c);d=Object.keys(b).filter(function(a){return-1==g.indexOf(a)});if(d.length)throw Error("Unknown options: "+d.toString());}k.l(Object.keys(c),function(a){var d=c[a];"function"==typeof d&&(c[a]=d(b[a]),delete b[a])});k.extend(c,b);k.extend(a,c)},ec:l,isArray:g,K:function(a){return JSON.stringify(a,null,4)},ue:function(a){return k.reduce(a,function(a,c){g(c)?a=a.concat(c):
a.push(c);return a},[])},od:function(a,b){for(var c=0,d=[],f=0;f<b.length;f++)if(g(b[f])){var k=[];d[f]=k;for(var m=0;m<b[f].length;m++)k.push(a[c]),c++}else d[f]=a[c],c++;return d},lc:function(a){var e=[];a.toString().replace(b,"").match(r)[1].split(d).forEach(function(a){a.replace(m,function(a,c,b){e.push(b)})});return e}})},{"../../vendor/observe-js/src/observe":41,"./../error":11,"./underscore":27}],27:[function(h,v){function l(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,
c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,g){return a.call(b,c,d,g)};case 4:return function(c,d,g,f){return a.call(b,c,d,g,f)}}return function(){return a.apply(b,arguments)}}function q(){}var n={},k=Array.prototype,f=k.forEach,r=k.map,d=k.reduce,m=Function.prototype.bind,b=k.slice,g={};n.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(c);return b};n.l=n.forEach=function(a,b,c){if(null==a)return a;if(f&&
a.forEach===f)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,k=a.length;d<k;d++){if(b.call(c,a[d],d,a)===g)return}else for(var m=n.keys(a),d=0,k=m.length;d<k;d++)if(b.call(c,a[m[d]],m[d],a)===g)return;return a};n.map=n.Yf=function(a,b,c){var d=[];if(null==a)return d;if(r&&a.map===r)return a.map(b,c);n.l(a,function(a,g,f){d.push(b.call(c,a,g,f))});return d};n.gh=function(a,b,c){var d=Array(Math.max(0,a));b=l(b,c,1);for(c=0;c<a;c++)d[c]=b(c);return d};n.C=function(a){var e=b.call(arguments,
1);return function(){for(var c=0,b=e.slice(),d=0,g=b.length;d<g;d++)b[d]===n&&(b[d]=arguments[c++]);for(;c<arguments.length;)b.push(arguments[c++]);return a.apply(this,b)}};n.Q=function(a,b){return n.map(a,n.ja(b))};n.reduce=n.hg=n.vg=function(a,b,c,g){var f=2<arguments.length;null==a&&(a=[]);if(d&&a.reduce===d)return g&&(b=n.bind(b,g)),f?a.reduce(b,c):a.reduce(b);n.l(a,function(a,d,k){f?c=b.call(g,c,a,d,k):(c=a,f=!0)});if(!f)throw new TypeError("Reduce of empty array with no initial value");return c};
n.ja=function(a){return function(b){return b[a]}};"function"!==typeof/./&&(n.dc=function(a){return"function"===typeof a});n.ad=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};n.gf=function(a,b){b=null==b?n.$c:n.dc(b)?b:n.ja(b);return n.Q(n.map(a,function(a,d,g){return{value:a,index:d,Uc:b.call(void 0,a,d,g)}}).sort(function(a,b){var e=a.Uc,d=b.Uc;if(e!==d){if(e>d||void 0===e)return 1;if(e<d||void 0===d)return-1}return a.index-b.index}),"value")};n.bind=function(a,e){var c,d;if(m&&
a.bind===m)return m.apply(a,b.call(arguments,1));if(!n.dc(a))throw new TypeError;c=b.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(e,c.concat(b.call(arguments)));q.prototype=a.prototype;var g=new q;q.prototype=null;u;var f=a.apply(g,c.concat(b.call(arguments)));return Object(f)===f?f:g}};n.$c=function(a){return a};n.kh=function(a){if(null==a)return[];for(var b=n.max(arguments,"length").length,c=Array(b),d=0;d<b;d++)c[d]=n.Q(arguments,d);return c};n.max=function(a,b,
c){var d=-Infinity,g=-Infinity,f;if(null==b&&null!=a){a=a.length===+a.length?a:n.jh(a);for(var k=0,m=a.length;k<m;k++)c=a[k],c>d&&(d=c)}else b=n.bd(b,c),n.l(a,function(a,c,k){f=b(a,c,k);if(f>g||-Infinity===f&&-Infinity===d)d=a,g=f});return d};n.bd=function(a,b){return null==a?n.$c:n.dc(a)?l(a,b,void 0):n.ad(a)?n.matches(a):n.ja(a)};n.Pe=function(a){for(var b=n.keys(a),c=b.length,d=Array(c),g=0;g<c;g++)d[g]=[b[g],a[b[g]]];return d};n.matches=function(a){var b=n.Pe(a),c=b.length;return function(a){if(null==
a)return!c;a=Object(a);for(var d=0;d<c;d++){var g=b[d],f=g[0];if(g[1]!==a[f]||!(f in a))return!1}return!0}};n.some=function(a,b,c){if(null==a)return!1;b=n.bd(b,c);c=a.length!==+a.length&&n.keys(a);var d=(c||a).length,g,f;for(g=0;g<d;g++)if(f=c?c[g]:g,b(a[f],f,a))return!0;return!1};n.extend=function(a){if(!n.ad(a))return a;for(var b,c,d=1,g=arguments.length;d<g;d++)for(c in b=arguments[d],b)hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a};v.g=n},{}],28:[function(h,v,l){function q(a){a?"*"==a||-1<a.indexOf("*")?
a=e:f.isArray(a)||(a=[a]):a=["GET"];return g.map(a,function(a){return a.toUpperCase()})}function n(a){if(!this)return new n(a);this.ib=b(!0,{},a);this.d=a;var e=function(a){a instanceof RegExp||(a=new RegExp(a,"g"));return a}.bind(this);if(this.d.path){var k=this.d.path;f.isArray(k)||(k=[k]);this.d.path=[];g.l(k,function(a){this.d.path.push(e.call(this,a))}.bind(this))}else this.d.path=[""];this.d.method=q(this.d.method);if(this.d.a){if("string"==typeof this.d.a)if(this.d.i)if(k="string"==typeof this.d.i?
m[this.d.i]:this.d.i)if(k=k[this.d.a])this.d.a=k;else throw Error("Model "+this.d.a+" does not exist",{q:a,ob:this});else throw Error("Collection "+this.d.i+" does not exist",{q:a,ob:this});else throw Error("Passed model as string, but did not specify the collection it belongs to",{q:a,ob:this});}else throw Error("Descriptors must be initialised with a model",{q:a,ob:this});if((a=this.d.data)&&a.length){k=a.split(".");if(1==k.length)a=k[0];else{var l={};a=l;for(var h=k[0],r=1;r<k.length;r++){var v=
k[r];if(r==k.length-1)l[h]=v;else var w={},l=l[h]=w,h=v}}this.d.data=a}d.call(this,"path",this.d);d.call(this,"method",this.d);d.call(this,"model",this.d);d.call(this,"data",this.d);d.call(this,"transforms",this.d)}h=siesta.ea;var k=h.error.F,f=h.na,r=f.assert,d=f.Wc,m=h.da,b=h.extend,g=f.h,a=h.log.B("Descriptor"),e="POST PATCH PUT HEAD GET DELETE OPTIONS TRACE CONNECT".split(" ");g.extend(n.prototype,{qg:e,Td:function(b){var d;for(d=0;d<this.d.path.length;d++){var e=this.d.path[d];a.trace.isEnabled&&
a.trace("Matching path",b,e.toString());var g=e.exec(b);a.trace.isEnabled&&(g?a.trace("Matched path successfully",b,e.toString()):a.trace("Failed to match path",b,e.toString()));if(g)return!0}return!1},Sd:function(a){for(var b=0;b<this.method.length;b++)if(a.toUpperCase()==this.method[b])return!0;return!1},ge:function(a,b){var d=Object.keys(b);r(1==d.length);for(var d=d[0],e=b;"string"!=typeof e[d];)e=e[d],d=Object.keys(e),r(1==d.length),d=d[0];var g=e[d],f={};e[d]=f;f[g]=a;return b},Dc:function(a){if(this.data){var d;
"string"==typeof this.data?(d={},d[this.data]=a):d=this.ge(a,b(!0,{},this.data));return d}return a},Na:function(b){a.debug.isEnabled&&a.debug("_extractData",b);if(this.data){if("string"==typeof this.data)return b[this.data];var d=Object.keys(this.data);r(1==d.length);for(var e=this.data;"string"!=typeof e&&(d=Object.keys(e),r(1==d.length),d=d[0],e=e[d],b=b[d],b););return b?b[e]:null}return b},Hc:function(a){var b=a.type?this.Sd(a.type):{};b&&(b=a.url?this.Td(a.url):{});return b},Kb:function(a){var b=
null;this.data?a&&(b=this.Na(a)):b=a;return b},match:function(a,b){var d=!1;this.Hc(a)&&(d=this.Kb(b));return d},jb:function(a){var b=this.V;if("function"==typeof b)a=b(a);else for(var d in b)if(b.hasOwnProperty(d)&&a[d]){var e=b[d],g=a[d];if("string"==typeof e)if(e=e.split("."),delete a[d],1==e.length)a[e[0]]=g;else{a[e[0]]={};for(var m=a[e[0]],l=1;l<e.length-1;l++){var h=e[l];m[h]={};m=m[h]}m[e[e.length-1]]=g}else if("function"==typeof e)g=e(g),f.isArray(g)?(delete a[d],a[g[0]]=g[1]):a[d]=g;else throw new k("Invalid transformer");
}return a}});l.ab=n;l.cf=q},{}],29:[function(h,v,l){function q(){if(!this)return new q;this.nc={};this.wb={}}function n(f,d){var k=d.a.o;f[k]||(f[k]=[]);f[k].push(d)}function k(f,d){return"string"==typeof d?f[d]||[]:f[d.name]||[]}h=siesta.ea;v=h.na.h;var f=h.log.B("Descriptor");v.extend(q.prototype,{We:function(f){n(this.nc,f)},Xe:function(k){f.trace.isEnabled&&f.trace("registerResponseDescriptor");n(this.wb,k)},bf:function(f){return k(this.nc,f)},df:function(l){l=k(this.wb,l);l.length||f.debug.isEnabled&&
f.debug("No response descriptors for collection ",this.wb);return l},reset:function(){this.nc={};this.wb={}}});l.ya=new q},{}],30:[function(h,v){function l(a,b,c){if(A.debug.isEnabled){var d=A.debug;a=a.type+" "+b.status+" "+a.url;A.trace.isEnabled&&c&&(d=A.trace,a+=": "+B.K(c));d(a)}}function q(a){if(A.debug.isEnabled){var b=A.debug;a=a.type+" "+a.url;A.trace.isEnabled&&(b=A.trace);b(a)}}function n(a,b,c,d){var e=this,g=Array.prototype.slice.call(arguments,2),f={},k=this.name;"function"==typeof g[0]?
d=g[0]:"object"==typeof g[0]&&(f=g[0],d=g[1]);g=B.defer();f.type=a;f.url||(f.url=this.Pa+b);void 0===f.vb&&(f.vb=!0);f.nf=function(a,b,c){l(f,c,a);var g={data:a,status:b,qf:c};if(f.vb){b=z.df(e);var m,h;for(c=0;c<b.length;c++){var p=b[c];if(h=p.match(f,a)){m=p;break}}if(m)A.trace.isEnabled&&A.trace("Model _constructSubOperation data: "+B.K(h)),"object"==typeof h?m.a.map(h,{jc:f.p},function(a,b){d&&d(a,b,g)}):d(null,!0,g);else if(d)if(k)a={},m=x.ud.zc,a[x.xc.sd]=m,a[x.xc.zb]=x.zb[m],d(a,null,g);else throw new C("Unnamed collection");
}else d(null,null,g)};f.error=function(a,b,c){a={qf:a,status:b,error:c};d&&d(a,null,a)};q(f);siesta.c.H.kb(f);return g.m}function k(a,b,c){this.Nc(b,function(b,d){var e=d;a.te&&(e={},w.l(a.te,function(a){e[a]=d[a]}));c(b,e)})}function f(a,b,c){var d=this,e=Array.prototype.slice.call(arguments,3),g,f={};"function"==typeof e[0]?g=e[0]:"object"==typeof e[0]&&(f=e[0],g=e[1]);var m=B.defer(g);g=m.finish.bind(m);var e=Array.prototype.slice.call(e,2),l=z.bf(this),h;f.type=a;f.url=this.Pa+b;for(var p=0;p<
l.length;p++){var r=l[p];if(r.Hc(f)){h=r;break}}h?(A.trace.isEnabled&&A.trace("Matched descriptor: "+h.u(!0)),k.call(h,c,f,function(k,m){A.trace.isEnabled&&A.trace("_serialise",{pb:k,data:m});k?g&&g(k,null,null):(f.data=m,f.p=c,w.C(n,a,b,f,g).apply(d,e))})):g&&(A.trace.isEnabled&&A.trace("Did not match descriptor"),g("No descriptor matched",null,null));return m.m}function r(a,b){var c=Array.prototype.slice.call(arguments,2),d={},e;"function"==typeof c[0]?e=c[0]:"object"==typeof c[0]&&(d=c[0],e=c[1]);
var g=B.defer(e),f=d.ag||"restore";void 0===d.vb&&(d.vb=!1);n.call(this,"DELETE",a,d,function(a,c,d,k){a?"restore"==f&&b.restore():"success"==f&&b.remove();e(a,c,d,k);g.finish(a,{x:c,y:d,z:k})});"now"!=f&&"restore"!=f||b.remove();return g.m}function d(a,b){var c=Array.prototype.slice.call(arguments,2);return w.C(a?f:n,b).apply(this,c)}function m(){return w.C(d,!1,"GET").apply(this,arguments)}function b(){return w.C(d,!1,"OPTIONS").apply(this,arguments)}function g(){return w.C(d,!1,"TRACE").apply(this,
arguments)}function a(){return w.C(d,!1,"HEAD").apply(this,arguments)}function e(){return w.C(d,!0,"POST").apply(this,arguments)}function c(){return w.C(d,!0,"PUT").apply(this,arguments)}function p(){return w.C(d,!0,"PATCH").apply(this,arguments)}if("undefined"==typeof siesta&&"undefined"==typeof v)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var t=siesta.ea,y=t.yb,D=t.log,B=t.na,x=t.error,w=B.h,E=h("./descriptor"),C=t.error.F,z=h("./descriptorRegistry").ya,
A=D.B("HTTP"),t={Eb:h("./requestDescriptor").Eb,Fb:h("./responseDescriptor").Fb,ab:E.ab,be:E.cf,Ac:h("./serialiser"),ya:h("./descriptorRegistry").ya,Hf:n,Gf:f,td:r,uf:d,vd:m,Ed:g,xd:b,wd:a,zd:e,Ad:c,yd:p,Lf:k,Bd:h("./paginator")};Object.defineProperty(t,"ajax",{get:function(){var a=F||($?$.kb:null)||(jQuery?jQuery.kb:null);if(!a)throw new C("ajax has not been defined and could not find $.ajax or jQuery.ajax");return a},set:function(a){F=a}});w.extend(y.prototype,{td:r,vd:m,Ed:g,xd:b,wd:a,zd:e,Ad:c,
yd:p});siesta.c||(siesta.c={});siesta.c.H=t;Object.defineProperties(siesta.c,{Va:{get:function(){return void 0!==siesta.c.Fc?siesta.c.Fc:!!siesta.c.H},set:function(a){siesta.c.Fc=a},enumerable:!0}});var F,y={};w.extend(siesta,{Yg:function(a){F=a},ig:function(){return siesta.c.H.kb},Wg:y,Xg:y});Object.defineProperties(y,{id:{get:function(){return siesta.c.Va?siesta.c.H.Ac.Be:null}},depth:{get:function(){return siesta.c.Va?siesta.c.H.Ac.Yc:null}}});"undefined"!=typeof v&&(v.g=t)},{"./descriptor":28,
"./descriptorRegistry":29,"./paginator":31,"./requestDescriptor":32,"./responseDescriptor":33,"./serialiser":34}],31:[function(h,v){function l(d){this.q={};k.Ta(this.q,d,{path:"/",a:null,page:"page",Ue:!0,kc:"pageSize",gc:"numPages",ke:"data",count:"count",type:"GET",dataType:"json"},!1);f.extend(this,{gc:null,count:null});this.xa()}var q=siesta.ea,n=q.error.F,k=q.na,f=k.h,r=h("querystring");f.extend(l.prototype,{Hb:function(d,f,b){if(d)if("function"==typeof d)f=d(f,b);else for(d=d.split("."),b=0;b<
d.length;b++)f=f[d[b]];return f},Na:function(d,f){return this.Hb(this.q.ke,d,f)},Ld:function(d,f){return this.Hb(this.q.gc,d,f)},Kd:function(d,f){return this.Hb(this.q.count,d,f)},Vd:function(d){var f=document.createElement("a");f.href=d;return f},page:function(d,m){var b=this,g={};"function"==typeof d?m=d:d&&(g=d);var a=k.defer(m),e=g.page,g=g.kc;m=a.finish.bind(a);var c=siesta.c.H.kb,l=f.extend({},this.q),h=this.q.a.i.Pa+this.q.path;if(this.q.Ue){var h=this.Vd(h),n=h.search,q=n.split("?");1<q.length&&
(n=q[1]);n=r.parse(n);e&&(n[this.q.page]=e);g&&(n[this.q.kc]=g);Object.keys(n).length&&(h.search="?"+r.stringify(n));h=h.href}else n={},e&&(n[this.q.page]=e),g&&(n[this.q.kc]=g),l.data=n;f.extend(l,{url:h,nf:function(a,c,d){var e=b.Na(a,d),g=b.Kd(a,d),f=b.Ld(a,d);b.q.a.map(e,function(e,k){e?m(e):(b.count=g,b.gc=f,m(null,k,{data:a,fh:c,Bg:d}))})},gg:m});c(l);return a.m},xa:function(){if(!this.q.a)throw new n("Paginator must have a model");}});v.g=l},{querystring:38}],32:[function(h,v,l){function q(d){if(!this)return new q(d);
n.call(this,d);this.d.serializer&&(this.d.va=this.d.serializer);this.d.va||(this.d.va=k.Yc(0));r.call(this,"serialiser",this.d);r.call(this,"serializer",this.d,"serialiser")}var n=h("./descriptor").ab,k=h("./serialiser");h=siesta.ea;var f=h.na;v=f.h;var r=f.Wc,d=h.log.B("Descriptor");q.prototype=Object.create(n.prototype);v.extend(q.prototype,{Nc:function(k,b){var g=f.defer(b);b=g.finish.bind(g);var a=this;d.trace.isEnabled&&d.trace("_serialise");var e,c=this.va(k,function(c,d){e||(d=a.jb(d),b&&b(c,
a.Dc(d)))});void 0!==c?(d.trace.isEnabled&&d.trace("serialiser doesnt use a callback"),e=!0,c=a.jb(c),b&&b(null,a.Dc(c))):d.trace.isEnabled&&d.trace("serialiser uses a callback",this.va);return g.m},u:function(d){var b={};b.methods=this.method;b.a=this.a.name;b.path=this.ib.path;b.va="function"==typeof this.ib.va?"function () { ... }":this.ib.va;var g={},a;for(a in this.V)this.V.hasOwnProperty(a)&&(g[a]="function"==typeof this.V[a]?"function () { ... }":this.V[a]);b.V=g;return d?f.K(b):b}});l.Eb=
q},{"./descriptor":28,"./serialiser":34}],33:[function(h,v,l){function q(k){if(!this)return new q(k);n.call(this,k)}var n=h("./descriptor").ab;h=siesta.ea.na.h;q.prototype=Object.create(n.prototype);h.extend(q.prototype,{Na:function(k){(k=n.prototype.Na.call(this,k))&&(k=this.jb(k));return k},Kb:function(k){(k=n.prototype.Kb.call(this,k))&&(k=this.jb(k));return k},u:function(k){var f={};f.methods=this.method;f.a=this.a.name;f.path=this.ib.path;var h={},d;for(d in this.V)this.V.hasOwnProperty(d)&&
(h[d]="function"==typeof this.V[d]?"function () { ... }":this.V[d]);f.V=h;return k?util.K(f):f}});l.Fb=q},{"./descriptor":28}],34:[function(h,v,l){function q(f){var d=f.a.id;if(d)return f[d]?f[d]:null;k.debug.isEnabled&&k.debug("No idfield")}function n(h,d,m){m=m||function(){};k.trace.isEnabled&&k.trace("depthSerialiser");var b={};f.l(d.Ca,function(a){k.trace.isEnabled&&k.trace("field",a);d[a]&&(b[a]=d[a])});var g=[],a=[],e={},c=[];f.l(d.Oa,function(f){k.trace.isEnabled&&k.trace("relationshipField",
f);var l=d.W[f];l.ta&&(k.debug.isEnabled&&k.debug(f),g.push(f),l.get(function(l,q){k.trace.isEnabled&&k.trace("proxy.get",f);k.debug.isEnabled&&k.debug(f,q);l?(a.push(l),c.push(f),e[f]={pb:l,vc:q}):q?h?n(h-1,q,function(d,k,l){d?a.push(d):b[f]=k;c.push(f);e[f]={pb:d,vc:q,Tg:l};g.length==c.length&&m&&m(a.length?a:null,b,e)}):(c.push(f),b[f]=q[d.W[f].Ua.id],e[f]={pb:l,vc:q},g.length==c.length&&m&&m(a.length?a:null,b,e)):(k.debug.isEnabled&&k.debug("no value for "+f),c.push(f),e[f]={pb:l,vc:q},g.length==
c.length&&m&&m(a.length?a:null,b,e))}))});g.length||m(null,b,{})}h=siesta.ea;v=h.na;var k=h.log.B("Serialisation"),f=v.h;l.bg=function(k){return f.C(n,k)};l.Yc=function(k){return f.C(n,k)};l.sg=q;l.Be=q},{}],35:[function(h,v){function l(){this.e=this.e||{};this.gb=this.gb||void 0}function q(k){return"function"===typeof k}function n(k){return"object"===typeof k&&null!==k}v.g=l;l.yc=l;l.prototype.e=void 0;l.prototype.gb=void 0;l.me=10;l.prototype.j=function(k){var f,l,d,h;this.e||(this.e={});if("error"===
k&&(!this.e.error||n(this.e.error)&&!this.e.error.length)){f=arguments[1];if(f instanceof Error)throw f;throw TypeError('Uncaught, unspecified "error" event.');}l=this.e[k];if(void 0===l)return!1;if(q(l))switch(arguments.length){case 1:l.call(this);break;case 2:l.call(this,arguments[1]);break;case 3:l.call(this,arguments[1],arguments[2]);break;default:f=arguments.length;d=Array(f-1);for(h=1;h<f;h++)d[h-1]=arguments[h];l.apply(this,d)}else if(n(l)){f=arguments.length;d=Array(f-1);for(h=1;h<f;h++)d[h-
1]=arguments[h];l=l.slice();f=l.length;for(h=0;h<f;h++)l[h].apply(this,d)}return!0};l.prototype.addListener=function(k,f){var h;if(!q(f))throw TypeError("listener must be a function");this.e||(this.e={});this.e.Kg&&this.j("newListener",k,q(f.Ga)?f.Ga:f);this.e[k]?n(this.e[k])?this.e[k].push(f):this.e[k]=[this.e[k],f]:this.e[k]=f;n(this.e[k])&&!this.e[k].pf&&(h=void 0===this.gb?l.me:this.gb)&&0<h&&this.e[k].length>h&&(this.e[k].pf=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this.e[k].length),"function"===typeof console.trace&&console.trace());return this};l.prototype.P=l.prototype.addListener;l.prototype.ub=function(k,f){function h(){this.removeListener(k,h);d||(d=!0,f.apply(this,arguments))}if(!q(f))throw TypeError("listener must be a function");var d=!1;h.Ga=f;this.P(k,h);return this};l.prototype.removeListener=function(k,f){var h,d,l;if(!q(f))throw TypeError("listener must be a function");if(!this.e||!this.e[k])return this;h=this.e[k];l=h.length;d=-1;if(h===f||q(h.Ga)&&
h.Ga===f)delete this.e[k],this.e.removeListener&&this.j("removeListener",k,f);else if(n(h)){for(;0<l--;)if(h[l]===f||h[l].Ga&&h[l].Ga===f){d=l;break}if(0>d)return this;1===h.length?(h.length=0,delete this.e[k]):h.splice(d,1);this.e.removeListener&&this.j("removeListener",k,f)}return this};l.prototype.Ja=function(k){var f;if(!this.e)return this;if(!this.e.removeListener)return 0===arguments.length?this.e={}:this.e[k]&&delete this.e[k],this;if(0===arguments.length){for(f in this.e)"removeListener"!==
f&&this.Ja(f);this.Ja("removeListener");this.e={};return this}f=this.e[k];if(q(f))this.removeListener(k,f);else for(;f.length;)this.removeListener(k,f[f.length-1]);delete this.e[k];return this};l.prototype.ua=function(k){return this.e&&this.e[k]?q(this.e[k])?[this.e[k]]:this.e[k].slice():[]};l.Eg=function(k,f){return k.e&&k.e[f]?q(k.e[f])?1:k.e[f].length:0}},{}],36:[function(h,v){v.g=function(h,n,k,f){k=k||"=";var r={};if("string"!==typeof h||0===h.length)return r;var d=/\+/g;h=h.split(n||"&");n=
1E3;f&&"number"===typeof f.Ke&&(n=f.Ke);f=h.length;0<n&&f>n&&(f=n);for(n=0;n<f;++n){var m=h[n].replace(d,"%20"),b=m.indexOf(k),g;0<=b?(g=m.substr(0,b),m=m.substr(b+1)):(g=m,m="");g=decodeURIComponent(g);m=decodeURIComponent(m);Object.prototype.hasOwnProperty.call(r,g)?l(r[g])?r[g].push(m):r[g]=[r[g],m]:r[g]=m}return r};var l=Array.isArray||function(h){return"[object Array]"===Object.prototype.toString.call(h)}},{}],37:[function(h,v){function l(f){switch(typeof f){case "string":return f;case "boolean":return f?
"true":"false";case "number":return isFinite(f)?f:"";default:return""}}function q(f,k){if(f.map)return f.map(k);for(var d=[],h=0;h<f.length;h++)d.push(k(f[h],h));return d}v.g=function(f,h,d,m){h=h||"&";d=d||"=";null===f&&(f=void 0);return"object"===typeof f?q(k(f),function(b){var g=encodeURIComponent(l(b))+d;return n(f[b])?q(f[b],function(a){return g+encodeURIComponent(l(a))}).join(h):g+encodeURIComponent(l(f[b]))}).join(h):m?encodeURIComponent(l(m))+d+encodeURIComponent(l(f)):""};var n=Array.isArray||
function(f){return"[object Array]"===Object.prototype.toString.call(f)},k=Object.keys||function(f){var k=[],d;for(d in f)Object.prototype.hasOwnProperty.call(f,d)&&k.push(d);return k}},{}],38:[function(h,v,l){l.Zf=l.parse=h("./decode");l.fg=l.stringify=h("./encode")},{"./decode":36,"./encode":37}],39:[function(h,v){function l(k){if(!k||"[object Object]"!==n.call(k)||k.nodeType||k.setInterval)return!1;var f=q.call(k,"constructor"),h=k.constructor&&k.constructor.prototype&&q.call(k.constructor.prototype,
"isPrototypeOf");if(k.constructor&&!f&&!h)return!1;for(var d in k);return void 0===d||q.call(k,d)}var q=Object.prototype.hasOwnProperty,n=Object.prototype.toString;v.g=function f(){var h,d,m,b,g,a=arguments[0],e=1,c=arguments.length,n=!1;if("boolean"===typeof a)n=a,a=arguments[1]||{},e=2;else if("object"!==typeof a&&"function"!==typeof a||void 0==a)a={};for(;e<c;++e)if(null!=(h=arguments[e]))for(d in h)m=a[d],b=h[d],a!==b&&(n&&b&&(l(b)||(g=Array.isArray(b)))?(g?(g=!1,m=m&&Array.isArray(m)?m:[]):m=
m&&l(m)?m:{},a[d]=f(n,m,b)):void 0!==b&&(a[d]=b));return a}},{}],40:[function(h,v){if("undefined"==typeof siesta&&"undefined"==typeof v)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var l=siesta.ea,q=l.da,n=l.na,k=n.h,f=l.re,r=[],d={},m={},b={},g=l.log.B("Storage");if("undefined"==typeof PouchDB)siesta.c.wa=!1,console.log("PouchDB is not present therefore storage is disabled.");else{var a=function(a){var b=n.defer(a);siesta.Gb(function(){a=a||function(){};
var c=r;r=[];d={};m={};g.trace&&g.trace("Saving objects",k.map(c,function(a){return a.u()}));e(c,a,b)});return b.m},e=function(a,b,d){var e=[];D.Sf(k.map(a,y)).then(function(f){for(var k=0;k<f.length;k++){var h=f[k],l=a[k];h.Ng?l.pa=h.rev:409==h.status?e.push(l):g.error('Error saving object with _id="'+l.b+'"',h)}e.length?c(e,b,d):(b(),d&&d.resolve())},function(a){b(a);d&&d.reject(a)})},c=function(a,b,c){D.Nf({keys:k.Q(a,"_id")}).then(function(d){for(var f=0;f<d.rows.length;f++)a[f].pa=d.rows[f].value.rev;
e(a,b,c)})["catch"](function(a){c.reject(a)})},p=function(a,b){var c=a.o,d=a.ed;if(g.trace){var e=c+"."+d;g.trace("Loading instances for "+e)}var f=q[c][d],c=function(a){"$1"==a.a&&"$2"==a.i&&emit(a.b,a)}.toString().replace("$1",d).replace("$2",c);g.trace.isEnabled&&g.trace("Querying pouch");D.Ia({map:c}).then(function(a){g.trace.isEnabled&&g.trace("Queried pouch succesffully");a=siesta.h.map(siesta.h.Q(a.rows,"value"),function(a){return t(a,f)});g.trace.isEnabled&&g.trace("Mapping data",a);f.map(a,
{Z:!0,fb:!0,mb:!1},function(a,c){a?g.error("Error loading models",a):g.trace.isEnabled&&g.trace("Loaded "+c?c.length.toString():"0 instances for "+e);b(a,c)})})["catch"](function(a){b(a)})},t=function(a,b){delete a.i;delete a.a;k.l(b.Oa,function(b){var c=a[b];siesta.isArray(c)?a[b]=k.map(c,function(a){return{b:a}}):a[b]={b:c}});return a},y=function(a){var b=siesta.h.extend({},a.X);b.collection=a.o;b.model=a.ed;b._id=a.b;a.f&&(b._deleted=!0);var c=a.pa;c&&(b._rev=c);return b=k.reduce(a.Oa,function(b,
c){var d=a[c];siesta.isArray(d)?b[c]=k.Q(d,"_id"):d&&(b[c]=d.b);return b},b)},D=new PouchDB("siesta"),B=function(a){a=a.p;var b=a.b;if(!a)throw new l.error.F("No obj field in notification received by storage extension");if(!(b in d)){d[b]=a;r.push(a);var c=a.o;m[c]||(m[c]={});var e=a.a.name;m[c][e]||(m[c][e]={});m[c][e][b]=a}};siesta.P("Siesta",B);k.extend(b,{Nd:function(a){if(w)throw Error("not loaded yet how can i save");var b=n.defer(a);if(siesta.c.wa){var c=[];k.l(q.Ea,function(a){var b=Object.keys(q[a].oa);
k.l(b,function(b){c.push(function(c){p({o:a,ed:b},c)})})});siesta.async.ia(c,function(a,c){if(!a){var d=[];siesta.h.l(c,function(){});g.trace&&g.trace("Loaded "+d.length.toString()+" instances")}b.finish(a)})}else b.finish();return b.m},save:a,Nc:y,Mc:function(a){siesta.removeListener("Siesta",B);r=[];d={};D.cg(function(b){b||(D=new PouchDB("siesta"));siesta.P("Siesta",B);g.warn("Reset complete");a(b)})}});Object.defineProperties(b,{Mf:{get:function(){return r}},ce:{get:function(){return d}},Ob:{get:function(){return m}},
Jf:{get:function(){return D}}});siesta.c||(siesta.c={});siesta.c.ca=b;Object.defineProperties(siesta.c,{wa:{get:function(){return void 0!==siesta.c.Oc?siesta.c.Oc:!!siesta.c.ca},set:function(a){siesta.c.Oc=a},enumerable:!0}});var x,w,E=1E3;Object.defineProperties(siesta,{Qc:{get:function(){return!!x},set:function(a){a?x||(x=setInterval(function(){w||(w=!0,siesta.save(function(a){a||f.j("saved");w=!1}))},siesta.fe)):x&&(clearInterval(x),x=null)}},fe:{get:function(){return E},set:function(a){E=a;x&&
(siesta.Qc=!1,siesta.Qc=!0)}},Yb:{get:function(){return!!Object.keys(siesta.c.ca.Ob).length},enumerable:!0}});k.extend(siesta,{save:a,$g:function(a){if(siesta.Gd)D=a;else throw Error("Cannot change PouchDB instance when an object graph exists.");}})}v.g=b},{}],41:[function(h,v,l){(function(h){(function(h){function k(a){for(var b=0;1E3>b&&a.Ra();)b++;B&&(h.oe=b)}function f(a){for(var b in a)return!1;return!0}function q(a,b){var c={},d={},e={},f;for(f in b){var g=a[f];if(void 0===g||g!==b[f])f in a?
g!==b[f]&&(e[f]=g):d[f]=void 0}for(f in a)f in b||(c[f]=a[f]);Array.isArray(a)&&a.length!==b.length&&(e.length=a.length);return{G:c,f:d,Sb:e}}function d(){if(!C.length)return!1;for(var a=0;a<C.length;a++)C[a]();C.length=0;return!0}function m(){function a(c){b&&b.ma===G&&!d&&b.Ra(c)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.Xc(a);b=c;e=!1},observe:function(b,d){c=b;d?Array.observe(c,a):Object.observe(c,a)},nb:function(b){d=b;Object.Xc(a);d=!1},close:function(){b=
void 0;Object.pd(c,a);A.push(this)}}}function b(){this.ma=F;this.D=this.Fa=this.tc=this.Qb=void 0;M++}function g(a){b.call(this);this.D=a;this.ba=void 0}function a(a){if(!Array.isArray(a))throw Error("Provided object is not an Array");g.call(this,a)}function e(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];O[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"==g.type?g.name in e?delete e[g.name]:d[g.name]=!0:g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0)):
(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(h in e)e[h]=void 0;b={};for(h in c)h in d||h in e||(f=a[h],c[h]!==f&&(b[h]=f));return{G:d,f:e,Sb:b}}function c(a,b,c){return{index:a,f:b,r:c}}function p(){}function t(a,b,d,e){b=c(b,d,e);e=!1;for(var f=0,g=0;g<a.length;g++){var h=a[g];h.index+=f;if(!e){d=b.index;var k=b.index+b.f.length,l=h.index,m=h.index+h.r;d=k<l||m<d?-1:k==l||m==d?0:d<l?k<m?k-l:m-l:m<k?m-d:k-d;0<=d?(a.splice(g,1),g--,f-=h.r-h.f.length,
b.r+=h.r-d,d=b.f.length+h.f.length-d,b.r||d?(d=h.f,b.index<h.index&&(k=b.f.slice(0,h.index-b.index),Array.prototype.push.apply(k,d),d=k),b.index+b.f.length>h.index+h.r&&Array.prototype.push.apply(d,b.f.slice(h.index+h.r-b.index)),b.f=d,h.index<b.index&&(b.index=h.index)):e=!0):b.index<h.index&&(e=!0,a.splice(g,0,b),g++,d=b.r-b.f.length,h.index+=d,f+=d)}}e||a.push(b)}function y(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];switch(d.type){case "splice":t(b,d.index,d.f.slice(),d.r);break;case "add":case "update":case "delete":var e=
d.name;if(+e!==e>>>0||""===e)continue;e=+d.name;if(0>e)continue;t(b,e,[d.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(d))}}return b}function D(a,b){var c=[];y(b).forEach(function(b){1==b.r&&1==b.f.length?b.f[0]!==a[b.index]&&c.push(b):c=c.concat(K.Pb(a,b.index,b.index+b.r,b.f,0,b.f.length))});return c}var B=h.eh,x=function(){function a(c){b=c}if("function"!==typeof Object.observe||"function"!==typeof Array.observe)return!1;var b=[],c={},d=[];Object.observe(c,
a);Array.observe(d,a);c.id=1;c.id=2;delete c.id;d.push(1,2);d.length=0;Object.Xc(a);if(5!==b.length||"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type)return!1;Object.pd(c,a);Array.pd(d,a);return!0}(),w=function(){if("undefined"!==typeof chrome&&chrome.de&&chrome.de.Vg||navigator.kg)return!1;try{return(new Function("","return true;"))()}catch(a){return!1}}(),E="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=
Object.create(b);Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))});return c},C=[],z=x?function(){var a={jd:!0},b=!1;Object.observe(a,function(){d();b=!1});return function(c){C.push(c);b||(b=!0,a.jd=!a.jd)}}():function(){return function(a){C.push(a)}}(),A=[],F=0,G=1,M=1;b.prototype={open:function(a,c){if(this.ma!=F)throw Error("Observer has already been opened.");b.Bc++;I&&H.push(this);this.Qb=a;this.tc=c;this.je();this.ma=G;return this.D},
close:function(){this.ma==G&&(b.Bc--,this.qe(),this.tc=this.Qb=this.D=void 0,this.ma=2)},nb:function(){this.ma==G&&k(this)},kd:function(a){try{this.Qb.apply(this.tc,a)}catch(c){b.Ff=!0,console.error("Exception caught during observer callback: "+(c.stack||c))}},pe:function(){this.Ra(void 0,!0);return this.D}};var I=!x,H;b.Bc=0;I&&(H=[]);var J=!1,N=x&&w&&function(){try{return eval("%RunMicrotasks()"),!0}catch(a){return!1}}();h.Aa=h.Aa||{};h.Aa.Qe=function(){if(!J)if(N)eval("%RunMicrotasks()");else if(I){J=
!0;var a=0,b,c;do{a++;c=H;H=[];b=!1;for(var e=0;e<c.length;e++){var f=c[e];f.ma==G&&(f.Ra()&&(b=!0),H.push(f))}d()&&(b=!0)}while(1E3>a&&b);B&&(h.oe=a);J=!1}};I&&(h.Aa.Xf=function(){H=[]});g.prototype=E({__proto__:b.prototype,Pc:!1,je:function(){if(x){var a=this.D,b=this.Pc,c=A.pop()||m();c.open(this);c.observe(a,b);this.Fa=c}else this.ba=this.Sa(this.D)},Sa:function(a){var b=Array.isArray(a)?[]:{},c;for(c in a)b[c]=a[c];Array.isArray(a)&&(b.length=a.length);return b},Ra:function(a){var b;if(x){if(!a)return!1;
b={};a=e(this.D,a,b)}else b=this.ba,a=q(this.D,this.ba);if(f(a.G)&&f(a.f)&&f(a.Sb))return!1;x||(this.ba=this.Sa(this.D));this.kd([a.G||{},a.f||{},a.Sb||{},function(a){return b[a]}]);return!0},qe:function(){x?(this.Fa.close(),this.Fa=void 0):this.ba=void 0},nb:function(){this.ma==G&&(x?this.Fa.nb(!1):k(this))},pe:function(){this.Fa?this.Fa.nb(!0):this.ba=this.Sa(this.D);return this.D}});a.prototype=E({__proto__:g.prototype,Pc:!0,Sa:function(a){return a.slice()},Ra:function(a){if(x){if(!a)return!1;
a=D(this.D,a)}else a=K.Pb(this.D,0,this.D.length,this.ba,0,this.ba.length);if(!a||!a.length)return!1;x||(this.ba=this.Sa(this.D));this.kd([a]);return!0}});a.Of=function(a,b,c){c.forEach(function(c){for(var d=[c.index,c.f.length],e=c.index;e<c.index+c.r;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})};var O={add:!0,update:!0,"delete":!0};p.prototype={he:function(a,b,c,d,e,f){f=f-e+1;c=c-b+1;for(var g=Array(f),h=0;h<f;h++)g[h]=Array(c),g[h][0]=h;for(var k=0;k<c;k++)g[0][k]=k;for(h=1;h<f;h++)for(k=
1;k<c;k++)if(this.Zb(a[b+k-1],d[e+h-1]))g[h][k]=g[h-1][k-1];else{var l=g[h-1][k]+1,m=g[h][k-1]+1;g[h][k]=l<m?l:m}return g},jf:function(a){for(var b=a.length-1,c=a[0].length-1,d=a[b][c],e=[];0<b||0<c;)if(0==b)e.push(2),c--;else if(0==c)e.push(3),b--;else{var f=a[b-1][c-1],g=a[b-1][c],h=a[b][c-1],k;k=g<h?g<f?g:f:h<f?h:f;k==f?(f==d?e.push(0):(e.push(1),d=f),b--,c--):k==g?(e.push(3),b--,d=g):(e.push(2),c--,d=h)}e.reverse();return e},Pb:function(a,b,d,e,f,g){var h=0,k=0,l=Math.min(d-b,g-f);0==b&&0==f&&
(h=this.ef(a,e,l));d==a.length&&g==e.length&&(k=this.ff(a,e,l-h));b+=h;f+=h;d-=k;g-=k;if(0==d-b&&0==g-f)return[];if(b==d){for(a=c(b,[],0);f<g;)a.f.push(e[f++]);return[a]}if(f==g)return[c(b,[],d-b)];g=this.jf(this.he(a,b,d,e,f,g));a=void 0;d=[];for(h=0;h<g.length;h++)switch(g[h]){case 0:a&&(d.push(a),a=void 0);b++;f++;break;case 1:a||(a=c(b,[],0));a.r++;b++;a.f.push(e[f]);f++;break;case 2:a||(a=c(b,[],0));a.r++;b++;break;case 3:a||(a=c(b,[],0)),a.f.push(e[f]),f++}a&&d.push(a);return d},ef:function(a,
b,c){for(var d=0;d<c;d++)if(!this.Zb(a[d],b[d]))return d;return c},ff:function(a,b,c){for(var d=a.length,e=b.length,f=0;f<c&&this.Zb(a[--d],b[--e]);)f++;return f},Rc:function(a,b){return this.Pb(a,0,a.length,b,0,b.length)},Zb:function(a,b){return a===b}};var K=new p,w=h;"undefined"!==typeof l&&("undefined"!==typeof v&&v.g&&(w=l=v.g),w=l);w.Bb=b;w.Bb.Ug=z;w.Bb.Mg={};w.Bb.pg=x;w.La=a;w.La.Rc=function(a,b){return K.Rc(a,b)};w.Aa=h.Aa;w.rf=p;w.zf=g})("undefined"!==typeof h&&h&&"undefined"!==typeof v&&
v?h:this||window)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[13]);

(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)})([function(module,exports,__webpack_require__){__webpack_require__(1);module.exports=__webpack_require__(3)},function(module,exports,__webpack_require__){(function(global,process){!function(global){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var undefined;var iteratorSymbol=typeof Symbol==="function"&&Symbol.iterator||"@@iterator";var inModule=typeof module==="object";var runtime=global.regeneratorRuntime;if(runtime){if(inModule){module.exports=runtime}return}runtime=global.regeneratorRuntime=inModule?module.exports:{};function wrap(innerFn,outerFn,self,tryLocsList){var generator=Object.create((outerFn||Generator).prototype);var context=new Context(tryLocsList||[]);generator._invoke=makeInvokeMethod(innerFn,self,context);return generator}runtime.wrap=wrap;function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}var GenStateSuspendedStart="suspendedStart";var GenStateSuspendedYield="suspendedYield";var GenStateExecuting="executing";var GenStateCompleted="completed";var ContinueSentinel={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype;GeneratorFunctionPrototype.constructor=GeneratorFunction;GeneratorFunction.displayName="GeneratorFunction";function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}runtime.isGeneratorFunction=function(genFun){var ctor=typeof genFun==="function"&&genFun.constructor;return ctor?ctor===GeneratorFunction||(ctor.displayName||ctor.name)==="GeneratorFunction":false};runtime.mark=function(genFun){if(Object.setPrototypeOf){Object.setPrototypeOf(genFun,GeneratorFunctionPrototype)}else{genFun.__proto__=GeneratorFunctionPrototype}genFun.prototype=Object.create(Gp);return genFun};runtime.awrap=function(arg){return new AwaitArgument(arg)};function AwaitArgument(arg){this.arg=arg}function AsyncIterator(generator){function invoke(method,arg){var result=generator[method](arg);var value=result.value;return value instanceof AwaitArgument?Promise.resolve(value.arg).then(invokeNext,invokeThrow):Promise.resolve(value).then(function(unwrapped){result.value=unwrapped;return result})}if(typeof process==="object"&&process.domain){invoke=process.domain.bind(invoke)}var invokeNext=invoke.bind(generator,"next");var invokeThrow=invoke.bind(generator,"throw");var invokeReturn=invoke.bind(generator,"return");var previousPromise;function enqueue(method,arg){function callInvokeWithMethodAndArg(){return invoke(method,arg)}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):new Promise(function(resolve){resolve(callInvokeWithMethodAndArg())})}this._invoke=enqueue}defineIteratorMethods(AsyncIterator.prototype);runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})};function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function invoke(method,arg){if(state===GenStateExecuting){throw new Error("Generator is already running")}if(state===GenStateCompleted){if(method==="throw"){throw arg}return doneResult()}while(true){var delegate=context.delegate;if(delegate){if(method==="return"||method==="throw"&&delegate.iterator[method]===undefined){context.delegate=null;var returnMethod=delegate.iterator["return"];if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if(record.type==="throw"){method="throw";arg=record.arg;continue}}if(method==="return"){continue}}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if(record.type==="throw"){context.delegate=null;method="throw";arg=record.arg;continue}method="next";arg=undefined;var info=record.arg;if(info.done){context[delegate.resultName]=info.value;context.next=delegate.nextLoc}else{state=GenStateSuspendedYield;return info}context.delegate=null}if(method==="next"){context._sent=arg;if(state===GenStateSuspendedYield){context.sent=arg}else{context.sent=undefined}}else if(method==="throw"){if(state===GenStateSuspendedStart){state=GenStateCompleted;throw arg}if(context.dispatchException(arg)){method="next";arg=undefined}}else if(method==="return"){context.abrupt("return",arg)}state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if(record.type==="normal"){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg===ContinueSentinel){if(context.delegate&&method==="next"){arg=undefined}}else{return info}}else if(record.type==="throw"){state=GenStateCompleted;method="throw";arg=record.arg}}}}defineIteratorMethods(Gp);Gp[iteratorSymbol]=function(){return this};Gp.toString=function(){return"[object Generator]"};function pushTryEntry(locs){var entry={tryLoc:locs[0]};if(1 in locs){entry.catchLoc=locs[1]}if(2 in locs){entry.finallyLoc=locs[2];entry.afterLoc=locs[3]}this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal";delete record.arg;entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}];tryLocsList.forEach(pushTryEntry,this);this.reset(true)}runtime.keys=function(object){var keys=[];for(var key in object){keys.push(key)}keys.reverse();return function next(){while(keys.length){var key=keys.pop();if(key in object){next.value=key;next.done=false;return next}}next.done=true;return next}};function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod){return iteratorMethod.call(iterable)}if(typeof iterable.next==="function"){return iterable}if(!isNaN(iterable.length)){var i=-1,next=function next(){while(++i<iterable.length){if(hasOwn.call(iterable,i)){next.value=iterable[i];next.done=false;return next}}next.value=undefined;next.done=true;return next};return next.next=next}}return{next:doneResult}}runtime.values=values;function doneResult(){return{value:undefined,done:true}}Context.prototype={constructor:Context,reset:function(skipTempReset){this.prev=0;this.next=0;this.sent=undefined;this.done=false;this.delegate=null;this.tryEntries.forEach(resetTryEntry);if(!skipTempReset){for(var name in this){if(name.charAt(0)==="t"&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))){this[name]=undefined}}}},stop:function(){this.done=true;var rootEntry=this.tryEntries[0];var rootRecord=rootEntry.completion;if(rootRecord.type==="throw"){throw rootRecord.arg}return this.rval},dispatchException:function(exception){if(this.done){throw exception}var context=this;function handle(loc,caught){record.type="throw";record.arg=exception;context.next=loc;return!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];var record=entry.completion;if(entry.tryLoc==="root"){return handle("end")}if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc");var hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}else if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else if(hasCatch){if(this.prev<entry.catchLoc){return handle(entry.catchLoc,true)}}else if(hasFinally){if(this.prev<entry.finallyLoc){return handle(entry.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}if(finallyEntry&&(type==="break"||type==="continue")&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc){finallyEntry=null}var record=finallyEntry?finallyEntry.completion:{};record.type=type;record.arg=arg;if(finallyEntry){this.next=finallyEntry.finallyLoc}else{this.complete(record)}return ContinueSentinel},complete:function(record,afterLoc){if(record.type==="throw"){throw record.arg}if(record.type==="break"||record.type==="continue"){this.next=record.arg}else if(record.type==="return"){this.rval=record.arg;this.next="end"}else if(record.type==="normal"&&afterLoc){this.next=afterLoc}},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc){this.complete(entry.completion,entry.afterLoc);resetTryEntry(entry);return ContinueSentinel}}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if(record.type==="throw"){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc};return ContinueSentinel}}}(typeof global==="object"?global:typeof window==="object"?window:typeof self==="object"?self:this)}).call(exports,function(){return this}(),__webpack_require__(2))},function(module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(4),CollectionRegistry=__webpack_require__(9).CollectionRegistry,Collection=__webpack_require__(10),cache=__webpack_require__(20),Model=__webpack_require__(15),error=__webpack_require__(8),events=__webpack_require__(23),RelationshipType=__webpack_require__(18),ReactiveQuery=__webpack_require__(31),ManyToManyProxy=__webpack_require__(36),OneToOneProxy=__webpack_require__(35),OneToManyProxy=__webpack_require__(33),RelationshipProxy=__webpack_require__(34),modelEvents=__webpack_require__(22),Query=__webpack_require__(19),querySet=__webpack_require__(26),log=__webpack_require__(11);util._patchBind();var siesta=function siesta(ext){if(!siesta.ext)siesta.ext={};util.extend(siesta.ext,ext||{});return siesta};util.extend(siesta,{on:events.on.bind(events),off:events.removeListener.bind(events),once:events.once.bind(events),removeAllListeners:events.removeAllListeners.bind(events)});util.extend(siesta,{removeListener:siesta.off,addListener:siesta.on});util.extend(siesta,{RelationshipType:RelationshipType,ModelEventType:modelEvents.ModelEventType,log:log.Level,InsertionPolicy:ReactiveQuery.InsertionPolicy,_internal:{log:log,Model:Model,error:error,ModelEventType:modelEvents.ModelEventType,ModelInstance:__webpack_require__(21),extend:__webpack_require__(28),MappingOperation:__webpack_require__(27),events:events,ProxyEventEmitter:events.ProxyEventEmitter,cache:__webpack_require__(20),modelEvents:modelEvents,CollectionRegistry:__webpack_require__(9).CollectionRegistry,Collection:Collection,utils:util,util:util,querySet:querySet,observe:__webpack_require__(5),Query:Query,ManyToManyProxy:ManyToManyProxy,OneToManyProxy:OneToManyProxy,OneToOneProxy:OneToOneProxy,RelationshipProxy:RelationshipProxy},isArray:util.isArray,isString:util.isString});siesta.ext={};var installed=false,installing=false;util.extend(siesta,{reset:function reset(cb){installed=false;installing=false;delete this.queuedTasks;cache.reset();CollectionRegistry.reset();events.removeAllListeners();cb()},collection:function collection(name,opts){var c=new Collection(name,opts);if(installed)c.installed=true;return c},install:function install(cb){if(!installing&&!installed){return util.promise(cb,function(cb){installing=true;var collectionNames=CollectionRegistry.collectionNames,tasks=collectionNames.map(function(n){var collection=CollectionRegistry[n];return collection.install.bind(collection)});tasks.push(function(done){installed=true;if(this.queuedTasks)this.queuedTasks.execute();done()}.bind(this));util.series(tasks,cb)}.bind(this))}else cb(error("already installing"))},_pushTask:function _pushTask(task){if(!this.queuedTasks){this.queuedTasks=new function Queue(){this.tasks=[];this.execute=function(){this.tasks.forEach(function(f){f()});this.tasks=[]}.bind(this)}}this.queuedTasks.tasks.push(task)},_afterInstall:function _afterInstall(task){if(!installed){if(!installing){this.install(function(err){if(err){console.error("Error setting up siesta",err)}delete this.queuedTasks}.bind(this))}if(!installed)this._pushTask(task);else task()}else{task()}},setLogLevel:function setLogLevel(loggerName,level){var Logger=log.loggerWithName(loggerName);Logger.setLevel(level)},graph:function graph(data,opts,cb){if(typeof opts=="function")cb=opts;opts=opts||{};return util.promise(cb,function(cb){var tasks=[],err;for(var collectionName in data){if(data.hasOwnProperty(collectionName)){var collection=CollectionRegistry[collectionName];if(collection){(function(collection,data){tasks.push(function(done){collection.graph(data,function(err,res){if(!err){var results={};results[collection.name]=res}done(err,results)})})})(collection,data[collectionName])}else{err='No such collection "'+collectionName+'"'}}}if(!err){util.series(tasks,function(err,results){if(!err){results=results.reduce(function(memo,res){return util.extend(memo,res)},{})}else results=null;cb(err,results)})}else cb(error(err,{data:data,invalidCollectionName:collectionName}))}.bind(this))},notify:util.next,registerComparator:Query.registerComparator.bind(Query),count:function count(){return cache.count()},get:function get(id,cb){return util.promise(cb,function(cb){this._afterInstall(function(){cb(null,cache._localCache()[id])})}.bind(this))},removeAll:function removeAll(cb){return util.promise(cb,function(cb){util.Promise.all(CollectionRegistry.collectionNames.map(function(collectionName){return CollectionRegistry[collectionName].removeAll()}.bind(this))).then(function(){cb(null)}).catch(cb)}.bind(this))}});Object.defineProperties(siesta,{_canChange:{get:function get(){return!(installing||installed)}},installed:{get:function get(){return installed}}});if(typeof window!="undefined"){window["siesta"]=siesta}siesta.log=__webpack_require__(12);module.exports=siesta;(function loadExtensions(){})()},function(module,exports,__webpack_require__){"use strict";var observe=__webpack_require__(5).Platform,argsarray=__webpack_require__(7),InternalSiestaError=__webpack_require__(8).InternalSiestaError;var extend=function extend(left,right){for(var prop in right){if(right.hasOwnProperty(prop)){left[prop]=right[prop]}}return left};var isArray=Array.isArray,isString=function isString(o){return typeof o=="string"||o instanceof String};extend(module.exports,{argsarray:argsarray,next:function next(callback){observe.performMicrotaskCheckpoint();setTimeout(callback)},extend:extend,guid:function(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return function(){return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}}(),assert:function assert(condition,message,context){if(!condition){message=message||"Assertion failed";context=context||{};throw new InternalSiestaError(message,context)}},pluck:function pluck(coll,key){return coll.map(function(o){return o[key]})},thenBy:function(){function extend(f){f.thenBy=tb;return f}function tb(y){var x=this;return extend(function(a,b){return x(a,b)||y(a,b)})}return extend}(),_patchBind:function _patchBind(){var _bind=Function.prototype.apply.bind(Function.prototype.bind);Object.defineProperty(Function.prototype,"bind",{value:function value(obj){var boundFunction=_bind(this,arguments);Object.defineProperty(boundFunction,"__siesta_bound_object",{value:obj,writable:true,configurable:true,enumerable:false});return boundFunction}})},Promise:Promise,promise:function promise(cb,fn){cb=cb||function(){};return new Promise(function(resolve,reject){var _cb=argsarray(function(args){var err=args[0],rest=args.slice(1);if(err){try{reject(err)}catch(e){console.error("Uncaught error during promise rejection",e)}}else{try{resolve(rest[0])}catch(e){try{reject(e)}catch(e){console.error("Uncaught error during promise rejection",e)}}}var bound=cb["__siesta_bound_object"]||cb;cb.apply(bound,args)});fn(_cb)})},defer:function defer(){var resolve,reject;var p=new Promise(function(_resolve,_reject){resolve=_resolve;reject=_reject});p.resolve=resolve;p.reject=reject;return p},subProperties:function subProperties(obj,subObj,properties){if(!isArray(properties)){properties=Array.prototype.slice.call(arguments,2)}for(var i=0;i<properties.length;i++){(function(property){var opts={set:false,name:property,property:property};if(!isString(property)){extend(opts,property)}var desc={get:function get(){return subObj[opts.property]},enumerable:true,configurable:true};if(opts.set){desc.set=function(v){subObj[opts.property]=v}}Object.defineProperty(obj,opts.name,desc)})(properties[i])}},capitaliseFirstLetter:function capitaliseFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1)},extendFromOpts:function extendFromOpts(obj,opts,defaults,errorOnUnknown){errorOnUnknown=errorOnUnknown==undefined?true:errorOnUnknown;if(errorOnUnknown){var defaultKeys=Object.keys(defaults),optsKeys=Object.keys(opts);var unknownKeys=optsKeys.filter(function(n){return defaultKeys.indexOf(n)==-1});if(unknownKeys.length)throw Error("Unknown options: "+unknownKeys.toString())}Object.keys(defaults).forEach(function(k){var d=defaults[k];if(typeof d=="function"){defaults[k]=d(opts[k]);delete opts[k]}});extend(defaults,opts);extend(obj,defaults)},isString:isString,isArray:isArray,prettyPrint:function prettyPrint(o){return JSON.stringify(o,null,4)},flattenArray:function flattenArray(arr){return arr.reduce(function(memo,e){if(isArray(e)){memo=memo.concat(e)}else{memo.push(e)}return memo},[])},unflattenArray:function unflattenArray(arr,modelArr){var n=0;var unflattened=[];for(var i=0;i<modelArr.length;i++){if(isArray(modelArr[i])){var newArr=[];unflattened[i]=newArr;for(var j=0;j<modelArr[i].length;j++){newArr.push(arr[n]);n++}}else{unflattened[i]=arr[n];n++}}return unflattened}});function compact(arr){arr=arr||[];return arr.filter(function(x){return x})}function parallel(tasks,cb){cb=cb||function(){};if(tasks&&tasks.length){var results=[],errors=[],numFinished=0;tasks.forEach(function(fn,idx){results[idx]=false;fn(function(err,res){numFinished++;if(err)errors[idx]=err;results[idx]=res;if(numFinished==tasks.length){cb(errors.length?compact(errors):null,compact(results),{results:results,errors:errors})}})})}else cb()}function series(tasks,cb){cb=cb||function(){};if(tasks&&tasks.length){var results,errors,idx;(function(){var executeTask=function executeTask(task){task(function(err,res){if(err)errors[idx]=err;results[idx]=res;if(!tasks.length){cb(errors.length?compact(errors):null,compact(results),{results:results,errors:errors})}else{idx++;nextTask()}})};var nextTask=function nextTask(){var nextTask=tasks.shift();executeTask(nextTask)};results=[];errors=[];idx=0;nextTask()})()}else cb()}extend(module.exports,{compact:compact,parallel:parallel,series:series});var FN_ARGS=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,FN_ARG_SPLIT=/,/,FN_ARG=/^\s*(_?)(.+?)\1\s*$/,STRIP_COMMENTS=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;extend(module.exports,{paramNames:function paramNames(fn){var params=[],fnText,argDecl;fnText=fn.toString().replace(STRIP_COMMENTS,"");argDecl=fnText.match(FN_ARGS);argDecl[1].split(FN_ARG_SPLIT).forEach(function(arg){arg.replace(FN_ARG,function(all,underscore,name){params.push(name)})});return params}})},function(module,exports,__webpack_require__){(function(global,module){"use strict";(function(global){"use strict";var testingExposeCycleCount=global.testingExposeCycleCount;function detectObjectObserve(){if(typeof Object.observe!=="function"||typeof Array.observe!=="function"){return false}var records=[];function callback(recs){records=recs}var test={};var arr=[];Object.observe(test,callback);Array.observe(arr,callback);test.id=1;test.id=2;delete test.id;arr.push(1,2);arr.length=0;Object.deliverChangeRecords(callback);if(records.length!==5)return false;if(records[0].type!="add"||records[1].type!="update"||records[2].type!="delete"||records[3].type!="splice"||records[4].type!="splice"){return false}Object.unobserve(test,callback);Array.unobserve(arr,callback);return true}var hasObserve=detectObjectObserve();function detectEval(){if(typeof chrome!=="undefined"&&chrome.app&&chrome.app.runtime){return false}if(navigator.getDeviceStorage){return false}try{var f=new Function("","return true;");return f()}catch(ex){return false}}var hasEval=detectEval();function isIndex(s){return+s===s>>>0&&s!==""}function toNumber(s){return+s}function isObject(obj){return obj===Object(obj)}var numberIsNaN=global.Number.isNaN||function(value){return typeof value==="number"&&global.isNaN(value)};function areSameValue(left,right){if(left===right)return left!==0||1/left===1/right;if(numberIsNaN(left)&&numberIsNaN(right))return true;return left!==left&&right!==right}var createObject="__proto__"in{}?function(obj){return obj}:function(obj){var proto=obj.__proto__;if(!proto)return obj;var newObject=Object.create(proto);Object.getOwnPropertyNames(obj).forEach(function(name){Object.defineProperty(newObject,name,Object.getOwnPropertyDescriptor(obj,name))});return newObject};var identStart="[$_a-zA-Z]";var identPart="[$_a-zA-Z0-9]";var identRegExp=new RegExp("^"+identStart+"+"+identPart+"*"+"$");function getPathCharType(char){if(char===undefined)return"eof";var code=char.charCodeAt(0);switch(code){case 91:case 93:case 46:case 34:case 39:case 48:return char;case 95:case 36:return"ident";case 32:case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}if(97<=code&&code<=122||65<=code&&code<=90)return"ident";if(49<=code&&code<=57)return"number";return"else"}var pathStateMachine={beforePath:{ws:["beforePath"],ident:["inIdent","append"],"[":["beforeElement"],eof:["afterPath"]},inPath:{ws:["inPath"],".":["beforeIdent"],"[":["beforeElement"],eof:["afterPath"]},beforeIdent:{ws:["beforeIdent"],ident:["inIdent","append"]},inIdent:{ident:["inIdent","append"],0:["inIdent","append"],number:["inIdent","append"],ws:["inPath","push"],".":["beforeIdent","push"],"[":["beforeElement","push"],eof:["afterPath","push"]},beforeElement:{ws:["beforeElement"],0:["afterZero","append"],number:["inIndex","append"],"'":["inSingleQuote","append",""],'"':["inDoubleQuote","append",""]},afterZero:{ws:["afterElement","push"],"]":["inPath","push"]},inIndex:{0:["inIndex","append"],number:["inIndex","append"],ws:["afterElement"],"]":["inPath","push"]},inSingleQuote:{"'":["afterElement"],eof:["error"],"else":["inSingleQuote","append"]},inDoubleQuote:{'"':["afterElement"],eof:["error"],"else":["inDoubleQuote","append"]},afterElement:{ws:["afterElement"],"]":["inPath","push"]}};function noop(){}function parsePath(path){var keys=[];var index=-1;var c,newChar,key,type,transition,action,typeMap,mode="beforePath";var actions={push:function push(){if(key===undefined)return;keys.push(key);key=undefined},append:function append(){if(key===undefined)key=newChar;else key+=newChar}};function maybeUnescapeQuote(){if(index>=path.length)return;var nextChar=path[index+1];if(mode=="inSingleQuote"&&nextChar=="'"||mode=="inDoubleQuote"&&nextChar=='"'){index++;newChar=nextChar;actions.append();return true}}while(mode){index++;c=path[index];if(c=="\\"&&maybeUnescapeQuote(mode))continue;type=getPathCharType(c);typeMap=pathStateMachine[mode];transition=typeMap[type]||typeMap["else"]||"error";if(transition=="error")return;mode=transition[0];action=actions[transition[1]]||noop;newChar=transition[2]===undefined?c:transition[2];action();if(mode==="afterPath"){return keys}}return}function isIdent(s){return identRegExp.test(s)}var constructorIsPrivate={};function Path(parts,privateToken){if(privateToken!==constructorIsPrivate)throw Error("Use Path.get to retrieve path objects");for(var i=0;i<parts.length;i++){this.push(String(parts[i]))}if(hasEval&&this.length){this.getValueFrom=this.compiledGetValueFromFn()}}var pathCache={};function getPath(pathString){if(pathString instanceof Path)return pathString;if(pathString==null||pathString.length==0)pathString="";if(typeof pathString!="string"){if(isIndex(pathString.length)){return new Path(pathString,constructorIsPrivate)}pathString=String(pathString)}var path=pathCache[pathString];if(path)return path;var parts=parsePath(pathString);if(!parts)return invalidPath;var path=new Path(parts,constructorIsPrivate);pathCache[pathString]=path;return path}Path.get=getPath;function formatAccessor(key){if(isIndex(key)){return"["+key+"]"}else{return'["'+key.replace(/"/g,'\\"')+'"]'}}Path.prototype=createObject({__proto__:[],valid:true,toString:function toString(){var pathString="";for(var i=0;i<this.length;i++){var key=this[i];if(isIdent(key)){pathString+=i?"."+key:key}else{pathString+=formatAccessor(key)}}return pathString},getValueFrom:function getValueFrom(obj,directObserver){for(var i=0;i<this.length;i++){if(obj==null)return;obj=obj[this[i]]}return obj},iterateObjects:function iterateObjects(obj,observe){for(var i=0;i<this.length;i++){if(i)obj=obj[this[i-1]];if(!isObject(obj))return;observe(obj,this[0])}},compiledGetValueFromFn:function compiledGetValueFromFn(){var str="";var pathString="obj";str+="if (obj != null";var i=0;var key;for(;i<this.length-1;i++){key=this[i];pathString+=isIdent(key)?"."+key:formatAccessor(key);str+=" &&\n     "+pathString+" != null"}str+=")\n";var key=this[i];pathString+=isIdent(key)?"."+key:formatAccessor(key);str+="  return "+pathString+";\nelse\n  return undefined;";return new Function("obj",str)},setValueFrom:function setValueFrom(obj,value){if(!this.length)return false;for(var i=0;i<this.length-1;i++){if(!isObject(obj))return false;obj=obj[this[i]]}if(!isObject(obj))return false;obj[this[i]]=value;return true}});var invalidPath=new Path("",constructorIsPrivate);invalidPath.valid=false;invalidPath.getValueFrom=invalidPath.setValueFrom=function(){};var MAX_DIRTY_CHECK_CYCLES=1e3;function dirtyCheck(observer){var cycles=0;while(cycles<MAX_DIRTY_CHECK_CYCLES&&observer.check_()){cycles++}if(testingExposeCycleCount)global.dirtyCheckCycleCount=cycles;return cycles>0}function objectIsEmpty(object){for(var prop in object){return false}return true}function diffIsEmpty(diff){return objectIsEmpty(diff.added)&&objectIsEmpty(diff.removed)&&objectIsEmpty(diff.changed)}function diffObjectFromOldObject(object,oldObject){var added={};var removed={};var changed={};for(var prop in oldObject){var newValue=object[prop];if(newValue!==undefined&&newValue===oldObject[prop])continue;if(!(prop in object)){removed[prop]=undefined;continue}if(newValue!==oldObject[prop])changed[prop]=newValue}for(var prop in object){if(prop in oldObject)continue;added[prop]=object[prop]}if(Array.isArray(object)&&object.length!==oldObject.length)changed.length=object.length;return{added:added,removed:removed,changed:changed}}var eomTasks=[];function runEOMTasks(){if(!eomTasks.length)return false;for(var i=0;i<eomTasks.length;i++){eomTasks[i]()}eomTasks.length=0;return true}var runEOM=hasObserve?function(){var eomObj={pingPong:true};var eomRunScheduled=false;Object.observe(eomObj,function(){runEOMTasks();eomRunScheduled=false});return function(fn){eomTasks.push(fn);if(!eomRunScheduled){eomRunScheduled=true;eomObj.pingPong=!eomObj.pingPong}}}():function(){return function(fn){eomTasks.push(fn)}}();var observedObjectCache=[];function newObservedObject(){var observer;var object;var discardRecords=false;var first=true;function callback(records){if(observer&&observer.state_===OPENED&&!discardRecords)observer.check_(records)}return{open:function open(obs){if(observer)throw Error("ObservedObject in use");if(!first)Object.deliverChangeRecords(callback);observer=obs;first=false},observe:function observe(obj,arrayObserve){object=obj;if(arrayObserve)Array.observe(object,callback);else Object.observe(object,callback)},deliver:function deliver(discard){discardRecords=discard;Object.deliverChangeRecords(callback);discardRecords=false},close:function close(){observer=undefined;Object.unobserve(object,callback);observedObjectCache.push(this)}}}function getObservedObject(observer,object,arrayObserve){var dir=observedObjectCache.pop()||newObservedObject();dir.open(observer);dir.observe(object,arrayObserve);return dir}var observedSetCache=[];function newObservedSet(){var observerCount=0;var observers=[];var objects=[];var rootObj;var rootObjProps;function observe(obj,prop){if(!obj)return;if(obj===rootObj)rootObjProps[prop]=true;if(objects.indexOf(obj)<0){objects.push(obj);Object.observe(obj,callback)}observe(Object.getPrototypeOf(obj),prop)}function allRootObjNonObservedProps(recs){for(var i=0;i<recs.length;i++){var rec=recs[i];if(rec.object!==rootObj||rootObjProps[rec.name]||rec.type==="setPrototype"){return false}}return true}function callback(recs){if(allRootObjNonObservedProps(recs))return;var observer;for(var i=0;i<observers.length;i++){observer=observers[i];if(observer.state_==OPENED){observer.iterateObjects_(observe)}}for(var i=0;i<observers.length;i++){observer=observers[i];if(observer.state_==OPENED){observer.check_()}}}var record={object:undefined,objects:objects,open:function open(obs,object){if(!rootObj){rootObj=object;rootObjProps={}}observers.push(obs);observerCount++;obs.iterateObjects_(observe)},close:function close(obs){observerCount--;if(observerCount>0){return}for(var i=0;i<objects.length;i++){Object.unobserve(objects[i],callback);Observer.unobservedCount++}observers.length=0;objects.length=0;rootObj=undefined;rootObjProps=undefined;observedSetCache.push(this)}};return record}var lastObservedSet;function getObservedSet(observer,obj){if(!lastObservedSet||lastObservedSet.object!==obj){lastObservedSet=observedSetCache.pop()||newObservedSet();lastObservedSet.object=obj}lastObservedSet.open(observer,obj);return lastObservedSet}var UNOPENED=0;var OPENED=1;var CLOSED=2;var RESETTING=3;var nextObserverId=1;function Observer(){this.state_=UNOPENED;this.callback_=undefined;this.target_=undefined;this.directObserver_=undefined;this.value_=undefined;this.id_=nextObserverId++}Observer.prototype={open:function open(callback,target){
if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");addToAll(this);this.callback_=callback;this.target_=target;this.connect_();this.state_=OPENED;return this.value_},close:function close(){if(this.state_!=OPENED)return;removeFromAll(this);this.disconnect_();this.value_=undefined;this.callback_=undefined;this.target_=undefined;this.state_=CLOSED},deliver:function deliver(){if(this.state_!=OPENED)return;dirtyCheck(this)},report_:function report_(changes){try{this.callback_.apply(this.target_,changes)}catch(ex){Observer._errorThrownDuringCallback=true;console.error("Exception caught during observer callback: "+(ex.stack||ex))}},discardChanges:function discardChanges(){this.check_(undefined,true);return this.value_}};var collectObservers=!hasObserve;var allObservers;Observer._allObserversCount=0;if(collectObservers){allObservers=[]}function addToAll(observer){Observer._allObserversCount++;if(!collectObservers)return;allObservers.push(observer)}function removeFromAll(observer){Observer._allObserversCount--}var runningMicrotaskCheckpoint=false;var hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{eval("%RunMicrotasks()");return true}catch(ex){return false}}();global.Platform=global.Platform||{};global.Platform.performMicrotaskCheckpoint=function(){if(runningMicrotaskCheckpoint)return;if(hasDebugForceFullDelivery){eval("%RunMicrotasks()");return}if(!collectObservers)return;runningMicrotaskCheckpoint=true;var cycles=0;var anyChanged,toCheck;do{cycles++;toCheck=allObservers;allObservers=[];anyChanged=false;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];if(observer.state_!=OPENED)continue;if(observer.check_())anyChanged=true;allObservers.push(observer)}if(runEOMTasks())anyChanged=true}while(cycles<MAX_DIRTY_CHECK_CYCLES&&anyChanged);if(testingExposeCycleCount)global.dirtyCheckCycleCount=cycles;runningMicrotaskCheckpoint=false};if(collectObservers){global.Platform.clearObservers=function(){allObservers=[]}}function ObjectObserver(object){Observer.call(this);this.value_=object;this.oldObject_=undefined}ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:false,connect_:function connect_(callback,target){if(hasObserve){this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve)}else{this.oldObject_=this.copyObject(this.value_)}},copyObject:function copyObject(object){var copy=Array.isArray(object)?[]:{};for(var prop in object){copy[prop]=object[prop]}if(Array.isArray(object))copy.length=object.length;return copy},check_:function check_(changeRecords,skipChanges){var diff;var oldValues;if(hasObserve){if(!changeRecords)return false;oldValues={};diff=diffObjectFromChangeRecords(this.value_,changeRecords,oldValues)}else{oldValues=this.oldObject_;diff=diffObjectFromOldObject(this.value_,this.oldObject_)}if(diffIsEmpty(diff))return false;if(!hasObserve)this.oldObject_=this.copyObject(this.value_);this.report_([diff.added||{},diff.removed||{},diff.changed||{},function(property){return oldValues[property]}]);return true},disconnect_:function disconnect_(){if(hasObserve){this.directObserver_.close();this.directObserver_=undefined}else{this.oldObject_=undefined}},deliver:function deliver(){if(this.state_!=OPENED)return;if(hasObserve)this.directObserver_.deliver(false);else dirtyCheck(this)},discardChanges:function discardChanges(){if(this.directObserver_)this.directObserver_.deliver(true);else this.oldObject_=this.copyObject(this.value_);return this.value_}});function ArrayObserver(array){if(!Array.isArray(array))throw Error("Provided object is not an Array");ObjectObserver.call(this,array)}ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:true,copyObject:function copyObject(arr){return arr.slice()},check_:function check_(changeRecords){var splices;if(hasObserve){if(!changeRecords)return false;splices=projectArraySplices(this.value_,changeRecords)}else{splices=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length)}if(!splices||!splices.length)return false;if(!hasObserve)this.oldObject_=this.copyObject(this.value_);this.report_([splices]);return true}});ArrayObserver.applySplices=function(previous,current,splices){splices.forEach(function(splice){var spliceArgs=[splice.index,splice.removed.length];var addIndex=splice.index;while(addIndex<splice.index+splice.addedCount){spliceArgs.push(current[addIndex]);addIndex++}Array.prototype.splice.apply(previous,spliceArgs)})};function PathObserver(object,path){Observer.call(this);this.object_=object;this.path_=getPath(path);this.directObserver_=undefined}PathObserver.prototype=createObject({__proto__:Observer.prototype,get path(){return this.path_},connect_:function connect_(){if(hasObserve)this.directObserver_=getObservedSet(this,this.object_);this.check_(undefined,true)},disconnect_:function disconnect_(){this.value_=undefined;if(this.directObserver_){this.directObserver_.close(this);this.directObserver_=undefined}},iterateObjects_:function iterateObjects_(observe){this.path_.iterateObjects(this.object_,observe)},check_:function check_(changeRecords,skipChanges){var oldValue=this.value_;this.value_=this.path_.getValueFrom(this.object_);if(skipChanges||areSameValue(this.value_,oldValue))return false;this.report_([this.value_,oldValue,this]);return true},setValue:function setValue(newValue){if(this.path_)this.path_.setValueFrom(this.object_,newValue)}});function CompoundObserver(reportChangesOnOpen){Observer.call(this);this.reportChangesOnOpen_=reportChangesOnOpen;this.value_=[];this.directObserver_=undefined;this.observed_=[]}var observerSentinel={};CompoundObserver.prototype=createObject({__proto__:Observer.prototype,connect_:function connect_(){if(hasObserve){var object;var needsDirectObserver=false;for(var i=0;i<this.observed_.length;i+=2){object=this.observed_[i];if(object!==observerSentinel){needsDirectObserver=true;break}}if(needsDirectObserver)this.directObserver_=getObservedSet(this,object)}this.check_(undefined,!this.reportChangesOnOpen_)},disconnect_:function disconnect_(){for(var i=0;i<this.observed_.length;i+=2){if(this.observed_[i]===observerSentinel)this.observed_[i+1].close()}this.observed_.length=0;this.value_.length=0;if(this.directObserver_){this.directObserver_.close(this);this.directObserver_=undefined}},addPath:function addPath(object,path){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add paths once started.");var path=getPath(path);this.observed_.push(object,path);if(!this.reportChangesOnOpen_)return;var index=this.observed_.length/2-1;this.value_[index]=path.getValueFrom(object)},addObserver:function addObserver(observer){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add observers once started.");this.observed_.push(observerSentinel,observer);if(!this.reportChangesOnOpen_)return;var index=this.observed_.length/2-1;this.value_[index]=observer.open(this.deliver,this)},startReset:function startReset(){if(this.state_!=OPENED)throw Error("Can only reset while open");this.state_=RESETTING;this.disconnect_()},finishReset:function finishReset(){if(this.state_!=RESETTING)throw Error("Can only finishReset after startReset");this.state_=OPENED;this.connect_();return this.value_},iterateObjects_:function iterateObjects_(observe){var object;for(var i=0;i<this.observed_.length;i+=2){object=this.observed_[i];if(object!==observerSentinel)this.observed_[i+1].iterateObjects(object,observe)}},check_:function check_(changeRecords,skipChanges){var oldValues;for(var i=0;i<this.observed_.length;i+=2){var object=this.observed_[i];var path=this.observed_[i+1];var value;if(object===observerSentinel){var observable=path;value=this.state_===UNOPENED?observable.open(this.deliver,this):observable.discardChanges()}else{value=path.getValueFrom(object)}if(skipChanges){this.value_[i/2]=value;continue}if(areSameValue(value,this.value_[i/2]))continue;oldValues=oldValues||[];oldValues[i/2]=this.value_[i/2];this.value_[i/2]=value}if(!oldValues)return false;this.report_([this.value_,oldValues,this.observed_]);return true}});function identFn(value){return value}function ObserverTransform(observable,getValueFn,setValueFn,dontPassThroughSet){this.callback_=undefined;this.target_=undefined;this.value_=undefined;this.observable_=observable;this.getValueFn_=getValueFn||identFn;this.setValueFn_=setValueFn||identFn;this.dontPassThroughSet_=dontPassThroughSet}ObserverTransform.prototype={open:function open(callback,target){this.callback_=callback;this.target_=target;this.value_=this.getValueFn_(this.observable_.open(this.observedCallback_,this));return this.value_},observedCallback_:function observedCallback_(value){value=this.getValueFn_(value);if(areSameValue(value,this.value_))return;var oldValue=this.value_;this.value_=value;this.callback_.call(this.target_,this.value_,oldValue)},discardChanges:function discardChanges(){this.value_=this.getValueFn_(this.observable_.discardChanges());return this.value_},deliver:function deliver(){return this.observable_.deliver()},setValue:function setValue(value){value=this.setValueFn_(value);if(!this.dontPassThroughSet_&&this.observable_.setValue)return this.observable_.setValue(value)},close:function close(){if(this.observable_)this.observable_.close();this.callback_=undefined;this.target_=undefined;this.observable_=undefined;this.value_=undefined;this.getValueFn_=undefined;this.setValueFn_=undefined}};var expectedRecordTypes={add:true,update:true,"delete":true};function diffObjectFromChangeRecords(object,changeRecords,oldValues){var added={};var removed={};for(var i=0;i<changeRecords.length;i++){var record=changeRecords[i];if(!expectedRecordTypes[record.type]){console.error("Unknown changeRecord type: "+record.type);console.error(record);continue}if(!(record.name in oldValues))oldValues[record.name]=record.oldValue;if(record.type=="update")continue;if(record.type=="add"){if(record.name in removed)delete removed[record.name];else added[record.name]=true;continue}if(record.name in added){delete added[record.name];delete oldValues[record.name]}else{removed[record.name]=true}}for(var prop in added){added[prop]=object[prop]}for(var prop in removed){removed[prop]=undefined}var changed={};for(var prop in oldValues){if(prop in added||prop in removed)continue;var newValue=object[prop];if(oldValues[prop]!==newValue)changed[prop]=newValue}return{added:added,removed:removed,changed:changed}}function newSplice(index,removed,addedCount){return{index:index,removed:removed,addedCount:addedCount}}var EDIT_LEAVE=0;var EDIT_UPDATE=1;var EDIT_ADD=2;var EDIT_DELETE=3;function ArraySplice(){}ArraySplice.prototype={calcEditDistances:function calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd){var rowCount=oldEnd-oldStart+1;var columnCount=currentEnd-currentStart+1;var distances=new Array(rowCount);for(var i=0;i<rowCount;i++){distances[i]=new Array(columnCount);distances[i][0]=i}for(var j=0;j<columnCount;j++){distances[0][j]=j}for(var i=1;i<rowCount;i++){for(var j=1;j<columnCount;j++){if(this.equals(current[currentStart+j-1],old[oldStart+i-1]))distances[i][j]=distances[i-1][j-1];else{var north=distances[i-1][j]+1;var west=distances[i][j-1]+1;distances[i][j]=north<west?north:west}}}return distances},spliceOperationsFromEditDistances:function spliceOperationsFromEditDistances(distances){var i=distances.length-1;var j=distances[0].length-1;var current=distances[i][j];var edits=[];while(i>0||j>0){if(i==0){edits.push(EDIT_ADD);j--;continue}if(j==0){edits.push(EDIT_DELETE);i--;continue}var northWest=distances[i-1][j-1];var west=distances[i-1][j];var north=distances[i][j-1];var min;if(west<north)min=west<northWest?west:northWest;else min=north<northWest?north:northWest;if(min==northWest){if(northWest==current){edits.push(EDIT_LEAVE)}else{edits.push(EDIT_UPDATE);current=northWest}i--;j--}else if(min==west){edits.push(EDIT_DELETE);i--;current=west}else{edits.push(EDIT_ADD);j--;current=north}}edits.reverse();return edits},calcSplices:function calcSplices(current,currentStart,currentEnd,old,oldStart,oldEnd){var prefixCount=0;var suffixCount=0;var minLength=Math.min(currentEnd-currentStart,oldEnd-oldStart);if(currentStart==0&&oldStart==0)prefixCount=this.sharedPrefix(current,old,minLength);if(currentEnd==current.length&&oldEnd==old.length)suffixCount=this.sharedSuffix(current,old,minLength-prefixCount);currentStart+=prefixCount;oldStart+=prefixCount;currentEnd-=suffixCount;oldEnd-=suffixCount;if(currentEnd-currentStart==0&&oldEnd-oldStart==0)return[];if(currentStart==currentEnd){var splice=newSplice(currentStart,[],0);while(oldStart<oldEnd){splice.removed.push(old[oldStart++])}return[splice]}else if(oldStart==oldEnd)return[newSplice(currentStart,[],currentEnd-currentStart)];var ops=this.spliceOperationsFromEditDistances(this.calcEditDistances(current,currentStart,currentEnd,old,oldStart,oldEnd));var splice=undefined;var splices=[];var index=currentStart;var oldIndex=oldStart;for(var i=0;i<ops.length;i++){switch(ops[i]){case EDIT_LEAVE:if(splice){splices.push(splice);splice=undefined}index++;oldIndex++;break;case EDIT_UPDATE:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;splice.removed.push(old[oldIndex]);oldIndex++;break;case EDIT_ADD:if(!splice)splice=newSplice(index,[],0);splice.addedCount++;index++;break;case EDIT_DELETE:if(!splice)splice=newSplice(index,[],0);splice.removed.push(old[oldIndex]);oldIndex++;break}}if(splice){splices.push(splice)}return splices},sharedPrefix:function sharedPrefix(current,old,searchLength){for(var i=0;i<searchLength;i++){if(!this.equals(current[i],old[i]))return i}return searchLength},sharedSuffix:function sharedSuffix(current,old,searchLength){var index1=current.length;var index2=old.length;var count=0;while(count<searchLength&&this.equals(current[--index1],old[--index2])){count++}return count},calculateSplices:function calculateSplices(current,previous){return this.calcSplices(current,0,current.length,previous,0,previous.length)},equals:function equals(currentValue,previousValue){return currentValue===previousValue}};var arraySplice=new ArraySplice;function calcSplices(current,currentStart,currentEnd,old,oldStart,oldEnd){return arraySplice.calcSplices(current,currentStart,currentEnd,old,oldStart,oldEnd)}function intersect(start1,end1,start2,end2){if(end1<start2||end2<start1)return-1;if(end1==start2||end2==start1)return 0;if(start1<start2){if(end1<end2)return end1-start2;else return end2-start2}else{if(end2<end1)return end2-start1;else return end1-start1}}function mergeSplice(splices,index,removed,addedCount){var splice=newSplice(index,removed,addedCount);var inserted=false;var insertionOffset=0;for(var i=0;i<splices.length;i++){var current=splices[i];current.index+=insertionOffset;if(inserted)continue;var intersectCount=intersect(splice.index,splice.index+splice.removed.length,current.index,current.index+current.addedCount);if(intersectCount>=0){splices.splice(i,1);i--;insertionOffset-=current.addedCount-current.removed.length;splice.addedCount+=current.addedCount-intersectCount;var deleteCount=splice.removed.length+current.removed.length-intersectCount;if(!splice.addedCount&&!deleteCount){inserted=true}else{var removed=current.removed;if(splice.index<current.index){var prepend=splice.removed.slice(0,current.index-splice.index);Array.prototype.push.apply(prepend,removed);removed=prepend}if(splice.index+splice.removed.length>current.index+current.addedCount){var append=splice.removed.slice(current.index+current.addedCount-splice.index);Array.prototype.push.apply(removed,append)}splice.removed=removed;if(current.index<splice.index){splice.index=current.index}}}else if(splice.index<current.index){inserted=true;splices.splice(i,0,splice);i++;var offset=splice.addedCount-splice.removed.length;current.index+=offset;insertionOffset+=offset}}if(!inserted)splices.push(splice)}function createInitialSplices(array,changeRecords){var splices=[];for(var i=0;i<changeRecords.length;i++){var record=changeRecords[i];switch(record.type){case"splice":mergeSplice(splices,record.index,record.removed.slice(),record.addedCount);break;case"add":case"update":case"delete":if(!isIndex(record.name))continue;var index=toNumber(record.name);if(index<0)continue;mergeSplice(splices,index,[record.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(record));break}}return splices}function projectArraySplices(array,changeRecords){var splices=[];createInitialSplices(array,changeRecords).forEach(function(splice){if(splice.addedCount==1&&splice.removed.length==1){if(splice.removed[0]!==array[splice.index])splices.push(splice);return}splices=splices.concat(calcSplices(array,splice.index,splice.index+splice.addedCount,splice.removed,0,splice.removed.length))});return splices}var expose=global;if(true){if(typeof module!=="undefined"&&module.exports){expose=exports=module.exports}expose=exports}expose.Observer=Observer;expose.Observer.runEOM_=runEOM;expose.Observer.observerSentinel_=observerSentinel;expose.Observer.hasObjectObserve=hasObserve;expose.ArrayObserver=ArrayObserver;expose.ArrayObserver.calculateSplices=function(current,previous){return arraySplice.calculateSplices(current,previous)};expose.Platform=global.Platform;expose.ArraySplice=ArraySplice;expose.ObjectObserver=ObjectObserver;expose.PathObserver=PathObserver;expose.CompoundObserver=CompoundObserver;expose.Path=Path;expose.ObserverTransform=ObserverTransform})(typeof global!=="undefined"&&global&&typeof module!=="undefined"&&module?global:undefined||window)}).call(exports,function(){return this}(),__webpack_require__(6)(module))},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1}return module}},function(module,exports){"use strict";module.exports=argsArray;function argsArray(fun){return function(){var len=arguments.length;if(len){var args=[];var i=-1;while(++i<len){args[i]=arguments[i]}return fun.call(this,args)}else{return fun.call(this,[])}}}},function(module,exports){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};function InternalSiestaError(message,context,ssf){this.message=message;this.context=context;if(ssf&&Error.captureStackTrace){Error.captureStackTrace(this,ssf)}}InternalSiestaError.prototype=Object.create(Error.prototype);InternalSiestaError.prototype.name="InternalSiestaError";InternalSiestaError.prototype.constructor=InternalSiestaError;function isSiestaError(err){if((typeof err==="undefined"?"undefined":_typeof(err))=="object"){return"error"in err&&"ok"in err&&"reason"in err}return false}module.exports=function(errMessage,extra){if(isSiestaError(errMessage)){return errMessage}var err={reason:errMessage,error:true,ok:false};for(var prop in extra||{}){if(extra.hasOwnProperty(prop))err[prop]=extra[prop]}err.toString=function(){return JSON.stringify(this)};return err};module.exports.InternalSiestaError=InternalSiestaError},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(4);function CollectionRegistry(){if(!this)return new CollectionRegistry;this.collectionNames=[]}util.extend(CollectionRegistry.prototype,{register:function register(collection){var name=collection.name;this[name]=collection;this.collectionNames.push(name)},reset:function reset(){var self=this;this.collectionNames.forEach(function(name){delete self[name]});this.collectionNames=[]}});exports.CollectionRegistry=new CollectionRegistry},function(module,exports,__webpack_require__){"use strict";var log=__webpack_require__(11)("collection"),CollectionRegistry=__webpack_require__(9).CollectionRegistry,InternalSiestaError=__webpack_require__(8).InternalSiestaError,Model=__webpack_require__(15),extend=__webpack_require__(28),observe=__webpack_require__(5).Platform,events=__webpack_require__(23),util=__webpack_require__(4),error=__webpack_require__(8),argsarray=__webpack_require__(7),cache=__webpack_require__(20);function Collection(name,opts){var self=this;if(!name)throw new Error("Collection must have a name");opts=opts||{};util.extendFromOpts(this,opts,{});util.extend(this,{name:name,_rawModels:{},_models:{},_opts:opts,installed:false});CollectionRegistry.register(this);this._makeAvailableOnRoot();events.ProxyEventEmitter.call(this,this.name)}Collection.prototype=Object.create(events.ProxyEventEmitter.prototype);util.extend(Collection.prototype,{_getModelsToInstall:function _getModelsToInstall(){var modelsToInstall=[];for(var name in this._models){if(this._models.hasOwnProperty(name)){var model=this._models[name];modelsToInstall.push(model)}}log("There are "+modelsToInstall.length.toString()+" mappings to install");return modelsToInstall},_makeAvailableOnRoot:function _makeAvailableOnRoot(){siesta[this.name]=this},install:function install(cb){var modelsToInstall=this._getModelsToInstall();return util.promise(cb,function(cb){if(!this.installed){this.installed=true;var errors=[];modelsToInstall.forEach(function(m){log('Installing relationships for mapping with name "'+m.name+'"');var err=m.installRelationships();if(err)errors.push(err)});if(!errors.length){modelsToInstall.forEach(function(m){log('Installing reverse relationships for mapping with name "'+m.name+'"');var err=m.installReverseRelationships();if(err)errors.push(err)});if(!errors.length){this.installed=true;this._makeAvailableOnRoot()}}cb(errors.length?error("Errors were encountered whilst setting up the collection",{errors:errors}):null)}else{throw new InternalSiestaError('Collection "'+this.name+'" has already been installed')}}.bind(this))},_model:function _model(name,opts){if(name){this._rawModels[name]=opts;opts=extend(true,{},opts);opts.name=name;opts.collection=this;var model=new Model(opts);this._models[name]=model;this[name]=model;if(this.installed){var error=model.installRelationships();if(!error)error=model.installReverseRelationships();if(error)throw error}return model}else{throw new Error("No name specified when creating mapping")}},model:argsarray(function(args){if(args.length){if(args.length==1){if(util.isArray(args[0])){return args[0].map(function(m){return this._model(m.name,m)}.bind(this))}else{var name,opts;if(util.isString(args[0])){name=args[0];opts={}}else{opts=args[0];name=opts.name}return this._model(name,opts)}}else{if(typeof args[0]=="string"){return this._model(args[0],args[1])}else{return args.map(function(m){return this._model(m.name,m)}.bind(this))}}}return null}),_dump:function _dump(asJson){var obj={};obj.installed=this.installed;obj.docId=this._docId;obj.name=this.name;return asJson?util.prettyPrint(obj):obj},count:function count(cb){return util.promise(cb,function(cb){var tasks=Object.keys(this._models).map(function(modelName){var m=this._models[modelName];return m.count.bind(m)}.bind(this));util.parallel(tasks,function(err,ns){var n;if(!err){n=ns.reduce(function(m,r){return m+r},0)}cb(err,n)})}.bind(this))},graph:function graph(data,opts,cb){if(typeof opts=="function")cb=opts;opts=opts||{};return util.promise(cb,function(cb){var tasks=[],err;for(var modelName in data){if(data.hasOwnProperty(modelName)){var model=this._models[modelName];if(model){(function(model,data){tasks.push(function(done){model.graph(data,function(err,models){if(!err){var results={};results[model.name]=models}done(err,results)})})})(model,data[modelName])}else{err='No such model "'+modelName+'"'}}}if(!err){util.series(tasks,function(err,results){if(!err){results=results.reduce(function(memo,res){return util.extend(memo,res||{})},{})}else results=null;cb(err,results)})}else cb(error(err,{data:data,invalidModelName:modelName}))}.bind(this))},removeAll:function removeAll(cb){return util.promise(cb,function(cb){util.Promise.all(Object.keys(this._models).map(function(modelName){var model=this._models[modelName];return model.removeAll()}.bind(this))).then(function(){cb(null)}).catch(cb)}.bind(this))}});module.exports=Collection},function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(12),argsarray=__webpack_require__(7);module.exports=function(name){var log=debug("siesta:"+name);var fn=argsarray(function(args){log.call(log,args)});Object.defineProperty(fn,"enabled",{get:function get(){return debug.enabled(name)}});return fn}},function(module,exports,__webpack_require__){exports=module.exports=__webpack_require__(13);exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},function(module,exports,__webpack_require__){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=__webpack_require__(14);exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},function(module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){str=""+str;if(str.length>1e4)return;var match=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},function(module,exports,__webpack_require__){(function(setImmediate){"use strict";var log=__webpack_require__(11)("model"),CollectionRegistry=__webpack_require__(9).CollectionRegistry,InternalSiestaError=__webpack_require__(8).InternalSiestaError,RelationshipType=__webpack_require__(18),Query=__webpack_require__(19),MappingOperation=__webpack_require__(27),ModelInstance=__webpack_require__(21),util=__webpack_require__(4),cache=__webpack_require__(20),argsarray=__webpack_require__(7),error=__webpack_require__(8),extend=__webpack_require__(28),modelEvents=__webpack_require__(22),Condition=__webpack_require__(29),events=__webpack_require__(23),Placeholder=__webpack_require__(30),ReactiveQuery=__webpack_require__(31),InstanceFactory=__webpack_require__(32);function Model(opts){var self=this;this._opts=opts?util.extend({},opts):{};util.extendFromOpts(this,opts,{methods:{},attributes:[],collection:function collection(c){if(util.isString(c)){c=CollectionRegistry[c]}return c},id:"id",relationships:[],name:null,indexes:[],singleton:false,statics:this.installStatics.bind(this),properties:{},init:null,serialise:null,serialiseField:null,serialisableFields:null,remove:null,parseAttribute:null},false);if(!this.parseAttribute){this.parseAttribute=function(attrName,value){return value}}this.attributes=Model._processAttributes(this.attributes);this._factory=new InstanceFactory(this);this._instance=this._factory._instance.bind(this._factory);util.extend(this,{_relationshipsInstalled:false,_reverseRelationshipsInstalled:false,children:[]});Object.defineProperties(this,{_relationshipNames:{get:function get(){return Object.keys(self.relationships)},enumerable:true},_attributeNames:{get:function get(){var names=[];if(self.id){names.push(self.id)}self.attributes.forEach(function(x){names.push(x.name)});return names},enumerable:true,configurable:true},installed:{get:function get(){return self._relationshipsInstalled&&self._reverseRelationshipsInstalled},enumerable:true,configurable:true},descendants:{get:function get(){return self.children.reduce(function(memo,descendant){return Array.prototype.concat.call(memo,descendant.descendants)}.bind(self),util.extend([],self.children))},enumerable:true},collectionName:{get:function get(){return this.collection.name},enumerable:true}});var globalEventName=this.collectionName+":"+this.name,proxied={query:this.query.bind(this)};events.ProxyEventEmitter.call(this,globalEventName,proxied);this._indexIsInstalled=new Condition(function(done){done()}.bind(this))}util.extend(Model,{_processAttributes:function _processAttributes(attributes){
return attributes.reduce(function(m,a){if(typeof a=="string"){m.push({name:a})}else{m.push(a)}return m},[])}});Model.prototype=Object.create(events.ProxyEventEmitter.prototype);util.extend(Model.prototype,{installStatics:function installStatics(statics){if(statics){Object.keys(statics).forEach(function(staticName){if(this[staticName]){log('Static method with name "'+staticName+'" already exists. Ignoring it.')}else{this[staticName]=statics[staticName].bind(this)}}.bind(this))}return statics},_validateRelationshipType:function _validateRelationshipType(relationship){if(!relationship.type){if(this.singleton)relationship.type=RelationshipType.OneToOne;else relationship.type=RelationshipType.OneToMany}if(this.singleton&&relationship.type==RelationshipType.ManyToMany){return"Singleton model cannot use ManyToMany relationship."}if(Object.keys(RelationshipType).indexOf(relationship.type)<0)return"Relationship type "+relationship.type+" does not exist";return null},_getReverseModel:function _getReverseModel(reverseName){var reverseModel;if(reverseName instanceof Model)reverseModel=reverseName;else reverseModel=this.collection[reverseName];if(!reverseModel){var arr=reverseName.split(".");if(arr.length==2){var collectionName=arr[0];reverseName=arr[1];var otherCollection=CollectionRegistry[collectionName];if(otherCollection)reverseModel=otherCollection[reverseName]}}return reverseModel},_getReverseModelOrPlaceholder:function _getReverseModelOrPlaceholder(forwardName,reverseName){var reverseModel=this._getReverseModel(reverseName);return reverseModel||new Placeholder({name:reverseName,ref:this,forwardName:forwardName})},installRelationships:function installRelationships(){if(!this._relationshipsInstalled){var err=null;for(var name in this._opts.relationships){if(this._opts.relationships.hasOwnProperty(name)){var relationship=this._opts.relationships[name];var isForward=!relationship.isReverse;if(isForward){log(this.name+": configuring relationship "+name,relationship);if(!(err=this._validateRelationshipType(relationship))){var reverseModelName=relationship.model;if(reverseModelName){var reverseModel=this._getReverseModelOrPlaceholder(name,reverseModelName);util.extend(relationship,{reverseModel:reverseModel,forwardModel:this,forwardName:name,reverseName:relationship.reverse||"reverse_"+name,isReverse:false});delete relationship.model;delete relationship.reverse}else return"Must pass model"}}}}}else{throw new InternalSiestaError('Relationships for "'+this.name+'" have already been installed')}if(!err)this._relationshipsInstalled=true;return err},_installReverse:function _installReverse(relationship){var reverseModel=relationship.reverseModel;var isPlaceholder=reverseModel.isPlaceholder;if(isPlaceholder){var modelName=relationship.reverseModel.name;reverseModel=this._getReverseModel(modelName);if(reverseModel){relationship.reverseModel=reverseModel}}if(reverseModel){var err;var reverseName=relationship.reverseName,forwardModel=relationship.forwardModel;if(reverseModel!=this||reverseModel==forwardModel){if(reverseModel.singleton){if(relationship.type==RelationshipType.ManyToMany)err="Singleton model cannot be related via reverse ManyToMany";if(relationship.type==RelationshipType.OneToMany)err="Singleton model cannot be related via reverse OneToMany"}if(!err){log(this.name+": configuring  reverse relationship "+reverseName);if(reverseModel.relationships[reverseName]){var isAncestorModel=reverseModel.relationships[reverseName].forwardModel.isAncestorOf(this);var isDescendentModel=reverseModel.relationships[reverseName].forwardModel.isDescendantOf(this);if(!isAncestorModel&&!isDescendentModel){err='Reverse relationship "'+reverseName+'" already exists on model "'+reverseModel.name+'"'}}if(!err){reverseModel.relationships[reverseName]=relationship}}}if(isPlaceholder){var existingReverseInstances=(cache._localCacheByType[reverseModel.collectionName]||{})[reverseModel.name]||{};Object.keys(existingReverseInstances).forEach(function(localId){var instancce=existingReverseInstances[localId];var r=util.extend({},relationship);r.isReverse=true;this._factory._installRelationship(r,instancce)}.bind(this))}}return err},_installReversePlaceholders:function _installReversePlaceholders(){for(var forwardName in this.relationships){if(this.relationships.hasOwnProperty(forwardName)){var relationship=this.relationships[forwardName];if(relationship.reverseModel.isPlaceholder)this._installReverse(relationship)}}},installReverseRelationships:function installReverseRelationships(){if(!this._reverseRelationshipsInstalled){for(var forwardName in this.relationships){if(this.relationships.hasOwnProperty(forwardName)){var relationship=this.relationships[forwardName];relationship=extend(true,{},relationship);relationship.isReverse=true;var err=this._installReverse(relationship)}}this._reverseRelationshipsInstalled=true}else{throw new InternalSiestaError('Reverse relationships for "'+this.name+'" have already been installed.')}return err},_query:function _query(query){return new Query(this,query||{})},query:function query(_query2,cb){var queryInstance;var promise=util.promise(cb,function(cb){if(!this.singleton){queryInstance=this._query(_query2);return queryInstance.execute(cb)}else{queryInstance=this._query({__ignoreInstalled:true});queryInstance.execute(function(err,objs){if(err)cb(err);else{_query2=util.extend({},_query2);_query2.__ignoreInstalled=true;if(!objs.length){this.graph({},function(err){if(!err){queryInstance=this._query(_query2);queryInstance.execute(cb)}else{cb(err)}}.bind(this))}else{queryInstance=this._query(_query2);queryInstance.execute(cb)}}}.bind(this))}}.bind(this));var linkPromise=new util.Promise(function(resolve,reject){promise.then(argsarray(function(args){setImmediate(function(){resolve.apply(null,args)})}),argsarray(function(args){setImmediate(function(){reject.apply(null,args)})}))});return this._link({then:linkPromise.then.bind(linkPromise),"catch":linkPromise.catch.bind(linkPromise),on:argsarray(function(args){var rq=new ReactiveQuery(this._query(_query2));rq.init();rq.on.apply(rq,args)}.bind(this))})},_reactiveQuery:function _reactiveQuery(query){return new ReactiveQuery(new Query(this,query||{}))},one:function one(opts,cb){if(typeof opts=="function"){cb=opts;opts={}}return util.promise(cb,function(cb){this.query(opts,function(err,res){if(err)cb(err);else{if(res.length>1){cb(error("More than one instance returned when executing get query!"))}else{res=res.length?res[0]:null;cb(null,res)}}})}.bind(this))},all:function all(q,cb){if(typeof q=="function"){cb=q;q={}}q=q||{};var query={};if(q.__order)query.__order=q.__order;return this.query(q,cb)},_attributeDefinitionWithName:function _attributeDefinitionWithName(name){for(var i=0;i<this.attributes.length;i++){var attributeDefinition=this.attributes[i];if(attributeDefinition.name==name)return attributeDefinition}},graph:function graph(data,opts,cb){if(typeof opts=="function")cb=opts;opts=opts||{};return util.promise(cb,function(cb){var _map=function(){var overrides=opts.override;if(overrides){if(util.isArray(overrides))opts.objects=overrides;else opts.objects=[overrides]}delete opts.override;if(util.isArray(data)){this._mapBulk(data,opts,cb)}else{this._mapBulk([data],opts,function(err,objects){var obj;if(objects){if(objects.length){obj=objects[0]}}err=err?util.isArray(data)?err:util.isArray(err)?err[0]:err:null;cb(err,obj)})}}.bind(this);if(opts._ignoreInstalled){_map()}else siesta._afterInstall(_map)}.bind(this))},_mapBulk:function _mapBulk(data,opts,callback){util.extend(opts,{model:this,data:data});var op=new MappingOperation(opts);op.start(function(err,objects){if(err){if(callback)callback(err)}else{callback(null,objects||[])}})},_countCache:function _countCache(){var collCache=cache._localCacheByType[this.collectionName]||{};var modelCache=collCache[this.name]||{};return Object.keys(modelCache).reduce(function(m,localId){m[localId]={};return m},{})},count:function count(cb){return util.promise(cb,function(cb){cb(null,Object.keys(this._countCache()).length)}.bind(this))},_dump:function _dump(asJSON){var dumped={};dumped.name=this.name;dumped.attributes=this.attributes;dumped.id=this.id;dumped.collection=this.collectionName;dumped.relationships=this.relationships.map(function(r){return r.isForward?r.forwardName:r.reverseName});return asJSON?util.prettyPrint(dumped):dumped},toString:function toString(){return"Model["+this.name+"]"},removeAll:function removeAll(cb){return util.promise(cb,function(cb){this.all().then(function(instances){instances.remove();cb()}).catch(cb)}.bind(this))}});util.extend(Model.prototype,{child:function child(nameOrOpts,opts){if(typeof nameOrOpts=="string"){opts.name=nameOrOpts}else{opts=name}util.extend(opts,{attributes:Array.prototype.concat.call(opts.attributes||[],this._opts.attributes),relationships:util.extend(opts.relationships||{},this._opts.relationships),methods:util.extend(util.extend({},this._opts.methods)||{},opts.methods),statics:util.extend(util.extend({},this._opts.statics)||{},opts.statics),properties:util.extend(util.extend({},this._opts.properties)||{},opts.properties),id:opts.id||this._opts.id,init:opts.init||this._opts.init,remove:opts.remove||this._opts.remove,serialise:opts.serialise||this._opts.serialise,serialiseField:opts.serialiseField||this._opts.serialiseField,parseAttribute:opts.parseAttribute||this._opts.parseAttribute});if(this._opts.serialisableFields){opts.serialisableFields=Array.prototype.concat.apply(opts.serialisableFields||[],this._opts.serialisableFields)}var model=this.collection.model(opts.name,opts);model.parent=this;this.children.push(model);return model},isChildOf:function isChildOf(parent){return this.parent==parent},isParentOf:function isParentOf(child){return this.children.indexOf(child)>-1},isDescendantOf:function isDescendantOf(ancestor){var parent=this.parent;while(parent){if(parent==ancestor)return true;parent=parent.parent}return false},isAncestorOf:function isAncestorOf(descendant){return this.descendants.indexOf(descendant)>-1},hasAttributeNamed:function hasAttributeNamed(attributeName){return this._attributeNames.indexOf(attributeName)>-1}});module.exports=Model}).call(exports,__webpack_require__(16).setImmediate)},function(module,exports,__webpack_require__){(function(setImmediate,clearImmediate){var nextTick=__webpack_require__(17).nextTick;var apply=Function.prototype.apply;var slice=Array.prototype.slice;var immediateIds={};var nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout(function onTimeout(){if(item._onTimeout)item._onTimeout()},msecs)}};exports.setImmediate=typeof setImmediate==="function"?setImmediate:function(fn){var id=nextImmediateId++;var args=arguments.length<2?false:slice.call(arguments,1);immediateIds[id]=true;nextTick(function onNextTick(){if(immediateIds[id]){if(args){fn.apply(null,args)}else{fn.call(null)}exports.clearImmediate(id)}});return id};exports.clearImmediate=typeof clearImmediate==="function"?clearImmediate:function(id){delete immediateIds[id]}}).call(exports,__webpack_require__(16).setImmediate,__webpack_require__(16).clearImmediate)},function(module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports){"use strict";module.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},function(module,exports,__webpack_require__){"use strict";var log=__webpack_require__(11)("query"),cache=__webpack_require__(20),util=__webpack_require__(4),error=__webpack_require__(8),ModelInstance=__webpack_require__(21),constructQuerySet=__webpack_require__(26);function Query(model,query){var opts={};for(var prop in query){if(query.hasOwnProperty(prop)){if(prop.slice(0,2)=="__"){opts[prop.slice(2)]=query[prop];delete query[prop]}}}util.extend(this,{model:model,query:query,opts:opts});opts.order=opts.order||[];if(!util.isArray(opts.order))opts.order=[opts.order]}function valueAsString(fieldValue){var fieldAsString;if(fieldValue===null)fieldAsString="null";else if(fieldValue===undefined)fieldAsString="undefined";else if(fieldValue instanceof ModelInstance)fieldAsString=fieldValue.localId;else fieldAsString=fieldValue.toString();return fieldAsString}function contains(opts){if(!opts.invalid){var obj=opts.object;if(util.isArray(obj)){arr=util.pluck(obj,opts.field)}else var arr=obj[opts.field];if(util.isArray(arr)||util.isString(arr)){return arr.indexOf(opts.value)>-1}}return false}var comparators={e:function e(opts){var fieldValue=opts.object[opts.field];if(log.enabled){log(opts.field+": "+valueAsString(fieldValue)+" == "+valueAsString(opts.value),{opts:opts})}return fieldValue==opts.value},lt:function lt(opts){if(!opts.invalid)return opts.object[opts.field]<opts.value;return false},gt:function gt(opts){if(!opts.invalid)return opts.object[opts.field]>opts.value;return false},lte:function lte(opts){if(!opts.invalid)return opts.object[opts.field]<=opts.value;return false},gte:function gte(opts){if(!opts.invalid)return opts.object[opts.field]>=opts.value;return false},contains:contains,"in":contains};util.extend(Query,{comparators:comparators,registerComparator:function registerComparator(symbol,fn){if(!comparators[symbol]){comparators[symbol]=fn}}});function cacheForModel(model){var cacheByType=cache._localCacheByType;var modelName=model.name;var collectionName=model.collectionName;var cacheByModel=cacheByType[collectionName];var cacheByLocalId;if(cacheByModel){cacheByLocalId=cacheByModel[modelName]||{}}return cacheByLocalId}util.extend(Query.prototype,{execute:function execute(cb){return util.promise(cb,function(cb){this._executeInMemory(cb)}.bind(this))},_dump:function _dump(asJson){return asJson?"{}":{}},sortFunc:function sortFunc(fields){var sortFunc=function sortFunc(ascending,field){return function(v1,v2){var d1=v1[field],d2=v2[field],res;if(typeof d1=="string"||d1 instanceof String&&typeof d2=="string"||d2 instanceof String){res=ascending?d1.localeCompare(d2):d2.localeCompare(d1)}else{if(d1 instanceof Date)d1=d1.getTime();if(d2 instanceof Date)d2=d2.getTime();if(ascending)res=d1-d2;else res=d2-d1}return res}};var s=util;for(var i=0;i<fields.length;i++){var field=fields[i];s=s.thenBy(sortFunc(field.ascending,field.field))}return s==util?null:s},_sortResults:function _sortResults(res){var order=this.opts.order;if(res&&order){var fields=order.map(function(ordering){var splt=ordering.split("-"),ascending=true,field=null;if(splt.length>1){field=splt[1];ascending=false}else{field=splt[0]}return{field:field,ascending:ascending}}.bind(this));var sortFunc=this.sortFunc(fields);if(res.immutable)res=res.mutableCopy();if(sortFunc)res.sort(sortFunc)}return res},_getCacheByLocalId:function _getCacheByLocalId(){return this.model.descendants.reduce(function(memo,childModel){return util.extend(memo,cacheForModel(childModel))},util.extend({},cacheForModel(this.model)))},_executeInMemory:function _executeInMemory(callback){var _executeInMemory=function(){this.model._indexIsInstalled.then(function(){var cacheByLocalId=this._getCacheByLocalId();var keys=Object.keys(cacheByLocalId);var self=this;var res=[];var err;for(var i=0;i<keys.length;i++){var k=keys[i];var obj=cacheByLocalId[k];var matches=self.objectMatchesQuery(obj);if(typeof matches=="string"){err=error(matches);break}else{if(matches)res.push(obj)}}res=this._sortResults(res);if(err)log("Error executing query",err);callback(err,err?null:constructQuerySet(res,this.model))}.bind(this)).catch(function(err){var _err='Unable to execute query due to failed index installation on Model "'+this.model.name+'"';console.error(_err,err);callback(_err)}.bind(this))}.bind(this);if(this.opts.ignoreInstalled){_executeInMemory()}else{siesta._afterInstall(_executeInMemory)}},clearOrdering:function clearOrdering(){this.opts.order=null},objectMatchesOrQuery:function objectMatchesOrQuery(obj,orQuery){for(var idx in orQuery){if(orQuery.hasOwnProperty(idx)){var query=orQuery[idx];if(this.objectMatchesBaseQuery(obj,query)){return true}}}return false},objectMatchesAndQuery:function objectMatchesAndQuery(obj,andQuery){for(var idx in andQuery){if(andQuery.hasOwnProperty(idx)){var query=andQuery[idx];if(!this.objectMatchesBaseQuery(obj,query)){return false}}}return true},splitMatches:function splitMatches(obj,unprocessedField,value){var op="e";var fields=unprocessedField.split(".");var splt=fields[fields.length-1].split("__");if(splt.length==2){var field=splt[0];op=splt[1]}else{field=splt[0]}fields[fields.length-1]=field;fields.slice(0,fields.length-1).forEach(function(f){if(util.isArray(obj)){obj=util.pluck(obj,f)}else{obj=obj[f]}});var notNullOrUndefined=obj!=undefined;if(notNullOrUndefined){if(util.isArray(obj)){}else{var val=obj[field];var invalid=util.isArray(val)?false:val===null||val===undefined}var comparator=Query.comparators[op],opts={object:obj,field:field,value:value,invalid:invalid};if(!comparator){return'No comparator registered for query operation "'+op+'"'}return comparator(opts)}return false},objectMatches:function objectMatches(obj,unprocessedField,value,query){if(unprocessedField=="$or"){var $or=query["$or"];if(!util.isArray($or)){$or=Object.keys($or).map(function(k){var normalised={};normalised[k]=$or[k];return normalised})}if(!this.objectMatchesOrQuery(obj,$or))return false}else if(unprocessedField=="$and"){if(!this.objectMatchesAndQuery(obj,query["$and"]))return false}else{var matches=this.splitMatches(obj,unprocessedField,value);if(typeof matches!="boolean")return matches;if(!matches)return false}return true},objectMatchesBaseQuery:function objectMatchesBaseQuery(obj,query){var fields=Object.keys(query);for(var i=0;i<fields.length;i++){var unprocessedField=fields[i],value=query[unprocessedField];var rt=this.objectMatches(obj,unprocessedField,value,query);if(typeof rt!="boolean")return rt;if(!rt)return false}return true},objectMatchesQuery:function objectMatchesQuery(obj){return this.objectMatchesBaseQuery(obj,this.query)}});module.exports=Query},function(module,exports,__webpack_require__){"use strict";var log=__webpack_require__(11)("cache"),InternalSiestaError=__webpack_require__(8).InternalSiestaError,util=__webpack_require__(4);function Cache(){this.reset();Object.defineProperty(this,"_localCacheByType",{get:function get(){return this.local}})}Cache.prototype={reset:function reset(){this.remote={};this.localById={};this.local={}},getViaLocalId:function getViaLocalId(localId){if(util.isArray(localId))return localId.map(function(x){return this.localById[x]}.bind(this));else return this.localById[localId]},getViaRemoteId:function getViaRemoteId(remoteId,opts){var c=(this.remote[opts.model.collectionName]||{})[opts.model.name]||{};return util.isArray(remoteId)?remoteId.map(function(x){return c[x]}):c[remoteId]},getSingleton:function getSingleton(model){var modelName=model.name;var collectionName=model.collectionName;var collectionCache=this.local[collectionName];if(collectionCache){var typeCache=collectionCache[modelName];if(typeCache){var objs=[];for(var prop in typeCache){if(typeCache.hasOwnProperty(prop)){objs.push(typeCache[prop])}}if(objs.length>1){var errStr="A singleton model has more than 1 object in the cache! This is a serious error. "+"Either a model has been modified after objects have already been created, or something has gone"+"very wrong. Please file a bug report if the latter.";throw new InternalSiestaError(errStr)}else if(objs.length){return objs[0]}}}return null},remoteInsert:function remoteInsert(obj,remoteId,previousRemoteId){if(obj){var collectionName=obj.model.collectionName;if(collectionName){if(!this.remote[collectionName]){this.remote[collectionName]={}}var type=obj.model.name;if(type){if(!this.remote[collectionName][type]){this.remote[collectionName][type]={}}if(previousRemoteId){this.remote[collectionName][type][previousRemoteId]=null}var cachedObject=this.remote[collectionName][type][remoteId];if(!cachedObject){this.remote[collectionName][type][remoteId]=obj;log("Remote cache insert: "+obj._dump(true))}else{if(obj!=cachedObject){var message="Object "+collectionName.toString()+":"+type.toString()+"["+obj.model.id+'="'+remoteId+'"] already exists in the cache.'+" This is a serious error, please file a bug report if you are experiencing this out in the wild";log(message,{obj:obj,cachedObject:cachedObject});throw new InternalSiestaError(message)}}}else{throw new InternalSiestaError("Model has no type",{model:obj.model,obj:obj})}}else{throw new InternalSiestaError("Model has no collection",{model:obj.model,obj:obj})}}else{var msg="Must pass an object when inserting to cache";log(msg);throw new InternalSiestaError(msg)}},get:function get(opts){log("get",opts);var obj,idField,remoteId;var localId=opts.localId;if(localId){obj=this.getViaLocalId(localId);if(obj){return obj}else{if(opts.model){idField=opts.model.id;remoteId=opts[idField];log(idField+"="+remoteId);return this.getViaRemoteId(remoteId,opts)}else{return null}}}else if(opts.model){idField=opts.model.id;remoteId=opts[idField];if(remoteId){return this.getViaRemoteId(remoteId,opts)}else if(opts.model.singleton){return this.getSingleton(opts.model)}}else{log("Invalid opts to cache",{opts:opts})}return null},_remoteCache:function _remoteCache(){return this.remote},_localCache:function _localCache(){return this.localById},insert:function insert(obj){var localId=obj.localId;if(localId){var collectionName=obj.model.collectionName;var modelName=obj.model.name;if(!this.localById[localId]){this.localById[localId]=obj;if(!this.local[collectionName])this.local[collectionName]={};if(!this.local[collectionName][modelName])this.local[collectionName][modelName]={};this.local[collectionName][modelName][localId]=obj}else{if(this.localById[localId]!=obj){var message='Object with localId="'+localId.toString()+'" is already in the cache. '+"This is a serious error. Please file a bug report if you are experiencing this out in the wild";log(message);throw new InternalSiestaError(message)}}}var idField=obj.idField;var remoteId=obj[idField];if(remoteId){this.remoteInsert(obj,remoteId)}else{log('No remote id ("'+idField+'") so wont be placing in the remote cache',obj)}},contains:function contains(obj){var q={localId:obj.localId};var model=obj.model;if(model.id){if(obj[model.id]){q.model=model;q[model.id]=obj[model.id]}}return!!this.get(q)},remove:function remove(obj){if(this.contains(obj)){var collectionName=obj.model.collectionName;var modelName=obj.model.name;var localId=obj.localId;if(!modelName)throw InternalSiestaError("No mapping name");if(!collectionName)throw InternalSiestaError("No collection name");if(!localId)throw InternalSiestaError("No localId");delete this.local[collectionName][modelName][localId];delete this.localById[localId];if(obj.model.id){var remoteId=obj[obj.model.id];if(remoteId){delete this.remote[collectionName][modelName][remoteId]}}}},count:function count(){return Object.keys(this.localById).length}};module.exports=new Cache},function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var log=__webpack_require__(11),util=__webpack_require__(4),error=__webpack_require__(8),modelEvents=__webpack_require__(22),ModelEventType=modelEvents.ModelEventType,events=__webpack_require__(23),cache=__webpack_require__(20);function ModelInstance(model){var self=this;this.model=model;util.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]);events.ProxyEventEmitter.call(this);Object.defineProperties(this,{_relationshipNames:{get:function get(){var proxies=Object.keys(self.__proxies||{}).map(function(x){return self.__proxies[x]});return proxies.map(function(p){if(p.isForward){return p.forwardName}else{return p.reverseName}})},enumerable:true,configurable:true},event:{get:function get(){return this.localId}}});this.removed=false;this._emitEvents=false}ModelInstance.prototype=Object.create(events.ProxyEventEmitter.prototype);util.extend(ModelInstance.prototype,{get:function get(cb){return util.promise(cb,function(cb){cb(null,this)}.bind(this))},emit:function emit(type,opts){if((typeof type==="undefined"?"undefined":_typeof(type))=="object")opts=type;else opts.type=type;opts=opts||{};util.extend(opts,{collection:this.collectionName,model:this.model.name,localId:this.localId,obj:this});modelEvents.emit(opts)},remove:function remove(cb,notification){_.each(this._relationshipNames,function(name){if(util.isArray(this[name])){this[name]=[]}else{this[name]=null}}.bind(this));notification=notification==null?true:notification;return util.promise(cb,function(cb){cache.remove(this);this.removed=true;if(notification){this.emit(modelEvents.ModelEventType.Remove,{old:this})}var remove=this.model.remove;if(remove){var paramNames=util.paramNames(remove);if(paramNames.length){var self=this;remove.call(this,function(err){cb(err,self)})}else{remove.call(this);cb(null,this)}}else{cb(null,this)}}.bind(this))}});util.extend(ModelInstance.prototype,{getAttributes:function getAttributes(){return util.extend({},this.__values)},isInstanceOf:function isInstanceOf(model){return this.model==model},isA:function isA(model){return this.model==model||this.model.isDescendantOf(model)}});util.extend(ModelInstance.prototype,{_dumpString:function _dumpString(reverseRelationships){return JSON.stringify(this._dump(reverseRelationships,null,4))},_dump:function _dump(reverseRelationships){var dumped=util.extend({},this.__values);dumped._rev=this._rev;dumped.localId=this.localId;return dumped}});function defaultSerialiser(attrName,value){return value}util.extend(ModelInstance.prototype,{_defaultSerialise:function _defaultSerialise(opts){var serialised={};var includeNullAttributes=opts.includeNullAttributes!==undefined?opts.includeNullAttributes:true,includeNullRelationships=opts.includeNullRelationships!==undefined?opts.includeNullRelationships:true;var serialisableFields=this.model.serialisableFields||this._attributeNames.concat.apply(this._attributeNames,this._relationshipNames).concat(this.id);this._attributeNames.forEach(function(attrName){if(serialisableFields.indexOf(attrName)>-1){var attrDefinition=this.model._attributeDefinitionWithName(attrName)||{};var serialiser;if(attrDefinition.serialise)serialiser=attrDefinition.serialise.bind(this);else{var serialiseField=this.model.serialiseField||defaultSerialiser;serialiser=serialiseField.bind(this,attrName)}var val=this[attrName];if(val===null){if(includeNullAttributes){serialised[attrName]=serialiser(val)}}else if(val!==undefined){serialised[attrName]=serialiser(val)}}}.bind(this));this._relationshipNames.forEach(function(relName){if(serialisableFields.indexOf(relName)>-1){var val=this[relName],rel=this.model.relationships[relName];if(rel&&!rel.isReverse){var serialiser;if(rel.serialise){serialiser=rel.serialise.bind(this)}else{var serialiseField=this.model.serialiseField;if(!serialiseField){if(util.isArray(val))val=util.pluck(val,this.model.id);else if(val)val=val[this.model.id]}serialiseField=serialiseField||defaultSerialiser;serialiser=serialiseField.bind(this,relName)}if(val===null){if(includeNullRelationships){serialised[relName]=serialiser(val)}}else if(util.isArray(val)){if(includeNullRelationships&&!val.length||val.length){serialised[relName]=serialiser(val)}}else if(val!==undefined){serialised[relName]=serialiser(val)}}}}.bind(this));return serialised},serialise:function serialise(opts){opts=opts||{};if(!this.model.serialise)return this._defaultSerialise(opts);else return this.model.serialise(this,opts)}});util.extend(ModelInstance.prototype,{_emitNew:function _emitNew(){modelEvents.emit({collection:this.model.collectionName,model:this.model.name,localId:this.localId,"new":this,type:ModelEventType.New,obj:this})}});module.exports=ModelInstance},function(module,exports,__webpack_require__){"use strict";var events=__webpack_require__(23),InternalSiestaError=__webpack_require__(8).InternalSiestaError,log=__webpack_require__(11)("events"),extend=__webpack_require__(4).extend,collectionRegistry=__webpack_require__(9).CollectionRegistry;var ModelEventType={Set:"set",Splice:"splice",New:"new",Remove:"remove"};function ModelEvent(opts){this._opts=opts||{};Object.keys(opts).forEach(function(k){this[k]=opts[k]}.bind(this))}ModelEvent.prototype._dump=function(pretty){var dumped={};dumped.collection=typeof this.collection=="string"?this.collection:this.collection._dump();dumped.model=typeof this.model=="string"?this.model:this.model.name;dumped.localId=this.localId;dumped.field=this.field;dumped.type=this.type;if(this.index)dumped.index=this.index;if(this.added)dumped.added=this.added.map(function(x){return x._dump()});if(this.removed)dumped.removed=this.removed.map(function(x){return x._dump()});if(this.old)dumped.old=this.old;if(this.new)dumped.new=this.new;return pretty?util.prettyPrint(dumped):dumped};function broadcastEvent(collectionName,modelName,opts){var genericEvent="Siesta",collection=collectionRegistry[collectionName],model=collection[modelName];if(!collection)throw new InternalSiestaError('No such collection "'+collectionName+'"');if(!model)throw new InternalSiestaError('No such model "'+modelName+'"');var shouldEmit=opts.obj._emitEvents;if(shouldEmit&&"new"in opts&&"old"in opts){if(opts.new instanceof Date&&opts.old instanceof Date){shouldEmit=opts.new.getTime()!=opts.old.getTime()}else{shouldEmit=opts.new!=opts.old}}if(shouldEmit){events.emit(genericEvent,opts);if(siesta.installed){var modelEvent=collectionName+":"+modelName,localIdEvent=opts.localId;events.emit(collectionName,opts);events.emit(modelEvent,opts);events.emit(localIdEvent,opts)}if(model.id&&opts.obj[model.id])events.emit(collectionName+":"+modelName+":"+opts.obj[model.id],opts)}}function validateEventOpts(opts){
if(!opts.model)throw new InternalSiestaError("Must pass a model");if(!opts.collection)throw new InternalSiestaError("Must pass a collection");if(!opts.localId)throw new InternalSiestaError("Must pass a local identifier");if(!opts.obj)throw new InternalSiestaError("Must pass the object")}function emit(opts){validateEventOpts(opts);var collection=opts.collection;var model=opts.model;var c=new ModelEvent(opts);broadcastEvent(collection,model,c);return c}extend(exports,{ModelEvent:ModelEvent,emit:emit,validateEventOpts:validateEventOpts,ModelEventType:ModelEventType})},function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var EventEmitter=__webpack_require__(24).EventEmitter,ArrayObserver=__webpack_require__(5).ArrayObserver,util=__webpack_require__(4),argsarray=__webpack_require__(7),modelEvents=__webpack_require__(22),Chain=__webpack_require__(25);var eventEmitter=new EventEmitter;eventEmitter.setMaxListeners(100);function ProxyEventEmitter(event,chainOpts){util.extend(this,{event:event,listeners:{}});var defaultChainOpts={};defaultChainOpts.on=this.on.bind(this);defaultChainOpts.once=this.once.bind(this);Chain.call(this,util.extend(defaultChainOpts,chainOpts||{}))}ProxyEventEmitter.prototype=Object.create(Chain.prototype);util.extend(ProxyEventEmitter.prototype,{on:function on(type,fn){if(typeof type=="function"){fn=type;type=null}else{if(type.trim()=="*")type=null;var _fn=fn;fn=function fn(e){e=e||{};if(type){if(e.type==type){_fn(e)}}else{_fn(e)}};var listeners=this.listeners;if(type){if(!listeners[type])listeners[type]=[];listeners[type].push(fn)}}eventEmitter.on(this.event,fn);return this._handlerLink({fn:fn,type:type,extend:this.proxyChainOpts})},once:function once(type,_fn2){var event=this.event;if(typeof type=="function"){_fn2=type;type=null}else{if(type.trim()=="*")type=null;var _fn=_fn2;_fn2=function fn(e){e=e||{};if(type){if(e.type==type){eventEmitter.removeListener(event,_fn2);_fn(e)}}else{_fn(e)}}}if(type)return eventEmitter.on(event,_fn2);else return eventEmitter.once(event,_fn2)},_removeListener:function _removeListener(fn,type){if(type){var listeners=this.listeners[type],idx=listeners.indexOf(fn);listeners.splice(idx,1)}return eventEmitter.removeListener(this.event,fn)},emit:function emit(type,payload){if((typeof type==="undefined"?"undefined":_typeof(type))=="object"){payload=type;type=null}else{payload=payload||{};payload.type=type}eventEmitter.emit.call(eventEmitter,this.event,payload)},_removeAllListeners:function _removeAllListeners(type){(this.listeners[type]||[]).forEach(function(fn){eventEmitter.removeListener(this.event,fn)}.bind(this));this.listeners[type]=[]},removeAllListeners:function removeAllListeners(type){if(type){this._removeAllListeners(type)}else{for(type in this.listeners){if(this.listeners.hasOwnProperty(type)){this._removeAllListeners(type)}}}}});util.extend(eventEmitter,{ProxyEventEmitter:ProxyEventEmitter,wrapArray:function wrapArray(array,field,modelInstance){if(!array.observer){array.observer=new ArrayObserver(array);array.observer.open(function(splices){var fieldIsAttribute=modelInstance._attributeNames.indexOf(field)>-1;if(fieldIsAttribute){splices.forEach(function(splice){modelEvents.emit({collection:modelInstance.collectionName,model:modelInstance.model.name,localId:modelInstance.localId,index:splice.index,removed:splice.removed,added:splice.addedCount?array.slice(splice.index,splice.index+splice.addedCount):[],type:modelEvents.ModelEventType.Splice,field:field,obj:modelInstance})})}})}}});var oldEmit=eventEmitter.emit;eventEmitter.emit=function(event,payload){try{oldEmit.call(eventEmitter,event,payload)}catch(e){console.error(e)}};module.exports=eventEmitter},function(module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},function(module,exports,__webpack_require__){"use strict";var argsarray=__webpack_require__(7);function Chain(opts){this.opts=opts}Chain.prototype={_handlerLink:function _handlerLink(opts){var firstLink;firstLink=function(){var typ=opts.type;if(opts.fn)this._removeListener(opts.fn,typ);if(firstLink._parentLink)firstLink._parentLink()}.bind(this);Object.keys(this.opts).forEach(function(prop){var func=this.opts[prop];firstLink[prop]=argsarray(function(args){var link=func.apply(func.__siesta_bound_object,args);link._parentLink=firstLink;return link}.bind(this))}.bind(this));firstLink._parentLink=null;return firstLink},_link:function _link(opts,clean){var chain=this;clean=clean||function(){};var link;link=function(){clean();if(link._parentLink)link._parentLink()}.bind(this);link.__siesta_isLink=true;link.opts=opts;link.clean=clean;Object.keys(opts).forEach(function(prop){var func=opts[prop];link[prop]=argsarray(function(args){var possibleLink=func.apply(func.__siesta_bound_object,args);if(!possibleLink||!possibleLink.__siesta_isLink){nextLink=chain._link(link.opts);for(var prop in possibleLink){if(possibleLink[prop]instanceof Function){nextLink[prop]=possibleLink[prop]}}}else{var nextLink=possibleLink}nextLink._parentLink=link;for(prop in link){if(link[prop]instanceof Function){nextLink[prop]=link[prop].bind(link)}}return nextLink}.bind(this))}.bind(this));link._parentLink=null;return link}};module.exports=Chain},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(4),Promise=util.Promise,error=__webpack_require__(8),ModelInstance=__webpack_require__(21);var ARRAY_METHODS=["push","sort","reverse","splice","shift","unshift"],NUMBER_METHODS=["toString","toExponential","toFixed","toPrecision","valueOf"],NUMBER_PROPERTIES=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],STRING_METHODS=["charAt","charCodeAt","concat","fromCharCode","indexOf","lastIndexOf","localeCompare","match","replace","search","slice","split","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toString","toUpperCase","trim","valueOf"],STRING_PROPERTIES=["length"];function getPropertyNames(object){var propertyNames;if(typeof object=="string"||object instanceof String){propertyNames=STRING_METHODS.concat(STRING_PROPERTIES)}else if(typeof object=="number"||object instanceof Number){propertyNames=NUMBER_METHODS.concat(NUMBER_PROPERTIES)}else{propertyNames=object.getOwnPropertyNames()}return propertyNames}function defineAttribute(arr,prop){if(!(prop in arr)){Object.defineProperty(arr,prop,{get:function get(){return querySet(util.pluck(arr,prop))},set:function set(v){if(util.isArray(v)){if(this.length!=v.length)throw error({message:"Must be same length"});for(var i=0;i<v.length;i++){this[i][prop]=v[i]}}else{for(i=0;i<this.length;i++){this[i][prop]=v}}}})}}function isPromise(obj){return obj.then&&obj.catch}function defineMethod(arr,prop){if(!(prop in arr)){arr[prop]=function(){var args=arguments,res=this.map(function(p){return p[prop].apply(p,args)});var arePromises=false;if(res.length)arePromises=isPromise(res[0]);return arePromises?Promise.all(res):querySet(res)}}}function modelQuerySet(arr,model){arr=util.extend([],arr);var attributeNames=model._attributeNames,relationshipNames=model._relationshipNames,names=attributeNames.concat(relationshipNames).concat(instanceMethods);names.forEach(defineAttribute.bind(defineAttribute,arr));var instanceMethods=Object.keys(ModelInstance.prototype);instanceMethods.forEach(defineMethod.bind(defineMethod,arr));return renderImmutable(arr)}function querySet(arr){if(arr.length){var referenceObject=arr[0],propertyNames=getPropertyNames(referenceObject);propertyNames.forEach(function(prop){if(typeof referenceObject[prop]=="function")defineMethod(arr,prop,arguments);else defineAttribute(arr,prop)})}return renderImmutable(arr)}function throwImmutableError(){throw new Error("Cannot modify a query set")}function renderImmutable(arr){ARRAY_METHODS.forEach(function(p){arr[p]=throwImmutableError});arr.immutable=true;arr.mutableCopy=arr.asArray=function(){var mutableArr=this.map(function(x){return x});mutableArr.asQuerySet=function(){return querySet(this)};mutableArr.asModelQuerySet=function(model){return modelQuerySet(this,model)};return mutableArr};return arr}module.exports=modelQuerySet},function(module,exports,__webpack_require__){"use strict";var ModelInstance=__webpack_require__(21),log=__webpack_require__(11)("graph"),cache=__webpack_require__(20),util=__webpack_require__(4);function SiestaError(opts){this.opts=opts}SiestaError.prototype.toString=function(){return JSON.stringify(this.opts,null,4)};function MappingOperation(opts){this._opts=opts;util.extendFromOpts(this,opts,{model:null,data:null,objects:[],disableevents:false,_ignoreInstalled:false});util.extend(this,{errors:[],subTaskResults:{},_newObjects:[]});this.model._installReversePlaceholders();this.data=this.preprocessData()}util.extend(MappingOperation.prototype,{mapAttributes:function mapAttributes(){for(var i=0;i<this.data.length;i++){var datum=this.data[i],object=this.objects[i];if(datum!=object){if(object){var fields=this.model._attributeNames;fields.forEach(function(f){if(datum[f]!==undefined){if(this.disableevents){object.__values[f]=datum[f]}else{object[f]=datum[f]}}}.bind(this));if(datum._rev)object._rev=datum._rev}}}},_map:function _map(){var self=this;var err;this.mapAttributes();var relationshipFields=Object.keys(self.subTaskResults);relationshipFields.forEach(function(f){var res=self.subTaskResults[f];var indexes=res.indexes,objects=res.objects;var relatedData=self.getRelatedData(f).relatedData;var unflattenedObjects=util.unflattenArray(objects,relatedData);for(var i=0;i<unflattenedObjects.length;i++){var idx=indexes[i];var error=self.errors[idx];err=error?error[f]:null;if(!err){var related=unflattenedObjects[i];var object=self.objects[idx];if(object){err=object.__proxies[f].set(related,{disableevents:self.disableevents});if(err){if(!self.errors[idx])self.errors[idx]={};self.errors[idx][f]=err}}}}})},_sortLookups:function _sortLookups(){var remoteLookups=[];var localLookups=[];for(var i=0;i<this.data.length;i++){if(!this.objects[i]){var lookup;var datum=this.data[i];var isScalar=typeof datum=="string"||typeof datum=="number"||datum instanceof String;if(datum){if(isScalar){lookup={index:i,datum:{}};lookup.datum[this.model.id]=datum;remoteLookups.push(lookup)}else if(datum instanceof ModelInstance){this.objects[i]=datum}else if(datum.localId){localLookups.push({index:i,datum:datum})}else if(datum[this.model.id]){remoteLookups.push({index:i,datum:datum})}else{this.objects[i]=this._instance()}}else{this.objects[i]=null}}}return{remoteLookups:remoteLookups,localLookups:localLookups}},_performLocalLookups:function _performLocalLookups(localLookups){var localIdentifiers=util.pluck(util.pluck(localLookups,"datum"),"localId"),localObjects=cache.getViaLocalId(localIdentifiers);for(var i=0;i<localIdentifiers.length;i++){var obj=localObjects[i];var localId=localIdentifiers[i];var lookup=localLookups[i];if(!obj){obj=cache.get({localId:localId});if(!obj)obj=this._instance({localId:localId},!this.disableevents);this.objects[lookup.index]=obj}else{this.objects[lookup.index]=obj}}},_performRemoteLookups:function _performRemoteLookups(remoteLookups){var remoteIdentifiers=util.pluck(util.pluck(remoteLookups,"datum"),this.model.id),remoteObjects=cache.getViaRemoteId(remoteIdentifiers,{model:this.model});for(var i=0;i<remoteObjects.length;i++){var obj=remoteObjects[i],lookup=remoteLookups[i];if(obj){this.objects[lookup.index]=obj}else{var data={};var remoteId=remoteIdentifiers[i];data[this.model.id]=remoteId;var cacheQuery={model:this.model};cacheQuery[this.model.id]=remoteId;var cached=cache.get(cacheQuery);if(cached){this.objects[lookup.index]=cached}else{this.objects[lookup.index]=this._instance();this.objects[lookup.index][this.model.id]=remoteId}}}},_lookup:function _lookup(){if(this.model.singleton){this._lookupSingleton()}else{var lookups=this._sortLookups(),remoteLookups=lookups.remoteLookups,localLookups=lookups.localLookups;this._performLocalLookups(localLookups);this._performRemoteLookups(remoteLookups)}},_lookupSingleton:function _lookupSingleton(){var localIdentifiers=util.pluck(this.data,"localId"),localId;for(i=0;i<localIdentifiers.length;i++){if(localIdentifiers[i]){localId={localId:localIdentifiers[i]};break}}var singleton=cache.getSingleton(this.model)||this._instance(localId);for(var i=0;i<this.data.length;i++){this.objects[i]=singleton}},_instance:function _instance(){var model=this.model,modelInstance=model._instance.apply(model,arguments);this._newObjects.push(modelInstance);return modelInstance},preprocessData:function preprocessData(){var data=util.extend([],this.data);return data.map(function(datum){if(datum){if(!util.isString(datum)){var keys=Object.keys(datum);keys.forEach(function(k){var isRelationship=this.model._relationshipNames.indexOf(k)>-1;if(isRelationship){var val=datum[k];if(val instanceof ModelInstance){datum[k]={localId:val.localId}}}}.bind(this))}}return datum}.bind(this))},start:function start(done){var data=this.data;if(data.length){var self=this;var tasks=[];this._lookup();tasks.push(this._executeSubOperations.bind(this));util.parallel(tasks,function(err){if(err)console.error(err);self._map();var initTasks=self._newObjects.reduce(function(memo,o){var init=o.model.init;if(init){var paramNames=util.paramNames(init);if(paramNames.length==1){memo.push(init.bind(o,done))}else{init.call(o)}}o._emitEvents=true;o._emitNew();return memo},[]);util.parallel(initTasks,function(){done(self.errors.length?self.errors:null,self.objects)})}.bind(this))}else{done(null,[])}},getRelatedData:function getRelatedData(name){var indexes=[];var relatedData=[];for(var i=0;i<this.data.length;i++){var datum=this.data[i];if(datum){var val=datum[name];if(val){indexes.push(i);relatedData.push(val)}}}return{indexes:indexes,relatedData:relatedData}},processErrorsFromTask:function processErrorsFromTask(relationshipName,errors,indexes){if(errors.length){var relatedData=this.getRelatedData(relationshipName).relatedData;var unflattenedErrors=util.unflattenArray(errors,relatedData);for(var i=0;i<unflattenedErrors.length;i++){var idx=indexes[i];var err=unflattenedErrors[i];var isError=err;if(util.isArray(err))isError=err.reduce(function(memo,x){return memo||x},false);if(isError){if(!this.errors[idx])this.errors[idx]={};this.errors[idx][relationshipName]=err}}}},_executeSubOperations:function _executeSubOperations(callback){var self=this,relationshipNames=Object.keys(this.model.relationships);if(relationshipNames.length){var tasks=relationshipNames.reduce(function(m,relationshipName){var relationship=self.model.relationships[relationshipName];var reverseModel=relationship.forwardName==relationshipName?relationship.reverseModel:relationship.forwardModel;if(reverseModel.singleton&&!relationship.isReverse){this.data.forEach(function(datum){if(!datum[relationshipName])datum[relationshipName]={}})}var __ret=this.getRelatedData(relationshipName),indexes=__ret.indexes,relatedData=__ret.relatedData;if(relatedData.length){var flatRelatedData=util.flattenArray(relatedData);var op=new MappingOperation({model:reverseModel,data:flatRelatedData,disableevents:self.disableevents,_ignoreInstalled:self._ignoreInstalled})}if(op){var task;task=function task(done){op.start(function(errors,objects){self.subTaskResults[relationshipName]={errors:errors,objects:objects,indexes:indexes};self.processErrorsFromTask(relationshipName,op.errors,indexes);done()})};m.push(task)}return m}.bind(this),[]);util.parallel(tasks,function(err){callback(err)})}else{callback()}}});module.exports=MappingOperation},function(module,exports){"use strict";var hasOwn=Object.prototype.hasOwnProperty;var toStr=Object.prototype.toString;var isArray=function isArray(arr){if(typeof Array.isArray==="function"){return Array.isArray(arr)}return toStr.call(arr)==="[object Array]"};var isPlainObject=function isPlainObject(obj){if(!obj||toStr.call(obj)!=="[object Object]"){return false}var hasOwnConstructor=hasOwn.call(obj,"constructor");var hasIsPrototypeOf=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!hasOwnConstructor&&!hasIsPrototypeOf){return false}var key;for(key in obj){}return typeof key==="undefined"||hasOwn.call(obj,key)};module.exports=function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}else if(typeof target!=="object"&&typeof target!=="function"||target==null){target={}}for(;i<length;++i){options=arguments[i];if(options!=null){for(name in options){src=target[name];copy=options[name];if(target!==copy){if(deep&&copy&&(isPlainObject(copy)||(copyIsArray=isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&isArray(src)?src:[]}else{clone=src&&isPlainObject(src)?src:{}}target[name]=extend(deep,clone,copy)}else if(typeof copy!=="undefined"){target[name]=copy}}}}}return target}},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(4);function Condition(fn,lazy){if(lazy===undefined||lazy===null){lazy=true}fn=fn||function(done){done()};this._promise=new util.Promise(function(resolve,reject){this.fn=function(){this.executed=true;var numComplete=0;var results=[];var errors=[];if(util.isArray(fn)){var checkComplete=function(){if(numComplete.length==fn.length){if(errors.length)this._promise.reject(errors);else this._promise.resolve(null,results)}}.bind(this);fn.forEach(function(cond,idx){cond.then(function(res){results[idx]=res;numComplete++;checkComplete()}).catch(function(err){errors[idx]=err;numComplete++})})}else{fn(function(err,res){if(err)reject(err);else resolve(res)}.bind(this))}}}.bind(this));if(!lazy)this._execute();this.executed=false}Condition.prototype={_execute:function _execute(){if(!this.executed)this.fn()},then:function then(success,fail){this._execute();return this._promise.then(success,fail)},"catch":function _catch(fail){this._execute();return this._promise.catch(fail)},resolve:function resolve(res){this.executed=true;this._promise.resolve(res)},reject:function reject(err){this.executed=true;this._promise.reject(err)}};module.exports=Condition},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(4);function Placeholder(opts){util.extend(this,opts||{});this.isPlaceholder=true}module.exports=Placeholder},function(module,exports,__webpack_require__){"use strict";var log=__webpack_require__(11)("query:reactive"),Query=__webpack_require__(19),EventEmitter=__webpack_require__(24).EventEmitter,events=__webpack_require__(23),Chain=__webpack_require__(25),modelEvents=__webpack_require__(22),InternalSiestaError=__webpack_require__(8).InternalSiestaError,constructQuerySet=__webpack_require__(26),util=__webpack_require__(4);function ReactiveQuery(query){var self=this;EventEmitter.call(this);Chain.call(this);util.extend(this,{insertionPolicy:ReactiveQuery.InsertionPolicy.Back,initialised:false});Object.defineProperty(this,"query",{get:function get(){return this._query},set:function set(v){if(v){this._query=v;this.results=constructQuerySet([],v.model)}else{this._query=null;this.results=null}},configurable:false,enumerable:true});if(query){util.extend(this,{_query:query,results:constructQuerySet([],query.model)})}Object.defineProperties(this,{initialized:{get:function get(){return this.initialised}},model:{get:function get(){var query=self._query;if(query){return query.model}}},collection:{get:function get(){return self.model.collectionName}}})}ReactiveQuery.prototype=Object.create(EventEmitter.prototype);util.extend(ReactiveQuery.prototype,Chain.prototype);util.extend(ReactiveQuery,{InsertionPolicy:{Front:"Front",Back:"Back"}});util.extend(ReactiveQuery.prototype,{init:function init(cb,_ignoreInit){if(this._query){var name=this._constructNotificationName();var handler=function(n){this._handleNotif(n)}.bind(this);this.handler=handler;events.on(name,handler);return util.promise(cb,function(cb){if(!this.initialised||_ignoreInit){this._query.execute(function(err,results){if(!err){cb(null,this._applyResults(results))}else{cb(err)}}.bind(this))}else{cb(null,this.results)}}.bind(this))}else throw new InternalSiestaError("No _query defined")},_applyResults:function _applyResults(results){this.results=results;this.initialised=true;return this.results},insert:function insert(newObj){var results=this.results.mutableCopy();if(this.insertionPolicy==ReactiveQuery.InsertionPolicy.Back)var idx=results.push(newObj);else idx=results.unshift(newObj);this.results=results.asModelQuerySet(this.model);return idx},update:function update(cb){return this.init(cb,true)},_handleNotif:function _handleNotif(n){if(n.type==modelEvents.ModelEventType.New){var newObj=n.new;if(this._query.objectMatchesQuery(newObj)){log("New object matches",newObj);var idx=this.insert(newObj);this.emit(modelEvents.ModelEventType.Splice,{index:idx,added:[newObj],type:modelEvents.ModelEventType.Splice,obj:this})}else{log("New object does not match",newObj)}}else if(n.type==modelEvents.ModelEventType.Set){newObj=n.obj;var index=this.results.indexOf(newObj),alreadyContains=index>-1,matches=this._query.objectMatchesQuery(newObj);if(matches&&!alreadyContains){log("Updated object now matches!",newObj);idx=this.insert(newObj);this.emit(modelEvents.ModelEventType.Splice,{index:idx,added:[newObj],type:modelEvents.ModelEventType.Splice,obj:this})}else if(!matches&&alreadyContains){log("Updated object no longer matches!",newObj);results=this.results.mutableCopy();var removed=results.splice(index,1);this.results=results.asModelQuerySet(this.model);this.emit(modelEvents.ModelEventType.Splice,{index:index,obj:this,"new":newObj,type:modelEvents.ModelEventType.Splice,removed:removed})}else if(!matches&&!alreadyContains){log("Does not contain, but doesnt match so not inserting",newObj)}else if(matches&&alreadyContains){log("Matches but already contains",newObj);this.emit(n.type,n)}}else if(n.type==modelEvents.ModelEventType.Remove){newObj=n.obj;var results=this.results.mutableCopy();index=results.indexOf(newObj);if(index>-1){log("Removing object",newObj);removed=results.splice(index,1);this.results=constructQuerySet(results,this.model);this.emit(modelEvents.ModelEventType.Splice,{index:index,obj:this,type:modelEvents.ModelEventType.Splice,removed:removed})}else{log("No modelEvents neccessary.",newObj)}}else{throw new InternalSiestaError('Unknown change type "'+n.type.toString()+'"')}this.results=constructQuerySet(this._query._sortResults(this.results),this.model)},_constructNotificationName:function _constructNotificationName(){return this.model.collectionName+":"+this.model.name},terminate:function terminate(){if(this.handler){events.removeListener(this._constructNotificationName(),this.handler)}this.results=null;this.handler=null},_registerEventHandler:function _registerEventHandler(on,name,fn){var removeListener=EventEmitter.prototype.removeListener;if(name.trim()=="*"){Object.keys(modelEvents.ModelEventType).forEach(function(k){on.call(this,modelEvents.ModelEventType[k],fn)}.bind(this))}else{on.call(this,name,fn)}return this._link({on:this.on.bind(this),once:this.once.bind(this),update:this.update.bind(this),insert:this.insert.bind(this)},function(){if(name.trim()=="*"){Object.keys(modelEvents.ModelEventType).forEach(function(k){removeListener.call(this,modelEvents.ModelEventType[k],fn)}.bind(this))}else{removeListener.call(this,name,fn)}})},on:function on(name,fn){return this._registerEventHandler(EventEmitter.prototype.on,name,fn)},once:function once(name,fn){return this._registerEventHandler(EventEmitter.prototype.once,name,fn)}});module.exports=ReactiveQuery},function(module,exports,__webpack_require__){"use strict";var log=__webpack_require__(11)("model"),InternalSiestaError=__webpack_require__(8).InternalSiestaError,RelationshipType=__webpack_require__(18),Query=__webpack_require__(19),ModelInstance=__webpack_require__(21),util=__webpack_require__(4),guid=util.guid,cache=__webpack_require__(20),extend=__webpack_require__(28),modelEvents=__webpack_require__(22),wrapArray=__webpack_require__(23).wrapArray,OneToManyProxy=__webpack_require__(33),OneToOneProxy=__webpack_require__(35),ManyToManyProxy=__webpack_require__(36),ReactiveQuery=__webpack_require__(31),ModelEventType=modelEvents.ModelEventType;function ModelInstanceFactory(model){this.model=model}ModelInstanceFactory.prototype={_getLocalId:function _getLocalId(data){var localId;if(data){localId=data.localId?data.localId:guid()}else{localId=guid()}return localId},_installAttributes:function _installAttributes(modelInstance,data){var Model=this.model,attributeNames=Model._attributeNames,idx=attributeNames.indexOf(Model.id);util.extend(modelInstance,{__values:util.extend(Model.attributes.reduce(function(m,a){if(a.default!==undefined)m[a.name]=a.default;return m},{}),data||{})});if(idx>-1)attributeNames.splice(idx,1);attributeNames.forEach(function(attributeName){var attributeDefinition=Model._attributeDefinitionWithName(attributeName);Object.defineProperty(modelInstance,attributeName,{get:function get(){var value=modelInstance.__values[attributeName];return value===undefined?null:value},set:function set(v){if(attributeDefinition.parse){v=attributeDefinition.parse.call(modelInstance,v)}if(Model.parseAttribute){v=Model.parseAttribute.call(modelInstance,attributeName,v)}var old=modelInstance.__values[attributeName];var propertyDependencies=this._propertyDependencies[attributeName]||[];propertyDependencies=propertyDependencies.map(function(dependant){return{prop:dependant,old:this[dependant]}}.bind(this));modelInstance.__values[attributeName]=v;propertyDependencies.forEach(function(dep){var propertyName=dep.prop;var new_=this[propertyName];modelEvents.emit({collection:Model.collectionName,model:Model.name,localId:modelInstance.localId,"new":new_,old:dep.old,type:ModelEventType.Set,field:propertyName,obj:modelInstance})}.bind(this));var e={collection:Model.collectionName,model:Model.name,localId:modelInstance.localId,"new":v,old:old,type:ModelEventType.Set,field:attributeName,obj:modelInstance};window.lastEmission=e;modelEvents.emit(e);if(util.isArray(v)){wrapArray(v,attributeName,modelInstance)}},enumerable:true,configurable:true})})},_installMethods:function _installMethods(modelInstance){var Model=this.model;Object.keys(Model.methods).forEach(function(methodName){if(modelInstance[methodName]===undefined){modelInstance[methodName]=Model.methods[methodName].bind(modelInstance)}else{log('A method with name "'+methodName+'" already exists. Ignoring it.')}}.bind(this))},_installProperties:function _installProperties(modelInstance){var _propertyNames=Object.keys(this.model.properties),_propertyDependencies={};_propertyNames.forEach(function(propName){var propDef=this.model.properties[propName];var dependencies=propDef.dependencies||[];dependencies.forEach(function(attr){if(!_propertyDependencies[attr])_propertyDependencies[attr]=[];_propertyDependencies[attr].push(propName)});delete propDef.dependencies;if(modelInstance[propName]===undefined){Object.defineProperty(modelInstance,propName,propDef)}else{log('A property/method with name "'+propName+'" already exists. Ignoring it.')}}.bind(this));modelInstance._propertyDependencies=_propertyDependencies;
},_installRemoteId:function _installRemoteId(modelInstance){var Model=this.model;var idField=Model.id;Object.defineProperty(modelInstance,idField,{get:function get(){return modelInstance.__values[Model.id]||null},set:function set(v){var old=modelInstance[Model.id];modelInstance.__values[Model.id]=v;modelEvents.emit({collection:Model.collectionName,model:Model.name,localId:modelInstance.localId,"new":v,old:old,type:ModelEventType.Set,field:Model.id,obj:modelInstance});cache.remoteInsert(modelInstance,v,old)},enumerable:true,configurable:true})},_installRelationship:function _installRelationship(definition,modelInstance){var proxy;var type=definition.type;if(type==RelationshipType.OneToMany){proxy=new OneToManyProxy(definition)}else if(type==RelationshipType.OneToOne){proxy=new OneToOneProxy(definition)}else if(type==RelationshipType.ManyToMany){proxy=new ManyToManyProxy(definition)}else{throw new InternalSiestaError("No such relationship type: "+type)}proxy.install(modelInstance)},_installRelationshipProxies:function _installRelationshipProxies(modelInstance){var model=this.model;for(var name in model.relationships){if(model.relationships.hasOwnProperty(name)){var definition=util.extend({},model.relationships[name]);this._installRelationship(definition,modelInstance)}}},_registerInstance:function _registerInstance(modelInstance,shouldRegisterChange){cache.insert(modelInstance);shouldRegisterChange=shouldRegisterChange===undefined?true:shouldRegisterChange;if(shouldRegisterChange)modelInstance._emitNew()},_installLocalId:function _installLocalId(modelInstance,data){modelInstance.localId=this._getLocalId(data)},_instance:function _instance(data,shouldRegisterChange){if(!this.model._relationshipsInstalled||!this.model._reverseRelationshipsInstalled){throw new InternalSiestaError("Model must be fully installed before creating any models")}var modelInstance=new ModelInstance(this.model);this._installLocalId(modelInstance,data);this._installAttributes(modelInstance,data);this._installMethods(modelInstance);this._installProperties(modelInstance);this._installRemoteId(modelInstance);this._installRelationshipProxies(modelInstance);this._registerInstance(modelInstance,shouldRegisterChange);return modelInstance}};module.exports=ModelInstanceFactory},function(module,exports,__webpack_require__){"use strict";var RelationshipProxy=__webpack_require__(34),util=__webpack_require__(4),modelEvents=__webpack_require__(22),events=__webpack_require__(23),wrapArrayForAttributes=events.wrapArray,ArrayObserver=__webpack_require__(5).ArrayObserver,ModelEventType=__webpack_require__(22).ModelEventType;function OneToManyProxy(opts){RelationshipProxy.call(this,opts);if(this.isReverse){this.related=[]}}OneToManyProxy.prototype=Object.create(RelationshipProxy.prototype);util.extend(OneToManyProxy.prototype,{clearReverse:function clearReverse(removed){var self=this;removed.forEach(function(removedObject){var reverseProxy=self.reverseProxyForInstance(removedObject);reverseProxy.setIdAndRelated(null)})},setReverseOfAdded:function setReverseOfAdded(added){var self=this;added.forEach(function(added){var forwardProxy=self.reverseProxyForInstance(added);forwardProxy.setIdAndRelated(self.object)})},wrapArray:function wrapArray(arr){var self=this;wrapArrayForAttributes(arr,this.reverseName,this.object);if(!arr.arrayObserver){arr.arrayObserver=new ArrayObserver(arr);var observerFunction=function observerFunction(splices){splices.forEach(function(splice){var added=splice.addedCount?arr.slice(splice.index,splice.index+splice.addedCount):[];var removed=splice.removed;self.clearReverse(removed);self.setReverseOfAdded(added);var model=self.getForwardModel();modelEvents.emit({collection:model.collectionName,model:model.name,localId:self.object.localId,field:self.getForwardName(),removed:removed,added:added,type:ModelEventType.Splice,index:splice.index,obj:self.object})})};arr.arrayObserver.open(observerFunction)}},get:function get(cb){return util.promise(cb,function(cb){cb(null,this.related)}.bind(this))},validate:function validate(obj){var str=Object.prototype.toString.call(obj);if(this.isForward){if(str=="[object Array]"){return"Cannot assign array forward oneToMany ("+str+"): "+this.forwardName}}else{if(str!="[object Array]"){return"Cannot scalar to reverse oneToMany ("+str+"): "+this.reverseName}}return null},set:function set(obj,opts){this.checkInstalled();var self=this;if(obj){var errorMessage;if(errorMessage=this.validate(obj)){return errorMessage}else{this.clearReverseRelated(opts);self.setIdAndRelated(obj,opts);if(self.isReverse){this.wrapArray(self.related)}self.setIdAndRelatedReverse(obj,opts)}}else{this.clearReverseRelated(opts);self.setIdAndRelated(obj,opts)}},install:function install(obj){RelationshipProxy.prototype.install.call(this,obj);if(this.isReverse){obj["splice"+util.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this);this.wrapArray(this.related)}}});module.exports=OneToManyProxy},function(module,exports,__webpack_require__){"use strict";var InternalSiestaError=__webpack_require__(8).InternalSiestaError,util=__webpack_require__(4),Query=__webpack_require__(19),log=__webpack_require__(11),cache=__webpack_require__(20),events=__webpack_require__(23),wrapArrayForAttributes=events.wrapArray,ArrayObserver=__webpack_require__(5).ArrayObserver,modelEvents=__webpack_require__(22),ModelEventType=modelEvents.ModelEventType;function RelationshipProxy(opts){var self=this;opts=opts||{};util.extend(this,{object:null,related:null});Object.defineProperties(this,{isForward:{get:function get(){return!self.isReverse},set:function set(v){self.isReverse=!v},enumerable:true}});util.extendFromOpts(this,opts,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null,serialise:null},false);this.cancelListens={}}util.extend(RelationshipProxy,{});util.extend(RelationshipProxy.prototype,{install:function install(modelInstance){if(modelInstance){if(!this.object){this.object=modelInstance;var self=this;var name=this.getForwardName();Object.defineProperty(modelInstance,name,{get:function get(){return self.related},set:function set(v){self.set(v)},configurable:true,enumerable:true});if(!modelInstance.__proxies)modelInstance.__proxies={};modelInstance.__proxies[name]=this;if(!modelInstance._proxies){modelInstance._proxies=[]}modelInstance._proxies.push(this)}else{throw new InternalSiestaError("Already installed.")}}else{throw new InternalSiestaError("No object passed to relationship install")}}});util.extend(RelationshipProxy.prototype,{set:function set(obj,opts){throw new InternalSiestaError("Must subclass RelationshipProxy")},get:function get(callback){throw new InternalSiestaError("Must subclass RelationshipProxy")}});util.extend(RelationshipProxy.prototype,{proxyForInstance:function proxyForInstance(modelInstance,reverse){var name=reverse?this.getReverseName():this.getForwardName(),model=reverse?this.reverseModel:this.forwardModel;var ret;if(util.isArray(modelInstance)){ret=modelInstance.map(function(o){return o.__proxies[name]})}else{var proxies=modelInstance.__proxies;var proxy=proxies[name];if(!proxy){var err='No proxy with name "'+name+'" on mapping '+model.name;throw new InternalSiestaError(err)}ret=proxy}return ret},reverseProxyForInstance:function reverseProxyForInstance(modelInstance){return this.proxyForInstance(modelInstance,true)},getReverseName:function getReverseName(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function getForwardName(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function getForwardModel(){return this.isForward?this.forwardModel:this.reverseModel},setIdAndRelated:function setIdAndRelated(obj,opts){opts=opts||{};if(!opts.disableevents)var oldValue=this._getOldValueForSetChangeEvent();if(obj){if(util.isArray(obj)){this.related=obj}else{this.related=obj}}else{this.related=null}if(!opts.disableevents)this.registerSetChange(obj,oldValue)},checkInstalled:function checkInstalled(){if(!this.object){throw new InternalSiestaError("Proxy must be installed on an object before can use it.")}},splicer:function splicer(opts){opts=opts||{};return function(idx,numRemove){opts=opts||{};if(!opts.disableevents){var added=this._getAddedForSpliceChangeEvent(arguments),removed=this._getRemovedForSpliceChangeEvent(idx,numRemove)}var add=Array.prototype.slice.call(arguments,2);var res=this.related.splice.bind(this.related,idx,numRemove).apply(this.related,add);if(!opts.disableevents)this.registerSpliceChange(idx,added,removed);return res}.bind(this)},clearReverseRelated:function clearReverseRelated(opts){opts=opts||{};var self=this;if(this.related){var reverseProxy=this.reverseProxyForInstance(this.related);var reverseProxies=util.isArray(reverseProxy)?reverseProxy:[reverseProxy];reverseProxies.forEach(function(p){if(util.isArray(p.related)){var idx=p.related.indexOf(self.object);p.makeChangesToRelatedWithoutObservations(function(){p.splicer(opts)(idx,1)})}else{p.setIdAndRelated(null,opts)}})}},setIdAndRelatedReverse:function setIdAndRelatedReverse(obj,opts){var self=this;var reverseProxy=this.reverseProxyForInstance(obj);var reverseProxies=util.isArray(reverseProxy)?reverseProxy:[reverseProxy];reverseProxies.forEach(function(p){if(util.isArray(p.related)){p.makeChangesToRelatedWithoutObservations(function(){p.splicer(opts)(p.related.length,0,self.object)})}else{p.clearReverseRelated(opts);p.setIdAndRelated(self.object,opts)}})},makeChangesToRelatedWithoutObservations:function makeChangesToRelatedWithoutObservations(f){if(this.related){this.related.arrayObserver.close();this.related.arrayObserver=null;f();this.wrapArray(this.related)}else{f()}},_getOldValueForSetChangeEvent:function _getOldValueForSetChangeEvent(){var oldValue=this.related;if(util.isArray(oldValue)&&!oldValue.length){oldValue=null}return oldValue},registerSetChange:function registerSetChange(newValue,oldValue){var proxyObject=this.object;if(!proxyObject)throw new InternalSiestaError("Proxy must have an object associated");var model=proxyObject.model.name;var collectionName=proxyObject.collectionName;modelEvents.emit({collection:collectionName,model:model,localId:proxyObject.localId,field:this.getForwardName(),old:oldValue,"new":newValue,type:ModelEventType.Set,obj:proxyObject})},_getRemovedForSpliceChangeEvent:function _getRemovedForSpliceChangeEvent(idx,numRemove){var removed=this.related?this.related.slice(idx,idx+numRemove):null;return removed},_getAddedForSpliceChangeEvent:function _getAddedForSpliceChangeEvent(args){var add=Array.prototype.slice.call(args,2),added=add.length?add:[];return added},registerSpliceChange:function registerSpliceChange(idx,added,removed){var model=this.object.model.name,coll=this.object.collectionName;modelEvents.emit({collection:coll,model:model,localId:this.object.localId,field:this.getForwardName(),index:idx,removed:removed,added:added,type:ModelEventType.Splice,obj:this.object})},wrapArray:function wrapArray(arr){var self=this;wrapArrayForAttributes(arr,this.reverseName,this.object);if(!arr.arrayObserver){arr.arrayObserver=new ArrayObserver(arr);var observerFunction=function observerFunction(splices){splices.forEach(function(splice){var added=splice.addedCount?arr.slice(splice.index,splice.index+splice.addedCount):[];var model=self.getForwardModel();modelEvents.emit({collection:model.collectionName,model:model.name,localId:self.object.localId,field:self.getForwardName(),removed:splice.removed,added:added,type:ModelEventType.Splice,obj:self.object})})};arr.arrayObserver.open(observerFunction)}},splice:function splice(){this.splicer({}).apply(this,arguments)}});module.exports=RelationshipProxy},function(module,exports,__webpack_require__){"use strict";var RelationshipProxy=__webpack_require__(34),util=__webpack_require__(4),SiestaModel=__webpack_require__(21);function OneToOneProxy(opts){RelationshipProxy.call(this,opts)}OneToOneProxy.prototype=Object.create(RelationshipProxy.prototype);util.extend(OneToOneProxy.prototype,{validate:function validate(obj){if(Object.prototype.toString.call(obj)=="[object Array]"){return"Cannot assign array to one to one relationship"}else if(!obj instanceof SiestaModel){}return null},set:function set(obj,opts){this.checkInstalled();if(obj){var errorMessage;if(errorMessage=this.validate(obj)){return errorMessage}else{this.clearReverseRelated(opts);this.setIdAndRelated(obj,opts);this.setIdAndRelatedReverse(obj,opts)}}else{this.clearReverseRelated(opts);this.setIdAndRelated(obj,opts)}},get:function get(cb){return util.promise(cb,function(cb){cb(null,this.related)}.bind(this))}});module.exports=OneToOneProxy},function(module,exports,__webpack_require__){"use strict";var RelationshipProxy=__webpack_require__(34),util=__webpack_require__(4),modelEvents=__webpack_require__(22),events=__webpack_require__(23),wrapArrayForAttributes=events.wrapArray,ArrayObserver=__webpack_require__(5).ArrayObserver,ModelEventType=__webpack_require__(22).ModelEventType;function ManyToManyProxy(opts){RelationshipProxy.call(this,opts);this.related=[];this.relatedCancelListeners={};if(this.isReverse){this.related=[]}}ManyToManyProxy.prototype=Object.create(RelationshipProxy.prototype);util.extend(ManyToManyProxy.prototype,{clearReverse:function clearReverse(removed){var self=this;removed.forEach(function(removedObject){var reverseProxy=self.reverseProxyForInstance(removedObject);var idx=reverseProxy.related.indexOf(self.object);reverseProxy.makeChangesToRelatedWithoutObservations(function(){reverseProxy.splice(idx,1)})})},setReverseOfAdded:function setReverseOfAdded(added){var self=this;added.forEach(function(addedObject){var reverseProxy=self.reverseProxyForInstance(addedObject);reverseProxy.makeChangesToRelatedWithoutObservations(function(){reverseProxy.splice(0,0,self.object)})})},wrapArray:function wrapArray(arr){var self=this;wrapArrayForAttributes(arr,this.reverseName,this.object);if(!arr.arrayObserver){arr.arrayObserver=new ArrayObserver(arr);var observerFunction=function observerFunction(splices){splices.forEach(function(splice){var added=splice.addedCount?arr.slice(splice.index,splice.index+splice.addedCount):[];var removed=splice.removed;self.clearReverse(removed);self.setReverseOfAdded(added);var model=self.getForwardModel();modelEvents.emit({collection:model.collectionName,model:model.name,localId:self.object.localId,field:self.getForwardName(),removed:removed,added:added,type:ModelEventType.Splice,index:splice.index,obj:self.object})})};arr.arrayObserver.open(observerFunction)}},get:function get(cb){return util.promise(cb,function(cb){cb(null,this.related)}.bind(this))},validate:function validate(obj){if(Object.prototype.toString.call(obj)!="[object Array]"){return"Cannot assign scalar to many to many"}return null},set:function set(obj,opts){this.checkInstalled();var self=this;if(obj){var errorMessage;if(errorMessage=this.validate(obj)){return errorMessage}else{this.clearReverseRelated(opts);self.setIdAndRelated(obj,opts);this.wrapArray(obj);self.setIdAndRelatedReverse(obj,opts)}}else{this.clearReverseRelated(opts);self.setIdAndRelated(obj,opts)}},install:function install(obj){RelationshipProxy.prototype.install.call(this,obj);this.wrapArray(this.related);obj["splice"+util.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this)},registerRemovalListener:function registerRemovalListener(obj){this.relatedCancelListeners[obj.localId]=obj.on("*",function(e){}.bind(this))}});module.exports=ManyToManyProxy}]);

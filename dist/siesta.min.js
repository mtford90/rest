(function e$$0(r,q,g){function p(m,d){if(!q[m]){if(!r[m]){var h="function"==typeof require&&require;if(!d&&h)return h(m,!0);if(n)return n(m,!0);h=Error("Cannot find module '"+m+"'");throw h.code="MODULE_NOT_FOUND",h;}h=q[m]={exports:{}};r[m][0].call(h.exports,function(f){var b=r[m][1][f];return p(b?b:f)},h,h.exports,e$$0,r,q,g)}return q[m].exports}for(var n="function"==typeof require&&require,h=0;h<g.length;h++)p(g[h]);return p})({1:[function(e,r,q){function g(a){p.call(this,a);this.indexAttribute=
"index"}var p=e("./reactiveQuery");q=e("./log");var n=e("./util"),h=e("./error"),m=e("./modelEvents"),d=h.InternalSiestaError,v=e("./querySet"),f=h.errorFactory(h.Components.ArrangedReactiveQuery),b=n._;q.loggerWithName("Query");g.prototype=Object.create(p.prototype);b.extend(g.prototype,{_refreshIndexes:function(){var a=this.results,c=this.indexAttribute;if(!a)throw new d("ArrangedReactiveQuery must be initialised");for(var k=0;k<a.length;k++)a[k][c]=k},_mergeIndexes:function(){for(var a=this.results,
c=[],k=[],l=[],t=0;t<a.length;t++){var y=a[t],f=y[this.indexAttribute];void 0==f?l.push(y):f>a.length?k.push(y):c[f]?l.push(y):c[f]=y}k=b.sortBy(k,function(a){return a[this.indexAttribute]}.bind(this));for(t=0;t<k.length;t++)y=k[t],a=this.results.length-k.length+t,y[this.indexAttribute]=a,c[a]=y;l=this._query._sortResults(l);for(k=0;l.length;){for(y=l.shift();c[k];)k++;c[k]=y;y[this.indexAttribute]=k}this.results=v(c,this.model)},init:function(a){var c=n.defer(a);p.prototype.init.call(this,function(a){a||
(this.model.hasAttributeNamed(this.indexAttribute)?(this._mergeIndexes(),this._query.clearOrdering()):a=f('Model "'+this.model.name+'" does not have an attribute named "'+this.indexAttribute+'"'));c.finish(a,a?null:this.results)}.bind(this));return c.promise},_handleNotif:function(a){a.field!=this.indexAttribute&&(p.prototype._handleNotif.call(this,a),this._refreshIndexes())},validateIndex:function(a){var c=this.results.length-1;if(!(0<=a&&a<=c))throw Error("Index "+a.toString()+" is out of bounds");
},swapObjectsAtIndexes:function(a,c){this.validateIndex(a);this.validateIndex(c);var k=this.results[a],l=this.results[c];if(!k)throw Error('No model at index "'+a.toString()+'"');if(!l)throw Error('No model at index "'+c.toString()+'"');this.results[c]=k;this.results[a]=l;k[this.indexAttribute]=c;l[this.indexAttribute]=a},swapObjects:function(a,c){var k=this.results.indexOf(a),l=this.results.indexOf(c);this.swapObjectsAtIndexes(k,l)},move:function(a,c){this.validateIndex(a);this.validateIndex(c);
var k=this.results.mutableCopy();(function(a,c){if(c>=this.length)for(var k=c-this.length;k--+1;)this.push(void 0)}).call(k,a,c);var l=k.splice(a,1)[0];this.emit("change",this.results=k.asModelQuerySet(this.model),{index:a,removed:[l],type:m.ModelEventType.Splice,obj:this,field:"results"});k.splice(c,0,l);this.emit("change",this.results=k.asModelQuerySet(this.model),{index:c,added:[l],type:m.ModelEventType.Splice,obj:this,field:"results"});this._refreshIndexes()}});r.exports=g},{"./error":11,"./log":14,
"./modelEvents":18,"./querySet":23,"./reactiveQuery":24,"./util":28}],2:[function(e,r,q){function g(d){var f=this;this.model=d;p.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]);m.ProxyEventEmitter.call(this);Object.defineProperties(this,{_relationshipNames:{get:function(){var b=n.map(Object.keys(f.__proxies||{}),function(a){return f.__proxies[a]});return n.map(b,function(a){return a.isForward?a.forwardName:
a.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return f._id in siesta.ext.storage._unsavedObjectsHash},enumerable:!0},event:{get:function(){return this._id}}});this.removed=!1}e("./log");var p=e("./util"),n=p._;e("./error");var h=e("./modelEvents"),m=e("./events"),d=e("./cache");g.prototype=Object.create(m.ProxyEventEmitter.prototype);n.extend(g.prototype,{get:function(d){var f=p.defer(d);d=f.finish.bind(f);d(null,this);return f.promise},emit:function(d,
f){"object"==typeof d?f=d:f.type=d;f=f||{};n.extend(f,{collection:this.collectionName,model:this.model.name,_id:this._id,obj:this});h.emit(f)},remove:function(m,f){f=null==f?!0:f;var b=p.defer(m);m=b.finish.bind(b);d.remove(this);this.removed=!0;f&&this.emit(h.ModelEventType.Remove,{old:this});var a=this.model.remove;if(a)if(p.paramNames(a).length){var c=this;a.call(this,function(a){m(a,c)})}else a.call(this),m(null,this);else m(null,this);return b.promise},restore:function(m){var f=p.defer(m);m=
f.finish.bind(f);var b=function(a){a||this.emit(h.ModelEventType.New,{"new":this});m(a,this)}.bind(this);if(this.removed){d.insert(this);this.removed=!1;var a=this.model.init;a?p.paramNames(a).length?a.call(this,b):(a.call(this),b()):b()}return f.promise}});n.extend(g.prototype,{getAttributes:function(){return n.extend({},this.__values)},isInstanceOf:function(d){return this.model==d},isA:function(d){return this.model==d||this.model.isDescendantOf(d)}});n.extend(g.prototype,{_dumpString:function(d){return JSON.stringify(this._dump(d,
null,4))},_dump:function(d){d=n.extend({},this.__values);d._rev=this._rev;d._id=this._id;return d}});r.exports=g},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":28}],3:[function(e,r,q){function g(b){p.call(this,b);this.isReverse&&(this.related=[])}var p=e("./RelationshipProxy");e("./store");var n=e("./util"),h=n._;e("./error");var m=e("./modelEvents");e("./modelInstance");var d=e("./events").wrapArray,v=e("../vendor/observe-js/src/observe").ArrayObserver,f=e("./modelEvents").ModelEventType;
g.prototype=Object.create(p.prototype);h.extend(g.prototype,{clearReverse:function(b){var a=this;h.each(b,function(c){a.reverseProxyForInstance(c).setIdAndRelated(null)})},setReverseOfAdded:function(b){var a=this;h.each(b,function(c){a.reverseProxyForInstance(c).setIdAndRelated(a.object)})},wrapArray:function(b){var a=this;d(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new v(b),b.arrayObserver.open(function(c){c.forEach(function(c){var l=c.addedCount?b.slice(c.index,c.index+c.addedCount):
[],t=c.removed;a.clearReverse(t);a.setReverseOfAdded(l);var y=a.getForwardModel();m.emit({collection:y.collectionName,model:y.name,_id:a.object._id,field:a.getForwardName(),removed:t,added:l,type:f.Splice,index:c.index,obj:a.object})})}))},get:function(b){var a=n.defer(b);b=a.finish.bind(a);b(null,this.related);return a.promise},validate:function(b){b=Object.prototype.toString.call(b);if(this.isForward){if("[object Array]"==b)return"Cannot assign array forward oneToMany ("+b+"): "+this.forwardName}else if("[object Array]"!=
b)return"Cannot scalar to reverse oneToMany ("+b+"): "+this.reverseName;return null},set:function(b,a){this.checkInstalled();if(b){var c;if(c=this.validate(b))return c;this.clearReverseRelated(a);this.setIdAndRelated(b,a);this.isReverse&&this.wrapArray(this.related);this.setIdAndRelatedReverse(b,a)}else this.clearReverseRelated(a),this.setIdAndRelated(b,a)},install:function(b){p.prototype.install.call(this,b);this.isReverse&&(b["splice"+n.capitaliseFirstLetter(this.reverseName)]=h.bind(this.splice,
this),this.wrapArray(this.related))}});r.exports=g},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],4:[function(e,r,q){function g(h){p.call(this,h)}var p=e("./RelationshipProxy");e("./store");var n=e("./util");q=n._;e("./error");e("./modelEvents");e("./modelInstance");g.prototype=Object.create(p.prototype);q.extend(g.prototype,{validate:function(h){return"[object Array]"==Object.prototype.toString.call(h)?
"Cannot assign array to one to one relationship":null},set:function(h,m){this.checkInstalled();if(h){var d;if(d=this.validate(h))return d;this.clearReverseRelated(m);this.setIdAndRelated(h,m);this.setIdAndRelatedReverse(h,m)}else this.clearReverseRelated(m),this.setIdAndRelated(h,m)},get:function(h){var m=n.defer(h);h=m.finish.bind(m);h(null,this.related);return m.promise}});r.exports=g},{"./RelationshipProxy":6,"./error":11,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],5:[function(e,
r,q){function g(a,c){var k={},l;for(l in c)c.hasOwnProperty(l)&&"__"==l.slice(0,2)&&(k[l.slice(2)]=c[l],delete c[l]);f.extend(this,{model:a,query:c,opts:k});k.order=k.order||[];h.isArray(k.order)||(k.order=[k.order])}function p(a){var c=a.name;a=n._localCacheByType[a.collectionName];var k;a&&(k=a[c]||{});return k}q=e("./log");var n=e("./cache"),h=e("./util"),m=e("./error"),d=e("./querySet"),v=m.errorFactory(m.Components.Query),f=h._,b=q.loggerWithName("Query");f.extend(g,{comparators:{e:function(a){var c=
a.object[a.field];b.trace&&b.trace(a.field+": "+(null===c?"null":void 0===c?"undefined":c.toString())+" == "+a.value.toString());return c==a.value},lt:function(a){return a.invalid?!1:a.object[a.field]<a.value},gt:function(a){return a.invalid?!1:a.object[a.field]>a.value},lte:function(a){return a.invalid?!1:a.object[a.field]<=a.value},gte:function(a){return a.invalid?!1:a.object[a.field]>=a.value},contains:function(a){return a.invalid?!1:-1<a.object[a.field].indexOf(a.value)}},registerComparator:function(a,
c){this.comparators[a]||(this.comparators[a]=c)}});f.extend(g.prototype,{execute:function(a){var c=h.defer(a);a=c.finish.bind(c);this._executeInMemory(a);return c.promise},_dump:function(a){return a?"{}":{}},sortFunc:function(a){for(var c=function(a,c){return function(t,k){var l=t[c],b=k[c];"string"==typeof l||l instanceof String&&"string"==typeof b||b instanceof String?l=a?l.localeCompare(b):b.localeCompare(l):(l instanceof Date&&(l=l.getTime()),b instanceof Date&&(b=b.getTime()),l=a?l-b:b-l);return l}},
k=h,l=0;l<a.length;l++)var t=a[l],k=k.thenBy(c(t.ascending,t.field));return k==h?null:k},_sortResults:function(a){var c=this.opts.order;a&&c&&(c=f.map(c,function(a){a=a.split("-");var c=!0,t=null;1<a.length?(t=a[1],c=!1):t=a[0];return{field:t,ascending:c}}.bind(this)),c=this.sortFunc(c),a.immutable&&(a=a.mutableCopy()),c&&a.sort(c));return a},_getCacheByLocalId:function(){return f.reduce(this.model.descendants,function(a,c){return f.extend(a,p(c))},f.extend({},p(this.model)))},_executeInMemory:function(a){var c=
function(){for(var c=this._getCacheByLocalId(),l=Object.keys(c),t=[],b,f=0;f<l.length;f++){var m=c[l[f]],h=this.objectMatchesQuery(m);if("string"==typeof h){b=v(h);break}else h&&t.push(m)}t=this._sortResults(t);a(b,b?null:d(t,this.model))}.bind(this);this.opts.ignoreInstalled?c():siesta._afterInstall(c)},clearOrdering:function(){this.opts.order=null},objectMatchesOrQuery:function(a,c){for(var k in c)if(c.hasOwnProperty(k)&&this.objectMatchesBaseQuery(a,c[k]))return!0;return!1},objectMatchesAndQuery:function(a,
c){for(var k in c)if(c.hasOwnProperty(k)&&!this.objectMatchesBaseQuery(a,c[k]))return!1;return!0},splitMatches:function(a,c,k){var l="e",t=c.split("."),b=t[t.length-1].split("__");2==b.length?(c=b[0],l=b[1]):c=b[0];t[t.length-1]=c;f.each(t.slice(0,t.length-1),function(c){a=a[c]});t=a[c];return(b=g.comparators[l])?b({object:a,field:c,value:k,invalid:null===t||void 0===t}):'No comparator registered for query operation "'+l+'"'},objectMatches:function(a,c,b,l){if("$or"==c){if(!this.objectMatchesOrQuery(a,
l.$or))return!1}else if("$and"==c){if(!this.objectMatchesAndQuery(a,l.$and))return!1}else{a=this.splitMatches(a,c,b);if("boolean"!=typeof a)return a;if(!a)return!1}return!0},objectMatchesBaseQuery:function(a,c){for(var b=Object.keys(c),l=0;l<b.length;l++){var t=b[l],t=this.objectMatches(a,t,c[t],c);if("boolean"!=typeof t)return t;if(!t)return!1}return!0},objectMatchesQuery:function(a){return this.objectMatchesBaseQuery(a,this.query)}});r.exports=g},{"./cache":8,"./error":11,"./log":14,"./querySet":23,
"./util":28}],6:[function(e,r,q){function g(b){var a=this;b=b||{};h.extend(this,{object:null,related:null});Object.defineProperties(this,{isForward:{get:function(){return!a.isReverse},set:function(c){a.isReverse=!c},enumerable:!0}});n.extendFromOpts(this,b,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null});this.cancelListens={}}var p=e("./error").InternalSiestaError;e("./store");var n=e("./util"),h=n._;e("./query");e("./log");e("./cache");var m=e("./events").wrapArray,
d=e("../vendor/observe-js/src/observe").ArrayObserver,v=e("./modelEvents"),f=v.ModelEventType;h.extend(g,{});h.extend(g.prototype,{install:function(b){if(b){if(this.object)throw new p("Already installed.");this.object=b;var a=this,c=this.getForwardName();Object.defineProperty(b,c,{get:function(){return a.related},set:function(c){a.set(c)},configurable:!0,enumerable:!0});b.__proxies||(b.__proxies={});b.__proxies[c]=this;b._proxies||(b._proxies=[]);b._proxies.push(this)}else throw new p("No object passed to relationship install");
}});h.extend(g.prototype,{set:function(b,a){throw new p("Must subclass RelationshipProxy");},get:function(b){throw new p("Must subclass RelationshipProxy");}});h.extend(g.prototype,{proxyForInstance:function(b,a){var c=a?this.getReverseName():this.getForwardName(),k=a?this.reverseModel:this.forwardModel;if(n.isArray(b))k=h.map(b,function(a){return a.__proxies[c]});else{var l=b.__proxies[c];if(!l)throw new p('No proxy with name "'+c+'" on mapping '+k.name);k=l}return k},reverseProxyForInstance:function(b){return this.proxyForInstance(b,
!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},clearRemovalListener:function(b){b=b._id;var a=this.cancelListens[b];a&&(a(),this.cancelListens[b]=null)},listenForRemoval:function(b){this.cancelListens[b._id]=b.listen(function(a){a.type==f.Remove&&(n.isArray(this.related)?(a=this.related.indexOf(b),
this.splice(a,1)):this.setIdAndRelated(null),this.clearRemovalListener(b))}.bind(this))},setIdAndRelated:function(b,a){a=a||{};a.disableevents||this.registerSetChange(b);var c=this.related;c&&this.clearRemovalListener(c);b?n.isArray(b)?(this.related=b,b.forEach(function(a){this.listenForRemoval(a)}.bind(this))):(this.related=b,this.listenForRemoval(b)):this.related=null},checkInstalled:function(){if(!this.object)throw new p("Proxy must be installed on an object before can use it.");},splicer:function(b){b=
b||{};return function(a,c){b=b||{};b.disableevents||this.registerSpliceChange.apply(this,arguments);var k=Array.prototype.slice.call(arguments,2);return h.partial(this.related.splice,a,c).apply(this.related,k)}.bind(this)},clearReverseRelated:function(b){b=b||{};var a=this;if(this.related){var c=this.reverseProxyForInstance(this.related),c=n.isArray(c)?c:[c];h.each(c,function(c){if(n.isArray(c.related)){var l=c.related.indexOf(a.object);c.makeChangesToRelatedWithoutObservations(function(){c.splicer(b)(l,
1)})}else c.setIdAndRelated(null,b)})}},setIdAndRelatedReverse:function(b,a){var c=this,k=this.reverseProxyForInstance(b),k=n.isArray(k)?k:[k];h.each(k,function(l){n.isArray(l.related)?l.makeChangesToRelatedWithoutObservations(function(){l.splicer(a)(l.related.length,0,c.object)}):(l.clearReverseRelated(a),l.setIdAndRelated(c.object,a))})},makeChangesToRelatedWithoutObservations:function(b){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,b(),this.wrapArray(this.related)):
b()},registerSetChange:function(b){var a=this.object;if(!a)throw new p("Proxy must have an object associated");var c=a.model.name,k=a.collectionName,l=this.related;n.isArray(l)&&!l.length&&(l=null);v.emit({collection:k,model:c,_id:a._id,field:this.getForwardName(),old:l,"new":b,type:f.Set,obj:a})},registerSpliceChange:function(b,a){var c=Array.prototype.slice.call(arguments,2);v.emit({collection:this.object.collectionName,model:this.object.model.name,_id:this.object._id,field:this.getForwardName(),
index:b,removed:this.related?this.related.slice(b,b+a):null,added:c.length?c:[],type:f.Splice,obj:this.object})},wrapArray:function(b){var a=this;m(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new d(b),b.arrayObserver.open(function(c){c.forEach(function(c){var l=c.addedCount?b.slice(c.index,c.index+c.addedCount):[],t=a.getForwardModel();v.emit({collection:t.collectionName,model:t.name,_id:a.object._id,field:a.getForwardName(),removed:c.removed,added:l,type:f.Splice,obj:a.object})})}))},
splice:function(){this.splicer({}).apply(this,arguments)}});r.exports=g},{"../vendor/observe-js/src/observe":44,"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":22,"./store":26,"./util":28}],7:[function(e,r,q){r.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},{}],8:[function(e,r,q){function g(a){var c=a.name;if(a=k[a.collectionName])if(c=a[c]){a=[];for(var l in c)c.hasOwnProperty(l)&&a.push(c[l]);if(1<a.length)throw new f("A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.");
if(a.length)return a[0]}return null}function p(c,b){var k=b.model.name,f=b.model.collectionName;if(l[f]&&(k=l[f][k]))return(k=k[c])?a.debug&&a.debug("Remote cache hit: "+k._dump(!0)):a.debug&&a.debug("Remote cache miss: "+c),k;a.debug&&a.debug("Remote cache miss: "+c);return null}function n(c,b,k){if(c){var d=c.model.collectionName;if(d){l[d]||(l[d]={});var m=c.model.name;if(m)if(l[d][m]||(l[d][m]={}),k&&(l[d][m][k]=null),k=l[d][m][b]){if(c!=k)throw b="Object "+d.toString()+":"+m.toString()+"["+c.model.id+
'="'+b+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild',a.error(b,{obj:c,cachedObject:k}),new f(b);a.debug.isEnabled&&a.debug("Object has already been inserted: "+c._dump(!0))}else l[d][m][b]=c,a.debug.isEnabled&&a.debug("Remote cache insert: "+c._dump(!0)),a.trace.isEnabled&&a.trace("Remote cache now looks like: "+h(!0));else throw new f("Model has no type",{model:c.model,obj:c});}else throw new f("Model has no collection",
{model:c.model,obj:c});}else throw a.error("Must pass an object when inserting to cache"),new f("Must pass an object when inserting to cache");}function h(a){var c={},k;for(k in l)if(l.hasOwnProperty(k)){var f={};c[k]=f;var d=l[k],m;for(m in d)if(d.hasOwnProperty(m)){var h={};f[m]=h;var g=d[m],e;for(e in g)g.hasOwnProperty(e)&&g[e]&&(h[e]=g[e]._dump())}}return a?b.prettyPrint((c,null,4)):c}function m(a){var l={},k;for(k in c)c.hasOwnProperty(k)&&(l[k]=c[k]._dump());return a?b.prettyPrint((l,null,
4)):l}function d(b){a.debug.isEnabled&&a.debug("get",b);var l,k;if(l=b._id){(k=c[l])?a.debug.isEnabled&&a.debug("Local cache hit: "+k._dump(!0)):a.debug.isEnabled&&a.debug("Local cache miss: "+l);if(k)return k;if(b.model)return l=b.model.id,k=b[l],a.debug.isEnabled&&a.debug(l+"="+k),p(k,b)}else if(b.model){l=b.model.id;if(k=b[l])return p(k,b);if(b.model.singleton)return g(b.model)}else a.warn("Invalid opts to cache",{opts:b});return null}function v(a){var c={_id:a._id},b=a.model;b.id&&a[b.id]&&(c.model=
b,c[b.id]=a[b.id]);return!!d(c)}r=e("./log");var f=e("./error").InternalSiestaError,b=e("./util"),a=r.loggerWithName("Cache"),c={},k={},l={};q._remoteCache=function(){return l};q._localCache=function(){return c};Object.defineProperty(q,"_localCacheByType",{get:function(){return k}});q.get=d;q.insert=function(b){var l=b._id;if(l){var d=b.model.collectionName,h=b.model.name;a.debug.isEnabled&&a.debug("Local cache insert: "+b._dumpString());if(!c[l])c[l]=b,a.trace.isEnabled&&a.trace("Local cache now looks like: "+
m(!0)),k[d]||(k[d]={}),k[d][h]||(k[d][h]={}),k[d][h][l]=b;else if(c[l]!=b)throw b='Object with _id="'+l.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild',a.error(b),new f(b);}l=b.idField;(d=b[l])?n(b,d):a.debug.isEnabled&&a.debug('No remote id ("'+l+'") so wont be placing in the remote cache',b)};q.remoteInsert=n;q.reset=function(){l={};c={};k={}};q._dump=function(a){var c={localCache:m(),remoteCache:h()};return a?
b.prettyPrint((c,null,4)):c};q.contains=v;q.remove=function(a){if(v(a)){var b=a.model.collectionName,d=a.model.name,m=a._id;if(!d)throw f("No mapping name");if(!b)throw f("No collection name");if(!m)throw f("No _id");delete k[b][d][m];delete c[m];a.model.id&&(a=a[a.model.id])&&delete l[b][d][a]}else throw new f("Object was not in cache.");};q.getSingleton=g},{"./error":11,"./log":14,"./util":28}],9:[function(e,r,q){function g(a,c){var b=this;if(!a)throw Error("Collection must have a name");c=c||{};
v.extendFromOpts(this,c,{baseURL:""});f.extend(this,{name:a,_rawModels:{},_models:{},_opts:c,installed:!1});Object.defineProperties(this,{dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection[b.name]||{}).length},enumerable:!0}});p.register(this);d.ProxyEventEmitter.call(this,this.name)}q=e("./log");var p=e("./collectionRegistry").CollectionRegistry,n=e("./error").InternalSiestaError,h=e("./model"),m=e("extend");e("../vendor/observe-js/src/observe");
var d=e("./events"),v=e("./util"),f=v._,b=e("./error"),a=b.errorFactory(b.Components.Collection);e("./cache");var c=["PUT","PATCH","POST","DELETE"],k=q.loggerWithName("Collection");g.prototype=Object.create(d.ProxyEventEmitter.prototype);f.extend(g.prototype,{install:function(a){var c=v.defer(a),b=this;if(this.installed)throw new n('Collection "'+this.name+'" has already been installed');var d=[],m;for(m in this._models)this._models.hasOwnProperty(m)&&d.push(this._models[m]);k.info.isEnabled&&k.info("There are "+
d.length.toString()+" mappings to install");d.length?(a=f.map(d,function(a){return f.bind(a.install,a)}),v.async.parallel(a,function(a){if(a)k.error("Failed to install collection",a);else{b.installed=!0;var l=[];f.each(d,function(a){k.info.isEnabled&&k.info('Installing relationships for mapping with name "'+a.name+'"');(a=a.installRelationships())&&l.push(a)});l.length||f.each(d,function(a){k.info.isEnabled&&k.info('Installing reverse relationships for mapping with name "'+a.name+'"');(a=a.installReverseRelationships())&&
l.push(a)});1==l.length?a=l[0]:l.length&&(a=l)}b._finaliseInstallation(a,c.finish.bind(c))})):b._finaliseInstallation(null,c.finish.bind(c));return c.promise},_finaliseInstallation:function(c,b){c&&(c=a("Errors were encountered whilst setting up the collection",{errors:c}));c||(this.installed=!0,e("./index")[this.name]=this);b(c)},_model:function(a,c){if(a){this._rawModels[a]=c;c=m(!0,{},c);c.name=a;c.collection=this;var b=new h(c);this._models[a]=b;return this[a]=b}throw Error("No name specified when creating mapping");
},model:function(){if(this.installed)throw Error("Cannot create new models once the object graph is established!");var a=this;return arguments.length?1==arguments.length?v.isArray(arguments[0])?f.map(arguments[0],function(c){return a._model(c.name,c)}):this._model(arguments[0].name,arguments[0]):"string"==typeof arguments[0]?this._model(arguments[0],arguments[1]):f.map(arguments,function(c){return a._model(c.name,c)}):null},descriptor:function(a){var b=[];if(siesta.ext.httpEnabled){a.collection=this;
var k=a.model;if(!k)throw Error("All descriptors must have a model");if("string"==typeof k||k instanceof String)k=this._models[k];if(!k)throw Error("You are attempting to define a descriptor a model which is not part of this collection");for(var d=siesta.ext.http._resolveMethod(a.method),f=[],k=[],h=0;h<d.length;h++){var g=d[h];-1<c.indexOf(g)?f.push(g):k.push(g)}f.length&&(d=m({},a),d.method=f,d=new siesta.ext.http.RequestDescriptor(d),siesta.ext.http.DescriptorRegistry.registerRequestDescriptor(d),
b.push(d));k.length&&(a=m({},a),a.method=k,a=new siesta.ext.http.ResponseDescriptor(a),siesta.ext.http.DescriptorRegistry.registerResponseDescriptor(a),b.push(a))}else throw Error("HTTP module not installed.");return b},_dump:function(a){var c={};c.installed=this.installed;c.docId=this._docId;c.name=this.name;c.baseURL=this.baseURL;return a?v.prettyPrint(c):c},count:function(a){var c=v.defer(a);a=f.map(this._models,function(a){return f.bind(a.count,a)});v.async.parallel(a,function(a,b){var k;a||(k=
f.reduce(b,function(a,c){return a+c},0));c.finish(a,k)});return c.promise}});r.exports=g},{"../vendor/observe-js/src/observe":44,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./index":13,"./log":14,"./model":17,"./util":28,extend:42}],10:[function(e,r,q){function g(){if(!this)return new g;this.collectionNames=[]}var p=e("./util")._;p.extend(g.prototype,{register:function(g){var h=g.name;this[h]=g;this.collectionNames.push(h)},reset:function(){var g=this;p.each(this.collectionNames,
function(h){delete g[h]});this.collectionNames=[]}});q.CollectionRegistry=new g},{"./util":28}],11:[function(e,r,q){function g(h,m,d){this.message=h;this.context=m;(d=d||arguments.callee)&&Error.captureStackTrace&&Error.captureStackTrace(this,d)}function p(h,m,d){d=d||{};this.component=h;this.message=m;for(var g in d)d.hasOwnProperty(g)&&(this[g]=d[g]);this.isUserError=!0}g.prototype=Object.create(Error.prototype);g.prototype.name="InternalSiestaError";g.prototype.constructor=g;e={Unknown:0,NoDescriptorMatched:1};
var n={Mapping:"Mapping",HTTP:"HTTP",ReactiveQuery:"ReactiveQuery",ArrangedReactiveQuery:"ArrangedReactiveQuery",Collection:"Collection",Query:"Query"};q={};q[e.NoDescriptorMatched]="No descriptor matched the HTTP response/request.";r.exports={InternalSiestaError:g,SiestaUserError:p,ErrorCode:e,ErrorField:{Message:"message",Code:"code"},Message:q,Components:n,errorFactory:function(h){if(h in n)return function(m,d){return new p(h,m,d)};throw new p('No such component "'+h+'"');}}},{}],12:[function(e,
r,q){function g(d){n.extend(this,{event:d,listeners:{}})}q=e("events").EventEmitter;var p=e("../vendor/observe-js/src/observe").ArrayObserver,n=e("./util")._,h=e("./modelEvents"),m=new q;m.setMaxListeners(100);n.extend(g.prototype,{listen:function(d,h){if("function"==typeof d)h=d,d=null;else{var f=h;h=function(a){a=a||{};d?a.type==d&&f(a):f(a)};var b=this.listeners;d&&(b[d]||(b[d]=[]),b[d].push(h))}m.on(this.event,h);return function(){this._removeListener(h,d)}.bind(this)},listenOnce:function(d,h){var f=
this.event;if("function"==typeof d)h=d,d=null;else{var b=h;h=function(a){a=a||{};d?a.type==d&&(m.removeListener(f,h),b(a)):b(a)}}return d?m.on(f,h):m.once(f,h)},_removeListener:function(d,h){if(h){var f=this.listeners[h],b=f.indexOf(d);f.splice(b,1)}return m.removeListener(this.event,d)},emit:function(d,h){"object"==typeof d?h=d:(h=h||{},h.type=d);m.emit.call(m,this.event,h)},_removeAllListeners:function(d){(this.listeners[d]||[]).forEach(function(d){m.removeListener(this.event,d)}.bind(this));this.listeners[d]=
[]},removeAllListeners:function(d){if(d)this._removeAllListeners(d);else for(d in this.listeners)this.listeners.hasOwnProperty(d)&&this._removeAllListeners(d)}});n.extend(g.prototype,{on:g.prototype.listen});n.extend(m,{ProxyEventEmitter:g,wrapArray:function(d,m,f){d.observer||(d.observer=new p(d),d.observer.open(function(b){-1<f._attributeNames.indexOf(m)&&b.forEach(function(a){h.emit({collection:f.collectionName,model:f.model.name,_id:f._id,index:a.index,removed:a.removed,added:a.addedCount?d.slice(a.index,
a.index+a.addedCount):[],type:h.ModelEventType.Splice,field:m,obj:f})})}))}});r.exports=m},{"../vendor/observe-js/src/observe":44,"./modelEvents":18,"./util":28,events:38}],13:[function(e,r,q){var g=e("./util"),p=e("./collectionRegistry").CollectionRegistry,n=e("./collection"),h=e("./cache");q=e("./model");var m=e("./error"),d=e("./events"),v=e("./RelationshipType"),f=e("./reactiveQuery"),b=e("./manyToManyProxy"),a=e("./oneToOneProxy"),c=e("./oneToManyProxy"),k=e("./relationshipProxy"),l=e("./modelEvents"),
t=e("./Query"),y=e("./querySet"),C=e("./log"),A=g._,x=function(a){x.ext||(x.ext={});A.extend(x.ext,a||{});return x};Object.defineProperty(x,"q",{get:function(){return this._q||window.q||window.Q},set:function(a){this._q=a}});A.extend(x,{on:d.on.bind(d),off:d.removeListener.bind(d),once:d.once.bind(d),removeAllListeners:d.removeAllListeners.bind(d)});A.extend(x,{removeListener:x.off,addListener:x.on});A.extend(x,{RelationshipType:v,ModelEventType:l.ModelEventType,log:C.Level,InsertionPolicy:f.InsertionPolicy,
_internal:{log:C,Model:q,error:m,ModelEventType:l.ModelEventType,ModelInstance:e("./modelInstance"),extend:e("extend"),MappingOperation:e("./mappingOperation"),events:d,ProxyEventEmitter:d.ProxyEventEmitter,cache:e("./cache"),modelEvents:l,CollectionRegistry:e("./collectionRegistry").CollectionRegistry,Collection:n,utils:g,util:g,_:g._,querySet:y,observe:e("../vendor/observe-js/src/observe"),Query:t,Store:e("./store"),ManyToManyProxy:b,OneToManyProxy:c,OneToOneProxy:a,RelationshipProxy:k},_:g._,async:g.async,
isArray:g.isArray,isString:g.isString});x.ext={};var w=!1,B=!1;A.extend(x,{reset:function(a){B=w=!1;delete this.queuedTasks;h.reset();p.reset();d.removeAllListeners();x.ext.httpEnabled&&x.ext.http.DescriptorRegistry.reset();x.ext.storageEnabled?x.ext.storage._reset(a):a()},resetData:function(a){var c=g.defer(a);a=c.finish.bind(c);x.ext.storage._reset(function(){var c=[],b=p.collectionNames.reduce(function(a,b){var k=p[b]._models;c.push(b);Object.keys(k).forEach(function(c){var b=k[c];a.push(function(a){b.all(function(c,
b){c||b.remove();a(c)})})});return a},[]);g.async.series([A.partial(g.async.parallel,b)],a)});return c.promise},collection:function(a,c){return new n(a,c)},install:function(a){if(B||w)throw new m.InternalSiestaError("Already installing...");B=!0;var c=g.defer(a);a=c.finish.bind(c);var b=A.map(p.collectionNames,function(a){return function(c){p[a].install(c)}}),k=this;x.async.series(b,function(c){c?a(c):x.ext.storageEnabled?x.ext.storage._load(function(c){c||(w=!0,k.queuedTasks&&k.queuedTasks.execute());
a(c)}):(w=!0,k.queuedTasks&&k.queuedTasks.execute(),a())});return c.promise},_pushTask:function(a){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[];this.execute=function(){this.tasks.forEach(function(a){a()});this.tasks=[]}.bind(this)});this.queuedTasks.tasks.push(a)},_afterInstall:function(a){w?a():(B||this.install(function(a){a&&console.error("Error setting up siesta",a);delete this.queuedTasks}.bind(this)),w?a():this._pushTask(a))},setLogLevel:function(a,c){C.loggerWithName(a).setLevel(c)},
notify:g.next,registerComparator:t.bind(t)});Object.defineProperties(x,{_canChange:{get:function(){return!(B||w)}}});"undefined"!=typeof window&&(window.siesta=x);r.exports=x;e("../http");e("../storage")},{"../http":33,"../storage":43,"../vendor/observe-js/src/observe":44,"./Query":5,"./RelationshipType":7,"./cache":8,"./collection":9,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./manyToManyProxy":15,"./mappingOperation":16,"./model":17,"./modelEvents":18,"./modelInstance":19,
"./oneToManyProxy":20,"./oneToOneProxy":21,"./querySet":23,"./reactiveQuery":24,"./relationshipProxy":25,"./store":26,"./util":28,extend:42}],14:[function(e,r,q){function g(m){if(!this)return new g(m);this.name=m;h[m]=g.Level.warn;this.trace=p(this,n.bind(console.debug?console.debug:console.log,console),g.Level.trace);this.debug=p(this,n.bind(console.debug?console.debug:console.log,console),g.Level.debug);this.info=p(this,n.bind(console.info?console.info:console.log,console),g.Level.info);this.log=
p(this,n.bind(console.log,console),g.Level.info);this.warn=p(this,n.bind(console.warn?console.warn:console.log,console),g.Level.warning);this.error=p(this,n.bind(console.error?console.error:console.log,console),g.Level.error);this.fatal=p(this,n.bind(console.error?console.error:console.log,console),g.Level.fatal)}function p(h,d,g){var f=function(b){h.performLog(d,g,b,arguments)};Object.defineProperty(f,"isEnabled",{get:function(){var b=h.currentLevel();return g>=b},enumerable:!0,configurable:!0});
f.f=d;f.logger=h;f.level=g;return f}var n=e("./util")._,h={};g.Level={trace:0,debug:1,info:2,warning:3,warn:3,error:4,fatal:5};g.LevelText={};g.LevelText[g.Level.trace]="TRACE";g.LevelText[g.Level.debug]="DEBUG";g.LevelText[g.Level.info]="INFO ";g.LevelText[g.Level.warning]="WARN ";g.LevelText[g.Level.error]="ERROR";g.levelAsText=function(h){return this.LevelText[h]};g.loggerWithName=function(h){return new g(h)};g.prototype.currentLevel=function(){var m=h[this.name];return m?m:g.Level.trace};g.prototype.setLevel=
function(m){h[this.name]=m};g.prototype.override=function(h,d,e){var f=this[g.levelAsText(h).trim().toLowerCase()].f,b=Array.prototype.slice.call(arguments,3,arguments.length);this.performLog(f,h,e,b,d)};g.prototype.performLog=function(h,d,e,f,b){if((void 0!==b?b:this.currentLevel())<=d){h=n.partial(h,g.levelAsText(d)+" ["+this.name+"]: "+e);d=[];for(e=0;e<f.length;e++)d[e]=f[e];d.splice(0,1);h.apply(h,d)}};r.exports=g},{"./util":28}],15:[function(e,r,q){function g(b){p.call(this,b);this.related=
[];this.relatedCancelListeners={}}var p=e("./RelationshipProxy");e("./store");var n=e("./util"),h=n._;e("./error");var m=e("./modelEvents"),d=e("./events").wrapArray;e("./modelInstance");var v=e("../vendor/observe-js/src/observe").ArrayObserver,f=e("./modelEvents").ModelEventType;g.prototype=Object.create(p.prototype);h.extend(g.prototype,{clearReverse:function(b){var a=this;h.each(b,function(c){var b=a.reverseProxyForInstance(c),l=b.related.indexOf(a.object);b.makeChangesToRelatedWithoutObservations(function(){b.splice(l,
1)})})},setReverseOfAdded:function(b){var a=this;h.each(b,function(c){var b=a.reverseProxyForInstance(c);b.makeChangesToRelatedWithoutObservations(function(){b.splice(0,0,a.object)})})},wrapArray:function(b){var a=this;d(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new v(b),b.arrayObserver.open(function(c){c.forEach(function(c){var l=c.addedCount?b.slice(c.index,c.index+c.addedCount):[],d=c.removed;a.clearReverse(d);a.setReverseOfAdded(l);var h=a.getForwardModel();m.emit({collection:h.collectionName,
model:h.name,_id:a.object._id,field:a.getForwardName(),removed:d,added:l,type:f.Splice,index:c.index,obj:a.object})})}))},get:function(b){var a=n.defer(b);b=a.finish.bind(a);b(null,this.related);return a.promise},validate:function(b){return"[object Array]"!=Object.prototype.toString.call(b)?"Cannot assign scalar to many to many":null},set:function(b,a){this.checkInstalled();if(b){var c;if(c=this.validate(b))return c;this.clearReverseRelated(a);this.setIdAndRelated(b,a);this.wrapArray(b);this.setIdAndRelatedReverse(b,
a)}else this.clearReverseRelated(a),this.setIdAndRelated(b,a)},install:function(b){p.prototype.install.call(this,b);this.wrapArray(this.related);b["splice"+n.capitaliseFirstLetter(this.reverseName)]=h.bind(this.splice,this)},registerRemovalListener:function(b){this.relatedCancelListeners[b._id]=b.listen(function(a){}.bind(this))}});r.exports=g},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],
16:[function(e,r,q){function g(b){this._opts=b;m.extendFromOpts(this,b,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,callInit:!0});d.extend(this,{errors:[],subTaskResults:{},_newObjects:[]})}var p=e("./store"),n=e("./modelInstance");q=e("./log");e("./error");var h=e("./cache"),m=e("./util"),d=m._,v=m.async;e("./modelEvents");var f=q.loggerWithName("Mapping");f.setLevel(q.Level.trace);d.extend(g.prototype,{mapAttributes:function(){for(var b=0;b<this.data.length;b++){var a=this.data[b],
c=this.objects[b];a!=c&&c&&(d.each(this.model._attributeNames,function(b){void 0!==a[b]&&(this.disableevents?c.__values[b]=a[b]:c[b]=a[b])}.bind(this)),a._rev&&(c._rev=a._rev))}},_map:function(){var b=this,a;this.mapAttributes();var c=d.keys(b.subTaskResults);d.each(c,function(c){for(var l=b.subTaskResults[c],d=l.indexes,l=l.objects,f=b.getRelatedData(c).relatedData,l=m.unflattenArray(l,f),f=0;f<l.length;f++){var h=d[f],g=b.errors[h];a=g?g[c]:null;if(!a){var g=l[f],e=b.objects[h];e&&(a=e.__proxies[c].set(g,
{disableevents:b.disableevents}))&&(b.errors[h]||(b.errors[h]={}),b.errors[h][c]=a)}}})},_lookup:function(b){var a=m.defer(b);b=a.finish.bind(a);for(var c=this,k=[],l=[],t=0;t<this.data.length;t++)if(!this.objects[t]){var g,e=this.data[t];g="string"==typeof e||"number"==typeof e||e instanceof String;e?g?(g={index:t,datum:{}},g.datum[c.model.id]=e,k.push(g)):e instanceof n?this.objects[t]=e:e._id?l.push({index:t,datum:e}):e[c.model.id]?k.push({index:t,datum:e}):this.objects[t]=c._new():this.objects[t]=
null}m.async.parallel([function(a){var b=d.pluck(d.pluck(l,"datum"),"_id");b.length?p.getMultipleLocal(b,function(k,d){if(!k)for(var t=0;t<b.length;t++){var f=d[t],g=b[t],m=l[t];f||(f=h.get({_id:g}))||(f=c._new({_id:g},!c.disableevents));c.objects[m.index]=f}a(k)}):a()},function(a){var b=d.pluck(d.pluck(k,"datum"),c.model.id);b.length?(f.trace.isEnabled&&f.trace("Looking up remoteIdentifiers: "+m.prettyPrint(b)),p.getMultipleRemote(b,c.model,function(l,d){if(!l){if(f.trace.isEnabled){var g={};for(t=
0;t<d.length;t++)g[b[t]]=d[t]?d[t]._id:null;f.trace("Results for remoteIdentifiers: "+m.prettyPrint(g))}for(t=0;t<d.length;t++){var e=d[t],g=k[t];if(e)c.objects[g.index]=e;else{var e=b[t],y={model:c.model};y[c.model.id]=e;(y=h.get(y))?c.objects[g.index]=y:(c.objects[g.index]=c._new(),c.objects[g.index][c.model.id]=e)}}}a(l)})):a()}],b);return a.promise},_lookupSingleton:function(b){var a=m.defer(b);b=a.finish.bind(a);for(var c=d.pluck(this.data,"_id"),k,l=0;l<c.length;l++)if(c[l]){k={_id:c[l]};break}for(var c=
h.getSingleton(this.model)||this._new(k),l=0;l<this.data.length;l++)this.objects[l]=c;b();return a.promise},_new:function(){var b=this.model,b=b._new.apply(b,arguments);this._newObjects.push(b);return b},start:function(b){if(this.data.length){var a=this,c=[];c.push(d.bind(this.model.singleton?this._lookupSingleton:this._lookup,this));c.push(d.bind(this._executeSubOperations,this));m.async.parallel(c,function(){try{a._map();var c;c=a.callInit?d.reduce(a._newObjects,function(a,c){var k=c.model.init;
k&&(m.paramNames(k).length?a.push(d.bind(k,c,b)):k.call(c));return a},[]):[];v.parallel(c,function(){b(a.errors.length?a.errors:null,a.objects)})}catch(l){console.error("caught error",l),b(l)}})}else b(null,[])},getRelatedData:function(b){for(var a=[],c=[],k=0;k<this.data.length;k++){var l=this.data[k];l&&l[b]&&(a.push(k),c.push(l[b]))}return{indexes:a,relatedData:c}},processErrorsFromTask:function(b,a,c){if(a.length){var k=this.getRelatedData(b).relatedData;a=m.unflattenArray(a,k);for(k=0;k<a.length;k++){var l=
c[k],t=a[k],f=t;m.isArray(t)&&(f=d.reduce(t,function(a,c){return a||c},!1));f&&(this.errors[l]||(this.errors[l]={}),this.errors[l][b]=t)}}},_executeSubOperations:function(b){var a=this,c=d.keys(this.model.relationships);c.length?(c=d.reduce(c,function(c,b){var d=a.model.relationships[b],f=d.forwardName==b?d.reverseModel:d.forwardModel;f.singleton&&!d.isReverse&&this.data.forEach(function(a){a[b]||(a[b]={})});var d=this.getRelatedData(b),h=d.indexes,d=d.relatedData;if(d.length)var d=m.flattenArray(d),
e=new g({model:f,data:d,disableevents:a.disableevents,_ignoreInstalled:a._ignoreInstalled,callInit:this.callInit});e&&c.push(function(c){e.start(function(k,d){a.subTaskResults[b]={errors:k,objects:d,indexes:h};a.processErrorsFromTask(b,e.errors,h);c()})});return c}.bind(this),[]),v.parallel(c,function(a){b(a)})):b()}});r.exports=g},{"./cache":8,"./error":11,"./log":14,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],17:[function(e,r,q){function g(a){var c=this;this._opts=a?w.extend({},
a):{};f.extendFromOpts(this,a,{methods:{},attributes:[],collection:function(a){f.isString(a)&&(a=p[a]);return a},id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,remove:null});this.attributes=g._processAttributes(this.attributes);w.extend(this,{_installed:!1,_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]});Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(c.relationships)},
enumerable:!0},_attributeNames:{get:function(){var a=[];c.id&&a.push(c.id);w.each(c.attributes,function(c){a.push(c.name)});return a},enumerable:!0,configurable:!0},installed:{get:function(){return c._installed&&c._relationshipsInstalled&&c._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return w.reduce(c.children,function(a,c){return Array.prototype.concat.call(a,c.descendants)}.bind(c),w.extend([],c.children))},enumerable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys((siesta.ext.storage._unsavedObjectsByCollection[this.collectionName]||
{})[this.name]||{}).length},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0}});k.ProxyEventEmitter.call(this,this.collectionName+":"+this.name)}q=e("./log");var p=e("./collectionRegistry").CollectionRegistry,n=e("./error").InternalSiestaError,h=e("./RelationshipType"),m=e("./query"),d=e("./mappingOperation"),v=e("./modelInstance"),f=e("./util"),b=e("./cache");e("./store");var a=e("extend"),c=e("./modelEvents"),k=e("./events"),l=e("./events").wrapArray;e("./RelationshipProxy");
var t=e("./OneToManyProxy"),y=e("./OneToOneProxy"),C=e("./manyToManyProxy"),A=e("./reactiveQuery"),x=e("./ArrangedReactiveQuery"),w=f._,B=f.guid,D=c.ModelEventType,z=q.loggerWithName("Model");w.extend(g,{_processAttributes:function(a){return w.reduce(a,function(a,c){"string"==typeof c?a.push({name:c}):a.push(c);return a},[])}});g.prototype=Object.create(k.ProxyEventEmitter.prototype);w.extend(g.prototype,{installStatics:function(a){a&&w.each(Object.keys(a),function(c){this[c]?z.error('Static method with name "'+
c+'" already exists. Ignoring it.'):this[c]=a[c].bind(this)}.bind(this));return a},installRelationships:function(){if(this._relationshipsInstalled)throw new n('Relationships for "'+this.name+'" have already been installed');this._relationships=[];if(this._opts.relationships)for(var a in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(a)){var c=this._opts.relationships[a];if(!c.isReverse){z.debug.isEnabled&&z.debug(this.name+": configuring relationship "+a,c);c.type||(c.type=this.singleton?
h.OneToOne:h.OneToMany);if(this.singleton&&c.type==h.ManyToMany)return"Singleton model cannot use ManyToMany relationship.";if(c.type==h.OneToMany||c.type==h.OneToOne||c.type==h.ManyToMany){var b=c.model;delete c.model;var k;if(b instanceof g)k=b;else{z.debug.isEnabled&&z.debug("reverseModelName",b);if(!this.collection)throw new n("Model must have collection");var l=this.collection;if(!l)throw new n("Collection "+this.collectionName+" not registered");k=l[b]}if(!k&&(l=b.split("."),2==l.length)){k=
l[0];b=l[1];l=p[k];if(!l)return'Collection with name "'+k+'" does not exist.';k=l[b]}z.debug.isEnabled&&z.debug("reverseModel",k);if(k)c.reverseModel=k,c.forwardModel=this,c.forwardName=a,c.reverseName=c.reverse||"reverse_"+a,delete c.reverse,c.isReverse=!1;else return'Model with name "'+b.toString()+'" does not exist'}else return"Relationship type "+c.type+" does not exist"}}this._relationshipsInstalled=!0;return null},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new n('Reverse relationships for "'+
this.name+'" have already been installed.');for(var c in this.relationships)if(this.relationships.hasOwnProperty(c)){var b=this.relationships[c],b=a(!0,{},b);b.isReverse=!0;var k=b.reverseModel,l=b.reverseName;if(k.singleton){if(b.type==h.ManyToMany)return"Singleton model cannot be related via reverse ManyToMany";if(b.type==h.OneToMany)return"Singleton model cannot be related via reverse OneToMany"}z.debug.isEnabled&&z.debug(this.name+": configuring  reverse relationship "+l);k.relationships[l]=b}this._reverseRelationshipsInstalled=
!0},_query:function(a){return a=new m(this,a||{})},query:function(a,c){if(this.singleton){var b=f.defer(c);c=b.finish.bind(b);this._query({__ignoreInstalled:!0}).execute(function(b,k){b?c(b):(a=w.extend({},a),a.__ignoreInstalled=!0,k.length?this._query(a).execute(c):this.map({},function(b){b?c(b):this._query(a).execute(c)}.bind(this)))}.bind(this));return b.promise}return this._query(a).execute(c)},reactiveQuery:function(a){return new A(new m(this,a||{}))},arrangedReactiveQuery:function(a){return new x(new m(this,
a||{}))},one:function(a,c){"function"==typeof a&&(c=a,a={});var b=f.defer(c);c=b.finish.bind(b);this.query(a,function(a,b){a?c(a):1<b.length?c("More than one instance returned when executing get query!"):(b=b.length?b[0]:null,c(null,b))});return b.promise},all:function(a,c){"function"==typeof a&&(c=a,a={});a=a||{};return this.query(a,c)},install:function(a){z.info.isEnabled&&z.info("Installing mapping "+this.name);var c=f.defer(a);a=c.finish.bind(c);if(this._installed)throw new n('Model "'+this.name+
'" has already been installed');this._installed=!0;a();return c.promise},map:function(a,c,b){"function"==typeof c&&(b=c);c=c||{};var k=f.defer(b);b=function(){var b=c.override;b&&(f.isArray(b)?c.objects=b:c.objects=[b]);delete c.override;f.isArray(a)?this._mapBulk(a,c,k.finish.bind(k)):this._mapBulk([a],c,function(a,c){var b;c&&c.length&&(b=c[0]);k.finish(a?f.isArray(a)?a[0]:a:null,b)})}.bind(this);c._ignoreInstalled?b():siesta._afterInstall(b);return k.promise},_mapBulk:function(a,c,b){w.extend(c,
{model:this,data:a});(new d(c)).start(function(a,c){a?b&&b(a):b(null,c||[])})},_countCache:function(){return w.reduce(Object.keys((b._localCacheByType[this.collectionName]||{})[this.name]||{}),function(a,c){a[c]={};return a},{})},count:function(a){var c=f.defer(a);a=c.finish.bind(c);var b=this._countCache();a(null,Object.keys(b).length);return c.promise},_new:function(a,k){k=void 0===k?!0:k;if(this.installed){var d=this,g;g=a?a._id?a._id:B():B();var e=new v(this);z.info.isEnabled&&z.info('New object created _id="'+
g.toString()+'", type='+this.name,a);e._id=g;g={};e.__values=g;var m=w.reduce(this.attributes,function(a,c){void 0!==c["default"]&&(a[c.name]=c["default"]);return a},{});w.extend(g,m);a&&w.extend(g,a);g=this._attributeNames;m=g.indexOf(this.id);-1<m&&g.splice(m,1);w.each(g,function(a){Object.defineProperty(e,a,{get:function(){var c=e.__values[a];return void 0===c?null:c},set:function(b){var k=e.__values[a],h=this._propertyDependencies[a],h=w.map(h,function(a){return{prop:a,old:this[a]}}.bind(this));
e.__values[a]=b;h.forEach(function(a){var b=a.prop;c.emit({collection:d.collectionName,model:d.name,_id:e._id,"new":this[b],old:a.old,type:D.Set,field:b,obj:e})}.bind(this));k={collection:d.collectionName,model:d.name,_id:e._id,"new":b,old:k,type:D.Set,field:a,obj:e};window.lastEmission=k;c.emit(k);f.isArray(b)&&l(b,a,e)},enumerable:!0,configurable:!0})});w.each(Object.keys(this.methods),function(a){void 0===e[a]?e[a]=this.methods[a].bind(e):z.error('A method with name "'+a+'" already exists. Ignoring it.')}.bind(this));
g=Object.keys(this.properties);var p={};w.each(g,function(a){var c=this.properties[a];(c.dependencies||[]).forEach(function(c){p[c]||(p[c]=[]);p[c].push(a)});delete c.dependencies;void 0===e[a]?Object.defineProperty(e,a,c):z.error('A property/method with name "'+a+'" already exists. Ignoring it.')}.bind(this));e._propertyDependencies=p;Object.defineProperty(e,this.id,{get:function(){return e.__values[d.id]||null},set:function(a){var k=e[d.id];e.__values[d.id]=a;c.emit({collection:d.collectionName,
model:d.name,_id:e._id,"new":a,old:k,type:D.Set,field:d.id,obj:e});b.remoteInsert(e,a,k)},enumerable:!0,configurable:!0});for(var x in this.relationships){var q;if(this.relationships.hasOwnProperty(x))if(q=w.extend({},this.relationships[x]),g=q.type,delete q.type,g==h.OneToMany)q=new t(q);else if(g==h.OneToOne)q=new y(q);else if(g==h.ManyToMany)q=new C(q);else throw new n("No such relationship type: "+g);q.install(e)}b.insert(e);k&&c.emit({collection:this.collectionName,model:this.name,_id:e._id,
"new":e,type:D.New,obj:e});return e}throw new n("Model must be fully installed before creating any models");},_dump:function(a){var c={};c.name=this.name;c.attributes=this.attributes;c.id=this.id;c.collection=this.collectionName;c.relationships=w.map(this.relationships,function(a){return a.isForward?a.forwardName:a.reverseName});return a?f.prettyPrint(c):c},toString:function(){return"Model["+this.name+"]"}});w.extend(g.prototype,{child:function(a,c){"string"==typeof a?c.name=a:c=name;w.extend(c,{attributes:Array.prototype.concat.call(c.attributes||
[],this._opts.attributes),relationships:w.extend(c.relationships||{},this._opts.relationships),methods:w.extend(w.extend({},this._opts.methods)||{},c.methods),statics:w.extend(w.extend({},this._opts.statics)||{},c.statics),properties:w.extend(w.extend({},this._opts.properties)||{},c.properties),id:c.id||this._opts.id,init:c.init||this._opts.init,remove:c.remove||this._opts.remove});var b=this.collection.model(c.name,c);b.parent=this;this.children.push(b);return b},isChildOf:function(a){return this.parent==
a},isParentOf:function(a){return-1<this.children.indexOf(a)},isDescendantOf:function(a){for(var c=this.parent;c;){if(c==a)return!0;c=c.parent}return!1},isAncestorOf:function(a){return-1<this.descendants.indexOf(a)},hasAttributeNamed:function(a){return-1<this._attributeNames.indexOf(a)}});w.extend(g.prototype,{paginator:function(a){if(siesta.ext.httpEnabled){var c=siesta.ext.http.Paginator;a=a||{};a.model=this;return new c(a)}}});r.exports=g},{"./ArrangedReactiveQuery":1,"./OneToManyProxy":3,"./OneToOneProxy":4,
"./RelationshipProxy":6,"./RelationshipType":7,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./manyToManyProxy":15,"./mappingOperation":16,"./modelEvents":18,"./modelInstance":19,"./query":22,"./reactiveQuery":24,"./store":26,"./util":28,extend:42}],18:[function(e,r,q){function g(d){this._opts=d||{};Object.keys(d).forEach(function(b){this[b]=d[b]}.bind(this))}function p(d){if(!d.model)throw new h("Must pass a model");if(!d.collection)throw new h("Must pass a collection");
if(!d._id)throw new h("Must pass a local identifier");if(!d.obj)throw new h("Must pass the object");}var n=e("./events"),h=e("./error").InternalSiestaError;r=e("./log");var m=e("./util")._.extend,d=e("./collectionRegistry").CollectionRegistry,v=r.loggerWithName("ModelEvents");g.prototype._dump=function(d){var b={};b.collection="string"==typeof this.collection?this.collection:this.collection._dump();b.model="string"==typeof this.model?this.model:this.model.name;b._id=this._id;b.field=this.field;b.type=
this.type;this.index&&(b.index=this.index);this.added&&(b.added=_.map(this.added,function(a){return a._dump()}));this.removed&&(b.removed=_.map(this.removed,function(a){return a._dump()}));this.old&&(b.old=this.old);this["new"]&&(b["new"]=this["new"]);return d?util.prettyPrint(b):b};m(q,{ModelEvent:g,emit:function(f){p(f);var b=f.collection,a=f.model;f=new g(f);v.trace.isEnabled&&v.trace('Sending notification "'+b+'" of type '+f.type);n.emit(b,f);var c=b+":"+a;v.trace.isEnabled&&v.trace('Sending notification "'+
c+'" of type '+f.type);n.emit(c,f);v.trace.isEnabled&&v.trace('Sending notification "Siesta" of type '+f.type);n.emit("Siesta",f);c=f._id;v.trace.isEnabled&&v.trace('Sending notification "'+c+'" of type '+f.type);n.emit(c,f);c=d[b];if(!c)throw b='No such collection "'+b+'"',v.error(b,d),new h(b);c=c[a];if(!c)throw b='No such model "'+a+'"',v.error(b,d),new h(b);c.id&&f.obj[c.id]&&(b=b+":"+a+":"+f.obj[c.id],v.trace.isEnabled&&v.trace('Sending notification "'+b+'" of type '+f.type),n.emit(b,f));return f},
validateEventOpts:p,ModelEventType:{Set:"Set",Splice:"Splice",New:"New",Remove:"Remove"}})},{"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./util":28}],19:[function(e,r,q){r.exports=e(2)},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":28,"/Users/mtford/Playground/rest/core/ModelInstance.js":2}],20:[function(e,r,q){r.exports=e(3)},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,
"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/OneToManyProxy.js":3}],21:[function(e,r,q){r.exports=e(4)},{"./RelationshipProxy":6,"./error":11,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/OneToOneProxy.js":4}],22:[function(e,r,q){r.exports=e(5)},{"./cache":8,"./error":11,"./log":14,"./querySet":23,"./util":28,"/Users/mtford/Playground/rest/core/Query.js":5}],23:[function(e,r,q){function g(a){return"string"==typeof a||a instanceof
String?C.concat(A):"number"==typeof a||a instanceof Number?t.concat(y):a.getOwnPropertyNames()}function p(c,l){l in c||Object.defineProperty(c,l,{get:function(){return d(k.pluck(c,l))},set:function(c){if(b.isArray(c)){if(this.length!=c.length)throw new a({message:"Must be same length"});for(var k=0;k<c.length;k++)this[k][l]=c[k]}else for(k=0;k<this.length;k++)this[k][l]=c}})}function n(a){return a.then&&a["catch"]}function h(a,c){c in a||(a[c]=function(){var a=arguments,b=this.map(function(b){return b[c].apply(b,
a)}),k=!1;b.length&&(k=n(b[0]));return k?siesta.q.all(b):d(b)})}function m(a,b){a=k.extend([],a);b._attributeNames.concat(b._relationshipNames).concat(l).forEach(k.partial(p,a));var l=Object.keys(c.prototype);l.forEach(k.partial(h,a));return f(a)}function d(a){if(a.length){var c=a[0];g(c).forEach(function(b){"function"==typeof c[b]?h(a,b,arguments):p(a,b)})}return f(a)}function v(){throw Error("Cannot modify a query set");}function f(a){l.forEach(function(c){a[c]=v});a.immutable=!0;a.mutableCopy=
a.asArray=function(){var a=k.map(this,function(a){return a});a.asQuerySet=function(){return d(this)};a.asModelQuerySet=function(a){return m(this,a)};return a};return a}var b=e("./util"),a=e("./error").SiestaUserError,c=e("./ModelInstance"),k=e("./util")._,l="push sort reverse splice shift unshift".split(" "),t=["toString","toExponential","toFixed","toPrecision","valueOf"],y=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],C="charAt charCodeAt concat fromCharCode indexOf lastIndexOf localeCompare match replace search slice split substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim valueOf".split(" "),
A=["length"];r.exports=m},{"./ModelInstance":2,"./error":11,"./util":28}],24:[function(e,r,q){function g(a){var c=this;p.call(this);f.extend(this,{_query:a,results:d([],a.model),insertionPolicy:g.InsertionPolicy.Back,initialised:!1});Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){return c._query.model}},collection:{get:function(){return c.model.collectionName}}})}q=e("./log");e("./query");var p=e("events").EventEmitter,n=e("./events"),h=e("./modelEvents"),
m=e("./error").InternalSiestaError,d=e("./querySet"),v=e("./util"),f=v._,b=q.loggerWithName("Query");g.prototype=Object.create(p.prototype);f.extend(g,{InsertionPolicy:{Front:"Front",Back:"Back"}});f.extend(g.prototype,{init:function(a){b.trace&&b.trace("init");var c=v.defer(a);a=c.finish.bind(c);this.initialised?a(null,this.results):this._query.execute(function(c,l){if(c)a(c);else{this.results=l;if(!this.handler){var d=this._constructNotificationName(),h=function(a){this._handleNotif(a)}.bind(this);
this.handler=h;n.on(d,h)}b.trace&&b.trace("Listening to "+d);this.initialised=!0;a(null,this.results)}}.bind(this));return c.promise},insert:function(a){var c=this.results.mutableCopy();a=this.insertionPolicy==g.InsertionPolicy.Back?c.push(a):c.unshift(a);this.results=c.asModelQuerySet(this.model);return a},_handleNotif:function(a){b.trace&&b.trace("_handleNotif",a);if(a.type==h.ModelEventType.New){var c=a["new"];if(this._query.objectMatchesQuery(c)){b.trace&&b.trace("New object matches",c._dumpString());
var k=this.insert(c);this.emit("change",this.results,{index:k,added:[c],type:h.ModelEventType.Splice,obj:this})}else b.trace&&b.trace("New object does not match",c._dumpString())}else if(a.type==h.ModelEventType.Set){var c=a.obj,k=this.results.indexOf(c),l=-1<k,f=this._query.objectMatchesQuery(c);f&&!l?(b.trace&&b.trace("Updated object now matches!",c._dumpString()),k=this.insert(c),this.emit("change",this.results,{index:k,added:[c],type:h.ModelEventType.Splice,obj:this})):!f&&l?(b.trace&&b.trace("Updated object no longer matches!",
c._dumpString()),l=this.results.mutableCopy(),a=l.splice(k,1),this.results=l.asModelQuerySet(this.model),this.emit("change",this.results,{index:k,obj:this,"new":c,type:h.ModelEventType.Splice,removed:a})):f||l?f&&l&&(b.trace&&b.trace("Matches but already contains",c._dumpString()),this.emit("change",this.results,a)):b.trace&&b.trace("Does not contain, but doesnt match so not inserting",c._dumpString())}else if(a.type==h.ModelEventType.Remove)c=a.obj,l=this.results.mutableCopy(),k=l.indexOf(c),-1<
k?(b.trace&&b.trace("Removing object",c._dumpString()),a=l.splice(k,1),this.results=d(l,this.model),this.emit("change",this.results,{index:k,obj:this,type:h.ModelEventType.Splice,removed:a})):b.trace&&b.trace("No modelEvents neccessary.",c._dumpString());else throw new m('Unknown change type "'+a.type.toString()+'"');this.results=d(this._query._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&
n.removeListener(this._constructNotificationName(),this.handler);this.handler=this.results=null},listen:function(a){this.on("change",a);return function(){this.removeListener("change",a)}.bind(this)},listenOnce:function(a){this.once("change",a)}});r.exports=g},{"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":22,"./querySet":23,"./util":28,events:38}],25:[function(e,r,q){r.exports=e(6)},{"../vendor/observe-js/src/observe":44,"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,
"./query":22,"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/RelationshipProxy.js":6}],26:[function(e,r,q){function g(f,b){var a=h.defer(b);b=a.finish.bind(a);v.debug.isEnabled&&v.debug("get",f);var c;if(f._id)if(h.isArray(f._id))p(m.map(f._id,function(a){return{_id:a}}),b);else if(c=d.get(f))v.debug.isEnabled&&v.debug("Had cached object",{opts:f,obj:c}),b&&b(null,c);else if(h.isArray(f._id))p(m.map(f._id,function(a){return{_id:a}}),b);else{if(b)if(c=siesta.ext.storage)c.store.getFromPouch(f,
b);else throw Error("Storage module not installed");}else if(f.model)if(h.isArray(f[f.model.id]))p(m.map(f[f.model.id],function(a){var c={};c[f.model.id]=a;c.model=f.model;return c}),b);else if(c=d.get(f))v.debug.isEnabled&&v.debug("Had cached object",{opts:f,obj:c}),b&&b(null,c);else if(c=f.model,c.singleton)c.one(b);else{var k=c.id,l=f[k],e={};if(e[k]=l)c.one(e,function(a,c){a?b(a):c?b(null,c):b(null,null)});else throw new n('Invalid options given to store. Missing "'+k.toString()+'."');}else throw new n("Invalid options given to store",
{opts:f});return a.promise}function p(d,b){var a=h.defer(b);b=a.finish.bind(a);var c=[],k=[];m.each(d,function(a){g(a,function(a,l){a?k.push(a):c.push(l);c.length+k.length==d.length&&b&&(k.length?b(k):b(null,c))})});return a.promise}var n=e("./error").InternalSiestaError;q=e("./log");var h=e("./util"),m=h._,d=e("./cache"),v=q.loggerWithName("Store");r.exports={get:g,getMultiple:p,getMultipleLocal:function(f,b){var a=h.defer(b);b=a.finish.bind(a);var c=m.reduce(f,function(a,c){var b=d.get({_id:c});
b?a.cached[c]=b:a.notCached.push(c);return a},{cached:{},notCached:[]});(function(a){b&&(a?b(a):b(null,m.map(f,function(a){return c.cached[a]})))})();return a.promise},getMultipleRemote:function(f,b,a){var c=h.defer(a);a=c.finish.bind(c);var k=m.reduce(f,function(a,c){var k={model:b};k[b.id]=c;(k=d.get(k))?a.cached[c]=k:a.notCached.push(c);return a},{cached:{},notCached:[]});(function(c){a&&(c?a(c):a(null,m.map(f,function(a){return k.cached[a]})))})();return c.promise}}},{"./cache":8,"./error":11,
"./log":14,"./util":28}],27:[function(e,r,q){function g(a,c){if(a.map)return a.map(c);var b=[];m(a,function(a,k,l){b.push(c(a,k,l))});return b}function p(a,c,b,k){c=g(c,function(a,c){return{index:c,value:a}});if(k){var d=[];a(c,function(a,c){b(a.value,function(b,k){d[a.index]=k;c(b)})},function(a){k(a,d)})}else a(c,function(a,c){b(a.value,function(a){c(a)})})}function n(a,c,b){b=b||function(){};if(!a.length)return b();var k=0,d=function(){c(a[k],function(c){c?(b(c),b=function(){}):(k+=1,k>=a.length?
b():d())})};d()}function h(a,c){if(a.forEach)return a.forEach(c);for(var b=0;b<a.length;b+=1)c(a[b],b,a)}function m(a,c,b){function k(c){c?(b(c),b=function(){}):(f+=1,f>=a.length&&b())}b=b||function(){};if(!a.length)return b();var f=0;h(a,function(a){c(a,d(k))})}function d(c){var b=!1;return function(){if(b)throw Error("Callback was already called.");b=!0;c.apply(a,arguments)}}var v=e("./misc"),f=e("./underscore"),b=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,
[m].concat(c))}}(p),a,c=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,[n].concat(c))}}(p),k=function(a,c,b){b=b||function(){};if(v.isArray(c))a.map(c,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},b);else{var k={};a.each(Object.keys(c),function(a,b){c[a](function(c){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);k[a]=d;b(c)})},function(a){b(a,k)})}};r.exports=
{series:function(a,b){b=b||function(){};if(v.isArray(a))c(a,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},b);else{var k={};n(f.keys(a),function(c,b){a[c](function(a){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);k[c]=d;b(a)})},function(a){b(a,k)})}},parallel:function(a,c){k({map:b,each:m},a,c)}}},{"./misc":29,"./underscore":30}],28:[function(e,r,q){q=e("./underscore");var g=e("./async");e=e("./misc");q.extend(r.exports,
{_:q,async:g});q.extend(r.exports,e)},{"./async":27,"./misc":29,"./underscore":30}],29:[function(e,r,q){var g=e("../../vendor/observe-js/src/observe").Platform,p=e("./underscore"),n=e("./../error").InternalSiestaError,h=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,m=/,/,d=/^\s*(_?)(.+?)\1\s*$/,v=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;e=function(a){return"[object Array]"===p.toString.call(a)};var f=Array.isArray||e,b=function(a){return"string"==typeof a||a instanceof String};p.extend(r.exports,{next:function(a){g.performMicrotaskCheckpoint();
setTimeout(a)},cb:function(a,c){return function(b){a&&a.apply(a,arguments);c&&(b?c.reject(b):c.resolve.apply(c,Array.prototype.slice.call(arguments,1)))}},guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),assert:function(a,c,b){if(!a)throw b=b||{},new n(c||"Assertion failed",b);},thenBy:function(){function a(a){a.thenBy=c;return a}function c(c){var b=this;return a(function(a,
d){return b(a,d)||c(a,d)})}return a}(),defer:function(a){var c;a=a||function(){};if(siesta.q){c=siesta.q.defer();var b=c.reject,d=c.resolve;p.extend(c,{reject:function(c){a(c);b.call(this,c)},resolve:function(c){a(null,c);d.call(this,c)},finish:function(c,f){a(c,f);c?b.call(this,c):d.call(this,f)}})}else c={promise:void 0,reject:function(c){a(c)},resolve:function(c){a(null,c)},finish:function(c,b){a(c,b)}};return c},defineSubProperty:function(a,c,b){return Object.defineProperty(this,a,{get:function(){return b?
c[b]:c[a]},set:function(d){b?c[b]=d:c[a]=d},enumerable:!0,configurable:!0})},defineSubPropertyNoSet:function(a,c,b){return Object.defineProperty(this,a,{get:function(){return b?c[b]:c[a]},enumerable:!0,configurable:!0})},subProperties:function(a,c,k){f(k)||(k=Array.prototype.slice.call(arguments,2));for(var d=0;d<k.length;d++)(function(k){var d={set:!1,name:k,property:k};b(k)||p.extend(d,k);k={get:function(){return c[d.property]},enumerable:!0,configurable:!0};d.set&&(k.set=function(a){c[d.property]=
a});Object.defineProperty(a,d.name,k)})(k[d])},capitaliseFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},extendFromOpts:function(a,c,b,d){if(void 0==d||d){var f=Object.keys(b);d=Object.keys(c).filter(function(a){return-1==f.indexOf(a)});if(d.length)throw Error("Unknown options: "+d.toString());}p.each(Object.keys(b),function(a){var d=b[a];"function"==typeof d&&(b[a]=d(c[a]),delete c[a])});p.extend(b,c);p.extend(a,b)},isString:b,isArray:f,prettyPrint:function(a){return JSON.stringify(a,
null,4)},flattenArray:function(a){return p.reduce(a,function(a,b){f(b)?a=a.concat(b):a.push(b);return a},[])},unflattenArray:function(a,c){for(var b=0,d=[],h=0;h<c.length;h++)if(f(c[h])){var e=[];d[h]=e;for(var g=0;g<c[h].length;g++)e.push(a[b]),b++}else d[h]=a[b],b++;return d},paramNames:function(a){var c=[];a.toString().replace(v,"").match(h)[1].split(m).forEach(function(a){a.replace(d,function(a,b,k){c.push(k)})});return c}})},{"../../vendor/observe-js/src/observe":44,"./../error":11,"./underscore":30}],
30:[function(e,r,q){var g={};e=Array.prototype;var p=e.forEach,n=e.map,h=e.reduce,m=Function.prototype.bind,d=e.slice,v={},f=function(){};g.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b};g.each=g.forEach=function(a,b,d){if(null==a)return a;if(p&&a.forEach===p)a.forEach(b,d);else if(a.length===+a.length)for(var f=0,h=a.length;f<h;f++){if(b.call(d,a[f],f,a)===v)return}else for(var e=g.keys(a),f=0,h=e.length;f<h;f++)if(b.call(d,a[e[f]],
e[f],a)===v)return;return a};g.map=g.collect=function(a,b,d){var f=[];if(null==a)return f;if(n&&a.map===n)return a.map(b,d);g.each(a,function(a,c,h){f.push(b.call(d,a,c,h))});return f};var b=function(a,b,d){if(void 0===b)return a;switch(null==d?3:d){case 1:return function(d){return a.call(b,d)};case 2:return function(d,f){return a.call(b,d,f)};case 3:return function(d,f,l){return a.call(b,d,f,l)};case 4:return function(d,f,l,h){return a.call(b,d,f,l,h)}}return function(){return a.apply(b,arguments)}};
g.times=function(a,d,f){var h=Array(Math.max(0,a));d=b(d,f,1);for(f=0;f<a;f++)h[f]=d(f);return h};g.partial=function(a){var b=d.call(arguments,1);return function(){for(var d=0,f=b.slice(),h=0,e=f.length;h<e;h++)f[h]===g&&(f[h]=arguments[d++]);for(;d<arguments.length;)f.push(arguments[d++]);return a.apply(this,f)}};g.pluck=function(a,b){return g.map(a,g.property(b))};g.reduce=g.foldl=g.inject=function(a,b,d,f){var e=2<arguments.length;null==a&&(a=[]);if(h&&a.reduce===h)return f&&(b=g.bind(b,f)),e?
a.reduce(b,d):a.reduce(b);g.each(a,function(a,c,h){e?d=b.call(f,d,a,c,h):(d=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");return d};g.property=function(a){return function(b){return b[a]}};"function"!==typeof/./&&(g.isFunction=function(a){return"function"===typeof a});g.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};var a=function(a){return null==a?g.identity:g.isFunction(a)?a:g.property(a)};g.sortBy=function(c,b,d){b=a(b);return g.pluck(g.map(c,
function(a,c,f){return{value:a,index:c,criteria:b.call(d,a,c,f)}}).sort(function(a,c){var b=a.criteria,d=c.criteria;if(b!==d){if(b>d||void 0===b)return 1;if(b<d||void 0===d)return-1}return a.index-c.index}),"value")};g.bind=function(a,b){var h,e;if(m&&a.bind===m)return m.apply(a,d.call(arguments,1));if(!g.isFunction(a))throw new TypeError;h=d.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,h.concat(d.call(arguments)));f.prototype=a.prototype;var g=new f;f.prototype=
null;u;var m=a.apply(g,h.concat(d.call(arguments)));return Object(m)===m?m:g}};g.identity=function(a){return a};g.zip=function(a){if(null==a)return[];for(var b=g.max(arguments,"length").length,d=Array(b),f=0;f<b;f++)d[f]=g.pluck(arguments,f);return d};g.max=function(a,b,d){var f=-Infinity,h=-Infinity,e;if(null==b&&null!=a){a=a.length===+a.length?a:g.values(a);for(var m=0,n=a.length;m<n;m++)d=a[m],d>f&&(f=d)}else b=g.iteratee(b,d),g.each(a,function(a,c,d){e=b(a,c,d);if(e>h||-Infinity===e&&-Infinity===
f)f=a,h=e});return f};g.iteratee=function(a,d,f){return null==a?g.identity:g.isFunction(a)?b(a,d,f):g.isObject(a)?g.matches(a):g.property(a)};g.pairs=function(a){for(var b=g.keys(a),d=b.length,f=Array(d),h=0;h<d;h++)f[h]=[b[h],a[b[h]]];return f};g.matches=function(a){var b=g.pairs(a),d=b.length;return function(a){if(null==a)return!d;a=Object(a);for(var c=0;c<d;c++){var f=b[c],h=f[0];if(f[1]!==a[h]||!(h in a))return!1}return!0}};g.some=function(a,b,d){if(null==a)return!1;b=g.iteratee(b,d);d=a.length!==
+a.length&&g.keys(a);var f=(d||a).length,h,e;for(h=0;h<f;h++)if(e=d?d[h]:h,b(a[e],e,a))return!0;return!1};g.extend=function(a){if(!g.isObject(a))return a;for(var b,d,f=1,h=arguments.length;f<h;f++)for(d in b=arguments[f],b)hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};r.exports=g},{}],31:[function(e,r,q){function g(a){a?"*"==a||-1<a.indexOf("*")?a=c:h.isArray(a)||(a=[a]):a=["GET"];return b.map(a,function(a){return a.toUpperCase()})}function p(a){if(!this)return new p(a);this._rawOpts=f(!0,{},a);
this._opts=a;var c=function(a){a instanceof RegExp||(a=new RegExp(a,"g"));return a}.bind(this);if(this._opts.path){var e=this._opts.path;h.isArray(e)||(e=[e]);this._opts.path=[];b.each(e,function(a){this._opts.path.push(c.call(this,a))}.bind(this))}else this._opts.path=[""];this._opts.method=g(this._opts.method);if(this._opts.model){if("string"==typeof this._opts.model)if(this._opts.collection)if(e="string"==typeof this._opts.collection?v[this._opts.collection]:this._opts.collection)if(e=e[this._opts.model])this._opts.model=
e;else throw Error("Model "+this._opts.model+" does not exist",{opts:a,descriptor:this});else throw Error("Collection "+this._opts.collection+" does not exist",{opts:a,descriptor:this});else throw Error("Passed model as string, but did not specify the collection it belongs to",{opts:a,descriptor:this});}else throw Error("Descriptors must be initialised with a model",{opts:a,descriptor:this});if((a=this._opts.data)&&a.length){e=a.split(".");if(1==e.length)a=e[0];else{var m={};a=m;for(var n=e[0],q=
1;q<e.length;q++){var r=e[q];if(q==e.length-1)m[n]=r;else var w={},m=m[n]=w,n=r}}this._opts.data=a}d.call(this,"path",this._opts);d.call(this,"method",this._opts);d.call(this,"model",this._opts);d.call(this,"data",this._opts);d.call(this,"transforms",this._opts)}e=siesta._internal;var n=e.error.InternalSiestaError,h=e.util,m=h.assert,d=h.defineSubProperty,v=e.CollectionRegistry,f=e.extend,b=h._,a=e.log.loggerWithName("Descriptor"),c="POST PATCH PUT HEAD GET DELETE OPTIONS TRACE CONNECT".split(" ");
b.extend(p.prototype,{httpMethods:c,_matchPath:function(c){var b;for(b=0;b<this._opts.path.length;b++){var d=this._opts.path[b];a.trace.isEnabled&&a.trace("Matching path",c,d.toString());var f=d.exec(c);a.trace.isEnabled&&(f?a.trace("Matched path successfully",c,d.toString()):a.trace("Failed to match path",c,d.toString()));if(f)return!0}return!1},_matchMethod:function(a){for(var c=0;c<this.method.length;c++)if(a.toUpperCase()==this.method[c])return!0;return!1},bury:function(a,c){var b=Object.keys(c);
m(1==b.length);for(var b=b[0],d=c;"string"!=typeof d[b];)d=d[b],b=Object.keys(d),m(1==b.length),b=b[0];var f=d[b],h={};d[b]=h;h[f]=a;return c},_embedData:function(a){if(this.data){var b;"string"==typeof this.data?(b={},b[this.data]=a):b=this.bury(a,f(!0,{},this.data));return b}return a},_extractData:function(b){a.debug.isEnabled&&a.debug("_extractData",b);if(this.data){if("string"==typeof this.data)return b[this.data];var c=Object.keys(this.data);m(1==c.length);for(var d=this.data;"string"!=typeof d&&
(c=Object.keys(d),m(1==c.length),c=c[0],d=d[c],b=b[c],b););return b?b[d]:null}return b},_matchConfig:function(a){var b=a.type?this._matchMethod(a.type):{};b&&(b=a.url?this._matchPath(a.url):{});return b},_matchData:function(a){var b=null;this.data?a&&(b=this._extractData(a)):b=a;return b},match:function(a,b){var c=!1;this._matchConfig(a)&&(c=this._matchData(b));return c},_transformData:function(a){var b=this.transforms;if("function"==typeof b)a=b(a);else for(var c in b)if(b.hasOwnProperty(c)&&a[c]){var d=
b[c],f=a[c];if("string"==typeof d)if(d=d.split("."),delete a[c],1==d.length)a[d[0]]=f;else{a[d[0]]={};for(var e=a[d[0]],g=1;g<d.length-1;g++){var m=d[g];e[m]={};e=e[m]}e[d[d.length-1]]=f}else if("function"==typeof d)f=d(f),h.isArray(f)?(delete a[c],a[f[0]]=f[1]):a[c]=f;else throw new n("Invalid transformer");}return a}});q.Descriptor=p;q.resolveMethod=g},{}],32:[function(e,r,q){function g(){if(!this)return new g(opts);this.requestDescriptors={};this.responseDescriptors={}}function p(e,d){var g=d.model,
f=g.collectionName;h.trace.isEnabled&&h.trace("_registerDescriptor",{model:g,collectionName:f});e[f]||(e[f]=[]);e[f].push(d)}function n(e,d){var g;g="string"==typeof d?e[d]||[]:e[d.name]||[];h.trace.isEnabled&&h.trace("_descriptorsForCollection",{collection:d,allDescriptors:e,descriptors:g});return g}e=siesta._internal;r=e.util._;var h=e.log.loggerWithName("Descriptor");r.extend(g.prototype,{registerRequestDescriptor:function(h){p(this.requestDescriptors,h)},registerResponseDescriptor:function(e){h.trace.isEnabled&&
h.trace("registerResponseDescriptor");p(this.responseDescriptors,e)},requestDescriptorsForCollection:function(h){return n(this.requestDescriptors,h)},responseDescriptorsForCollection:function(e){var d=n(this.responseDescriptors,e);d.length||h.debug.isEnabled&&h.debug("No response descriptors for collection ",{collection:e});return d},reset:function(){this.requestDescriptors={};this.responseDescriptors={}}});q.DescriptorRegistry=new g},{}],33:[function(e,r,q){function g(a,b,c){if(z.debug.isEnabled){var d=
z.debug;a=a.type+" "+b.status+" "+a.url;z.trace.isEnabled&&c&&(d=z.trace,a+=": "+A.prettyPrint(c));d(a)}}function p(a){if(z.debug.isEnabled){var b=z.debug;a=a.type+" "+a.url;z.trace.isEnabled&&(b=z.trace);b(a)}}function n(a,b,c,d){function f(a,b,c){g(m,c,a);var h={data:a,status:b,xhr:c};if(m.parseResponse){b=D.responseDescriptorsForCollection(e);var k,n;for(c=0;c<b.length;c++){var p=b[c];if(n=p.match(m,a)){k=p;break}}if(k)z.trace.isEnabled&&z.trace("Model _constructSubOperation data: "+A.prettyPrint(n)),
"object"==typeof n?k.model.map(n,{override:m.obj},function(a,b){d&&d(a,b,h)}):d(null,!0,h);else if(d)if(l)d("No descriptors matched",null,h);else throw new B("Unnamed collection");}else d(null,null,h)}function h(a,b,c){a={xhr:a,status:b,error:c};d&&d(a,null,a)}var e=this,k=Array.prototype.slice.call(arguments,2),m={},l=this.name;"function"==typeof k[0]?d=k[0]:"object"==typeof k[0]&&(m=k[0],d=k[1]);k=A.defer();m.type=a;m.method=a;m.url||(m.url=this.baseURL+b);void 0===m.parseResponse&&(m.parseResponse=
!0);p(m);var n=siesta.ext.http.ajax(m);n.success?(n.success(f),n.error(h)):n.done?(n.done(f),n.fail(h)):d("Incompatible ajax function. Could not find success/fail methods on returned promise.");return k.promise}function h(a,b,c){this._serialise(b,function(b,d){var f=d;a.fields&&(f={},x.each(a.fields,function(a){f[a]=d[a]}));c(b,f)})}function m(a,b,c){var d=this,f=Array.prototype.slice.call(arguments,3),e,g={};"function"==typeof f[0]?e=f[0]:"object"==typeof f[0]&&(g=f[0],e=f[1]);var k=A.defer(e);e=
k.finish.bind(k);var f=Array.prototype.slice.call(f,2),m=D.requestDescriptorsForCollection(this),l;g.type=a;g.url=this.baseURL+b;for(var p=0;p<m.length;p++){var v=m[p];if(v._matchConfig(g)){l=v;break}}l?(z.trace.isEnabled&&z.trace("Matched descriptor: "+l._dump(!0)),h.call(l,c,g,function(h,k){z.trace.isEnabled&&z.trace("_serialise",{err:h,data:k});h?e&&e(h,null,null):(g.data=k,g.obj=c,x.partial(n,a,b,g,e).apply(d,f))})):e&&(z.trace.isEnabled&&z.trace("Did not match descriptor"),e("No descriptor matched",
null,null));return k.promise}function d(a,b){var c=Array.prototype.slice.call(arguments,2),d={},f;"function"==typeof c[0]?f=c[0]:"object"==typeof c[0]&&(d=c[0],f=c[1]);var h=A.defer(f),e=d.deletionMode||"restore";void 0===d.parseResponse&&(d.parseResponse=!1);n.call(this,"DELETE",a,d,function(a,c,d,g){a?"restore"==e&&b.restore():"success"==e&&b.remove();f(a,c,d,g);h.finish(a,{x:c,y:d,z:g})});"now"!=e&&"restore"!=e||b.remove();return h.promise}function v(a,b){var c=Array.prototype.slice.call(arguments,
2);return x.partial(a?m:n,b).apply(this,c)}function f(){return x.partial(v,!1,"GET").apply(this,arguments)}function b(){return x.partial(v,!1,"OPTIONS").apply(this,arguments)}function a(){return x.partial(v,!1,"TRACE").apply(this,arguments)}function c(){return x.partial(v,!1,"HEAD").apply(this,arguments)}function k(){return x.partial(v,!0,"POST").apply(this,arguments)}function l(){return x.partial(v,!0,"PUT").apply(this,arguments)}function t(){return x.partial(v,!0,"PATCH").apply(this,arguments)}
if("undefined"==typeof siesta&&"undefined"==typeof r)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var y=siesta._internal;q=y.Collection;var C=y.log,A=y.util,x=A._,w=e("./descriptor"),B=y.error.InternalSiestaError,D=e("./descriptorRegistry").DescriptorRegistry,z=C.loggerWithName("HTTP");e={RequestDescriptor:e("./requestDescriptor").RequestDescriptor,ResponseDescriptor:e("./responseDescriptor").ResponseDescriptor,Descriptor:w.Descriptor,_resolveMethod:w.resolveMethod,
Serialiser:e("./serialiser"),DescriptorRegistry:e("./descriptorRegistry").DescriptorRegistry,_httpResponse:n,_httpRequest:m,DELETE:d,HTTP_METHOD:v,GET:f,TRACE:a,OPTIONS:b,HEAD:c,POST:k,PUT:l,PATCH:t,_serialiseObject:h,Paginator:e("./paginator")};Object.defineProperty(e,"ajax",{get:function(){var a=G||($?$.ajax:null)||(jQuery?jQuery.ajax:null);if(!a)throw new B("ajax has not been defined and could not find $.ajax or jQuery.ajax");return a},set:function(a){G=a}});x.extend(q.prototype,{DELETE:d,GET:f,
TRACE:a,OPTIONS:b,HEAD:c,POST:k,PUT:l,PATCH:t});siesta.ext||(siesta.ext={});siesta.ext.http=e;Object.defineProperties(siesta.ext,{httpEnabled:{get:function(){return void 0!==siesta.ext._httpEnabled?siesta.ext._httpEnabled:!!siesta.ext.http},set:function(a){siesta.ext._httpEnabled=a},enumerable:!0}});var G;q={};x.extend(siesta,{setAjax:function(a){G=a},getAjax:function(){return siesta.ext.http.ajax},serialisers:q,serializers:q});Object.defineProperties(q,{id:{get:function(){return siesta.ext.httpEnabled?
siesta.ext.http.Serialiser.idSerialiser:null}},depth:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.depthSerializer:null}}});"undefined"!=typeof r&&(r.exports=e)},{"./descriptor":31,"./descriptorRegistry":32,"./paginator":34,"./requestDescriptor":35,"./responseDescriptor":36,"./serialiser":37}],34:[function(e,r,q){function g(d){this.opts={};n.extendFromOpts(this.opts,d,{path:"/",model:null,page:"page",queryParams:!0,pageSize:"pageSize",numPages:"numPages",dataPath:"data",
count:"count",type:"GET",dataType:"json"},!1);h.extend(this,{numPages:null,count:null});this.validate()}q=siesta._internal;var p=q.error.InternalSiestaError,n=q.util,h=n._,m=e("querystring");h.extend(g.prototype,{_extract:function(d,h,f){if(d)if("function"==typeof d)h=d(h,f);else for(d=d.split("."),f=0;f<d.length;f++)h=h[d[f]];return h},_extractData:function(d,h){return this._extract(this.opts.dataPath,d,h)},_extractNumPages:function(d,h){return this._extract(this.opts.numPages,d,h)},_extractCount:function(d,
h){return this._extract(this.opts.count,d,h)},_parseURL:function(d){var h=document.createElement("a");h.href=d;return h},page:function(d,e){var f=this,b={};"function"==typeof d?e=d:d&&(b=d);var a=n.defer(e),c=b.page,b=b.pageSize;e=a.finish.bind(a);var g=siesta.ext.http.ajax,l=h.extend({},this.opts),p=this.opts.model.collection.baseURL+this.opts.path;if(this.opts.queryParams){var p=this._parseURL(p),q=p.search,r=q.split("?");1<r.length&&(q=r[1]);q=m.parse(q);c&&(q[this.opts.page]=c);b&&(q[this.opts.pageSize]=
b);Object.keys(q).length&&(p.search="?"+m.stringify(q));p=p.href}else q={},c&&(q[this.opts.page]=c),b&&(q[this.opts.pageSize]=b),l.data=q;h.extend(l,{url:p,success:function(a,b,c){var d=f._extractData(a,c),h=f._extractCount(a,c),g=f._extractNumPages(a,c);f.opts.model.map(d,function(d,k){d?e(d):(f.count=h,f.numPages=g,e(null,k,{data:a,textStatus:b,jqXHR:c}))})},fail:e});g(l);return a.promise},validate:function(){if(!this.opts.model)throw new p("Paginator must have a model");}});r.exports=g},{querystring:41}],
35:[function(e,r,q){function g(d){if(!this)return new g(d);p.call(this,d);this._opts.serializer&&(this._opts.serialiser=this._opts.serializer);this._opts.serialiser||(this._opts.serialiser=n.depthSerializer(0));m.call(this,"serialiser",this._opts);m.call(this,"serializer",this._opts,"serialiser")}var p=e("./descriptor").Descriptor,n=e("./serialiser");e=siesta._internal;var h=e.util;r=h._;var m=h.defineSubProperty,d=e.log.loggerWithName("Descriptor");g.prototype=Object.create(p.prototype);r.extend(g.prototype,
{_serialise:function(e,f){var b=h.defer(f);f=b.finish.bind(b);var a=this;d.trace.isEnabled&&d.trace("_serialise");var c,g=this.serialiser(e,function(b,d){c||(d=a._transformData(d),f&&f(b,a._embedData(d)))});void 0!==g?(d.trace.isEnabled&&d.trace("serialiser doesnt use a callback"),c=!0,g=a._transformData(g),f&&f(null,a._embedData(g))):d.trace.isEnabled&&d.trace("serialiser uses a callback",this.serialiser);return b.promise},_dump:function(d){var f={};f.methods=this.method;f.model=this.model.name;
f.path=this._rawOpts.path;f.serialiser="function"==typeof this._rawOpts.serialiser?"function () { ... }":this._rawOpts.serialiser;var b={},a;for(a in this.transforms)this.transforms.hasOwnProperty(a)&&(b[a]="function"==typeof this.transforms[a]?"function () { ... }":this.transforms[a]);f.transforms=b;return d?h.prettyPrint(f):f}});q.RequestDescriptor=g},{"./descriptor":31,"./serialiser":37}],36:[function(e,r,q){function g(e){if(!this)return new g(e);p.call(this,e)}var p=e("./descriptor").Descriptor;
e=siesta._internal.util._;g.prototype=Object.create(p.prototype);e.extend(g.prototype,{_extractData:function(e){(e=p.prototype._extractData.call(this,e))&&(e=this._transformData(e));return e},_matchData:function(e){(e=p.prototype._matchData.call(this,e))&&(e=this._transformData(e));return e},_dump:function(e){var h={};h.methods=this.method;h.model=this.model.name;h.path=this._rawOpts.path;var g={},d;for(d in this.transforms)this.transforms.hasOwnProperty(d)&&(g[d]="function"==typeof this.transforms[d]?
"function () { ... }":this.transforms[d]);h.transforms=g;return e?util.prettyPrint(h):h}});q.ResponseDescriptor=g},{"./descriptor":31}],37:[function(e,r,q){function g(e){var d=e.model.id;if(d)return e[d]?e[d]:null;n.debug.isEnabled&&n.debug("No idfield")}function p(e,d,g){g=g||function(){};n.trace.isEnabled&&n.trace("depthSerialiser");var f={};h.each(d._attributeNames,function(a){n.trace.isEnabled&&n.trace("field",a);d[a]&&(f[a]=d[a])});var b=[],a=[],c={},k=[];h.each(d._relationshipNames,function(h){n.trace.isEnabled&&
n.trace("relationshipField",h);var q=d.__proxies[h];q.isForward&&(n.debug.isEnabled&&n.debug(h),b.push(h),q.get(function(q,r){n.trace.isEnabled&&n.trace("proxy.get",h);n.debug.isEnabled&&n.debug(h,r);q?(a.push(q),k.push(h),c[h]={err:q,v:r}):r?e?p(e-1,r,function(d,e,m){d?a.push(d):f[h]=e;k.push(h);c[h]={err:d,v:r,resp:m};b.length==k.length&&g&&g(a.length?a:null,f,c)}):(k.push(h),f[h]=r[d.__proxies[h].forwardModel.id],c[h]={err:q,v:r},b.length==k.length&&g&&g(a.length?a:null,f,c)):(n.debug.isEnabled&&
n.debug("no value for "+h),k.push(h),c[h]={err:q,v:r},b.length==k.length&&g&&g(a.length?a:null,f,c))}))});b.length||g(null,f,{})}e=siesta._internal;r=e.util;var n=e.log.loggerWithName("Serialisation"),h=r._;q.depthSerialiser=function(e){return h.partial(p,e)};q.depthSerializer=function(e){return h.partial(p,e)};q.idSerializer=g;q.idSerialiser=g},{}],38:[function(e,r,q){function g(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function p(h){return"function"===typeof h}
function n(h){return"object"===typeof h&&null!==h}r.exports=g;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._maxListeners=void 0;g.defaultMaxListeners=10;g.prototype.setMaxListeners=function(h){if("number"!==typeof h||0>h||isNaN(h))throw TypeError("n must be a positive number");this._maxListeners=h;return this};g.prototype.emit=function(h){var e,d,g,f;this._events||(this._events={});if("error"===h&&(!this._events.error||n(this._events.error)&&!this._events.error.length)){e=arguments[1];
if(e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.');}d=this._events[h];if(void 0===d)return!1;if(p(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:e=arguments.length;g=Array(e-1);for(f=1;f<e;f++)g[f-1]=arguments[f];d.apply(this,g)}else if(n(d)){e=arguments.length;g=Array(e-1);for(f=1;f<e;f++)g[f-1]=arguments[f];d=d.slice();e=d.length;for(f=0;f<e;f++)d[f].apply(this,
g)}return!0};g.prototype.addListener=function(e,m){var d;if(!p(m))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",e,p(m.listener)?m.listener:m);this._events[e]?n(this._events[e])?this._events[e].push(m):this._events[e]=[this._events[e],m]:this._events[e]=m;n(this._events[e])&&!this._events[e].warned&&(d=void 0!==this._maxListeners?this._maxListeners:g.defaultMaxListeners)&&0<d&&this._events[e].length>d&&(this._events[e].warned=
!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace());return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(e,g){function d(){this.removeListener(e,d);n||(n=!0,g.apply(this,arguments))}if(!p(g))throw TypeError("listener must be a function");var n=!1;d.listener=g;this.on(e,d);return this};g.prototype.removeListener=
function(e,g){var d,q,f;if(!p(g))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;d=this._events[e];f=d.length;q=-1;if(d===g||p(d.listener)&&d.listener===g)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,g);else if(n(d)){for(;0<f--;)if(d[f]===g||d[f].listener&&d[f].listener===g){q=f;break}if(0>q)return this;1===d.length?(d.length=0,delete this._events[e]):d.splice(q,1);this._events.removeListener&&this.emit("removeListener",
e,g)}return this};g.prototype.removeAllListeners=function(e){var g;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(g in this._events)"removeListener"!==g&&this.removeAllListeners(g);this.removeAllListeners("removeListener");this._events={};return this}g=this._events[e];if(p(g))this.removeListener(e,g);else for(;g.length;)this.removeListener(e,g[g.length-1]);delete this._events[e];
return this};g.prototype.listeners=function(e){return this._events&&this._events[e]?p(this._events[e])?[this._events[e]]:this._events[e].slice():[]};g.listenerCount=function(e,g){return e._events&&e._events[g]?p(e._events[g])?1:e._events[g].length:0}},{}],39:[function(e,r,q){r.exports=function(e,n,h,m){h=h||"=";var d={};if("string"!==typeof e||0===e.length)return d;var q=/\+/g;e=e.split(n||"&");n=1E3;m&&"number"===typeof m.maxKeys&&(n=m.maxKeys);m=e.length;0<n&&m>n&&(m=n);for(n=0;n<m;++n){var f=e[n].replace(q,
"%20"),b=f.indexOf(h),a;0<=b?(a=f.substr(0,b),f=f.substr(b+1)):(a=f,f="");a=decodeURIComponent(a);f=decodeURIComponent(f);Object.prototype.hasOwnProperty.call(d,a)?g(d[a])?d[a].push(f):d[a]=[d[a],f]:d[a]=f}return d};var g=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],40:[function(e,r,q){function g(e,d){if(e.map)return e.map(d);for(var h=[],f=0;f<e.length;f++)h.push(d(e[f],f));return h}var p=function(e){switch(typeof e){case "string":return e;case "boolean":return e?
"true":"false";case "number":return isFinite(e)?e:"";default:return""}};r.exports=function(e,d,q,f){d=d||"&";q=q||"=";null===e&&(e=void 0);return"object"===typeof e?g(h(e),function(b){var a=encodeURIComponent(p(b))+q;return n(e[b])?g(e[b],function(b){return a+encodeURIComponent(p(b))}).join(d):a+encodeURIComponent(p(e[b]))}).join(d):f?encodeURIComponent(p(f))+q+encodeURIComponent(p(e)):""};var n=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},h=Object.keys||
function(e){var d=[],h;for(h in e)Object.prototype.hasOwnProperty.call(e,h)&&d.push(h);return d}},{}],41:[function(e,r,q){q.decode=q.parse=e("./decode");q.encode=q.stringify=e("./encode")},{"./decode":39,"./encode":40}],42:[function(e,r,q){var g=Object.prototype.hasOwnProperty,p=Object.prototype.toString,n=function(e){if(!e||"[object Object]"!==p.call(e)||e.nodeType||e.setInterval)return!1;var m=g.call(e,"constructor"),d=e.constructor&&e.constructor.prototype&&g.call(e.constructor.prototype,"isPrototypeOf");
if(e.constructor&&!m&&!d)return!1;for(var n in e);return void 0===n||g.call(e,n)};r.exports=function m(){var d,e,f,b,a,c=arguments[0],g=1,l=arguments.length,p=!1;if("boolean"===typeof c)p=c,c=arguments[1]||{},g=2;else if("object"!==typeof c&&"function"!==typeof c||void 0==c)c={};for(;g<l;++g)if(null!=(d=arguments[g]))for(e in d)f=c[e],b=d[e],c!==b&&(p&&b&&(n(b)||(a=Array.isArray(b)))?(a?(a=!1,f=f&&Array.isArray(f)?f:[]):f=f&&n(f)?f:{},c[e]=m(p,f,b)):void 0!==b&&(c[e]=b));return c}},{}],43:[function(e,
r,q){if("undefined"==typeof siesta&&"undefined"==typeof r)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var g=siesta._internal,p=g.CollectionRegistry,n=g.util,h=n._,m=g.events,d=[],v={},f={};e={};var b=g.log.loggerWithName("Storage");if("undefined"==typeof PouchDB)siesta.ext.storageEnabled=!1,console.log("PouchDB is not present therefore storage is disabled.");else{q=function(c){var e=n.defer(c);siesta._afterInstall(function(){c=c||function(){};var g=d;d=
[];v={};f={};b.trace&&b.trace("Saving objects",h.map(g,function(a){return a._dump()}));a(g,c,e)});return e.promise};var a=function(a,d,e){var f=[];y.bulkDocs(h.map(a,t)).then(function(g){for(var h=0;h<g.length;h++){var k=g[h],l=a[h];k.ok?l._rev=k.rev:409==k.status?f.push(l):b.error('Error saving object with _id="'+l._id+'"',k)}f.length?c(f,d,e):(d(),e&&e.resolve())},function(a){d(a);e&&e.reject(a)})},c=function(b,c,d){y.allDocs({keys:h.pluck(b,"_id")}).then(function(e){for(var f=0;f<e.rows.length;f++)b[f]._rev=
e.rows[f].value.rev;a(b,c,d)})["catch"](function(a){d.reject(a)})},k=function(a,c){var d=a.collectionName,e=a.modelName;if(b.trace){var f=d+"."+e;b.trace("Loading instances for "+f)}var g=p[d][e],d=function(a){"$1"==a.model&&"$2"==a.collection&&emit(a._id,a)}.toString().replace("$1",e).replace("$2",d);b.trace.isEnabled&&b.trace("Querying pouch");y.query({map:d}).then(function(a){b.trace.isEnabled&&b.trace("Queried pouch succesffully");a=siesta._.map(siesta._.pluck(a.rows,"value"),function(a){return l(a,
g)});b.trace.isEnabled&&b.trace("Mapping data",a);g.map(a,{disableevents:!0,_ignoreInstalled:!0,callInit:!1},function(a,d){a?b.error("Error loading models",a):b.trace.isEnabled&&b.trace("Loaded "+d?d.length.toString():"0 instances for "+f);c(a,d)})})["catch"](function(a){c(a)})},l=function(a,b){delete a.collection;delete a.model;h.each(b._relationshipNames,function(b){var c=a[b];siesta.isArray(c)?a[b]=h.map(c,function(a){return{_id:a}}):a[b]={_id:c}});return a},t=function(a){var b=siesta._.extend({},
a.__values);b.collection=a.collectionName;b.model=a.modelName;b._id=a._id;a.removed&&(b._deleted=!0);var c=a._rev;c&&(b._rev=c);return b=h.reduce(a._relationshipNames,function(b,c){var d=a[c];siesta.isArray(d)?b[c]=h.pluck(d,"_id"):d&&(b[c]=d._id);return b},b)},y=new PouchDB("siesta"),C=function(a){a=a.obj;var b=a._id;if(!a)throw new g.error.InternalSiestaError("No obj field in notification received by storage extension");if(!(b in v)){v[b]=a;d.push(a);var c=a.collectionName;f[c]||(f[c]={});var e=
a.model.name;f[c][e]||(f[c][e]={});f[c][e][b]=a}};siesta.on("Siesta",C);h.extend(e,{_load:function(a){if(x)throw Error("not loaded yet how can i save");var c=n.defer(a);if(siesta.ext.storageEnabled){var d=[];h.each(p.collectionNames,function(a){var b=Object.keys(p[a]._models);h.each(b,function(b){d.push(function(c){k({collectionName:a,modelName:b},c)})})});siesta.async.parallel(d,function(a,d){if(!a){var e=[];siesta._.each(d,function(a){e.concat(a)});b.trace&&b.trace("Loaded "+e.length.toString()+
" instances")}c.finish(a)})}else c.finish();return c.promise},save:q,_serialise:t,_reset:function(a){siesta.removeListener("Siesta",C);d=[];v={};y.destroy(function(c){c||(y=new PouchDB("siesta"));siesta.on("Siesta",C);b.warn("Reset complete");a(c)})}});Object.defineProperties(e,{_unsavedObjects:{get:function(){return d}},_unsavedObjectsHash:{get:function(){return v}},_unsavedObjectsByCollection:{get:function(){return f}},_pouch:{get:function(){return y}}});siesta.ext||(siesta.ext={});siesta.ext.storage=
e;Object.defineProperties(siesta.ext,{storageEnabled:{get:function(){return void 0!==siesta.ext._storageEnabled?siesta.ext._storageEnabled:!!siesta.ext.storage},set:function(a){siesta.ext._storageEnabled=a},enumerable:!0}});var A,x,w=1E3;Object.defineProperties(siesta,{autosave:{get:function(){return!!A},set:function(a){a?A||(A=setInterval(function(){x||(x=!0,siesta.save(function(a){a||m.emit("saved");x=!1}))},siesta.autosaveInterval)):A&&(clearInterval(A),A=null)}},autosaveInterval:{get:function(){return w},
set:function(a){w=a;A&&(siesta.autosave=!1,siesta.autosave=!0)}},dirty:{get:function(){return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection).length},enumerable:!0}});h.extend(siesta,{save:q,setPouch:function(a){if(siesta._canChange)y=a;else throw Error("Cannot change PouchDB instance when an object graph exists.");}})}r.exports=e},{}],44:[function(e,r,q){(function(e){(function(e){function g(a){for(var b=0;1E3>b&&a.check_();)b++;x&&(e.dirtyCheckCycleCount=b);return 0<b}function h(a){for(var b in a)return!1;
return!0}function m(a){return h(a.added)&&h(a.removed)&&h(a.changed)}function d(a,b){var c={},d={},e={},f;for(f in b){var g=a[f];if(void 0===g||g!==b[f])f in a?g!==b[f]&&(e[f]=g):d[f]=void 0}for(f in a)f in b||(c[f]=a[f]);Array.isArray(a)&&a.length!==b.length&&(e.length=a.length);return{added:c,removed:d,changed:e}}function v(){if(!z.length)return!1;for(var a=0;a<z.length;a++)z[a]();z.length=0;return!0}function f(){function a(c){b&&b.state_===E&&!d&&b.check_(c)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");
e||Object.deliverChangeRecords(a);b=c;e=!1},observe:function(b,d){c=b;d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b;Object.deliverChangeRecords(a);d=!1},close:function(){b=void 0;Object.unobserve(c,a);L.push(this)}}}function b(){this.state_=K;this.value_=this.directObserver_=this.target_=this.callback_=void 0;this.id_=M++}function a(a){b.call(this);this.value_=a;this.oldObject_=void 0}function c(b){if(!Array.isArray(b))throw Error("Provided object is not an Array");a.call(this,
b)}function k(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];O[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"==g.type?g.name in e?delete e[g.name]:d[g.name]=!0:g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(h in e)e[h]=void 0;b={};for(h in c)h in d||h in e||(f=a[h],c[h]!==f&&(b[h]=f));return{added:d,removed:e,changed:b}}function l(a,b,c){return{index:a,
removed:b,addedCount:c}}function t(){}function y(a,b,c,d){b=l(b,c,d);d=!1;for(var e=0,f=0;f<a.length;f++){var g=a[f];g.index+=e;if(!d){c=b.index;var h=b.index+b.removed.length,k=g.index,m=g.index+g.addedCount;c=h<k||m<c?-1:h==k||m==c?0:c<k?h<m?h-k:m-k:m<h?m-c:h-c;0<=c?(a.splice(f,1),f--,e-=g.addedCount-g.removed.length,b.addedCount+=g.addedCount-c,c=b.removed.length+g.removed.length-c,b.addedCount||c?(c=g.removed,b.index<g.index&&(h=b.removed.slice(0,g.index-b.index),Array.prototype.push.apply(h,
c),c=h),b.index+b.removed.length>g.index+g.addedCount&&(h=b.removed.slice(g.index+g.addedCount-b.index),Array.prototype.push.apply(c,h)),b.removed=c,g.index<b.index&&(b.index=g.index)):d=!0):b.index<g.index&&(d=!0,a.splice(f,0,b),f++,c=b.addedCount-b.removed.length,g.index+=c,e+=c)}}d||a.push(b)}function C(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];switch(e.type){case "splice":y(c,e.index,e.removed.slice(),e.addedCount);break;case "add":case "update":case "delete":var f=e.name;if(+f!==f>>>0||
""===f)continue;f=+e.name;if(0>f)continue;y(c,f,[e.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(e))}}return c}function A(a,b){var c=[];C(a,b).forEach(function(b){1==b.addedCount&&1==b.removed.length?b.removed[0]!==a[b.index]&&c.push(b):c=c.concat(J.calcSplices(a,b.index,b.index+b.addedCount,b.removed,0,b.removed.length))});return c}var x=e.testingExposeCycleCount,w=function(){function a(c){b=c}if("function"!==typeof Object.observe||"function"!==typeof Array.observe)return!1;
var b=[],c={},d=[];Object.observe(c,a);Array.observe(d,a);c.id=1;c.id=2;delete c.id;d.push(1,2);d.length=0;Object.deliverChangeRecords(a);if(5!==b.length||"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type)return!1;Object.unobserve(c,a);Array.unobserve(d,a);return!0}(),B=function(){if("undefined"!==typeof chrome&&chrome.app&&chrome.app.runtime||navigator.getDeviceStorage)return!1;try{return(new Function("","return true;"))()}catch(a){return!1}}(),
D="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))});return c},z=[],G=w?function(){var a={pingPong:!0},b=!1;Object.observe(a,function(){v();b=!1});return function(c){z.push(c);b||(b=!0,a.pingPong=!a.pingPong)}}():function(){return function(a){z.push(a)}}(),L=[],K=0,E=1,M=1;b.prototype={open:function(a,c){if(this.state_!=K)throw Error("Observer has already been opened.");
b._allObserversCount++;H&&F.push(this);this.callback_=a;this.target_=c;this.connect_();this.state_=E;return this.value_},close:function(){this.state_==E&&(b._allObserversCount--,this.disconnect_(),this.target_=this.callback_=this.value_=void 0,this.state_=2)},deliver:function(){this.state_==E&&g(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(c){b._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(c.stack||c))}},discardChanges:function(){this.check_(void 0,
!0);return this.value_}};var H=!w,F;b._allObserversCount=0;H&&(F=[]);var I=!1,N=w&&B&&function(){try{return eval("%RunMicrotasks()"),!0}catch(a){return!1}}();e.Platform=e.Platform||{};e.Platform.performMicrotaskCheckpoint=function(){if(!I)if(N)eval("%RunMicrotasks()");else if(H){I=!0;var a=0,b,c;do{a++;c=F;F=[];b=!1;for(var d=0;d<c.length;d++){var f=c[d];f.state_==E&&(f.check_()&&(b=!0),F.push(f))}v()&&(b=!0)}while(1E3>a&&b);x&&(e.dirtyCheckCycleCount=a);I=!1}};H&&(e.Platform.clearObservers=function(){F=
[]});a.prototype=D({__proto__:b.prototype,arrayObserve:!1,connect_:function(a,b){if(w){var c=this.value_,d=this.arrayObserve,e=L.pop()||f();e.open(this);e.observe(c,d);this.directObserver_=e}else this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{},c;for(c in a)b[c]=a[c];Array.isArray(a)&&(b.length=a.length);return b},check_:function(a,b){var c,e;if(w){if(!a)return!1;e={};c=k(this.value_,a,e)}else e=this.oldObject_,c=d(this.value_,this.oldObject_);if(m(c))return!1;
w||(this.oldObject_=this.copyObject(this.value_));this.report_([c.added||{},c.removed||{},c.changed||{},function(a){return e[a]}]);return!0},disconnect_:function(){w?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==E&&(w?this.directObserver_.deliver(!1):g(this))},discardChanges:function(){this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_);return this.value_}});c.prototype=D({__proto__:a.prototype,
arrayObserve:!0,copyObject:function(a){return a.slice()},check_:function(a){if(w){if(!a)return!1;a=A(this.value_,a)}else a=J.calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);if(!a||!a.length)return!1;w||(this.oldObject_=this.copyObject(this.value_));this.report_([a]);return!0}});c.applySplices=function(a,b,c){c.forEach(function(c){for(var d=[c.index,c.removed.length],e=c.index;e<c.index+c.addedCount;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})};var O=
{add:!0,update:!0,"delete":!0};t.prototype={calcEditDistances:function(a,b,c,d,e,f){f=f-e+1;c=c-b+1;for(var g=Array(f),h=0;h<f;h++)g[h]=Array(c),g[h][0]=h;for(var k=0;k<c;k++)g[0][k]=k;for(h=1;h<f;h++)for(k=1;k<c;k++)if(this.equals(a[b+k-1],d[e+h-1]))g[h][k]=g[h-1][k-1];else{var l=g[h-1][k]+1,m=g[h][k-1]+1;g[h][k]=l<m?l:m}return g},spliceOperationsFromEditDistances:function(a){for(var b=a.length-1,c=a[0].length-1,d=a[b][c],e=[];0<b||0<c;)if(0==b)e.push(2),c--;else if(0==c)e.push(3),b--;else{var f=
a[b-1][c-1],g=a[b-1][c],h=a[b][c-1],k;k=g<h?g<f?g:f:h<f?h:f;k==f?(f==d?e.push(0):(e.push(1),d=f),b--,c--):k==g?(e.push(3),b--,d=g):(e.push(2),c--,d=h)}e.reverse();return e},calcSplices:function(a,b,c,d,e,f){var g=0,h=0,k=Math.min(c-b,f-e);0==b&&0==e&&(g=this.sharedPrefix(a,d,k));c==a.length&&f==d.length&&(h=this.sharedSuffix(a,d,k-g));b+=g;e+=g;c-=h;f-=h;if(0==c-b&&0==f-e)return[];if(b==c){for(a=l(b,[],0);e<f;)a.removed.push(d[e++]);return[a]}if(e==f)return[l(b,[],c-b)];f=this.spliceOperationsFromEditDistances(this.calcEditDistances(a,
b,c,d,e,f));a=void 0;c=[];for(g=0;g<f.length;g++)switch(f[g]){case 0:a&&(c.push(a),a=void 0);b++;e++;break;case 1:a||(a=l(b,[],0));a.addedCount++;b++;a.removed.push(d[e]);e++;break;case 2:a||(a=l(b,[],0));a.addedCount++;b++;break;case 3:a||(a=l(b,[],0)),a.removed.push(d[e]),e++}a&&c.push(a);return c},sharedPrefix:function(a,b,c){for(var d=0;d<c;d++)if(!this.equals(a[d],b[d]))return d;return c},sharedSuffix:function(a,b,c){for(var d=a.length,e=b.length,f=0;f<c&&this.equals(a[--d],b[--e]);)f++;return f},
calculateSplices:function(a,b){return this.calcSplices(a,0,a.length,b,0,b.length)},equals:function(a,b){return a===b}};var J=new t,B=e;"undefined"!==typeof q&&("undefined"!==typeof r&&r.exports&&(B=q=r.exports),B=q);B.Observer=b;B.Observer.runEOM_=G;B.Observer.observerSentinel_={};B.Observer.hasObjectObserve=w;B.ArrayObserver=c;B.ArrayObserver.calculateSplices=function(a,b){return J.calculateSplices(a,b)};B.Platform=e.Platform;B.ArraySplice=t;B.ObjectObserver=a})("undefined"!==typeof e&&e&&"undefined"!==
typeof r&&r?e:this||window)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[13]);

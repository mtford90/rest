(function e$$0(t,q,c){function n(k,g){if(!q[k]){if(!t[k]){var m="function"==typeof require&&require;if(!g&&m)return m(k,!0);if(p)return p(k,!0);m=Error("Cannot find module '"+k+"'");throw m.code="MODULE_NOT_FOUND",m;}m=q[k]={exports:{}};t[k][0].call(m.exports,function(h){var d=t[k][1][h];return n(d?d:h)},m,m.exports,e$$0,t,q,c)}return q[k].exports}for(var p="function"==typeof require&&require,k=0;k<c.length;k++)n(c[k]);return n})({1:[function(e,t,q){function c(b){n.call(this,b);this.indexAttribute=
"index"}var n=e("./reactiveQuery");q=e("./log");var p=e("./util"),k=e("./error"),r=e("./modelEvents"),g=k.InternalSiestaError,m=e("./QuerySet"),h=k.errorFactory(k.Components.ArrangedReactiveQuery),d=p._;q.loggerWithName("Query");c.prototype=Object.create(n.prototype);d.extend(c.prototype,{_refreshIndexes:function(){var b=this.results,a=this.indexAttribute;if(!b)throw new g("ArrangedReactiveQuery must be initialised");for(var f=0;f<b.length;f++)b[f][a]=f},_mergeIndexes:function(){for(var b=this.results,
a=[],f=[],l=[],v=0;v<b.length;v++){var w=b[v],h=w[this.indexAttribute];void 0==h?l.push(w):h>b.length?f.push(w):a[h]?l.push(w):a[h]=w}f=d.sortBy(f,function(a){return a[this.indexAttribute]}.bind(this));for(v=0;v<f.length;v++)w=f[v],b=this.results.length-f.length+v,w[this.indexAttribute]=b,a[b]=w;l=this._query._sortResults(l);for(f=0;l.length;){for(w=l.shift();a[f];)f++;a[f]=w;w[this.indexAttribute]=f}this.results=m(a,this.model)},init:function(b){var a=p.defer(b);n.prototype.init.call(this,function(f){f||
(this.model.hasAttributeNamed(this.indexAttribute)?(this._mergeIndexes(),this._query.clearOrdering()):f=h('Model "'+this.model.name+'" does not have an attribute named "'+this.indexAttribute+'"'));a.finish(f,f?null:this.results)}.bind(this));return a.promise},_handleNotif:function(b){b.field!=this.indexAttribute&&(n.prototype._handleNotif.call(this,b),this._refreshIndexes())},validateIndex:function(b){var a=this.results.length-1;if(!(0<=b&&b<=a))throw Error("Index "+b.toString()+" is out of bounds");
},swapObjectsAtIndexes:function(b,a){this.validateIndex(b);this.validateIndex(a);var f=this.results[b],l=this.results[a];if(!f)throw Error('No model at index "'+b.toString()+'"');if(!l)throw Error('No model at index "'+a.toString()+'"');this.results[a]=f;this.results[b]=l;f[this.indexAttribute]=a;l[this.indexAttribute]=b},swapObjects:function(b,a){var f=this.results.indexOf(b),l=this.results.indexOf(a);this.swapObjectsAtIndexes(f,l)},move:function(b,a){this.validateIndex(b);this.validateIndex(a);
var f=this.results.mutableCopy();(function(a,f){if(f>=this.length)for(var b=f-this.length;b--+1;)this.push(void 0)}).call(f,b,a);var l=f.splice(b,1)[0];this.results=f.asModelQuerySet(this.model);this.emit("change",{index:b,removed:[l],type:r.ModelEventType.Splice,obj:this,field:"results"});f.splice(a,0,l);this.results=f.asModelQuerySet(this.model);this.emit("change",{index:a,added:[l],type:r.ModelEventType.Splice,obj:this,field:"results"});this._refreshIndexes()}});t.exports=c},{"./QuerySet":7,"./error":14,
"./log":17,"./modelEvents":20,"./reactiveQuery":22,"./util":25}],2:[function(e,t,q){function c(d){n.call(this,d);this.related=[];this.relatedCancelListeners={}}var n=e("./RelationshipProxy");e("./store");var p=e("./util"),k=p._;e("./error");var r=e("./modelEvents"),g=e("./events").wrapArray;e("./modelInstance");var m=e("../vendor/observe-js/src/observe").ArrayObserver,h=e("./modelEvents").ModelEventType;c.prototype=Object.create(n.prototype);k.extend(c.prototype,{clearReverse:function(d){var b=this;
k.each(d,function(a){var f=b.reverseProxyForInstance(a),l=f.related.indexOf(b.object);f.makeChangesToRelatedWithoutObservations(function(){f.splice(l,1)})})},setReverseOfAdded:function(d){var b=this;k.each(d,function(a){var f=b.reverseProxyForInstance(a);f.makeChangesToRelatedWithoutObservations(function(){f.splice(0,0,b.object)})})},wrapArray:function(d){var b=this;g(d,this.reverseName,this.object);d.arrayObserver||(d.arrayObserver=new m(d),d.arrayObserver.open(function(a){a.forEach(function(a){var l=
a.addedCount?d.slice(a.index,a.index+a.addedCount):[],v=a.removed;b.clearReverse(v);b.setReverseOfAdded(l);var w=b.getForwardModel();r.emit({collection:w.collectionName,model:w.name,_id:b.object._id,field:b.getForwardName(),removed:v,added:l,type:h.Splice,index:a.index,obj:b.object})})}))},get:function(d){var b=p.defer(d);d=b.finish.bind(b);d(null,this.related);return b.promise},validate:function(d){return"[object Array]"!=Object.prototype.toString.call(d)?"Cannot assign scalar to many to many":null},
set:function(d,b){this.checkInstalled();if(d){var a;if(a=this.validate(d))return a;this.clearReverseRelated(b);this.setIdAndRelated(d,b);this.wrapArray(d);this.setIdAndRelatedReverse(d,b)}else this.clearReverseRelated(b),this.setIdAndRelated(d,b)},install:function(d){n.prototype.install.call(this,d);this.wrapArray(this.related);d["splice"+p.capitaliseFirstLetter(this.reverseName)]=k.bind(this.splice,this)},registerRemovalListener:function(d){this.relatedCancelListeners[d._id]=d.listen(function(b){}.bind(this))}});
t.exports=c},{"../vendor/observe-js/src/observe":41,"./RelationshipProxy":9,"./error":14,"./events":15,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25}],3:[function(e,t,q){function c(g){var h=this;this.model=g;n.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]);r.ProxyEventEmitter.call(this);Object.defineProperties(this,{_relationshipNames:{get:function(){var d=p.map(Object.keys(h.__proxies||
{}),function(b){return h.__proxies[b]});return p.map(d,function(b){return b.isForward?b.forwardName:b.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return h._id in siesta.ext.storage._unsavedObjectsHash},enumerable:!0},event:{get:function(){return this._id}}});this.removed=!1}e("./log");var n=e("./util"),p=n._;e("./error");var k=e("./modelEvents"),r=e("./events"),g=e("./cache");c.prototype=Object.create(r.ProxyEventEmitter.prototype);p.extend(c.prototype,
{get:function(g){var h=n.defer(g);g=h.finish.bind(h);g(null,this);return h.promise},emit:function(g,h){"object"==typeof g?h=g:h.type=g;h=h||{};p.extend(h,{collection:this.collectionName,model:this.model.name,_id:this._id,obj:this});k.emit(h)},remove:function(c,h){h=null==h?!0:h;var d=n.defer(c);c=d.finish.bind(d);g.remove(this);this.removed=!0;h&&this.emit(k.ModelEventType.Remove,{old:this});var b=this.model.remove;if(b)if(n.paramNames(b).length){var a=this;b.call(this,function(f){c(f,a)})}else b.call(this),
c(null,this);else c(null,this);return d.promise},restore:function(c){var h=n.defer(c);c=h.finish.bind(h);var d=function(a){a||this.emit(k.ModelEventType.New,{"new":this});c(a,this)}.bind(this);if(this.removed){g.insert(this);this.removed=!1;var b=this.model.init;b?1<n.paramNames(b).length?b.call(this,!0,d):(b.call(this,!0),d()):d()}return h.promise}});p.extend(c.prototype,{getAttributes:function(){return p.extend({},this.__values)},isInstanceOf:function(g){return this.model==g},isA:function(g){return this.model==
g||this.model.isDescendantOf(g)}});p.extend(c.prototype,{_dumpString:function(g){return JSON.stringify(this._dump(g,null,4))},_dump:function(g){g=p.extend({},this.__values);g._rev=this._rev;g._id=this._id;return g}});t.exports=c},{"./cache":11,"./error":14,"./events":15,"./log":17,"./modelEvents":20,"./util":25}],4:[function(e,t,q){function c(d){n.call(this,d);this.isReverse&&(this.related=[])}var n=e("./RelationshipProxy");e("./store");var p=e("./util"),k=p._;e("./error");var r=e("./modelEvents");
e("./modelInstance");var g=e("./events").wrapArray,m=e("../vendor/observe-js/src/observe").ArrayObserver,h=e("./modelEvents").ModelEventType;c.prototype=Object.create(n.prototype);k.extend(c.prototype,{clearReverse:function(d){var b=this;k.each(d,function(a){b.reverseProxyForInstance(a).setIdAndRelated(null)})},setReverseOfAdded:function(d){var b=this;k.each(d,function(a){b.reverseProxyForInstance(a).setIdAndRelated(b.object)})},wrapArray:function(d){var b=this;g(d,this.reverseName,this.object);d.arrayObserver||
(d.arrayObserver=new m(d),d.arrayObserver.open(function(a){a.forEach(function(a){var l=a.addedCount?d.slice(a.index,a.index+a.addedCount):[],v=a.removed;b.clearReverse(v);b.setReverseOfAdded(l);var w=b.getForwardModel();r.emit({collection:w.collectionName,model:w.name,_id:b.object._id,field:b.getForwardName(),removed:v,added:l,type:h.Splice,index:a.index,obj:b.object})})}))},get:function(d){var b=p.defer(d);d=b.finish.bind(b);d(null,this.related);return b.promise},validate:function(d){d=Object.prototype.toString.call(d);
if(this.isForward){if("[object Array]"==d)return"Cannot assign array forward oneToMany ("+d+"): "+this.forwardName}else if("[object Array]"!=d)return"Cannot scalar to reverse oneToMany ("+d+"): "+this.reverseName;return null},set:function(d,b){this.checkInstalled();if(d){var a;if(a=this.validate(d))return a;this.clearReverseRelated(b);this.setIdAndRelated(d,b);this.isReverse&&this.wrapArray(this.related);this.setIdAndRelatedReverse(d,b)}else this.clearReverseRelated(b),this.setIdAndRelated(d,b)},
install:function(d){n.prototype.install.call(this,d);this.isReverse&&(d["splice"+p.capitaliseFirstLetter(this.reverseName)]=k.bind(this.splice,this),this.wrapArray(this.related))}});t.exports=c},{"../vendor/observe-js/src/observe":41,"./RelationshipProxy":9,"./error":14,"./events":15,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25}],5:[function(e,t,q){function c(c){n.call(this,c)}var n=e("./RelationshipProxy");e("./store");var p=e("./util");q=p._;e("./error");e("./modelEvents");e("./modelInstance");
c.prototype=Object.create(n.prototype);q.extend(c.prototype,{validate:function(c){return"[object Array]"==Object.prototype.toString.call(c)?"Cannot assign array to one to one relationship":null},set:function(c,e){this.checkInstalled();if(c){var g;if(g=this.validate(c))return g;this.clearReverseRelated(e);this.setIdAndRelated(c,e);this.setIdAndRelatedReverse(c,e)}else this.clearReverseRelated(e),this.setIdAndRelated(c,e)},get:function(c){var e=p.defer(c);c=e.finish.bind(e);c(null,this.related);return e.promise}});
t.exports=c},{"./RelationshipProxy":9,"./error":14,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25}],6:[function(e,t,q){function c(a,f){var b={},v;for(v in f)f.hasOwnProperty(v)&&"__"==v.slice(0,2)&&(b[v.slice(2)]=f[v],delete f[v]);h.extend(this,{model:a,query:f,opts:b});b.order=b.order||[];k.isArray(b.order)||(b.order=[b.order])}function n(a){var f=a.name;a=p._localCacheByType[a.collectionName];var b;a&&(b=a[f]||{});return b}q=e("./log");var p=e("./cache"),k=e("./util"),r=e("./error"),
g=e("./QuerySet"),m=r.errorFactory(r.Components.Query),h=k._,d=q.loggerWithName("Query"),b={e:function(a){var f=a.object[a.field];d.trace&&d.trace(a.field+": "+(null===f?"null":void 0===f?"undefined":f.toString())+" == "+a.value.toString());return f==a.value},lt:function(a){return a.invalid?!1:a.object[a.field]<a.value},gt:function(a){return a.invalid?!1:a.object[a.field]>a.value},lte:function(a){return a.invalid?!1:a.object[a.field]<=a.value},gte:function(a){return a.invalid?!1:a.object[a.field]>=
a.value},contains:function(a){return a.invalid?!1:-1<a.object[a.field].indexOf(a.value)}};console.log("comparators",b);h.extend(c,{comparators:b,registerComparator:function(a,f){b[a]||(b[a]=f)}});h.extend(c.prototype,{execute:function(a){var f=k.defer(a);a=f.finish.bind(f);this._executeInMemory(a);return f.promise},_dump:function(a){return a?"{}":{}},sortFunc:function(a){for(var f=function(a,f){return function(b,v){var l=b[f],d=v[f];"string"==typeof l||l instanceof String&&"string"==typeof d||d instanceof
String?l=a?l.localeCompare(d):d.localeCompare(l):(l instanceof Date&&(l=l.getTime()),d instanceof Date&&(d=d.getTime()),l=a?l-d:d-l);return l}},b=k,v=0;v<a.length;v++)var d=a[v],b=b.thenBy(f(d.ascending,d.field));return b==k?null:b},_sortResults:function(a){var f=this.opts.order;a&&f&&(f=h.map(f,function(a){a=a.split("-");var f=!0,b=null;1<a.length?(b=a[1],f=!1):b=a[0];return{field:b,ascending:f}}.bind(this)),f=this.sortFunc(f),a.immutable&&(a=a.mutableCopy()),f&&a.sort(f));return a},_getCacheByLocalId:function(){return h.reduce(this.model.descendants,
function(a,f){return h.extend(a,n(f))},h.extend({},n(this.model)))},_executeInMemory:function(a){var f=function(){for(var f=this._getCacheByLocalId(),b=Object.keys(f),w=[],h,c=0;c<b.length;c++){var e=f[b[c]],k=this.objectMatchesQuery(e);if("string"==typeof k){h=m(k);break}else k&&w.push(e)}w=this._sortResults(w);h&&d.error("Error executing query",h);a(h,h?null:g(w,this.model))}.bind(this);this.opts.ignoreInstalled?f():siesta._afterInstall(f)},clearOrdering:function(){this.opts.order=null},objectMatchesOrQuery:function(a,
f){for(var b in f)if(f.hasOwnProperty(b)&&this.objectMatchesBaseQuery(a,f[b]))return!0;return!1},objectMatchesAndQuery:function(a,f){for(var b in f)if(f.hasOwnProperty(b)&&!this.objectMatchesBaseQuery(a,f[b]))return!1;return!0},splitMatches:function(a,b,d){var v="e",w=b.split("."),g=w[w.length-1].split("__");2==g.length?(b=g[0],v=g[1]):b=g[0];w[w.length-1]=b;h.each(w.slice(0,w.length-1),function(b){a=a[b]});w=a[b];w=null===w||void 0===w;console.log("Query.comparators",c.comparators);return(g=c.comparators[v])?
g({object:a,field:b,value:d,invalid:w}):'No comparator registered for query operation "'+v+'"'},objectMatches:function(a,b,d,v){if("$or"==b){if(!this.objectMatchesOrQuery(a,v.$or))return!1}else if("$and"==b){if(!this.objectMatchesAndQuery(a,v.$and))return!1}else{a=this.splitMatches(a,b,d);if("boolean"!=typeof a)return a;if(!a)return!1}return!0},objectMatchesBaseQuery:function(a,b){for(var d=Object.keys(b),v=0;v<d.length;v++){var w=d[v],w=this.objectMatches(a,w,b[w],b);if("boolean"!=typeof w)return w;
if(!w)return!1}return!0},objectMatchesQuery:function(a){return this.objectMatchesBaseQuery(a,this.query)}});t.exports=c},{"./QuerySet":7,"./cache":11,"./error":14,"./log":17,"./util":25}],7:[function(e,t,q){function c(a){return"string"==typeof a||a instanceof String?D.concat(B):"number"==typeof a||a instanceof Number?v.concat(w):a.getOwnPropertyNames()}function n(a,v){v in a||Object.defineProperty(a,v,{get:function(){return g(f.pluck(a,v))},set:function(a){if(d.isArray(a)){if(this.length!=a.length)throw new b({message:"Must be same length"});
for(var f=0;f<a.length;f++)this[f][v]=a[f]}else for(f=0;f<this.length;f++)this[f][v]=a}})}function p(a){return a.then&&a["catch"]}function k(a,b){b in a||(a[b]=function(){var a=arguments,f=this.map(function(f){return f[b].apply(f,a)}),v=!1;f.length&&(v=p(f[0]));return v?siesta.q.all(f):g(f)})}function r(b,v){b=f.extend([],b);v._attributeNames.concat(v._relationshipNames).concat(d).forEach(f.partial(n,b));var d=Object.keys(a.prototype);d.forEach(f.partial(k,b));return h(b)}function g(a){if(a.length){var b=
a[0];c(b).forEach(function(f){"function"==typeof b[f]?k(a,f,arguments):n(a,f)})}return h(a)}function m(){throw Error("Cannot modify a query set");}function h(a){l.forEach(function(b){a[b]=m});a.immutable=!0;a.mutableCopy=a.asArray=function(){var a=f.map(this,function(a){return a});a.asQuerySet=function(){return g(this)};a.asModelQuerySet=function(a){return r(this,a)};return a};return a}var d=e("./util"),b=e("./error").SiestaUserError,a=e("./ModelInstance"),f=e("./util")._,l="push sort reverse splice shift unshift".split(" "),
v=["toString","toExponential","toFixed","toPrecision","valueOf"],w=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],D="charAt charCodeAt concat fromCharCode indexOf lastIndexOf localeCompare match replace search slice split substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim valueOf".split(" "),B=["length"];t.exports=r},{"./ModelInstance":3,"./error":14,"./util":25}],8:[function(e,t,q){function c(b){var a=this;n.call(this);h.extend(this,
{_query:b,results:g([],b.model),insertionPolicy:c.InsertionPolicy.Back,initialised:!1});Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){return a._query.model}},collection:{get:function(){return a.model.collectionName}}})}q=e("./log");e("./Query");var n=e("events").EventEmitter,p=e("./events"),k=e("./modelEvents"),r=e("./error").InternalSiestaError,g=e("./QuerySet"),m=e("./util"),h=m._,d=q.loggerWithName("Query");c.prototype=Object.create(n.prototype);
h.extend(c,{InsertionPolicy:{Front:"Front",Back:"Back"}});h.extend(c.prototype,{init:function(b){d.trace&&d.trace("init");var a=m.defer(b);b=a.finish.bind(a);this.initialised?b(null,this.results):this._query.execute(function(a,l){if(a)b(a);else{this.results=l;if(!this.handler){var v=this._constructNotificationName(),w=function(a){this._handleNotif(a)}.bind(this);this.handler=w;p.on(v,w)}d.trace&&d.trace("Listening to "+v);this.initialised=!0;b(null,this.results)}}.bind(this));return a.promise},insert:function(b){var a=
this.results.mutableCopy();b=this.insertionPolicy==c.InsertionPolicy.Back?a.push(b):a.unshift(b);this.results=a.asModelQuerySet(this.model);return b},_handleNotif:function(b){d.trace&&d.trace("_handleNotif",b);if(b.type==k.ModelEventType.New){var a=b["new"];if(this._query.objectMatchesQuery(a)){d.trace&&d.trace("New object matches",a._dumpString());var f=this.insert(a);this.emit("change",{index:f,added:[a],type:k.ModelEventType.Splice,obj:this})}else d.trace&&d.trace("New object does not match",a._dumpString())}else if(b.type==
k.ModelEventType.Set){var a=b.obj,f=this.results.indexOf(a),l=-1<f,v=this._query.objectMatchesQuery(a);v&&!l?(d.trace&&d.trace("Updated object now matches!",a._dumpString()),f=this.insert(a),this.emit("change",{index:f,added:[a],type:k.ModelEventType.Splice,obj:this})):!v&&l?(d.trace&&d.trace("Updated object no longer matches!",a._dumpString()),l=this.results.mutableCopy(),b=l.splice(f,1),this.results=l.asModelQuerySet(this.model),this.emit("change",{index:f,obj:this,"new":a,type:k.ModelEventType.Splice,
removed:b})):v||l?v&&l&&(d.trace&&d.trace("Matches but already contains",a._dumpString()),this.emit("change",b)):d.trace&&d.trace("Does not contain, but doesnt match so not inserting",a._dumpString())}else if(b.type==k.ModelEventType.Remove)a=b.obj,l=this.results.mutableCopy(),f=l.indexOf(a),-1<f?(d.trace&&d.trace("Removing object",a._dumpString()),b=l.splice(f,1),this.results=g(l,this.model),this.emit("change",{index:f,obj:this,type:k.ModelEventType.Splice,removed:b})):d.trace&&d.trace("No modelEvents neccessary.",
a._dumpString());else throw new r('Unknown change type "'+b.type.toString()+'"');this.results=g(this._query._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&p.removeListener(this._constructNotificationName(),this.handler);this.handler=this.results=null},listen:function(b){this.on("change",b);return function(){this.removeListener("change",b)}.bind(this)},listenOnce:function(b){this.once("change",
b)}});t.exports=c},{"./Query":6,"./QuerySet":7,"./error":14,"./events":15,"./log":17,"./modelEvents":20,"./util":25,events:35}],9:[function(e,t,q){function c(d){var b=this;d=d||{};k.extend(this,{object:null,related:null});Object.defineProperties(this,{isForward:{get:function(){return!b.isReverse},set:function(a){b.isReverse=!a},enumerable:!0}});p.extendFromOpts(this,d,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null});this.cancelListens={}}var n=e("./error").InternalSiestaError;
e("./store");var p=e("./util"),k=p._;e("./Query");e("./log");e("./cache");var r=e("./events").wrapArray,g=e("../vendor/observe-js/src/observe").ArrayObserver,m=e("./modelEvents"),h=m.ModelEventType;k.extend(c,{});k.extend(c.prototype,{install:function(d){if(d){if(this.object)throw new n("Already installed.");this.object=d;var b=this,a=this.getForwardName();Object.defineProperty(d,a,{get:function(){return b.related},set:function(a){b.set(a)},configurable:!0,enumerable:!0});d.__proxies||(d.__proxies=
{});d.__proxies[a]=this;d._proxies||(d._proxies=[]);d._proxies.push(this)}else throw new n("No object passed to relationship install");}});k.extend(c.prototype,{set:function(d,b){throw new n("Must subclass RelationshipProxy");},get:function(d){throw new n("Must subclass RelationshipProxy");}});k.extend(c.prototype,{proxyForInstance:function(d,b){var a=b?this.getReverseName():this.getForwardName(),f=b?this.reverseModel:this.forwardModel;if(p.isArray(d))f=k.map(d,function(b){return b.__proxies[a]});
else{var l=d.__proxies[a];if(!l)throw new n('No proxy with name "'+a+'" on mapping '+f.name);f=l}return f},reverseProxyForInstance:function(d){return this.proxyForInstance(d,!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},clearRemovalListener:function(d){d=d._id;var b=this.cancelListens[d];b&&
(b(),this.cancelListens[d]=null)},listenForRemoval:function(d){this.cancelListens[d._id]=d.listen(function(b){b.type==h.Remove&&(p.isArray(this.related)?(b=this.related.indexOf(d),this.splice(b,1)):this.setIdAndRelated(null),this.clearRemovalListener(d))}.bind(this))},setIdAndRelated:function(d,b){b=b||{};b.disableevents||this.registerSetChange(d);var a=this.related;a&&this.clearRemovalListener(a);d?p.isArray(d)?(this.related=d,d.forEach(function(a){this.listenForRemoval(a)}.bind(this))):(this.related=
d,this.listenForRemoval(d)):this.related=null},checkInstalled:function(){if(!this.object)throw new n("Proxy must be installed on an object before can use it.");},splicer:function(d){d=d||{};return function(b,a){d=d||{};d.disableevents||this.registerSpliceChange.apply(this,arguments);var f=Array.prototype.slice.call(arguments,2);return k.partial(this.related.splice,b,a).apply(this.related,f)}.bind(this)},clearReverseRelated:function(d){d=d||{};var b=this;if(this.related){var a=this.reverseProxyForInstance(this.related),
a=p.isArray(a)?a:[a];k.each(a,function(a){if(p.isArray(a.related)){var l=a.related.indexOf(b.object);a.makeChangesToRelatedWithoutObservations(function(){a.splicer(d)(l,1)})}else a.setIdAndRelated(null,d)})}},setIdAndRelatedReverse:function(d,b){var a=this,f=this.reverseProxyForInstance(d),f=p.isArray(f)?f:[f];k.each(f,function(f){p.isArray(f.related)?f.makeChangesToRelatedWithoutObservations(function(){f.splicer(b)(f.related.length,0,a.object)}):(f.clearReverseRelated(b),f.setIdAndRelated(a.object,
b))})},makeChangesToRelatedWithoutObservations:function(d){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,d(),this.wrapArray(this.related)):d()},registerSetChange:function(d){var b=this.object;if(!b)throw new n("Proxy must have an object associated");var a=b.model.name,f=b.collectionName,l=this.related;p.isArray(l)&&!l.length&&(l=null);m.emit({collection:f,model:a,_id:b._id,field:this.getForwardName(),old:l,"new":d,type:h.Set,obj:b})},registerSpliceChange:function(d,
b){var a=Array.prototype.slice.call(arguments,2);m.emit({collection:this.object.collectionName,model:this.object.model.name,_id:this.object._id,field:this.getForwardName(),index:d,removed:this.related?this.related.slice(d,d+b):null,added:a.length?a:[],type:h.Splice,obj:this.object})},wrapArray:function(d){var b=this;r(d,this.reverseName,this.object);d.arrayObserver||(d.arrayObserver=new g(d),d.arrayObserver.open(function(a){a.forEach(function(a){var l=a.addedCount?d.slice(a.index,a.index+a.addedCount):
[],v=b.getForwardModel();m.emit({collection:v.collectionName,model:v.name,_id:b.object._id,field:b.getForwardName(),removed:a.removed,added:l,type:h.Splice,obj:b.object})})}))},splice:function(){this.splicer({}).apply(this,arguments)}});t.exports=c},{"../vendor/observe-js/src/observe":41,"./Query":6,"./cache":11,"./error":14,"./events":15,"./log":17,"./modelEvents":20,"./store":23,"./util":25}],10:[function(e,t,q){t.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},{}],
11:[function(e,t,q){function c(a){var b=a.name;if(a=f[a.collectionName])if(b=a[b]){a=[];for(var d in b)b.hasOwnProperty(d)&&a.push(b[d]);if(1<a.length)throw new h("A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.");if(a.length)return a[0]}return null}function n(a,f){var d=f.model.name,h=f.model.collectionName;if(l[h]&&(d=
l[h][d]))return(d=d[a])?b.debug&&b.debug("Remote cache hit: "+d._dump(!0)):b.debug&&b.debug("Remote cache miss: "+a),d;b.debug&&b.debug("Remote cache miss: "+a);return null}function p(a,f,d){if(a){var g=a.model.collectionName;if(g){l[g]||(l[g]={});var c=a.model.name;if(c)if(l[g][c]||(l[g][c]={}),d&&(l[g][c][d]=null),d=l[g][c][f]){if(a!=d)throw f="Object "+g.toString()+":"+c.toString()+"["+a.model.id+'="'+f+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild',
b.error(f,{obj:a,cachedObject:d}),new h(f);b.debug.isEnabled&&b.debug("Object has already been inserted: "+a._dump(!0))}else l[g][c][f]=a,b.debug.isEnabled&&b.debug("Remote cache insert: "+a._dump(!0)),b.trace.isEnabled&&b.trace("Remote cache now looks like: "+k(!0));else throw new h("Model has no type",{model:a.model,obj:a});}else throw new h("Model has no collection",{model:a.model,obj:a});}else throw b.error("Must pass an object when inserting to cache"),new h("Must pass an object when inserting to cache");
}function k(a){var b={},f;for(f in l)if(l.hasOwnProperty(f)){var h={};b[f]=h;var g=l[f],c;for(c in g)if(g.hasOwnProperty(c)){var e={};h[c]=e;var k=g[c],m;for(m in k)k.hasOwnProperty(m)&&k[m]&&(e[m]=k[m]._dump())}}return a?d.prettyPrint((b,null,4)):b}function r(b){var f={},l;for(l in a)a.hasOwnProperty(l)&&(f[l]=a[l]._dump());return b?d.prettyPrint((f,null,4)):f}function g(f){b.debug.isEnabled&&b.debug("get",f);var d,l;if(d=f._id){(l=a[d])?b.debug.isEnabled&&b.debug("Local cache hit: "+l._dump(!0)):
b.debug.isEnabled&&b.debug("Local cache miss: "+d);if(l)return l;if(f.model)return d=f.model.id,l=f[d],b.debug.isEnabled&&b.debug(d+"="+l),n(l,f)}else if(f.model){d=f.model.id;if(l=f[d])return n(l,f);if(f.model.singleton)return c(f.model)}else b.warn("Invalid opts to cache",{opts:f});return null}function m(a){var b={_id:a._id},f=a.model;f.id&&a[f.id]&&(b.model=f,b[f.id]=a[f.id]);return!!g(b)}t=e("./log");var h=e("./error").InternalSiestaError,d=e("./util"),b=t.loggerWithName("Cache"),a={},f={},l=
{};q._remoteCache=function(){return l};q._localCache=function(){return a};Object.defineProperty(q,"_localCacheByType",{get:function(){return f}});q.get=g;q.insert=function(d){var l=d._id;if(l){var g=d.model.collectionName,c=d.model.name;b.debug.isEnabled&&b.debug("Local cache insert: "+d._dumpString());if(!a[l])a[l]=d,b.trace.isEnabled&&b.trace("Local cache now looks like: "+r(!0)),f[g]||(f[g]={}),f[g][c]||(f[g][c]={}),f[g][c][l]=d;else if(a[l]!=d)throw d='Object with _id="'+l.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild',
b.error(d),new h(d);}l=d.idField;(g=d[l])?p(d,g):b.debug.isEnabled&&b.debug('No remote id ("'+l+'") so wont be placing in the remote cache',d)};q.remoteInsert=p;q.reset=function(){l={};a={};f={}};q._dump=function(a){var b={localCache:r(),remoteCache:k()};return a?d.prettyPrint((b,null,4)):b};q.contains=m;q.remove=function(b){if(m(b)){var d=b.model.collectionName,g=b.model.name,c=b._id;if(!g)throw h("No mapping name");if(!d)throw h("No collection name");if(!c)throw h("No _id");delete f[d][g][c];delete a[c];
b.model.id&&(b=b[b.model.id])&&delete l[d][g][b]}else throw new h("Object was not in cache.");};q.getSingleton=c},{"./error":14,"./log":17,"./util":25}],12:[function(e,t,q){function c(a,b){var f=this;if(!a)throw Error("Collection must have a name");b=b||{};m.extendFromOpts(this,b,{baseURL:""});h.extend(this,{name:a,_rawModels:{},_models:{},_opts:b,installed:!1});Object.defineProperties(this,{dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection[f.name]||
{}).length},enumerable:!0}});n.register(this);g.ProxyEventEmitter.call(this,this.name)}q=e("./log");var n=e("./collectionRegistry").CollectionRegistry,p=e("./error").InternalSiestaError,k=e("./model"),r=e("extend");e("../vendor/observe-js/src/observe");var g=e("./events"),m=e("./util"),h=m._,d=e("./error"),b=d.errorFactory(d.Components.Collection);e("./cache");var a=["PUT","PATCH","POST","DELETE"],f=q.loggerWithName("Collection");c.prototype=Object.create(g.ProxyEventEmitter.prototype);h.extend(c.prototype,
{install:function(a){var b=m.defer(a),d=this;if(this.installed)throw new p('Collection "'+this.name+'" has already been installed');var g=[],c;for(c in this._models)this._models.hasOwnProperty(c)&&g.push(this._models[c]);f.info.isEnabled&&f.info("There are "+g.length.toString()+" mappings to install");g.length?(a=h.map(g,function(a){return h.bind(a.install,a)}),m.async.parallel(a,function(a){if(a)f.error("Failed to install collection",a);else{d.installed=!0;var l=[];h.each(g,function(a){f.info.isEnabled&&
f.info('Installing relationships for mapping with name "'+a.name+'"');(a=a.installRelationships())&&l.push(a)});l.length||h.each(g,function(a){f.info.isEnabled&&f.info('Installing reverse relationships for mapping with name "'+a.name+'"');(a=a.installReverseRelationships())&&l.push(a)});1==l.length?a=l[0]:l.length&&(a=l)}d._finaliseInstallation(a,b.finish.bind(b))})):d._finaliseInstallation(null,b.finish.bind(b));return b.promise},_finaliseInstallation:function(a,f){a&&(a=b("Errors were encountered whilst setting up the collection",
{errors:a}));a||(this.installed=!0,e("./index")[this.name]=this);f(a)},_model:function(a,b){if(a){this._rawModels[a]=b;b=r(!0,{},b);b.name=a;b.collection=this;var f=new k(b);this._models[a]=f;return this[a]=f}throw Error("No name specified when creating mapping");},model:function(a){if(this.installed)throw Error("Cannot create new models once the object graph is established!");var b=this;if(arguments.length){if(1==arguments.length){if(m.isArray(arguments[0]))return h.map(arguments[0],function(a){return b._model(a.name,
a)});var f,d;m.isString(arguments[0])?(f=arguments[0],d={}):(d=arguments[0],f=d.name);return this._model(f,d)}return"string"==typeof arguments[0]?this._model(arguments[0],arguments[1]):h.map(arguments,function(a){return b._model(a.name,a)})}return null},descriptor:function(b){var f=[];if(siesta.ext.httpEnabled){b.collection=this;for(var d=siesta.ext.http._resolveMethod(b.method),g=[],h=[],c=0;c<d.length;c++){var e=d[c];-1<a.indexOf(e)?g.push(e):h.push(e)}g.length&&(d=r({},b),d.method=g,d=new siesta.ext.http.RequestDescriptor(d),
siesta.ext.http.DescriptorRegistry.registerRequestDescriptor(d),f.push(d));h.length&&(b=r({},b),b.method=h,b=new siesta.ext.http.ResponseDescriptor(b),siesta.ext.http.DescriptorRegistry.registerResponseDescriptor(b),f.push(b))}else throw Error("HTTP module not installed.");return f},_dump:function(a){var b={};b.installed=this.installed;b.docId=this._docId;b.name=this.name;b.baseURL=this.baseURL;return a?m.prettyPrint(b):b},count:function(a){var b=m.defer(a);a=h.map(this._models,function(a){return h.bind(a.count,
a)});m.async.parallel(a,function(a,f){var d;a||(d=h.reduce(f,function(a,b){return a+b},0));b.finish(a,d)});return b.promise}});t.exports=c},{"../vendor/observe-js/src/observe":41,"./cache":11,"./collectionRegistry":13,"./error":14,"./events":15,"./index":16,"./log":17,"./model":19,"./util":25,extend:39}],13:[function(e,t,q){function c(){if(!this)return new c;this.collectionNames=[]}var n=e("./util")._;n.extend(c.prototype,{register:function(c){var e=c.name;this[e]=c;this.collectionNames.push(e)},
reset:function(){var c=this;n.each(this.collectionNames,function(e){delete c[e]});this.collectionNames=[]}});q.CollectionRegistry=new c},{"./util":25}],14:[function(e,t,q){function c(c,e,g){this.message=c;this.context=e;(g=g||arguments.callee)&&Error.captureStackTrace&&Error.captureStackTrace(this,g)}function n(c,e,g){g=g||{};this.component=c;this.message=e;for(var m in g)g.hasOwnProperty(m)&&(this[m]=g[m]);this.isUserError=!0}c.prototype=Object.create(Error.prototype);c.prototype.name="InternalSiestaError";
c.prototype.constructor=c;e={Unknown:0,NoDescriptorMatched:1};var p={Mapping:"Mapping",HTTP:"HTTP",ReactiveQuery:"ReactiveQuery",ArrangedReactiveQuery:"ArrangedReactiveQuery",Collection:"Collection",Query:"Query"};q={};q[e.NoDescriptorMatched]="No descriptor matched the HTTP response/request.";t.exports={InternalSiestaError:c,SiestaUserError:n,ErrorCode:e,ErrorField:{Message:"message",Code:"code"},Message:q,Components:p,errorFactory:function(c){if(c in p)return function(e,g){return new n(c,e,g)};
throw new n('No such component "'+c+'"');}}},{}],15:[function(e,t,q){function c(g){p.extend(this,{event:g,listeners:{}})}q=e("events").EventEmitter;var n=e("../vendor/observe-js/src/observe").ArrayObserver,p=e("./util")._,k=e("./modelEvents"),r=new q;r.setMaxListeners(100);p.extend(c.prototype,{listen:function(g,c){if("function"==typeof g)c=g,g=null;else{var h=c;c=function(b){b=b||{};g?b.type==g&&h(b):h(b)};var d=this.listeners;g&&(d[g]||(d[g]=[]),d[g].push(c))}r.on(this.event,c);return function(){this._removeListener(c,
g)}.bind(this)},listenOnce:function(g,c){var h=this.event;if("function"==typeof g)c=g,g=null;else{var d=c;c=function(b){b=b||{};g?b.type==g&&(r.removeListener(h,c),d(b)):d(b)}}return g?r.on(h,c):r.once(h,c)},_removeListener:function(g,c){if(c){var h=this.listeners[c],d=h.indexOf(g);h.splice(d,1)}return r.removeListener(this.event,g)},emit:function(c,e){"object"==typeof c?e=c:(e=e||{},e.type=c);r.emit.call(r,this.event,e)},_removeAllListeners:function(c){(this.listeners[c]||[]).forEach(function(c){r.removeListener(this.event,
c)}.bind(this));this.listeners[c]=[]},removeAllListeners:function(c){if(c)this._removeAllListeners(c);else for(c in this.listeners)this.listeners.hasOwnProperty(c)&&this._removeAllListeners(c)}});p.extend(c.prototype,{on:c.prototype.listen});p.extend(r,{ProxyEventEmitter:c,wrapArray:function(c,e,h){c.observer||(c.observer=new n(c),c.observer.open(function(d){-1<h._attributeNames.indexOf(e)&&d.forEach(function(b){k.emit({collection:h.collectionName,model:h.model.name,_id:h._id,index:b.index,removed:b.removed,
added:b.addedCount?c.slice(b.index,b.index+b.addedCount):[],type:k.ModelEventType.Splice,field:e,obj:h})})}))}});t.exports=r},{"../vendor/observe-js/src/observe":41,"./modelEvents":20,"./util":25,events:35}],16:[function(e,t,q){var c=e("./util"),n=e("./collectionRegistry").CollectionRegistry,p=e("./collection"),k=e("./cache");q=e("./model");var r=e("./error"),g=e("./events"),m=e("./RelationshipType"),h=e("./ReactiveQuery"),d=e("./ManyToManyProxy"),b=e("./OneToOneProxy"),a=e("./OneToManyProxy"),f=
e("./RelationshipProxy"),l=e("./modelEvents"),v=e("./Query"),w=e("./QuerySet"),D=e("./log"),B=c._,y=function(a){y.ext||(y.ext={});B.extend(y.ext,a||{});return y};Object.defineProperty(y,"q",{get:function(){return this._q||window.q||window.Q},set:function(a){this._q=a}});B.extend(y,{on:g.on.bind(g),off:g.removeListener.bind(g),once:g.once.bind(g),removeAllListeners:g.removeAllListeners.bind(g)});B.extend(y,{removeListener:y.off,addListener:y.on});B.extend(y,{RelationshipType:m,ModelEventType:l.ModelEventType,
log:D.Level,InsertionPolicy:h.InsertionPolicy,_internal:{log:D,Model:q,error:r,ModelEventType:l.ModelEventType,ModelInstance:e("./modelInstance"),extend:e("extend"),MappingOperation:e("./mappingOperation"),events:g,ProxyEventEmitter:g.ProxyEventEmitter,cache:e("./cache"),modelEvents:l,CollectionRegistry:e("./collectionRegistry").CollectionRegistry,Collection:p,utils:c,util:c,_:c._,querySet:w,observe:e("../vendor/observe-js/src/observe"),Query:v,Store:e("./store"),ManyToManyProxy:d,OneToManyProxy:a,
OneToOneProxy:b,RelationshipProxy:f},_:c._,async:c.async,isArray:c.isArray,isString:c.isString});y.ext={};var x=!1,A=!1;B.extend(y,{reset:function(a){A=x=!1;delete this.queuedTasks;k.reset();n.reset();g.removeAllListeners();y.ext.httpEnabled&&y.ext.http.DescriptorRegistry.reset();y.ext.storageEnabled?y.ext.storage._reset(a):a()},resetData:function(a){var b=c.defer(a);a=b.finish.bind(b);y.ext.storage._reset(function(){var b=[],f=n.collectionNames.reduce(function(a,f){var d=n[f]._models;b.push(f);Object.keys(d).forEach(function(b){var f=
d[b];a.push(function(a){f.all(function(b,f){b||f.remove();a(b)})})});return a},[]);c.async.series([B.partial(c.async.parallel,f)],a)});return b.promise},collection:function(a,b){return new p(a,b)},install:function(a){if(A||x)throw new r.InternalSiestaError("Already installing...");A=!0;var b=c.defer(a);a=b.finish.bind(b);var f=B.map(n.collectionNames,function(a){return function(b){n[a].install(b)}}),d=this;y.async.series(f,function(b){if(b)a(b);else{if(y.ext.httpEnabled){b=function(a){Object.keys(a).forEach(function(b){a[b].forEach(function(a){a=
a._resolveCollectionAndModel();console.log("error",a);a&&f.push(a)})})};var f=[],l=y.ext.http.DescriptorRegistry,c=l.responseDescriptors;b(l.requestDescriptors);b(c);console.log("errors",f);if(f.length){a(f);return}}y.ext.storageEnabled?y.ext.storage._load(function(b){b||(x=!0,d.queuedTasks&&d.queuedTasks.execute());a(b)}):(x=!0,d.queuedTasks&&d.queuedTasks.execute(),a())}});return b.promise},_pushTask:function(a){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[];this.execute=function(){this.tasks.forEach(function(a){a()});
this.tasks=[]}.bind(this)});this.queuedTasks.tasks.push(a)},_afterInstall:function(a){x?a():(A||this.install(function(a){a&&console.error("Error setting up siesta",a);delete this.queuedTasks}.bind(this)),x?a():this._pushTask(a))},setLogLevel:function(a,b){D.loggerWithName(a).setLevel(b)},notify:c.next,registerComparator:v.registerComparator.bind(v)});Object.defineProperties(y,{_canChange:{get:function(){return!(A||x)}}});"undefined"!=typeof window&&(window.siesta=y);t.exports=y;var C=Function.prototype.apply.bind(Function.prototype.bind);
Object.defineProperty(Function.prototype,"bind",{value:function(a){var b=C(this,arguments);Object.defineProperty(b,"__siesta_bound_object",{value:a,writable:!0,configurable:!0,enumerable:!1});return b}});e("../http");e("../storage")},{"../http":30,"../storage":40,"../vendor/observe-js/src/observe":41,"./ManyToManyProxy":2,"./OneToManyProxy":4,"./OneToOneProxy":5,"./Query":6,"./QuerySet":7,"./ReactiveQuery":8,"./RelationshipProxy":9,"./RelationshipType":10,"./cache":11,"./collection":12,"./collectionRegistry":13,
"./error":14,"./events":15,"./log":17,"./mappingOperation":18,"./model":19,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25,extend:39}],17:[function(e,t,q){function c(e){if(!this)return new c(e);this.name=e;k[e]=c.Level.warn;this.trace=n(this,p.bind(console.debug?console.debug:console.log,console),c.Level.trace);this.debug=n(this,p.bind(console.debug?console.debug:console.log,console),c.Level.debug);this.info=n(this,p.bind(console.info?console.info:console.log,console),c.Level.info);
this.log=n(this,p.bind(console.log,console),c.Level.info);this.warn=n(this,p.bind(console.warn?console.warn:console.log,console),c.Level.warning);this.error=n(this,p.bind(console.error?console.error:console.log,console),c.Level.error);this.fatal=n(this,p.bind(console.error?console.error:console.log,console),c.Level.fatal)}function n(c,g,e){var h=function(d){c.performLog(g,e,d,arguments)};Object.defineProperty(h,"isEnabled",{get:function(){var d=c.currentLevel();return e>=d},enumerable:!0,configurable:!0});
h.f=g;h.logger=c;h.level=e;return h}var p=e("./util")._,k={};c.Level={trace:0,debug:1,info:2,warning:3,warn:3,error:4,fatal:5};c.LevelText={};c.LevelText[c.Level.trace]="TRACE";c.LevelText[c.Level.debug]="DEBUG";c.LevelText[c.Level.info]="INFO ";c.LevelText[c.Level.warning]="WARN ";c.LevelText[c.Level.error]="ERROR";c.levelAsText=function(c){return this.LevelText[c]};c.loggerWithName=function(e){return new c(e)};c.prototype.currentLevel=function(){var e=k[this.name];return e?e:c.Level.trace};c.prototype.setLevel=
function(c){k[this.name]=c};c.prototype.override=function(e,g,k){var h=this[c.levelAsText(e).trim().toLowerCase()].f,d=Array.prototype.slice.call(arguments,3,arguments.length);this.performLog(h,e,k,d,g)};c.prototype.performLog=function(e,g,k,h,d){if((void 0!==d?d:this.currentLevel())<=g){e=p.partial(e,c.levelAsText(g)+" ["+this.name+"]: "+k);g=[];for(k=0;k<h.length;k++)g[k]=h[k];g.splice(0,1);e.apply(e,g)}};t.exports=c},{"./util":25}],18:[function(e,t,q){function c(d){this._opts=d;r.extendFromOpts(this,
d,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,fromStorage:!1});g.extend(this,{errors:[],subTaskResults:{},_newObjects:[]})}var n=e("./store"),p=e("./modelInstance");q=e("./log");e("./error");var k=e("./cache"),r=e("./util"),g=r._,m=r.async;e("./modelEvents");var h=q.loggerWithName("Mapping");h.setLevel(q.Level.trace);g.extend(c.prototype,{mapAttributes:function(){for(var d=0;d<this.data.length;d++){var b=this.data[d],a=this.objects[d];b!=a&&a&&(g.each(this.model._attributeNames,
function(f){void 0!==b[f]&&(this.disableevents?a.__values[f]=b[f]:a[f]=b[f])}.bind(this)),b._rev&&(a._rev=b._rev))}},_map:function(){var d=this,b;this.mapAttributes();var a=g.keys(d.subTaskResults);g.each(a,function(a){for(var l=d.subTaskResults[a],c=l.indexes,l=l.objects,h=d.getRelatedData(a).relatedData,l=r.unflattenArray(l,h),h=0;h<l.length;h++){var g=c[h],e=d.errors[g];b=e?e[a]:null;if(!b){var e=l[h],k=d.objects[g];k&&(b=k.__proxies[a].set(e,{disableevents:d.disableevents}))&&(d.errors[g]||(d.errors[g]=
{}),d.errors[g][a]=b)}}})},_lookup:function(d){var b=r.defer(d);d=b.finish.bind(b);for(var a=this,f=[],l=[],c=0;c<this.data.length;c++)if(!this.objects[c]){var e,m=this.data[c];e="string"==typeof m||"number"==typeof m||m instanceof String;m?e?(e={index:c,datum:{}},e.datum[a.model.id]=m,f.push(e)):m instanceof p?this.objects[c]=m:m._id?l.push({index:c,datum:m}):m[a.model.id]?f.push({index:c,datum:m}):this.objects[c]=a._new():this.objects[c]=null}r.async.parallel([function(b){var f=g.pluck(g.pluck(l,
"datum"),"_id");f.length?n.getMultipleLocal(f,function(d,c){if(!d)for(var h=0;h<f.length;h++){var g=c[h],e=f[h],v=l[h];g||(g=k.get({_id:e}))||(g=a._new({_id:e},!a.disableevents));a.objects[v.index]=g}b(d)}):b()},function(b){var d=g.pluck(g.pluck(f,"datum"),a.model.id);d.length?(h.trace.isEnabled&&h.trace("Looking up remoteIdentifiers: "+r.prettyPrint(d)),n.getMultipleRemote(d,a.model,function(l,g){if(!l){if(h.trace.isEnabled){var e={};for(c=0;c<g.length;c++)e[d[c]]=g[c]?g[c]._id:null;h.trace("Results for remoteIdentifiers: "+
r.prettyPrint(e))}for(c=0;c<g.length;c++){var w=g[c],e=f[c];if(w)a.objects[e.index]=w;else{var w=d[c],m={model:a.model};m[a.model.id]=w;(m=k.get(m))?a.objects[e.index]=m:(a.objects[e.index]=a._new(),a.objects[e.index][a.model.id]=w)}}}b(l)})):b()}],d);return b.promise},_lookupSingleton:function(d){var b=r.defer(d);d=b.finish.bind(b);for(var a=g.pluck(this.data,"_id"),f,l=0;l<a.length;l++)if(a[l]){f={_id:a[l]};break}for(var a=k.getSingleton(this.model)||this._new(f),l=0;l<this.data.length;l++)this.objects[l]=
a;d();return b.promise},_new:function(){var d=this.model,d=d._new.apply(d,arguments);this._newObjects.push(d);return d},start:function(d){if(this.data.length){var b=this,a=[];a.push(g.bind(this.model.singleton?this._lookupSingleton:this._lookup,this));a.push(g.bind(this._executeSubOperations,this));r.async.parallel(a,function(){try{b._map();var a=this.fromStorage,l=g.reduce(b._newObjects,function(b,l){var c=l.model.init;c&&(1<r.paramNames(c).length?b.push(g.bind(c,l,a,d)):c.call(l,a));return b},[]);
m.parallel(l,function(){d(b.errors.length?b.errors:null,b.objects)})}catch(c){console.error("Uncaught error when executing init funcitons on models.",c),d(c)}}.bind(this))}else d(null,[])},getRelatedData:function(d){for(var b=[],a=[],f=0;f<this.data.length;f++){var c=this.data[f];c&&c[d]&&(b.push(f),a.push(c[d]))}return{indexes:b,relatedData:a}},processErrorsFromTask:function(d,b,a){if(b.length){var f=this.getRelatedData(d).relatedData;b=r.unflattenArray(b,f);for(f=0;f<b.length;f++){var c=a[f],h=
b[f],e=h;r.isArray(h)&&(e=g.reduce(h,function(a,b){return a||b},!1));e&&(this.errors[c]||(this.errors[c]={}),this.errors[c][d]=h)}}},_executeSubOperations:function(d){var b=this,a=g.keys(this.model.relationships);a.length?(a=g.reduce(a,function(a,d){var h=b.model.relationships[d],g=h.forwardName==d?h.reverseModel:h.forwardModel;g.singleton&&!h.isReverse&&this.data.forEach(function(a){a[d]||(a[d]={})});var h=this.getRelatedData(d),e=h.indexes,h=h.relatedData;if(h.length)var h=r.flattenArray(h),k=new c({model:g,
data:h,disableevents:b.disableevents,_ignoreInstalled:b._ignoreInstalled,fromStorage:this.fromStorage});k&&a.push(function(a){k.start(function(f,c){b.subTaskResults[d]={errors:f,objects:c,indexes:e};b.processErrorsFromTask(d,k.errors,e);a()})});return a}.bind(this),[]),m.parallel(a,function(a){d(a)})):d()}});t.exports=c},{"./cache":11,"./error":14,"./log":17,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25}],19:[function(e,t,q){function c(a){var b=this;this._opts=a?x.extend({},a):
{};h.extendFromOpts(this,a,{methods:{},attributes:[],collection:function(a){h.isString(a)&&(a=n[a]);return a},id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,remove:null});this.attributes=c._processAttributes(this.attributes);x.extend(this,{_installed:!1,_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]});Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(b.relationships)},
enumerable:!0},_attributeNames:{get:function(){var a=[];b.id&&a.push(b.id);x.each(b.attributes,function(b){a.push(b.name)});return a},enumerable:!0,configurable:!0},installed:{get:function(){return b._installed&&b._relationshipsInstalled&&b._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return x.reduce(b.children,function(a,b){return Array.prototype.concat.call(a,b.descendants)}.bind(b),x.extend([],b.children))},enumerable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys((siesta.ext.storage._unsavedObjectsByCollection[this.collectionName]||
{})[this.name]||{}).length},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0}});f.ProxyEventEmitter.call(this,this.collectionName+":"+this.name)}q=e("./log");var n=e("./collectionRegistry").CollectionRegistry,p=e("./error").InternalSiestaError,k=e("./RelationshipType"),r=e("./Query"),g=e("./mappingOperation"),m=e("./modelInstance"),h=e("./util"),d=e("./cache");e("./store");var b=e("extend"),a=e("./modelEvents"),f=e("./events"),l=e("./events").wrapArray;e("./RelationshipProxy");
var v=e("./OneToManyProxy"),w=e("./OneToOneProxy"),D=e("./ManyToManyProxy"),B=e("./ReactiveQuery"),y=e("./ArrangedReactiveQuery"),x=h._,A=h.guid,C=a.ModelEventType,z=q.loggerWithName("Model");x.extend(c,{_processAttributes:function(a){return x.reduce(a,function(a,b){"string"==typeof b?a.push({name:b}):a.push(b);return a},[])}});c.prototype=Object.create(f.ProxyEventEmitter.prototype);x.extend(c.prototype,{installStatics:function(a){a&&x.each(Object.keys(a),function(b){this[b]?z.error('Static method with name "'+
b+'" already exists. Ignoring it.'):this[b]=a[b].bind(this)}.bind(this));return a},installRelationships:function(){if(this._relationshipsInstalled)throw new p('Relationships for "'+this.name+'" have already been installed');this._relationships=[];if(this._opts.relationships)for(var a in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(a)){var b=this._opts.relationships[a];if(!b.isReverse){z.debug.isEnabled&&z.debug(this.name+": configuring relationship "+a,b);b.type||(b.type=this.singleton?
k.OneToOne:k.OneToMany);if(this.singleton&&b.type==k.ManyToMany)return"Singleton model cannot use ManyToMany relationship.";if(b.type==k.OneToMany||b.type==k.OneToOne||b.type==k.ManyToMany){var f=b.model;delete b.model;var d;if(f instanceof c)d=f;else{z.debug.isEnabled&&z.debug("reverseModelName",f);if(!this.collection)throw new p("Model must have collection");var l=this.collection;if(!l)throw new p("Collection "+this.collectionName+" not registered");d=l[f]}if(!d&&(l=f.split("."),2==l.length)){d=
l[0];f=l[1];l=n[d];if(!l)return'Collection with name "'+d+'" does not exist.';d=l[f]}z.debug.isEnabled&&z.debug("reverseModel",d);if(d)b.reverseModel=d,b.forwardModel=this,b.forwardName=a,b.reverseName=b.reverse||"reverse_"+a,delete b.reverse,b.isReverse=!1;else return'Model with name "'+f.toString()+'" does not exist'}else return"Relationship type "+b.type+" does not exist"}}this._relationshipsInstalled=!0;return null},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new p('Reverse relationships for "'+
this.name+'" have already been installed.');for(var a in this.relationships)if(this.relationships.hasOwnProperty(a)){var f=this.relationships[a],f=b(!0,{},f);f.isReverse=!0;var d=f.reverseModel,c=f.reverseName;if(d.singleton){if(f.type==k.ManyToMany)return"Singleton model cannot be related via reverse ManyToMany";if(f.type==k.OneToMany)return"Singleton model cannot be related via reverse OneToMany"}z.debug.isEnabled&&z.debug(this.name+": configuring  reverse relationship "+c);d.relationships[c]=f}this._reverseRelationshipsInstalled=
!0},_query:function(a){return a=new r(this,a||{})},query:function(a,b){if(this.singleton){var f=h.defer(b);b=f.finish.bind(f);this._query({__ignoreInstalled:!0}).execute(function(f,d){f?b(f):(a=x.extend({},a),a.__ignoreInstalled=!0,d.length?this._query(a).execute(b):this.graph({},function(f){f?b(f):this._query(a).execute(b)}.bind(this)))}.bind(this));return f.promise}return this._query(a).execute(b)},reactiveQuery:function(a){return new B(new r(this,a||{}))},arrangedReactiveQuery:function(a){return new y(new r(this,
a||{}))},one:function(a,b){"function"==typeof a&&(b=a,a={});var f=h.defer(b);b=f.finish.bind(f);this.query(a,function(a,f){a?b(a):1<f.length?b("More than one instance returned when executing get query!"):(f=f.length?f[0]:null,b(null,f))});return f.promise},all:function(a,b){"function"==typeof a&&(b=a,a={});a=a||{};return this.query(a,b)},install:function(a){z.info.isEnabled&&z.info("Installing mapping "+this.name);var b=h.defer(a);a=b.finish.bind(b);if(this._installed)throw new p('Model "'+this.name+
'" has already been installed');this._installed=!0;a();return b.promise},graph:function(a,b,f){"function"==typeof b&&(f=b);b=b||{};var d=h.defer(f);f=function(){var f=b.override;f&&(h.isArray(f)?b.objects=f:b.objects=[f]);delete b.override;h.isArray(a)?this._mapBulk(a,b,d.finish.bind(d)):this._mapBulk([a],b,function(a,b){var f;b&&b.length&&(f=b[0]);d.finish(a?h.isArray(a)?a[0]:a:null,f)})}.bind(this);b._ignoreInstalled?f():siesta._afterInstall(f);return d.promise},_mapBulk:function(a,b,f){x.extend(b,
{model:this,data:a});(new g(b)).start(function(a,b){a?f&&f(a):f(null,b||[])})},_countCache:function(){return x.reduce(Object.keys((d._localCacheByType[this.collectionName]||{})[this.name]||{}),function(a,b){a[b]={};return a},{})},count:function(a){var b=h.defer(a);a=b.finish.bind(b);var f=this._countCache();a(null,Object.keys(f).length);return b.promise},_new:function(b,f){f=void 0===f?!0:f;if(this.installed){var c=this,g;g=b?b._id?b._id:A():A();var e=new m(this);z.info.isEnabled&&z.info('New object created _id="'+
g.toString()+'", type='+this.name,b);e._id=g;g={};e.__values=g;var r=x.reduce(this.attributes,function(a,b){void 0!==b["default"]&&(a[b.name]=b["default"]);return a},{});x.extend(g,r);b&&x.extend(g,b);g=this._attributeNames;r=g.indexOf(this.id);-1<r&&g.splice(r,1);x.each(g,function(b){Object.defineProperty(e,b,{get:function(){var a=e.__values[b];return void 0===a?null:a},set:function(f){var d=e.__values[b],g=this._propertyDependencies[b],g=x.map(g,function(a){return{prop:a,old:this[a]}}.bind(this));
e.__values[b]=f;g.forEach(function(b){var f=b.prop;a.emit({collection:c.collectionName,model:c.name,_id:e._id,"new":this[f],old:b.old,type:C.Set,field:f,obj:e})}.bind(this));d={collection:c.collectionName,model:c.name,_id:e._id,"new":f,old:d,type:C.Set,field:b,obj:e};window.lastEmission=d;a.emit(d);h.isArray(f)&&l(f,b,e)},enumerable:!0,configurable:!0})});x.each(Object.keys(this.methods),function(a){void 0===e[a]?e[a]=this.methods[a].bind(e):z.error('A method with name "'+a+'" already exists. Ignoring it.')}.bind(this));
g=Object.keys(this.properties);var n={};x.each(g,function(a){var b=this.properties[a];(b.dependencies||[]).forEach(function(b){n[b]||(n[b]=[]);n[b].push(a)});delete b.dependencies;void 0===e[a]?Object.defineProperty(e,a,b):z.error('A property/method with name "'+a+'" already exists. Ignoring it.')}.bind(this));e._propertyDependencies=n;Object.defineProperty(e,this.id,{get:function(){return e.__values[c.id]||null},set:function(b){var f=e[c.id];e.__values[c.id]=b;a.emit({collection:c.collectionName,
model:c.name,_id:e._id,"new":b,old:f,type:C.Set,field:c.id,obj:e});d.remoteInsert(e,b,f)},enumerable:!0,configurable:!0});for(var q in this.relationships){var t;if(this.relationships.hasOwnProperty(q))if(t=x.extend({},this.relationships[q]),g=t.type,delete t.type,g==k.OneToMany)t=new v(t);else if(g==k.OneToOne)t=new w(t);else if(g==k.ManyToMany)t=new D(t);else throw new p("No such relationship type: "+g);t.install(e)}d.insert(e);f&&a.emit({collection:this.collectionName,model:this.name,_id:e._id,
"new":e,type:C.New,obj:e});return e}throw new p("Model must be fully installed before creating any models");},_dump:function(a){var b={};b.name=this.name;b.attributes=this.attributes;b.id=this.id;b.collection=this.collectionName;b.relationships=x.map(this.relationships,function(a){return a.isForward?a.forwardName:a.reverseName});return a?h.prettyPrint(b):b},toString:function(){return"Model["+this.name+"]"}});x.extend(c.prototype,{child:function(a,b){"string"==typeof a?b.name=a:b=name;x.extend(b,{attributes:Array.prototype.concat.call(b.attributes||
[],this._opts.attributes),relationships:x.extend(b.relationships||{},this._opts.relationships),methods:x.extend(x.extend({},this._opts.methods)||{},b.methods),statics:x.extend(x.extend({},this._opts.statics)||{},b.statics),properties:x.extend(x.extend({},this._opts.properties)||{},b.properties),id:b.id||this._opts.id,init:b.init||this._opts.init,remove:b.remove||this._opts.remove});var f=this.collection.model(b.name,b);f.parent=this;this.children.push(f);return f},isChildOf:function(a){return this.parent==
a},isParentOf:function(a){return-1<this.children.indexOf(a)},isDescendantOf:function(a){for(var b=this.parent;b;){if(b==a)return!0;b=b.parent}return!1},isAncestorOf:function(a){return-1<this.descendants.indexOf(a)},hasAttributeNamed:function(a){return-1<this._attributeNames.indexOf(a)}});x.extend(c.prototype,{paginator:function(a){if(siesta.ext.httpEnabled){var b=siesta.ext.http.Paginator;a=a||{};a.model=this;return new b(a)}}});t.exports=c},{"./ArrangedReactiveQuery":1,"./ManyToManyProxy":2,"./OneToManyProxy":4,
"./OneToOneProxy":5,"./Query":6,"./ReactiveQuery":8,"./RelationshipProxy":9,"./RelationshipType":10,"./cache":11,"./collectionRegistry":13,"./error":14,"./events":15,"./log":17,"./mappingOperation":18,"./modelEvents":20,"./modelInstance":21,"./store":23,"./util":25,extend:39}],20:[function(e,t,q){function c(c){this._opts=c||{};Object.keys(c).forEach(function(d){this[d]=c[d]}.bind(this))}function n(c){if(!c.model)throw new k("Must pass a model");if(!c.collection)throw new k("Must pass a collection");
if(!c._id)throw new k("Must pass a local identifier");if(!c.obj)throw new k("Must pass the object");}var p=e("./events"),k=e("./error").InternalSiestaError;t=e("./log");var r=e("./util")._.extend,g=e("./collectionRegistry").CollectionRegistry,m=t.loggerWithName("ModelEvents");c.prototype._dump=function(c){var d={};d.collection="string"==typeof this.collection?this.collection:this.collection._dump();d.model="string"==typeof this.model?this.model:this.model.name;d._id=this._id;d.field=this.field;d.type=
this.type;this.index&&(d.index=this.index);this.added&&(d.added=_.map(this.added,function(b){return b._dump()}));this.removed&&(d.removed=_.map(this.removed,function(b){return b._dump()}));this.old&&(d.old=this.old);this["new"]&&(d["new"]=this["new"]);return c?util.prettyPrint(d):d};r(q,{ModelEvent:c,emit:function(e){n(e);var d=e.collection,b=e.model;e=new c(e);m.trace.isEnabled&&m.trace('Sending notification "'+d+'" of type '+e.type);p.emit(d,e);var a=d+":"+b;m.trace.isEnabled&&m.trace('Sending notification "'+
a+'" of type '+e.type);p.emit(a,e);m.trace.isEnabled&&m.trace('Sending notification "Siesta" of type '+e.type);p.emit("Siesta",e);a=e._id;m.trace.isEnabled&&m.trace('Sending notification "'+a+'" of type '+e.type);p.emit(a,e);a=g[d];if(!a)throw d='No such collection "'+d+'"',m.error(d,g),new k(d);a=a[b];if(!a)throw d='No such model "'+b+'"',m.error(d,g),new k(d);a.id&&e.obj[a.id]&&(d=d+":"+b+":"+e.obj[a.id],m.trace.isEnabled&&m.trace('Sending notification "'+d+'" of type '+e.type),p.emit(d,e));return e},
validateEventOpts:n,ModelEventType:{Set:"Set",Splice:"Splice",New:"New",Remove:"Remove"}})},{"./collectionRegistry":13,"./error":14,"./events":15,"./log":17,"./util":25}],21:[function(e,t,q){t.exports=e(3)},{"./cache":11,"./error":14,"./events":15,"./log":17,"./modelEvents":20,"./util":25,"/Users/mtford/Playground/rest/core/ModelInstance.js":3}],22:[function(e,t,q){t.exports=e(8)},{"./Query":6,"./QuerySet":7,"./error":14,"./events":15,"./log":17,"./modelEvents":20,"./util":25,"/Users/mtford/Playground/rest/core/ReactiveQuery.js":8,
events:35}],23:[function(e,t,q){function c(c,d){var b=k.defer(d);d=b.finish.bind(b);m.debug.isEnabled&&m.debug("get",c);var a;if(c._id)if(k.isArray(c._id))n(r.map(c._id,function(a){return{_id:a}}),d);else if(a=g.get(c))m.debug.isEnabled&&m.debug("Had cached object",{opts:c,obj:a}),d&&d(null,a);else if(k.isArray(c._id))n(r.map(c._id,function(a){return{_id:a}}),d);else{if(d)if(a=siesta.ext.storage)a.store.getFromPouch(c,d);else throw Error("Storage module not installed");}else if(c.model)if(k.isArray(c[c.model.id]))n(r.map(c[c.model.id],
function(a){var b={};b[c.model.id]=a;b.model=c.model;return b}),d);else if(a=g.get(c))m.debug.isEnabled&&m.debug("Had cached object",{opts:c,obj:a}),d&&d(null,a);else if(a=c.model,a.singleton)a.one(d);else{var f=a.id,l=c[f],e={};if(e[f]=l)a.one(e,function(a,b){a?d(a):b?d(null,b):d(null,null)});else throw new p('Invalid options given to store. Missing "'+f.toString()+'."');}else throw new p("Invalid options given to store",{opts:c});return b.promise}function n(e,d){var b=k.defer(d);d=b.finish.bind(b);
var a=[],f=[];r.each(e,function(b){c(b,function(b,c){b?f.push(b):a.push(c);a.length+f.length==e.length&&d&&(f.length?d(f):d(null,a))})});return b.promise}var p=e("./error").InternalSiestaError;q=e("./log");var k=e("./util"),r=k._,g=e("./cache"),m=q.loggerWithName("Store");t.exports={get:c,getMultiple:n,getMultipleLocal:function(c,d){var b=k.defer(d);d=b.finish.bind(b);var a=r.reduce(c,function(a,b){var d=g.get({_id:b});d?a.cached[b]=d:a.notCached.push(b);return a},{cached:{},notCached:[]});(function(b){d&&
(b?d(b):d(null,r.map(c,function(b){return a.cached[b]})))})();return b.promise},getMultipleRemote:function(c,d,b){var a=k.defer(b);b=a.finish.bind(a);var f=r.reduce(c,function(a,b){var f={model:d};f[d.id]=b;(f=g.get(f))?a.cached[b]=f:a.notCached.push(b);return a},{cached:{},notCached:[]});(function(a){b&&(a?b(a):b(null,r.map(c,function(a){return f.cached[a]})))})();return a.promise}}},{"./cache":11,"./error":14,"./log":17,"./util":25}],24:[function(e,t,q){function c(a,b){if(a.map)return a.map(b);
var f=[];r(a,function(a,d,c){f.push(b(a,d,c))});return f}function n(a,b,f,d){b=c(b,function(a,b){return{index:b,value:a}});if(d){var e=[];a(b,function(a,b){f(a.value,function(f,d){e[a.index]=d;b(f)})},function(a){d(a,e)})}else a(b,function(a,b){f(a.value,function(a){b(a)})})}function p(a,b,f){f=f||function(){};if(!a.length)return f();var d=0,c=function(){b(a[d],function(b){b?(f(b),f=function(){}):(d+=1,d>=a.length?f():c())})};c()}function k(a,b){if(a.forEach)return a.forEach(b);for(var f=0;f<a.length;f+=
1)b(a[f],f,a)}function r(a,b,f){function d(b){b?(f(b),f=function(){}):(c+=1,c>=a.length&&f())}f=f||function(){};if(!a.length)return f();var c=0;k(a,function(a){b(a,g(d))})}function g(a){var f=!1;return function(){if(f)throw Error("Callback was already called.");f=!0;a.apply(b,arguments)}}var m=e("./misc"),h=e("./underscore"),d=function(a){return function(){var b=Array.prototype.slice.call(arguments);return a.apply(null,[r].concat(b))}}(n),b,a=function(a){return function(){var b=Array.prototype.slice.call(arguments);
return a.apply(null,[p].concat(b))}}(n),f=function(a,b,f){f=f||function(){};if(m.isArray(b))a.map(b,function(a,b){a&&a(function(a){var f=Array.prototype.slice.call(arguments,1);1>=f.length&&(f=f[0]);b.call(null,a,f)})},f);else{var d={};a.each(Object.keys(b),function(a,f){b[a](function(b){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);d[a]=c;f(b)})},function(a){f(a,d)})}};t.exports={series:function(b,f){f=f||function(){};if(m.isArray(b))a(b,function(a,b){a&&a(function(a){var f=
Array.prototype.slice.call(arguments,1);1>=f.length&&(f=f[0]);b.call(null,a,f)})},f);else{var d={};p(h.keys(b),function(a,f){b[a](function(b){var c=Array.prototype.slice.call(arguments,1);1>=c.length&&(c=c[0]);d[a]=c;f(b)})},function(a){f(a,d)})}},parallel:function(a,b){f({map:d,each:r},a,b)}}},{"./misc":26,"./underscore":27}],25:[function(e,t,q){q=e("./underscore");var c=e("./async");e=e("./misc");q.extend(t.exports,{_:q,async:c});q.extend(t.exports,e)},{"./async":24,"./misc":26,"./underscore":27}],
26:[function(e,t,q){var c=e("../../vendor/observe-js/src/observe").Platform,n=e("./underscore"),p=e("./../error").InternalSiestaError,k=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,r=/,/,g=/^\s*(_?)(.+?)\1\s*$/,m=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;e=function(b){return"[object Array]"===n.toString.call(b)};var h=Array.isArray||e,d=function(b){return"string"==typeof b||b instanceof String};n.extend(t.exports,{next:function(b){c.performMicrotaskCheckpoint();setTimeout(b)},cb:function(b,a){return function(f){b&&
b.apply(b,arguments);a&&(f?a.reject(f):a.resolve.apply(a,Array.prototype.slice.call(arguments,1)))}},guid:function(){function b(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return b()+b()+"-"+b()+"-"+b()+"-"+b()+"-"+b()+b()+b()}}(),assert:function(b,a,f){if(!b)throw f=f||{},new p(a||"Assertion failed",f);},thenBy:function(){function b(b){b.thenBy=a;return b}function a(a){var d=this;return b(function(b,c){return d(b,c)||a(b,c)})}return b}(),defer:function(b){var a;
b=b||function(){};if(siesta.q){a=siesta.q.defer();var f=a.reject,d=a.resolve;n.extend(a,{reject:function(a){b(a);f.call(this,a)},resolve:function(a){var f=b.__siesta_bound_object||b,c=Array.prototype.slice.call(arguments,0);c.unshift(null);b.apply(f,c);d.apply(this,arguments)},finish:function(a,b){if(a)this.reject(a);else{var f=Array.prototype.slice.call(arguments,1);this.resolve.apply(this,f)}}})}else a={promise:void 0,reject:function(a){b.apply(b.__siesta_bound_object||b,arguments)},resolve:function(a){var f=
b.__siesta_bound_object||b,d=Array.prototype.slice.call(arguments,0);d.unshift(null);b.apply(f,d)},finish:function(a,f){b.apply(b.__siesta_bound_object||b,arguments)}};return a},defineSubProperty:function(b,a,f){return Object.defineProperty(this,b,{get:function(){return f?a[f]:a[b]},set:function(d){f?a[f]=d:a[b]=d},enumerable:!0,configurable:!0})},defineSubPropertyNoSet:function(b,a,f){return Object.defineProperty(this,b,{get:function(){return f?a[f]:a[b]},enumerable:!0,configurable:!0})},subProperties:function(b,
a,f){h(f)||(f=Array.prototype.slice.call(arguments,2));for(var c=0;c<f.length;c++)(function(f){var c={set:!1,name:f,property:f};d(f)||n.extend(c,f);f={get:function(){return a[c.property]},enumerable:!0,configurable:!0};c.set&&(f.set=function(b){a[c.property]=b});Object.defineProperty(b,c.name,f)})(f[c])},capitaliseFirstLetter:function(b){return b.charAt(0).toUpperCase()+b.slice(1)},extendFromOpts:function(b,a,f,d){if(void 0==d||d){var c=Object.keys(f);d=Object.keys(a).filter(function(a){return-1==
c.indexOf(a)});if(d.length)throw Error("Unknown options: "+d.toString());}n.each(Object.keys(f),function(b){var d=f[b];"function"==typeof d&&(f[b]=d(a[b]),delete a[b])});n.extend(f,a);n.extend(b,f)},isString:d,isArray:h,prettyPrint:function(b){return JSON.stringify(b,null,4)},flattenArray:function(b){return n.reduce(b,function(a,b){h(b)?a=a.concat(b):a.push(b);return a},[])},unflattenArray:function(b,a){for(var f=0,d=[],c=0;c<a.length;c++)if(h(a[c])){var e=[];d[c]=e;for(var g=0;g<a[c].length;g++)e.push(b[f]),
f++}else d[c]=b[f],f++;return d},paramNames:function(b){var a=[];b.toString().replace(m,"").match(k)[1].split(r).forEach(function(b){b.replace(g,function(b,f,d){a.push(d)})});return a}})},{"../../vendor/observe-js/src/observe":41,"./../error":14,"./underscore":27}],27:[function(e,t,q){var c={};e=Array.prototype;var n=e.forEach,p=e.map,k=e.reduce,r=Function.prototype.bind,g=e.slice,m={},h=function(){};c.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],d;for(d in a)a.hasOwnProperty(d)&&
b.push(d);return b};c.each=c.forEach=function(a,b,d){if(null==a)return a;if(n&&a.forEach===n)a.forEach(b,d);else if(a.length===+a.length)for(var e=0,g=a.length;e<g;e++){if(b.call(d,a[e],e,a)===m)return}else for(var h=c.keys(a),e=0,g=h.length;e<g;e++)if(b.call(d,a[h[e]],h[e],a)===m)return;return a};c.map=c.collect=function(a,b,d){var e=[];if(null==a)return e;if(p&&a.map===p)return a.map(b,d);c.each(a,function(a,c,g){e.push(b.call(d,a,c,g))});return e};var d=function(a,b,d){if(void 0===b)return a;switch(null==
d?3:d){case 1:return function(d){return a.call(b,d)};case 2:return function(d,c){return a.call(b,d,c)};case 3:return function(d,c,e){return a.call(b,d,c,e)};case 4:return function(d,c,e,g){return a.call(b,d,c,e,g)}}return function(){return a.apply(b,arguments)}};c.times=function(a,b,c){var e=Array(Math.max(0,a));b=d(b,c,1);for(c=0;c<a;c++)e[c]=b(c);return e};c.partial=function(a){var b=g.call(arguments,1);return function(){for(var d=0,e=b.slice(),g=0,h=e.length;g<h;g++)e[g]===c&&(e[g]=arguments[d++]);
for(;d<arguments.length;)e.push(arguments[d++]);return a.apply(this,e)}};c.pluck=function(a,b){return c.map(a,c.property(b))};c.reduce=c.foldl=c.inject=function(a,b,d,e){var g=2<arguments.length;null==a&&(a=[]);if(k&&a.reduce===k)return e&&(b=c.bind(b,e)),g?a.reduce(b,d):a.reduce(b);c.each(a,function(a,c,h){g?d=b.call(e,d,a,c,h):(d=a,g=!0)});if(!g)throw new TypeError("Reduce of empty array with no initial value");return d};c.property=function(a){return function(b){return b[a]}};"function"!==typeof/./&&
(c.isFunction=function(a){return"function"===typeof a});c.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};var b=function(a){return null==a?c.identity:c.isFunction(a)?a:c.property(a)};c.sortBy=function(a,d,e){d=b(d);return c.pluck(c.map(a,function(a,b,c){return{value:a,index:b,criteria:d.call(e,a,b,c)}}).sort(function(a,b){var d=a.criteria,f=b.criteria;if(d!==f){if(d>f||void 0===d)return 1;if(d<f||void 0===f)return-1}return a.index-b.index}),"value")};c.bind=function(a,
b){var d,e;if(r&&a.bind===r)return r.apply(a,g.call(arguments,1));if(!c.isFunction(a))throw new TypeError;d=g.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,d.concat(g.call(arguments)));h.prototype=a.prototype;var c=new h;h.prototype=null;u;var k=a.apply(c,d.concat(g.call(arguments)));return Object(k)===k?k:c}};c.identity=function(a){return a};c.zip=function(a){if(null==a)return[];for(var b=c.max(arguments,"length").length,d=Array(b),e=0;e<b;e++)d[e]=c.pluck(arguments,
e);return d};c.max=function(a,b,d){var e=-Infinity,g=-Infinity,h;if(null==b&&null!=a){a=a.length===+a.length?a:c.values(a);for(var k=0,m=a.length;k<m;k++)d=a[k],d>e&&(e=d)}else b=c.iteratee(b,d),c.each(a,function(a,d,c){h=b(a,d,c);if(h>g||-Infinity===h&&-Infinity===e)e=a,g=h});return e};c.iteratee=function(a,b,e){return null==a?c.identity:c.isFunction(a)?d(a,b,e):c.isObject(a)?c.matches(a):c.property(a)};c.pairs=function(a){for(var b=c.keys(a),d=b.length,e=Array(d),g=0;g<d;g++)e[g]=[b[g],a[b[g]]];
return e};c.matches=function(a){var b=c.pairs(a),d=b.length;return function(a){if(null==a)return!d;a=Object(a);for(var c=0;c<d;c++){var e=b[c],g=e[0];if(e[1]!==a[g]||!(g in a))return!1}return!0}};c.some=function(a,b,d){if(null==a)return!1;b=c.iteratee(b,d);d=a.length!==+a.length&&c.keys(a);var e=(d||a).length,g,h;for(g=0;g<e;g++)if(h=d?d[g]:g,b(a[h],h,a))return!0;return!1};c.extend=function(a){if(!c.isObject(a))return a;for(var b,d,e=1,g=arguments.length;e<g;e++)for(d in b=arguments[e],b)hasOwnProperty.call(b,
d)&&(a[d]=b[d]);return a};t.exports=c},{}],28:[function(e,t,q){function c(b){b?"*"==b||-1<b.indexOf("*")?b=a:k.isArray(b)||(b=[b]):b=["GET"];return d.map(b,function(a){return a.toUpperCase()})}function n(a){if(!this)return new n(a);this._rawOpts=h(!0,{},a);this._opts=a;var b=function(a){a instanceof RegExp||(a=new RegExp(a,"g"));return a}.bind(this);this._opts.path?(a=this._opts.path,k.isArray(a)||(a=[a]),this._opts.path=[],d.each(a,function(a){this._opts.path.push(b.call(this,a))}.bind(this))):this._opts.path=
[""];this._opts.method=c(this._opts.method);if((a=this._opts.data)&&a.length){var e=a.split(".");if(1==e.length)a=e[0];else{var m={};a=m;for(var r=e[0],p=1;p<e.length;p++){var q=e[p];if(p==e.length-1)m[r]=q;else var t={},m=m[r]=t,r=q}}this._opts.data=a}g.call(this,"path",this._opts);g.call(this,"method",this._opts);g.call(this,"data",this._opts);g.call(this,"transforms",this._opts)}e=siesta._internal;var p=e.error.InternalSiestaError,k=e.util,r=k.assert,g=k.defineSubProperty,m=e.CollectionRegistry,
h=e.extend,d=k._,b=e.log.loggerWithName("Descriptor"),a="POST PATCH PUT HEAD GET DELETE OPTIONS TRACE CONNECT".split(" ");d.extend(n.prototype,{httpMethods:a,_resolveCollectionAndModel:function(){var a;a=this._opts.collection;var b=this._opts.model;console.log("rawCollection",a);console.log("rawModel",b);if(a)a="string"==typeof a?m[a]:a;else if(b&&!k.isString(b))a=b.collection;else return"Must pass collection or a model object";var d;if(b)if(k.isString(b))if(d=a._models[b])this._opts.model=d;else return"Model "+
b+" does not exist in collection";else{if(b.collection!=a)return"Passed model is not part of the passed collection";d=b}else return"Descriptors must be initialised with a model";this.model=d;this.collection=a},_matchPath:function(a){var d;for(d=0;d<this._opts.path.length;d++){var c=this._opts.path[d];b.trace.isEnabled&&b.trace("Matching path",a,c.toString());var e=c.exec(a);b.trace.isEnabled&&(e?b.trace("Matched path successfully",a,c.toString()):b.trace("Failed to match path",a,c.toString()));if(e)return!0}return!1},
_matchMethod:function(a){for(var b=0;b<this.method.length;b++)if(a.toUpperCase()==this.method[b])return!0;return!1},bury:function(a,b){var d=Object.keys(b);r(1==d.length);for(var d=d[0],c=b;"string"!=typeof c[d];)c=c[d],d=Object.keys(c),r(1==d.length),d=d[0];var e=c[d],g={};c[d]=g;g[e]=a;return b},_embedData:function(a){if(this.data){var b;"string"==typeof this.data?(b={},b[this.data]=a):b=this.bury(a,h(!0,{},this.data));return b}return a},_extractData:function(a){b.debug.isEnabled&&b.debug("_extractData",
a);if(this.data){if("string"==typeof this.data)return a[this.data];var d=Object.keys(this.data);r(1==d.length);for(var c=this.data;"string"!=typeof c&&(d=Object.keys(c),r(1==d.length),d=d[0],c=c[d],a=a[d],a););return a?a[c]:null}return a},_matchConfig:function(a){var b=a.type?this._matchMethod(a.type):{};b&&(b=a.url?this._matchPath(a.url):{});return b},_matchData:function(a){var b=null;this.data?a&&(b=this._extractData(a)):b=a;return b},match:function(a,b){var d=!1;this._matchConfig(a)&&(d=this._matchData(b));
return d},_transformData:function(a){var b=this.transforms;if("function"==typeof b)a=b(a);else for(var d in b)if(b.hasOwnProperty(d)&&a[d]){var c=b[d],e=a[d];if("string"==typeof c)if(c=c.split("."),delete a[d],1==c.length)a[c[0]]=e;else{a[c[0]]={};for(var g=a[c[0]],h=1;h<c.length-1;h++){var m=c[h];g[m]={};g=g[m]}g[c[c.length-1]]=e}else if("function"==typeof c)e=c(e),k.isArray(e)?(delete a[d],a[e[0]]=e[1]):a[d]=e;else throw new p("Invalid transformer");}return a}});q.Descriptor=n;q.resolveMethod=c},
{}],29:[function(e,t,q){function c(){if(!this)return new c(opts);this.requestDescriptors={};this.responseDescriptors={}}function n(c,e){var d=e._opts.model,b=e._opts.collection,a;if(b)a=k.isString(b)?b:b.name;else if(d){if(k.isString(d))throw new r("Not enough information to register the descriptor");a=d.collection.name}c[a]||(c[a]=[]);c[a].push(e)}function p(c,e){var d;d="string"==typeof e?c[e]||[]:c[e.name]||[];g.trace.isEnabled&&g.trace("_descriptorsForCollection",{collection:e,allDescriptors:c,
descriptors:d});return d}e=siesta._internal;var k=e.util;t=k._;var r=e.error.InternalSiestaError,g=e.log.loggerWithName("Descriptor");t.extend(c.prototype,{registerRequestDescriptor:function(c){n(this.requestDescriptors,c)},registerResponseDescriptor:function(c){g.trace.isEnabled&&g.trace("registerResponseDescriptor");n(this.responseDescriptors,c)},requestDescriptorsForCollection:function(c){return p(this.requestDescriptors,c)},responseDescriptorsForCollection:function(c){var e=p(this.responseDescriptors,
c);e.length||g.debug.isEnabled&&g.debug("No response descriptors for collection ",{collection:c});return e},reset:function(){this.requestDescriptors={};this.responseDescriptors={}}});q.DescriptorRegistry=new c},{}],30:[function(e,t,q){function c(a,b,d){if(z.debug.isEnabled){var c=z.debug;a=a.type+" "+b.status+" "+a.url;z.trace.isEnabled&&d&&(c=z.trace,a+=": "+B.prettyPrint(d));c(a)}}function n(a){if(z.debug.isEnabled){var b=z.debug;a=a.type+" "+a.url;z.trace.isEnabled&&(b=z.trace);b(a)}}function p(a,
b,d,f){var e=this,g=Array.prototype.slice.call(arguments,2),h={},k=this.name;"function"==typeof g[0]?f=g[0]:"object"==typeof g[0]&&(h=g[0],f=g[1]);g=B.defer(f);f=g.finish.bind(g);siesta._afterInstall(function(){function d(a,b,g){c(h,g,a);if(h.parseResponse){b=C.responseDescriptorsForCollection(e);for(var m,l,r=0;r<b.length;r++){var p=b[r];if(l=p.match(h,a)){m=p;break}}if(m)z.trace.isEnabled&&z.trace("Model _constructSubOperation data: "+B.prettyPrint(l)),"object"==typeof l?m.model.graph(l,{override:h.obj},
function(b,d){f(b,d,a,g)}):f(null,null,null,g);else if(f)if(k)f(null,null,a,g);else throw new A("Unnamed collection");}else f(null,null,a,g)}function g(a,b,d){f&&f(d,null,null,a)}h.type=a;h.method=a;h.url||(h.url=this.baseURL+b);void 0===h.parseResponse&&(h.parseResponse=!0);n(h);var m=siesta.ext.http.ajax;m?(m=m(h),m.success?(m.success(d),m.error(g)):m.done?(m.done(d),m.fail(g)):f("Incompatible ajax function. Could not find success/fail methods on returned promise.")):f("No ajax function. Ensure that either $.ajax is available, or call siesta.setAjax(ajax) with a compatible ajax function e.g. zepto, jquery, $http")}.bind(this));
return g.promise}function k(a,b,d){this._serialise(b,function(b,c){var f=c;a.fields&&(f={},y.each(a.fields,function(a){f[a]=c[a]}));d(b,f)})}function r(a,b,d){var c=this,f=Array.prototype.slice.call(arguments,3),e,g={};"function"==typeof f[0]?e=f[0]:"object"==typeof f[0]&&(g=f[0],e=f[1]);var h=B.defer(e);e=h.finish.bind(h);var f=Array.prototype.slice.call(f,2),m=C.requestDescriptorsForCollection(this),l;g.type=a;g.url=this.baseURL+b;for(var r=0;r<m.length;r++){var n=m[r];if(n._matchConfig(g)){l=n;
break}}l?(z.trace.isEnabled&&z.trace("Matched descriptor: "+l._dump(!0)),k.call(l,d,g,function(h,k){z.trace.isEnabled&&z.trace("_serialise",{err:h,data:k});h?e&&e(h,null,null):(g.data=k,g.obj=d,y.partial(p,a,b,g,e).apply(c,f))})):e&&(z.trace.isEnabled&&z.trace("Did not match descriptor"),e("No descriptor matched",null,null));return h.promise}function g(a,b){var d=Array.prototype.slice.call(arguments,2),c={},f;"function"==typeof d[0]?f=d[0]:"object"==typeof d[0]&&(c=d[0],f=d[1]);var e=B.defer(f),g=
c.deletionMode||"restore";void 0===c.parseResponse&&(c.parseResponse=!1);p.call(this,"DELETE",a,c,function(a,d,c,h){a?"restore"==g&&b.restore():"success"==g&&b.remove();f(a,d,c,h);e.finish(a,{x:d,y:c,z:h})});"now"!=g&&"restore"!=g||b.remove();return e.promise}function m(a,b){var d=Array.prototype.slice.call(arguments,2);return y.partial(a?r:p,b).apply(this,d)}function h(){return y.partial(m,!1,"GET").apply(this,arguments)}function d(){return y.partial(m,!1,"OPTIONS").apply(this,arguments)}function b(){return y.partial(m,
!1,"TRACE").apply(this,arguments)}function a(){return y.partial(m,!1,"HEAD").apply(this,arguments)}function f(){return y.partial(m,!0,"POST").apply(this,arguments)}function l(){return y.partial(m,!0,"PUT").apply(this,arguments)}function v(){return y.partial(m,!0,"PATCH").apply(this,arguments)}if("undefined"==typeof siesta&&"undefined"==typeof t)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var w=siesta._internal;q=w.Collection;var D=w.log,B=w.util,y=B._,
x=e("./descriptor"),A=w.error.InternalSiestaError,C=e("./descriptorRegistry").DescriptorRegistry,z=D.loggerWithName("HTTP");e={RequestDescriptor:e("./requestDescriptor").RequestDescriptor,ResponseDescriptor:e("./responseDescriptor").ResponseDescriptor,Descriptor:x.Descriptor,_resolveMethod:x.resolveMethod,Serialiser:e("./serialiser"),DescriptorRegistry:e("./descriptorRegistry").DescriptorRegistry,_httpResponse:p,_httpRequest:r,DELETE:g,HTTP_METHOD:m,GET:h,TRACE:b,OPTIONS:d,HEAD:a,POST:f,PUT:l,PATCH:v,
_serialiseObject:k,Paginator:e("./paginator")};Object.defineProperty(e,"ajax",{get:function(){return E||($?$.ajax:null)||(jQuery?jQuery.ajax:null)},set:function(a){E=a}});y.extend(q.prototype,{DELETE:g,GET:h,TRACE:b,OPTIONS:d,HEAD:a,POST:f,PUT:l,PATCH:v});siesta.ext||(siesta.ext={});siesta.ext.http=e;Object.defineProperties(siesta.ext,{httpEnabled:{get:function(){return void 0!==siesta.ext._httpEnabled?siesta.ext._httpEnabled:!!siesta.ext.http},set:function(a){siesta.ext._httpEnabled=a},enumerable:!0}});
var E;q={};y.extend(siesta,{setAjax:function(a){E=a},getAjax:function(){return siesta.ext.http.ajax},serialisers:q,serializers:q});Object.defineProperty(siesta,"ajax",{get:function(){return E},set:function(a){E=a}});Object.defineProperties(q,{id:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.idSerialiser:null}},depth:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.depthSerializer:null}}});"undefined"!=typeof t&&(t.exports=e)},{"./descriptor":28,"./descriptorRegistry":29,
"./paginator":31,"./requestDescriptor":32,"./responseDescriptor":33,"./serialiser":34}],31:[function(e,t,q){function c(c){this.opts={};p.extendFromOpts(this.opts,c,{path:"/",model:null,page:"page",queryParams:!0,pageSize:"pageSize",numPages:"numPages",dataPath:"data",count:"count",type:"GET",dataType:"json"},!1);k.extend(this,{numPages:null,count:null});this.validate()}q=siesta._internal;var n=q.error.InternalSiestaError,p=q.util,k=p._,r=e("querystring");k.extend(c.prototype,{_extract:function(c,
e,h){if(c)if("function"==typeof c)e=c(e,h);else for(c=c.split("."),h=0;h<c.length;h++)e=e[c[h]];return e},_extractData:function(c,e){return this._extract(this.opts.dataPath,c,e)},_extractNumPages:function(c,e){return this._extract(this.opts.numPages,c,e)},_extractCount:function(c,e){return this._extract(this.opts.count,c,e)},_parseURL:function(c){var e=document.createElement("a");e.href=c;return e},page:function(c,e){var h=this,d={};"function"==typeof c?e=c:c&&(d=c);var b=p.defer(e),a=d.page,d=d.pageSize;
e=b.finish.bind(b);var f=siesta.ext.http.ajax,l=k.extend({},this.opts),n=this.opts.model.collection.baseURL+this.opts.path;if(this.opts.queryParams){var n=this._parseURL(n),q=n.search,t=q.split("?");1<t.length&&(q=t[1]);q=r.parse(q);a&&(q[this.opts.page]=a);d&&(q[this.opts.pageSize]=d);Object.keys(q).length&&(n.search="?"+r.stringify(q));n=n.href}else q={},a&&(q[this.opts.page]=a),d&&(q[this.opts.pageSize]=d),l.data=q;k.extend(l,{url:n,success:function(a,b,d){var c=h._extractData(a,d),f=h._extractCount(a,
d),g=h._extractNumPages(a,d);h.opts.model.graph(c,function(c,k){c?e(c):(h.count=f,h.numPages=g,e(null,k,{data:a,textStatus:b,jqXHR:d}))})},fail:e});f(l);return b.promise},validate:function(){if(!this.opts.model)throw new n("Paginator must have a model");}});t.exports=c},{querystring:38}],32:[function(e,t,q){function c(e){if(!this)return new c(e);n.call(this,e);this._opts.serializer&&(this._opts.serialiser=this._opts.serializer);this._opts.serialiser||(this._opts.serialiser=p.depthSerializer(0));r.call(this,
"serialiser",this._opts);r.call(this,"serializer",this._opts,"serialiser")}var n=e("./descriptor").Descriptor,p=e("./serialiser");e=siesta._internal;var k=e.util;t=k._;var r=k.defineSubProperty,g=e.log.loggerWithName("Descriptor");c.prototype=Object.create(n.prototype);t.extend(c.prototype,{_serialise:function(c,e){var d=k.defer(e);e=d.finish.bind(d);var b=this;g.trace.isEnabled&&g.trace("_serialise");var a,f=this.serialiser(c,function(d,c){a||(c=b._transformData(c),e&&e(d,b._embedData(c)))});void 0!==
f?(g.trace.isEnabled&&g.trace("serialiser doesnt use a callback"),a=!0,f=b._transformData(f),e&&e(null,b._embedData(f))):g.trace.isEnabled&&g.trace("serialiser uses a callback",this.serialiser);return d.promise},_dump:function(c){var e={};e.methods=this.method;e.model=this.model.name;e.path=this._rawOpts.path;e.serialiser="function"==typeof this._rawOpts.serialiser?"function () { ... }":this._rawOpts.serialiser;var d={},b;for(b in this.transforms)this.transforms.hasOwnProperty(b)&&(d[b]="function"==
typeof this.transforms[b]?"function () { ... }":this.transforms[b]);e.transforms=d;return c?k.prettyPrint(e):e}});q.RequestDescriptor=c},{"./descriptor":28,"./serialiser":34}],33:[function(e,t,q){function c(e){if(!this)return new c(e);n.call(this,e)}var n=e("./descriptor").Descriptor;e=siesta._internal.util._;c.prototype=Object.create(n.prototype);e.extend(c.prototype,{_extractData:function(c){(c=n.prototype._extractData.call(this,c))&&(c=this._transformData(c));return c},_matchData:function(c){(c=
n.prototype._matchData.call(this,c))&&(c=this._transformData(c));return c},_dump:function(c){var e={};e.methods=this.method;e.model=this.model.name;e.path=this._rawOpts.path;var r={},g;for(g in this.transforms)this.transforms.hasOwnProperty(g)&&(r[g]="function"==typeof this.transforms[g]?"function () { ... }":this.transforms[g]);e.transforms=r;return c?util.prettyPrint(e):e}});q.ResponseDescriptor=c},{"./descriptor":28}],34:[function(e,t,q){function c(c){var e=c.model.id;if(e)return c[e]?c[e]:null;
p.debug.isEnabled&&p.debug("No idfield")}function n(c,e,m){m=m||function(){};p.trace.isEnabled&&p.trace("depthSerialiser");var h={};k.each(e._attributeNames,function(a){p.trace.isEnabled&&p.trace("field",a);e[a]&&(h[a]=e[a])});var d=[],b=[],a={},f=[];k.each(e._relationshipNames,function(k){p.trace.isEnabled&&p.trace("relationshipField",k);var q=e.__proxies[k];q.isForward&&(p.debug.isEnabled&&p.debug(k),d.push(k),q.get(function(q,t){p.trace.isEnabled&&p.trace("proxy.get",k);p.debug.isEnabled&&p.debug(k,
t);q?(b.push(q),f.push(k),a[k]={err:q,v:t}):t?c?n(c-1,t,function(c,e,g){c?b.push(c):h[k]=e;f.push(k);a[k]={err:c,v:t,resp:g};d.length==f.length&&m&&m(b.length?b:null,h,a)}):(f.push(k),h[k]=t[e.__proxies[k].forwardModel.id],a[k]={err:q,v:t},d.length==f.length&&m&&m(b.length?b:null,h,a)):(p.debug.isEnabled&&p.debug("no value for "+k),f.push(k),a[k]={err:q,v:t},d.length==f.length&&m&&m(b.length?b:null,h,a))}))});d.length||m(null,h,{})}e=siesta._internal;t=e.util;var p=e.log.loggerWithName("Serialisation"),
k=t._;q.depthSerialiser=function(c){return k.partial(n,c)};q.depthSerializer=function(c){return k.partial(n,c)};q.idSerializer=c;q.idSerialiser=c},{}],35:[function(e,t,q){function c(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function n(c){return"function"===typeof c}function p(c){return"object"===typeof c&&null!==c}t.exports=c;c.EventEmitter=c;c.prototype._events=void 0;c.prototype._maxListeners=void 0;c.defaultMaxListeners=10;c.prototype.setMaxListeners=function(c){if("number"!==
typeof c||0>c||isNaN(c))throw TypeError("n must be a positive number");this._maxListeners=c;return this};c.prototype.emit=function(c){var e,g,m,h;this._events||(this._events={});if("error"===c&&(!this._events.error||p(this._events.error)&&!this._events.error.length)){e=arguments[1];if(e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.');}g=this._events[c];if(void 0===g)return!1;if(n(g))switch(arguments.length){case 1:g.call(this);break;case 2:g.call(this,arguments[1]);
break;case 3:g.call(this,arguments[1],arguments[2]);break;default:e=arguments.length;m=Array(e-1);for(h=1;h<e;h++)m[h-1]=arguments[h];g.apply(this,m)}else if(p(g)){e=arguments.length;m=Array(e-1);for(h=1;h<e;h++)m[h-1]=arguments[h];g=g.slice();e=g.length;for(h=0;h<e;h++)g[h].apply(this,m)}return!0};c.prototype.addListener=function(e,r){var g;if(!n(r))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:
r);this._events[e]?p(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r;p(this._events[e])&&!this._events[e].warned&&(g=void 0!==this._maxListeners?this._maxListeners:c.defaultMaxListeners)&&0<g&&this._events[e].length>g&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace());
return this};c.prototype.on=c.prototype.addListener;c.prototype.once=function(c,e){function g(){this.removeListener(c,g);m||(m=!0,e.apply(this,arguments))}if(!n(e))throw TypeError("listener must be a function");var m=!1;g.listener=e;this.on(c,g);return this};c.prototype.removeListener=function(c,e){var g,m,h;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[c])return this;g=this._events[c];h=g.length;m=-1;if(g===e||n(g.listener)&&g.listener===e)delete this._events[c],
this._events.removeListener&&this.emit("removeListener",c,e);else if(p(g)){for(;0<h--;)if(g[h]===e||g[h].listener&&g[h].listener===e){m=h;break}if(0>m)return this;1===g.length?(g.length=0,delete this._events[c]):g.splice(m,1);this._events.removeListener&&this.emit("removeListener",c,e)}return this};c.prototype.removeAllListeners=function(c){var e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[c]&&delete this._events[c],this;if(0===
arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);this.removeAllListeners("removeListener");this._events={};return this}e=this._events[c];if(n(e))this.removeListener(c,e);else for(;e.length;)this.removeListener(c,e[e.length-1]);delete this._events[c];return this};c.prototype.listeners=function(c){return this._events&&this._events[c]?n(this._events[c])?[this._events[c]]:this._events[c].slice():[]};c.listenerCount=function(c,e){return c._events&&c._events[e]?n(c._events[e])?
1:c._events[e].length:0}},{}],36:[function(e,t,q){t.exports=function(e,p,k,r){k=k||"=";var g={};if("string"!==typeof e||0===e.length)return g;var m=/\+/g;e=e.split(p||"&");p=1E3;r&&"number"===typeof r.maxKeys&&(p=r.maxKeys);r=e.length;0<p&&r>p&&(r=p);for(p=0;p<r;++p){var h=e[p].replace(m,"%20"),d=h.indexOf(k),b;0<=d?(b=h.substr(0,d),h=h.substr(d+1)):(b=h,h="");b=decodeURIComponent(b);h=decodeURIComponent(h);Object.prototype.hasOwnProperty.call(g,b)?c(g[b])?g[b].push(h):g[b]=[g[b],h]:g[b]=h}return g};
var c=Array.isArray||function(c){return"[object Array]"===Object.prototype.toString.call(c)}},{}],37:[function(e,t,q){function c(c,e){if(c.map)return c.map(e);for(var k=[],h=0;h<c.length;h++)k.push(e(c[h],h));return k}var n=function(c){switch(typeof c){case "string":return c;case "boolean":return c?"true":"false";case "number":return isFinite(c)?c:"";default:return""}};t.exports=function(e,g,m,h){g=g||"&";m=m||"=";null===e&&(e=void 0);return"object"===typeof e?c(k(e),function(d){var b=encodeURIComponent(n(d))+
m;return p(e[d])?c(e[d],function(a){return b+encodeURIComponent(n(a))}).join(g):b+encodeURIComponent(n(e[d]))}).join(g):h?encodeURIComponent(n(h))+m+encodeURIComponent(n(e)):""};var p=Array.isArray||function(c){return"[object Array]"===Object.prototype.toString.call(c)},k=Object.keys||function(c){var e=[],k;for(k in c)Object.prototype.hasOwnProperty.call(c,k)&&e.push(k);return e}},{}],38:[function(e,t,q){q.decode=q.parse=e("./decode");q.encode=q.stringify=e("./encode")},{"./decode":36,"./encode":37}],
39:[function(e,t,q){var c=Object.prototype.hasOwnProperty,n=Object.prototype.toString,p=function(e){if(!e||"[object Object]"!==n.call(e)||e.nodeType||e.setInterval)return!1;var p=c.call(e,"constructor"),g=e.constructor&&e.constructor.prototype&&c.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!p&&!g)return!1;for(var m in e);return void 0===m||c.call(e,m)};t.exports=function r(){var c,e,h,d,b,a=arguments[0],f=1,l=arguments.length,n=!1;if("boolean"===typeof a)n=a,a=arguments[1]||{},
f=2;else if("object"!==typeof a&&"function"!==typeof a||void 0==a)a={};for(;f<l;++f)if(null!=(c=arguments[f]))for(e in c)h=a[e],d=c[e],a!==d&&(n&&d&&(p(d)||(b=Array.isArray(d)))?(b?(b=!1,h=h&&Array.isArray(h)?h:[]):h=h&&p(h)?h:{},a[e]=r(n,h,d)):void 0!==d&&(a[e]=d));return a}},{}],40:[function(e,t,q){if("undefined"==typeof siesta&&"undefined"==typeof t)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var c=siesta._internal,n=c.CollectionRegistry,p=c.util,k=
p._,r=c.events,g=[],m={},h={};e={};var d=c.log.loggerWithName("Storage");if("undefined"==typeof PouchDB)siesta.ext.storageEnabled=!1,console.log("PouchDB is not present therefore storage is disabled.");else{q=function(a){var c=p.defer(a);siesta._afterInstall(function(){a=a||function(){};var e=g;g=[];m={};h={};d.trace&&d.trace("Saving objects",k.map(e,function(a){return a._dump()}));b(e,a,c)});return c.promise};var b=function(b,c,e){var f=[];B.bulkDocs(k.map(b,v)).then(function(g){for(var h=0;h<g.length;h++){var k=
g[h],l=b[h];k.ok?l._rev=k.rev:409==k.status?f.push(l):d.error('Error saving object with _id="'+l._id+'"',k)}f.length?a(f,c,e):(c(),e&&e.resolve())},function(a){c(a);e&&e.reject(a)})},a=function(a,c,d){B.allDocs({keys:k.pluck(a,"_id")}).then(function(e){for(var f=0;f<e.rows.length;f++)a[f]._rev=e.rows[f].value.rev;b(a,c,d)})["catch"](function(a){d.reject(a)})},f=function(a,b){var c=a.collectionName,e=a.modelName;if(d.trace){var f=c+"."+e;d.trace("Loading instances for "+f)}var g=n[c][e],c=function(a){"$1"==
a.model&&"$2"==a.collection&&emit(a._id,a)}.toString().replace("$1",e).replace("$2",c);d.trace.isEnabled&&d.trace("Querying pouch");B.query({map:c}).then(function(a){console.log("resp",a);d.trace.isEnabled&&d.trace("Queried pouch successfully");a=siesta._.map(siesta._.pluck(a.rows,"value"),function(a){return l(a,g)});d.trace.isEnabled&&d.trace("Mapping data",a);console.log("data",a);g.graph(a,{disableevents:!0,_ignoreInstalled:!0,fromStorage:!0},function(a,c){a?d.error("Error loading models",a):d.trace.isEnabled&&
d.trace("Loaded "+c?c.length.toString():"0 instances for "+f);b(a,c)})})["catch"](function(a){b(a)})},l=function(a,b){w(a);delete a.collection;delete a.model;k.each(b._relationshipNames,function(b){var c=a[b];siesta.isArray(c)?a[b]=k.map(c,function(a){return{_id:a}}):a[b]={_id:c}});return a},v=function(a){var b=siesta._.extend({},a.__values);D(b);b.collection=a.collectionName;b.model=a.modelName;b._id=a._id;a.removed&&(b._deleted=!0);var c=a._rev;c&&(b._rev=c);return b=k.reduce(a._relationshipNames,
function(b,c){var d=a[c];siesta.isArray(d)?b[c]=k.pluck(d,"_id"):d&&(b[c]=d._id);return b},b)},w=function(a){(a.siesta_meta||{dateFields:[]}).dateFields.forEach(function(b){var c=a[b];c instanceof Date||(a[b]=new Date(Date.parse(c)))});delete a.siesta_meta},D=function(a){a.siesta_meta={dateFields:[]};for(var b in a)a.hasOwnProperty(b)&&a[b]instanceof Date&&a.siesta_meta.dateFields.push(b)},B=new PouchDB("siesta"),y=function(a){a=a.obj;var b=a._id;if(!a)throw new c.error.InternalSiestaError("No obj field in notification received by storage extension");
if(!(b in m)){m[b]=a;g.push(a);var d=a.collectionName;h[d]||(h[d]={});var e=a.model.name;h[d][e]||(h[d][e]={});h[d][e][b]=a}};siesta.on("Siesta",y);k.extend(e,{_load:function(a){if(A)throw Error("not loaded yet how can i save");var b=p.defer(a);if(siesta.ext.storageEnabled){var c=[];k.each(n.collectionNames,function(a){var b=Object.keys(n[a]._models);k.each(b,function(b){c.push(function(c){f({collectionName:a,modelName:b},c)})})});siesta.async.parallel(c,function(a,c){if(!a){var e=[];siesta._.each(c,
function(a){e.concat(a)});d.trace&&d.trace("Loaded "+e.length.toString()+" instances")}b.finish(a)})}else b.finish();return b.promise},save:q,_serialise:v,_reset:function(a){siesta.removeListener("Siesta",y);g=[];m={};B.destroy(function(b){b||(B=new PouchDB("siesta"));siesta.on("Siesta",y);d.warn("Reset complete");a(b)})}});Object.defineProperties(e,{_unsavedObjects:{get:function(){return g}},_unsavedObjectsHash:{get:function(){return m}},_unsavedObjectsByCollection:{get:function(){return h}},_pouch:{get:function(){return B}}});
siesta.ext||(siesta.ext={});siesta.ext.storage=e;Object.defineProperties(siesta.ext,{storageEnabled:{get:function(){return void 0!==siesta.ext._storageEnabled?siesta.ext._storageEnabled:!!siesta.ext.storage},set:function(a){siesta.ext._storageEnabled=a},enumerable:!0}});var x,A,C=1E3;Object.defineProperties(siesta,{autosave:{get:function(){return!!x},set:function(a){a?x||(x=setInterval(function(){A||(A=!0,siesta.save(function(a){a||r.emit("saved");A=!1}))},siesta.autosaveInterval)):x&&(clearInterval(x),
x=null)}},autosaveInterval:{get:function(){return C},set:function(a){C=a;x&&(siesta.autosave=!1,siesta.autosave=!0)}},dirty:{get:function(){return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection).length},enumerable:!0}});k.extend(siesta,{save:q,setPouch:function(a){if(siesta._canChange)B=a;else throw Error("Cannot change PouchDB instance when an object graph exists.");}})}t.exports=e},{}],41:[function(e,t,q){(function(c){(function(c){function e(a){for(var b=0;1E3>b&&a.check_();)b++;y&&
(c.dirtyCheckCycleCount=b);return 0<b}function k(a){for(var b in a)return!1;return!0}function r(a){return k(a.added)&&k(a.removed)&&k(a.changed)}function g(a,b){var c={},d={},e={},f;for(f in b){var g=a[f];if(void 0===g||g!==b[f])f in a?g!==b[f]&&(e[f]=g):d[f]=void 0}for(f in a)f in b||(c[f]=a[f]);Array.isArray(a)&&a.length!==b.length&&(e.length=a.length);return{added:c,removed:d,changed:e}}function m(){if(!z.length)return!1;for(var a=0;a<z.length;a++)z[a]();z.length=0;return!0}function h(){function a(c){b&&
b.state_===F&&!d&&b.check_(c)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.deliverChangeRecords(a);b=c;e=!1},observe:function(b,d){c=b;d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b;Object.deliverChangeRecords(a);d=!1},close:function(){b=void 0;Object.unobserve(c,a);K.push(this)}}}function d(){this.state_=L;this.value_=this.directObserver_=this.target_=this.callback_=void 0;this.id_=M++}function b(a){d.call(this);this.value_=a;this.oldObject_=
void 0}function a(a){if(!Array.isArray(a))throw Error("Provided object is not an Array");b.call(this,a)}function f(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];O[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"==g.type?g.name in e?delete e[g.name]:d[g.name]=!0:g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(h in e)e[h]=void 0;b={};for(h in c)h in d||h in
e||(f=a[h],c[h]!==f&&(b[h]=f));return{added:d,removed:e,changed:b}}function l(a,b,c){return{index:a,removed:b,addedCount:c}}function v(){}function w(a,b,c,d){b=l(b,c,d);d=!1;for(var e=0,f=0;f<a.length;f++){var g=a[f];g.index+=e;if(!d){c=b.index;var h=b.index+b.removed.length,k=g.index,m=g.index+g.addedCount;c=h<k||m<c?-1:h==k||m==c?0:c<k?h<m?h-k:m-k:m<h?m-c:h-c;0<=c?(a.splice(f,1),f--,e-=g.addedCount-g.removed.length,b.addedCount+=g.addedCount-c,c=b.removed.length+g.removed.length-c,b.addedCount||
c?(c=g.removed,b.index<g.index&&(h=b.removed.slice(0,g.index-b.index),Array.prototype.push.apply(h,c),c=h),b.index+b.removed.length>g.index+g.addedCount&&(h=b.removed.slice(g.index+g.addedCount-b.index),Array.prototype.push.apply(c,h)),b.removed=c,g.index<b.index&&(b.index=g.index)):d=!0):b.index<g.index&&(d=!0,a.splice(f,0,b),f++,c=b.addedCount-b.removed.length,g.index+=c,e+=c)}}d||a.push(b)}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];switch(e.type){case "splice":w(c,e.index,e.removed.slice(),
e.addedCount);break;case "add":case "update":case "delete":var f=e.name;if(+f!==f>>>0||""===f)continue;f=+e.name;if(0>f)continue;w(c,f,[e.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(e))}}return c}function B(a,b){var c=[];D(a,b).forEach(function(b){1==b.addedCount&&1==b.removed.length?b.removed[0]!==a[b.index]&&c.push(b):c=c.concat(J.calcSplices(a,b.index,b.index+b.addedCount,b.removed,0,b.removed.length))});return c}var y=c.testingExposeCycleCount,x=function(){function a(c){b=
c}if("function"!==typeof Object.observe||"function"!==typeof Array.observe)return!1;var b=[],c={},d=[];Object.observe(c,a);Array.observe(d,a);c.id=1;c.id=2;delete c.id;d.push(1,2);d.length=0;Object.deliverChangeRecords(a);if(5!==b.length||"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type)return!1;Object.unobserve(c,a);Array.unobserve(d,a);return!0}(),A=function(){if("undefined"!==typeof chrome&&chrome.app&&chrome.app.runtime||navigator.getDeviceStorage)return!1;
try{return(new Function("","return true;"))()}catch(a){return!1}}(),C="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))});return c},z=[],E=x?function(){var a={pingPong:!0},b=!1;Object.observe(a,function(){m();b=!1});return function(c){z.push(c);b||(b=!0,a.pingPong=!a.pingPong)}}():function(){return function(a){z.push(a)}}(),K=[],
L=0,F=1,M=1;d.prototype={open:function(a,b){if(this.state_!=L)throw Error("Observer has already been opened.");d._allObserversCount++;H&&G.push(this);this.callback_=a;this.target_=b;this.connect_();this.state_=F;return this.value_},close:function(){this.state_==F&&(d._allObserversCount--,this.disconnect_(),this.target_=this.callback_=this.value_=void 0,this.state_=2)},deliver:function(){this.state_==F&&e(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(b){d._errorThrownDuringCallback=
!0,console.error("Exception caught during observer callback: "+(b.stack||b))}},discardChanges:function(){this.check_(void 0,!0);return this.value_}};var H=!x,G;d._allObserversCount=0;H&&(G=[]);var I=!1,N=x&&A&&function(){try{return eval("%RunMicrotasks()"),!0}catch(a){return!1}}();c.Platform=c.Platform||{};c.Platform.performMicrotaskCheckpoint=function(){if(!I)if(N)eval("%RunMicrotasks()");else if(H){I=!0;var a=0,b,d;do{a++;d=G;G=[];b=!1;for(var e=0;e<d.length;e++){var f=d[e];f.state_==F&&(f.check_()&&
(b=!0),G.push(f))}m()&&(b=!0)}while(1E3>a&&b);y&&(c.dirtyCheckCycleCount=a);I=!1}};H&&(c.Platform.clearObservers=function(){G=[]});b.prototype=C({__proto__:d.prototype,arrayObserve:!1,connect_:function(a,b){if(x){var c=this.value_,d=this.arrayObserve,e=K.pop()||h();e.open(this);e.observe(c,d);this.directObserver_=e}else this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{},c;for(c in a)b[c]=a[c];Array.isArray(a)&&(b.length=a.length);return b},check_:function(a,
b){var c,d;if(x){if(!a)return!1;d={};c=f(this.value_,a,d)}else d=this.oldObject_,c=g(this.value_,this.oldObject_);if(r(c))return!1;x||(this.oldObject_=this.copyObject(this.value_));this.report_([c.added||{},c.removed||{},c.changed||{},function(a){return d[a]}]);return!0},disconnect_:function(){x?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==F&&(x?this.directObserver_.deliver(!1):e(this))},discardChanges:function(){this.directObserver_?
this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_);return this.value_}});a.prototype=C({__proto__:b.prototype,arrayObserve:!0,copyObject:function(a){return a.slice()},check_:function(a){if(x){if(!a)return!1;a=B(this.value_,a)}else a=J.calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);if(!a||!a.length)return!1;x||(this.oldObject_=this.copyObject(this.value_));this.report_([a]);return!0}});a.applySplices=function(a,b,c){c.forEach(function(c){for(var d=
[c.index,c.removed.length],e=c.index;e<c.index+c.addedCount;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})};var O={add:!0,update:!0,"delete":!0};v.prototype={calcEditDistances:function(a,b,c,d,e,f){f=f-e+1;c=c-b+1;for(var g=Array(f),h=0;h<f;h++)g[h]=Array(c),g[h][0]=h;for(var k=0;k<c;k++)g[0][k]=k;for(h=1;h<f;h++)for(k=1;k<c;k++)if(this.equals(a[b+k-1],d[e+h-1]))g[h][k]=g[h-1][k-1];else{var l=g[h-1][k]+1,m=g[h][k-1]+1;g[h][k]=l<m?l:m}return g},spliceOperationsFromEditDistances:function(a){for(var b=
a.length-1,c=a[0].length-1,d=a[b][c],e=[];0<b||0<c;)if(0==b)e.push(2),c--;else if(0==c)e.push(3),b--;else{var f=a[b-1][c-1],g=a[b-1][c],h=a[b][c-1],k;k=g<h?g<f?g:f:h<f?h:f;k==f?(f==d?e.push(0):(e.push(1),d=f),b--,c--):k==g?(e.push(3),b--,d=g):(e.push(2),c--,d=h)}e.reverse();return e},calcSplices:function(a,b,c,d,e,f){var g=0,h=0,k=Math.min(c-b,f-e);0==b&&0==e&&(g=this.sharedPrefix(a,d,k));c==a.length&&f==d.length&&(h=this.sharedSuffix(a,d,k-g));b+=g;e+=g;c-=h;f-=h;if(0==c-b&&0==f-e)return[];if(b==
c){for(a=l(b,[],0);e<f;)a.removed.push(d[e++]);return[a]}if(e==f)return[l(b,[],c-b)];f=this.spliceOperationsFromEditDistances(this.calcEditDistances(a,b,c,d,e,f));a=void 0;c=[];for(g=0;g<f.length;g++)switch(f[g]){case 0:a&&(c.push(a),a=void 0);b++;e++;break;case 1:a||(a=l(b,[],0));a.addedCount++;b++;a.removed.push(d[e]);e++;break;case 2:a||(a=l(b,[],0));a.addedCount++;b++;break;case 3:a||(a=l(b,[],0)),a.removed.push(d[e]),e++}a&&c.push(a);return c},sharedPrefix:function(a,b,c){for(var d=0;d<c;d++)if(!this.equals(a[d],
b[d]))return d;return c},sharedSuffix:function(a,b,c){for(var d=a.length,e=b.length,f=0;f<c&&this.equals(a[--d],b[--e]);)f++;return f},calculateSplices:function(a,b){return this.calcSplices(a,0,a.length,b,0,b.length)},equals:function(a,b){return a===b}};var J=new v,A=c;"undefined"!==typeof q&&("undefined"!==typeof t&&t.exports&&(A=q=t.exports),A=q);A.Observer=d;A.Observer.runEOM_=E;A.Observer.observerSentinel_={};A.Observer.hasObjectObserve=x;A.ArrayObserver=a;A.ArrayObserver.calculateSplices=function(a,
b){return J.calculateSplices(a,b)};A.Platform=c.Platform;A.ArraySplice=v;A.ObjectObserver=b})("undefined"!==typeof c&&c&&"undefined"!==typeof t&&t?c:this||window)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[16]);

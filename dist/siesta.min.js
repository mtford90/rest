!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r=n(1),i=n(2),s=n(3),o=n(4),a=n(5);r._patchBind();var l={createApp:function(e,t){return t=t||{},t.name=e,new s(t)},log:n(27),lib:{log:a,Condition:n(6),Model:n(7),error:n(8),ModelEventType:o.ModelEventType,ModelInstance:n(9),extend:n(23),MappingOperation:n(10),events:n(11),ProxyEventEmitter:n(12),modelEvents:o,Collection:n(13),ReactiveFilter:i,utils:r,util:r,Serialiser:n(14),filterSet:n(15),observe:n(24),Filter:n(16),ManyToManyProxy:n(17),OneToManyProxy:n(18),OneToOneProxy:n(19),RelationshipProxy:n(20),Storage:n(22),Context:s},constants:{Deletion:{Cascade:"cascade",Nullify:"nullify"}},isArray:r.isArray,isString:r.isString,RelationshipType:n(21),ModelEventType:o.ModelEventType,InsertionPolicy:i.InsertionPolicy};"undefined"!=typeof window&&(window.siesta=l)},function(e,t,n){function r(e){return e=e||[],e.filter(function(e){return e})}function i(e,t){if(t=t||function(){},e&&e.length){var n=[],i=[],s=0;e.forEach(function(o,a){n[a]=!1,o(function(o,l){s++,o&&(i[a]=o),n[a]=l,s==e.length&&t(i.length?r(i):null,r(n),{results:n,errors:i})})})}else t()}function s(e,t){function n(n){n(function(n,l){n&&(o[a]=n),s[a]=l,e.length?(a++,i()):t(o.length?r(o):null,r(s),{results:s,errors:o})})}function i(){var t=e.shift();n(t)}if(t=t||function(){},e&&e.length){var s=[],o=[],a=0;i()}else t()}var o=n(24).Platform,a=n(25),l=n(34),c=n(8).InternalSiestaError,h=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},u=Array.isArray,d=function(e){return"string"==typeof e||e instanceof String};h(e.exports,{argsarray:l,next:function(e){o.performMicrotaskCheckpoint(),setTimeout(e)},extend:h,guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),assert:function(e,t,n){if(!e)throw t=t||"Assertion failed",n=n||{},new c(t,n)},pluck:function(e,t){return e.map(function(e){return e[t]})},thenBy:function(){function e(e){return e.thenBy=t,e}function t(t){var n=this;return e(function(e,r){return n(e,r)||t(e,r)})}return e}(),_patchBind:function(){var e=Function.prototype.apply.bind(Function.prototype.bind);Object.defineProperty(Function.prototype,"bind",{value:function(t){var n=e(this,arguments);return Object.defineProperty(n,"__siesta_bound_object",{value:t,writable:!0,configurable:!0,enumerable:!1}),n}})},Promise:a,promise:function(e,t){return e=e||function(){},new a(function(n,r){var i=l(function(t){var i=t[0],s=t.slice(1);i?r(i):n(s[0]);var o=e.__siesta_bound_object||e;e.apply(o,t)});t(i)})},defer:function(){var e,t,n=new a(function(n,r){e=n,t=r});return n.resolve=e,n.reject=t,n},subProperties:function(e,t,n){u(n)||(n=Array.prototype.slice.call(arguments,2));for(var r=0;r<n.length;r++)!function(n){var r={set:!1,name:n,property:n};d(n)||h(r,n);var i={get:function(){return t[r.property]},enumerable:!0,configurable:!0};r.set&&(i.set=function(e){t[r.property]=e}),Object.defineProperty(e,r.name,i)}(n[r])},capitaliseFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},extendFromOpts:function(e,t,n,r){if(r=void 0==r?!0:r){var i=Object.keys(n),s=Object.keys(t),o=s.filter(function(e){return-1==i.indexOf(e)});if(o.length)throw Error("Unknown options: "+o.toString())}Object.keys(n).forEach(function(e){var r=n[e];"function"==typeof r&&(n[e]=r(t[e]),delete t[e])}),h(n,t),h(e,n)},isString:d,isArray:u,prettyPrint:function(e){return JSON.stringify(e,null,4)},flattenArray:function(e){return e.reduce(function(e,t){return u(t)?e=e.concat(t):e.push(t),e},[])},unflattenArray:function(e,t){for(var n=0,r=[],i=0;i<t.length;i++)if(u(t[i])){var s=[];r[i]=s;for(var o=0;o<t[i].length;o++)s.push(e[n]),n++}else r[i]=e[n],n++;return r}}),h(e.exports,{compact:r,parallel:i,series:s});var f=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,v=/,/,p=/^\s*(_?)(.+?)\1\s*$/,m=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;h(e.exports,{paramNames:function(e){var t,n,r=[];return t=e.toString().replace(m,""),n=t.match(f),n[1].split(v).forEach(function(e){e.replace(p,function(e,t,n){r.push(n)})}),r}})},function(e,t,n){function r(e){var t=this;s.call(this),o.call(this),h.extend(this,{insertionPolicy:r.InsertionPolicy.Back,initialised:!1}),Object.defineProperty(this,"filter",{get:function(){return this._filter},set:function(e){e?(this._filter=e,this.results=c([],e.model)):(this._filter=null,this.results=null)},configurable:!1,enumerable:!0}),e&&h.extend(this,{_filter:e,results:c([],e.model)}),Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){var e=t._filter;return e?e.model:void 0}},collection:{get:function(){return t.model.collectionName}}})}var i=n(5)("filter:reactive"),s=(n(16),n(32).EventEmitter),o=n(26),a=n(4),l=n(8).InternalSiestaError,c=n(15),h=n(1);r.prototype=Object.create(s.prototype),h.extend(r.prototype,o.prototype),h.extend(r,{InsertionPolicy:{Front:"Front",Back:"Back"}}),h.extend(r.prototype,{init:function(e,t){if(this._filter){var n=this._constructNotificationName(),r=function(e){this._handleNotif(e)}.bind(this);return this.handler=r,this.model.context.events.on(n,r),h.promise(e,function(e){!this.initialised||t?this._filter.execute(function(t,n){t?e(t):e(null,this._applyResults(n))}.bind(this)):e(null,this.results)}.bind(this))}throw new l("No _filter defined")},_applyResults:function(e){return this.results=e,this.initialised=!0,this.results},insert:function(e){var t=this.results.mutableCopy();if(this.insertionPolicy==r.InsertionPolicy.Back)var n=t.push(e);else n=t.unshift(e);return this.results=t.asModelFilterSet(this.model),n},update:function(e){return this.init(e,!0)},_handleNotif:function(e){if(e.type==a.ModelEventType.New){var t=e["new"];if(this._filter.objectMatchesFilter(t)){i("New object matches",t);var n=this.insert(t);this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this})}else i("New object does not match",t)}else if(e.type==a.ModelEventType.Set){t=e.obj;var r=this.results.indexOf(t),s=r>-1,o=this._filter.objectMatchesFilter(t);if(o&&!s)i("Updated object now matches!",t),n=this.insert(t),this.emit(a.ModelEventType.Splice,{index:n,added:[t],type:a.ModelEventType.Splice,obj:this});else if(!o&&s){i("Updated object no longer matches!",t),u=this.results.mutableCopy();var h=u.splice(r,1);this.results=u.asModelFilterSet(this.model),this.emit(a.ModelEventType.Splice,{index:r,obj:this,"new":t,type:a.ModelEventType.Splice,removed:h})}else o||s?o&&s&&(i("Matches but already contains",t),this.emit(e.type,e)):i("Does not contain, but doesnt match so not inserting",t)}else{if(e.type!=a.ModelEventType.Remove)throw new l('Unknown change type "'+e.type.toString()+'"');t=e.obj;var u=this.results.mutableCopy();r=u.indexOf(t),r>-1?(i("Removing object",t),h=u.splice(r,1),this.results=c(u,this.model),this.emit(a.ModelEventType.Splice,{index:r,obj:this,type:a.ModelEventType.Splice,removed:h})):i("No modelEvents neccessary.",t)}this.results=c(this._filter._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&this.model.context.events.removeListener(this._constructNotificationName(),this.handler),this.results=null,this.handler=null},_registerEventHandler:function(e,t,n){var r=s.prototype.removeListener;return"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(t){e.call(this,a.ModelEventType[t],n)}.bind(this)):e.call(this,t,n),this._link({on:this.on.bind(this),once:this.once.bind(this),update:this.update.bind(this),insert:this.insert.bind(this)},function(){"*"==t.trim()?Object.keys(a.ModelEventType).forEach(function(e){r.call(this,a.ModelEventType[e],n)}.bind(this)):r.call(this,t,n)})},on:function(e,t){return this._registerEventHandler(s.prototype.on,e,t)},once:function(e,t){return this._registerEventHandler(s.prototype.once,e,t)}}),e.exports=r},function(e,t,n){function r(e){this._storage=new u(this,e)}function i(e){if(this.collections={},this.cache=new a,e=e||{},this.name=e.name,e.storage&&r.call(this,e.storage),!this.name)throw new Error("Must provide name to context");this.events=s();var t=this.events.removeListener.bind(this.events);l.extend(this,{on:this.events.on.bind(this.events),off:t,removeListener:t,once:this.events.once.bind(this.events),removeAllListeners:this.events.removeAllListeners.bind(this.events),notify:l.next,digest:l.next,emit:l.next,registerComparator:d.registerComparator.bind(d),save:function(e){return l.promise(e,function(e){this._storage?this._storage.save(e):e()}.bind(this))}});var n,i,o=500;Object.defineProperties(this,{storage:{get:function(){return!!this._storage},set:function(e){e?this._storage=new u(this):delete this._storage}},dirty:{get:function(){var e=this._storage;if(e){{e._unsavedObjectsByCollection}return!!Object.keys(e.unsavedObjectsByCollection).length}return!1},enumerable:!0},autosaveInterval:{get:function(){return o},set:function(e){o=e,n&&(this.autosave=!1,this.autosave=!0)}},autosave:{get:function(){return!!n},set:function(e){e?n||(n=setInterval(function(){i||(i=!0,this._storage.save(function(e){e||this.events.emit("saved"),i=!1}.bind(this)))}.bind(this),this.autosaveInterval)):n&&(clearInterval(n),n=null)}},collectionNames:{get:function(){return Object.keys(this.collections)}}}),this.autosave=e.autosave,e.autosaveInterval&&(this.autosaveInterval=e.autosaveInterval)}var s=n(11),o=n(4),a=n(28),l=n(1),c=n(7),h=n(8),u=n(22),d=n(16),f=n(13);i.prototype={collection:function(e,t){t=t||{},t.context=this;var n=new f(e,t);if(this[e]){var r='A collection with name "'+e+'" already exists, or that name is not allowed';throw console.error(r,this[e]),Error(r)}return this[e]=n,n},broadcast:function(e){o.emit(this,e)},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},l.promise(n,function(t){var n,r=[];for(var i in e)if(e.hasOwnProperty(i)){var s=this.collections[i];s?!function(e,t){r.push(function(n){e.graph(t,function(t,r){if(!t){var i={};i[e.name]=r}n(t,i)})})}(s,e[i]):n='No such collection "'+i+'"'}n?t(h(n,{data:e,invalidCollectionName:i})):l.series(r,function(e,n){n=e?null:n.reduce(function(e,t){return l.extend(e,t)},{}),t(e,n)})}.bind(this))},count:function(){return this.cache.count()},get:function(e,t){return l.promise(t,function(t){t(null,this.cache._localCache()[e])}.bind(this))},removeAll:function(e){return l.promise(e,function(e){l.Promise.all(this.collectionNames.map(function(e){var t=this.collections[e];return t.removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))},_ensureInstalled:function(e){e=e||function(){};var t=this.collectionNames.reduce(function(e,t){var n=this.collections[t];return e=e.concat(n.models)}.bind(this),[]);c.install(t,e)},_pushTask:function(e){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[],this.execute=function(){this.tasks.forEach(function(e){e()}),this.tasks=[]}.bind(this)}),this.queuedTasks.tasks.push(e)},reset:function(e,t){delete this.queuedTasks,this.cache.reset();var n=this.collectionNames;n.forEach(function(e){this[e]=void 0}.bind(this)),this.removeAllListeners(),this._storage?(t=void 0===t?!0:t,t?this._storage._reset(e,new PouchDB("siesta",{auto_compaction:!0,adapter:"memory"})):e()):e()},context:function(e){var t=new i(e),n=this.collectionNames,r={};return n.forEach(function(e){var n=t.collection(e),i=this.collections[e];r[e]=n;var s=i._rawModels;Object.keys(s).forEach(function(e){var t=l.extend({},s[e]);t.name=e;var r=t.relationships;r&&Object.keys(r).forEach(function(e){var t=l.extend({},r[e]);t.model&&t.model instanceof c&&(t.model=t.model.name),r[e]=t}),n.model(t)})}.bind(this)),t}},e.exports=i},function(e,t,n){function r(e){this._opts=e||{},Object.keys(e).forEach(function(t){this[t]=e[t]}.bind(this))}function i(e,t,n,r){var i="Siesta",s=e.collections[t],o=s[n];if(!s)throw new a('No such collection "'+t+'"');if(!o)throw new a('No such model "'+n+'"');var l=r.obj._emitEvents;if(l&&"new"in r&&"old"in r&&(l=r["new"]instanceof Date&&r.old instanceof Date?r["new"].getTime()!=r.old.getTime():r["new"]!=r.old),l){e.events.emit(i,r);var c=t+":"+n,h=r.localId;e.events.emit(t,r),e.events.emit(c,r),e.events.emit(h,r),o.id&&r.obj[o.id]&&e.events.emit(t+":"+n+":"+r.obj[o.id],r)}}function s(e){if(!e.model)throw new a("Must pass a model");if(!e.collection)throw new a("Must pass a collection");if(!e.localId)throw new a("Must pass a local identifier");if(!e.obj)throw new a("Must pass the object")}function o(e,t){s(t);var n=t.collection,o=t.model,a=new r(t);return i(e,n,o,a),a}var a=n(8).InternalSiestaError,l=(n(5)("events"),n(24).ArrayObserver),c=n(1).extend,h={Set:"set",Splice:"splice",New:"new",Remove:"remove"};r.prototype._dump=function(e){var t={};return t.collection="string"==typeof this.collection?this.collection:this.collection._dump(),t.model="string"==typeof this.model?this.model:this.model.name,t.localId=this.localId,t.field=this.field,t.type=this.type,this.index&&(t.index=this.index),this.added&&(t.added=this.added.map(function(e){return e._dump()})),this.removed&&(t.removed=this.removed.map(function(e){return e._dump()})),this.old&&(t.old=this.old),this["new"]&&(t["new"]=this["new"]),e?util.prettyPrint(t):t},c(t,{ModelEvent:r,emit:o,validateEventOpts:s,ModelEventType:h,wrapArray:function(e,t,n){e.observer||(e.observer=new l(e),e.observer.open(function(r){var i=n._attributeNames.indexOf(t)>-1;i&&r.forEach(function(r){o(n.context,{collection:n.collectionName,model:n.model.name,localId:n.localId,index:r.index,removed:r.removed,added:r.addedCount?e.slice(r.index,r.index+r.addedCount):[],type:h.Splice,field:t,obj:n})})}))}})},function(e,t,n){var r=n(27),i=n(34);e.exports=function(e){var t=r("siesta:"+e),n=i(function(e){t.call(t,e)});return Object.defineProperty(n,"enabled",{get:function(){return r.enabled(e)}}),n}},function(e,t,n){function r(e,t){(void 0===t||null===t)&&(this.lazy=!0),this._fn=e||function(e){e()},this.reset()}var i=n(1),s=n(25),o=n(34);r.all=o(function(e){return new r(e)}),r.prototype={_execute:function(){if(!this.executed){var e=i.pluck(this.dependent,"_promise");s.all(e).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()})}},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){this._promise=new s(function(e,t){this.reject=t,this.resolve=e,this.fn=function(){this.executed=!0;var n=0,r=[],s=[];if(i.isArray(this._fn)){var o=function(){n==this._fn.length&&(s.length?t(s):e(r))}.bind(this);this._fn.forEach(function(e,t){e.then(function(e){r[t]=e,n++,o()}.bind(this))["catch"](function(e){s[t]=e,n++,o()}.bind(this))})}else this._fn(function(n,r){n?t(n):e(r)}.bind(this))}.bind(this)}.bind(this)),this.lazy||this._execute(),this.executed=!1,this.dependent=[]}},e.exports=r},function(e,t,n){(function(t){function r(e){var t=this;this._rawOpts=c.extend({},e||{}),this._opts=e?c.extend({},e):{},c.extendFromOpts(this,e,{methods:{},attributes:[],collection:null,id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,serialise:null,serialiseField:null,serialisableFields:null,remove:null,parseAttribute:null},!1),this.parseAttribute||(this.parseAttribute=function(e,t){return t}),this.attributes=r._processAttributes(this.attributes),this._factory=new b(this),this._instance=this._factory._instance.bind(this._factory),c.extend(this,{_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]}),Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(t.relationships)},enumerable:!0},_attributeNames:{get:function(){var e=[];return t.id&&e.push(t.id),t.attributes.forEach(function(t){e.push(t.name)}),e},enumerable:!0,configurable:!0},installed:{get:function(){return t._relationshipsInstalled&&t._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return t.children.reduce(function(e,t){return Array.prototype.concat.call(e,t.descendants)}.bind(t),c.extend([],t.children))},enumerable:!0},dirty:{get:function(){if(this.context.storage){var e=this.context._storage._unsavedObjectsByCollection,t=(e[this.collectionName]||{})[this.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0},context:{get:function(){return this.collection.context}}});var n=this.collectionName+":"+this.name,i={filter:this.filter.bind(this)};f.call(this,this.context,n,i),this.installRelationships(),this.installReverseRelationships(),this._indexIsInstalled=new d(function(e){this.context.storage?this.context._storage.ensureIndexInstalled(this,function(t){e(t)}):e()}.bind(this)),this._modelLoadedFromStorage=new d(function(e){var t=this.context.storage;t?this.context._storage.loadModel({model:this},function(t){e(t)}):e()}.bind(this)),this._storageEnabled=new d([this._indexIsInstalled,this._modelLoadedFromStorage])}var i=n(5)("model"),s=n(8).InternalSiestaError,o=n(21),a=n(16),l=n(10),c=(n(9),n(1)),h=n(34),u=n(8),d=(n(23),n(4),n(6)),f=n(12),v=(c.Promise,n(25)),p=n(29),m=n(2),b=n(30);c.extend(r,{_processAttributes:function(e){return e.reduce(function(e,t){return e.push("string"==typeof t?{name:t}:t),e},[])},install:function(e,t){return t=t||function(){},new v(function(n,r){var i=e.map(function(e){return e._storageEnabled});d.all.apply(d,i).then(function(){e.forEach(function(e){e._installReversePlaceholders()}),t(),n()})["catch"](function(e){r(e)})})}}),r.prototype=Object.create(f.prototype),c.extend(r.prototype,{installStatics:function(e){return e&&Object.keys(e).forEach(function(t){this[t]?i('Static method with name "'+t+'" already exists. Ignoring it.'):this[t]=e[t].bind(this)}.bind(this)),e},_validateRelationshipType:function(e){if(e.type||(e.type=this.singleton?o.OneToOne:o.OneToMany),this.singleton&&e.type==o.ManyToMany)throw new Error("Singleton model cannot use ManyToMany relationship.");if(Object.keys(o).indexOf(e.type)<0)throw new Error("Relationship type "+e.type+" does not exist")},_getReverseModel:function(e){var t;if(t=e instanceof r?e:this.collection[e],!t){var n=e.split(".");if(2==n.length){var i=n[0];e=n[1];var s=this.context.collections[i];s&&(t=s[e])}}return t},_getReverseModelOrPlaceholder:function(e,t){var n=this._getReverseModel(t);return n||new p({name:t,ref:this,forwardName:e})},installRelationships:function(){if(this._relationshipsInstalled)throw new s('Relationships for "'+this.name+'" have already been installed');var e=null;for(var t in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(t)){var n=this._opts.relationships[t];n.deletion||(n.deletion=siesta.constants.Deletion.Nullify);var r=!n.isReverse;if(r&&(i(this.name+": configuring relationship "+t,n),!(e=this._validateRelationshipType(n)))){var o=n.model;if(!o)return"Must pass model";var a=this._getReverseModelOrPlaceholder(t,o);c.extend(n,{reverseModel:a,forwardModel:this,forwardName:t,reverseName:n.reverse||"reverse_"+t,isReverse:!1}),delete n.model,delete n.reverse}}return e||(this._relationshipsInstalled=!0),e},_installReverse:function(e){var t=c.extend({},e);t.isReverse=!0;var n=t.reverseModel,r=n.isPlaceholder;if(r){var i=t.reverseModel.name;n=this._getReverseModel(i),n&&(t.reverseModel=n,e.reverseModel=n)}if(n){var s=t.reverseName,a=t.forwardModel;if(n!=this||n==a){if(n.singleton){if(t.type==o.ManyToMany)throw new Error("Singleton model cannot be related via reverse ManyToMany");if(t.type==o.OneToMany)throw new Error("Singleton model cannot be related via reverse OneToMany")}if(n.relationships[s]){var l=n.relationships[s].forwardModel.isAncestorOf(this),h=n.relationships[s].forwardModel.isDescendantOf(this);if(!l&&!h&&!r)throw new Error('Reverse relationship "'+s+'" already exists on model "'+n.name+'"')}n.relationships[s]=t}var u=(this.context.cache._localCacheByType[n.collectionName]||{})[n.name]||{};Object.keys(u).forEach(function(e){var n=u[e];this._factory._installRelationship(t,n)}.bind(this))}},_installReversePlaceholders:function(){for(var e in this.relationships)if(this.relationships.hasOwnProperty(e)){var t=this.relationships[e];t.reverseModel.isPlaceholder&&this._installReverse(t)}},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new s('Reverse relationships for "'+this.name+'" have already been installed.');for(var e in this.relationships)this.relationships.hasOwnProperty(e)&&this._installReverse(this.relationships[e]);this._reverseRelationshipsInstalled=!0},_filter:function(e){return new a(this,e||{})},filter:function(e,n){var r,i=c.promise(n,function(t){this.context._ensureInstalled(function(){return this.singleton?(r=this._filter({__ignoreInstalled:!0}),void r.execute(function(n,i){n?t(n):(e=c.extend({},e),e.__ignoreInstalled=!0,i.length?(r=this._filter(e),r.execute(t)):this.graph({},function(n){n?t(n):(r=this._filter(e),r.execute(t))}.bind(this)))}.bind(this))):(r=this._filter(e),r.execute(t))}.bind(this))}.bind(this)),s=new c.Promise(function(e,n){i.then(h(function(n){t(function(){e.apply(null,n)})}),h(function(e){t(function(){n.apply(null,e)})}))});return this._link({then:s.then.bind(s),"catch":s["catch"].bind(s),on:h(function(t){var n=new m(this._filter(e));n.init(),n.on.apply(n,t)}.bind(this))})},_reactiveFilter:function(e){return new m(new a(this,e||{}))},one:function(e,t){return"function"==typeof e&&(t=e,e={}),c.promise(t,function(t){this.filter(e,function(e,n){e?t(e):n.length>1?t(u("More than one instance returned when executing get filter!")):(n=n.length?n[0]:null,t(null,n))})}.bind(this))},all:function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};var n={};return e.__order&&(n.__order=e.__order),this.filter(e,t)},_attributeDefinitionWithName:function(e){for(var t=0;t<this.attributes.length;t++){var n=this.attributes[t];if(n.name==e)return n}},_graph:function(e,t,n){var r=function(){var r=t.override;r&&(t.objects=c.isArray(r)?r:[r]),delete t.override,c.isArray(e)?this._mapBulk(e,t,n):this._mapBulk([e],t,function(t,r){var i;r&&r.length&&(i=r[0]),t=t?c.isArray(e)?t:c.isArray(t)?t[0]:t:null,n(t,i)})}.bind(this);r()},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},c.promise(n,function(n){this.context._ensureInstalled(function(r){r?n(r):this._graph(e,t,n)}.bind(this))}.bind(this))},_mapBulk:function(e,t,n){c.extend(t,{model:this,data:e});var r=new l(t);r.start(function(e,t){e?n&&n(e):n(null,t||[])})},_countCache:function(){var e=this.context.cache._localCacheByType[this.collectionName]||{},t=e[this.name]||{};return Object.keys(t).reduce(function(e,t){return e[t]={},e},{})},count:function(e){return c.promise(e,function(e){this.context._ensureInstalled(function(){e(null,Object.keys(this._countCache()).length)}.bind(this))}.bind(this))},_dump:function(e){var t={};return t.name=this.name,t.attributes=this.attributes,t.id=this.id,t.collection=this.collectionName,t.relationships=this.relationships.map(function(e){return e.isForward?e.forwardName:e.reverseName}),e?c.prettyPrint(t):t},toString:function(){return"Model["+this.name+"]"},removeAll:function(e){return c.promise(e,function(e){this.all().then(function(t){t.remove(),e()})["catch"](e)}.bind(this))}}),c.extend(r.prototype,{child:function(e,t){"string"==typeof e?t.name=e:t=name,c.extend(t,{attributes:Array.prototype.concat.call(t.attributes||[],this._opts.attributes),relationships:c.extend(t.relationships||{},this._opts.relationships),methods:c.extend(c.extend({},this._opts.methods)||{},t.methods),statics:c.extend(c.extend({},this._opts.statics)||{},t.statics),properties:c.extend(c.extend({},this._opts.properties)||{},t.properties),id:t.id||this._opts.id,init:t.init||this._opts.init,remove:t.remove||this._opts.remove,parseAttribute:t.parseAttribute||this._opts.parseAttribute});var n=this.collection.model(t.name,t);return n.parent=this,this.children.push(n),n},isChildOf:function(e){return this.parent==e},isParentOf:function(e){return this.children.indexOf(e)>-1},isDescendantOf:function(e){for(var t=this.parent;t;){if(t==e)return!0;t=t.parent}return!1},isAncestorOf:function(e){return this.descendants.indexOf(e)>-1},hasAttributeNamed:function(e){return this._attributeNames.indexOf(e)>-1}}),e.exports=r}).call(t,n(33).setImmediate)},function(e,t,n){function r(e,t,n){Error.call(this,e,t,n),this.message=e,this.context=t,n&&Error.captureStackTrace&&Error.captureStackTrace(this,n)}function i(e){return"object"==typeof e?"error"in e&&"ok"in e&&"reason"in e:!1}r.prototype=Object.create(Error.prototype),r.prototype.name="InternalSiestaError",r.prototype.constructor=r,e.exports=function(e,t){if(i(e))return e;var n={reason:e,error:!0,ok:!1};for(var r in t||{})t.hasOwnProperty(r)&&(n[r]=t[r]);return n.toString=function(){return JSON.stringify(this)},n},e.exports.InternalSiestaError=r},function(e,t,n){function r(e){if(!e)throw new Error("wtf");var t=this;this.model=e,a.call(this,e.context),this.__proxies={},this._proxies=[],i.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]),Object.defineProperties(this,{_relationshipNames:{get:function(){var e=Object.keys(t.__proxies||{}).map(function(e){return t.__proxies[e]});return e.map(function(e){return e.isForward?e.forwardName:e.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){return this.context.storage?t.localId in this.context._storage._unsavedObjectsHash:void 0},enumerable:!0},event:{get:function(){return this.localId}},context:{get:function(){return this.model.context}}}),this.removed=!1,this._emitEvents=!1}var i=(n(5),n(1)),s=(n(8),n(4)),o=s.ModelEventType,a=n(12);r.prototype=Object.create(a.prototype),i.extend(r.prototype,{get:function(e){return i.promise(e,function(e){e(null,this)}.bind(this))},emit:function(e,t){"object"==typeof e?t=e:t.type=e,t=t||{},i.extend(t,{collection:this.collectionName,model:this.model.name,localId:this.localId,obj:this}),this.context.broadcast(t)},remove:function(e,t){return _.each(this._relationshipNames,function(e){var t,n=this.model.relationships[e];if(n&&n.deletion===siesta.constants.Deletion.Cascade)if("OneToMany"==n.type)n.isReverse&&(t=this[e]);else if("OneToOne"==n.type){var r=this[e];r&&(t=[r])}this[e]=i.isArray(this[e])?[]:null,t&&t.forEach(function(e){e.remove()})}.bind(this)),t=null==t?!0:t,i.promise(e,function(e){this.context.cache.remove(this),this.removed=!0,t&&this.emit(s.ModelEventType.Remove,{old:this});var n=this.model.remove;if(n){var r=i.paramNames(n);if(r.length){var o=this;n.call(this,function(t){e(t,o)})}else n.call(this),e(null,this)}else e(null,this)}.bind(this))},restore:function(e){return i.promise(e,function(e){var t=function(t){t||this.emit(s.ModelEventType.New,{"new":this}),e(t,this)}.bind(this);if(this.removed){this.context.cache.insert(this),this.removed=!1;var n=this.model.init;if(n){var r=i.paramNames(n),o=!0;r.length>1?n.call(this,o,t):(n.call(this,o),t())}else t()}}.bind(this))}}),i.extend(r.prototype,{getAttributes:function(){return i.extend({},this.__values)},isInstanceOf:function(e){return this.model==e},isA:function(e){return this.model==e||this.model.isDescendantOf(e)}}),i.extend(r.prototype,{_dumpString:function(e){return JSON.stringify(this._dump(e,null,4))},_dump:function(e){var t=i.extend({},this.__values);return t._rev=this._rev,t.localId=this.localId,t}}),i.extend(r.prototype,{_emitNew:function(){this.context.broadcast({collection:this.model.collectionName,model:this.model.name,localId:this.localId,"new":this,type:o.New,obj:this})}}),e.exports=r},function(e,t,n){function r(e){this.opts=e}function i(e){this._opts=e,o.extendFromOpts(this,e,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,fromStorage:!1}),o.extend(this,{errors:[],subTaskResults:{},_newObjects:[]}),this.model._installReversePlaceholders(),this.data=this.preprocessData()}var s=n(9),o=(n(5)("graph"),n(1));r.prototype.toString=function(){return JSON.stringify(this.opts,null,4)},o.extend(i.prototype,{mapAttributes:function(){for(var e=0;e<this.data.length;e++){var t=this.data[e],n=this.objects[e];if(t!=n&&n){var r=this.model._attributeNames;r.forEach(function(r){if(void 0!==t[r])if(this.disableevents)n.__values[r]=t[r];else try{n[r]=t[r]}catch(i){this.errors[e]=i}}.bind(this)),t._rev&&(n._rev=t._rev)}}},_map:function(){var e,t=this;this.mapAttributes();var n=Object.keys(t.subTaskResults);n.forEach(function(n){for(var r=t.subTaskResults[n],i=r.indexes,s=r.objects,a=t.getRelatedData(n).relatedData,l=o.unflattenArray(s,a),c=0;c<l.length;c++){var h=i[c],u=t.errors[h];if(e=u?u[n]:null,!e){var d=l[c],f=t.objects[h];f&&(e=f.__proxies[n].set(d,{disableevents:t.disableevents}),e&&(t.errors[h]||(t.errors[h]={}),t.errors[h][n]=e))}}})},_sortLookups:function(){for(var e=[],t=[],n=0;n<this.data.length;n++)if(!this.objects[n]){var r,i=this.data[n],o="string"==typeof i||"number"==typeof i||i instanceof String;i?o?(r={index:n,datum:{}},r.datum[this.model.id]=i,e.push(r)):i instanceof s?this.objects[n]=i:i.localId?t.push({index:n,datum:i}):i[this.model.id]?e.push({index:n,datum:i}):this.objects[n]=this._instance():this.objects[n]=null}return{remoteLookups:e,localLookups:t}},_performLocalLookups:function(e){for(var t=this.model.context.cache,n=o.pluck(o.pluck(e,"datum"),"localId"),r=t.getViaLocalId(n),i=0;i<n.length;i++){var s=r[i],a=n[i],l=e[i];s?this.objects[l.index]=s:(s=t.get({localId:a}),s||(s=this._instance({localId:a},!this.disableevents)),this.objects[l.index]=s)}},_performRemoteLookups:function(e){for(var t=this.model.context.cache,n=o.pluck(o.pluck(e,"datum"),this.model.id),r=t.getViaRemoteId(n,{model:this.model}),i=0;i<r.length;i++){var s=r[i],a=e[i];if(s)this.objects[a.index]=s;else{var l={},c=n[i];l[this.model.id]=c;var h={model:this.model};h[this.model.id]=c;var u=t.get(h);u?this.objects[a.index]=u:(this.objects[a.index]=this._instance(),this.objects[a.index][this.model.id]=c)}}},_lookup:function(){if(this.model.singleton)this._lookupSingleton();else{var e=this._sortLookups(),t=e.remoteLookups,n=e.localLookups;this._performLocalLookups(n),this._performRemoteLookups(t)}},_lookupSingleton:function(){var e,t=o.pluck(this.data,"localId");for(r=0;r<t.length;r++)if(t[r]){e={localId:t[r]};break}for(var n=this.model.context.cache.getSingleton(this.model)||this._instance(e),r=0;r<this.data.length;r++)this.objects[r]=n},_instance:function(){var e=this.model,t=e._instance.apply(e,arguments);return this._newObjects.push(t),t},preprocessData:function(){var e=o.extend([],this.data);return e.map(function(e){if(e&&!o.isString(e)){var t=Object.keys(e);t.forEach(function(t){var n=this.model._relationshipNames.indexOf(t)>-1;if(n){var r=e[t];r instanceof s&&(e[t]={localId:r.localId})}}.bind(this))}return e}.bind(this))},start:function(e){var t=this.data;if(t.length){var n=this,r=[];this._lookup(),r.push(this._executeSubOperations.bind(this)),o.parallel(r,function(t){t&&console.error(t),n._map();var r=this.fromStorage,i=n._newObjects.reduce(function(t,n){var i=n.model.init;if(i){var s=o.paramNames(i);s.length>1?t.push(i.bind(n,r,e)):i.call(n,r)}return n._emitEvents=!0,n._emitNew(),t},[]);o.parallel(i,function(){e(n.errors.length?n.errors:null,n.objects)})}.bind(this))}else e(null,[])},getRelatedData:function(e){for(var t=[],n=[],r=0;r<this.data.length;r++){var i=this.data[r];if(i){var s=i[e];s&&(t.push(r),n.push(s))}}return{indexes:t,relatedData:n}},processErrorsFromTask:function(e,t,n){if(t.length)for(var r=this.getRelatedData(e).relatedData,i=o.unflattenArray(t,r),s=0;s<i.length;s++){var a=n[s],l=i[s],c=l;o.isArray(l)&&(c=l.reduce(function(e,t){return e||t},!1)),c&&(this.errors[a]||(this.errors[a]={}),
this.errors[a][e]=l)}},_executeSubOperations:function(e){var t=this,n=Object.keys(this.model.relationships);if(n.length){var r=n.reduce(function(e,n){var r=t.model.relationships[n],s=r.forwardName==n?r.reverseModel:r.forwardModel;s.singleton&&!r.isReverse&&this.data.forEach(function(e){e[n]||(e[n]={})});var a=this.getRelatedData(n),l=a.indexes,c=a.relatedData;if(c.length)var h=o.flattenArray(c),u=new i({model:s,data:h,disableevents:t.disableevents,_ignoreInstalled:t._ignoreInstalled,fromStorage:this.fromStorage});if(u){var d;d=function(e){u.start(function(r,i){t.subTaskResults[n]={errors:r,objects:i,indexes:l},t.processErrorsFromTask(n,u.errors,l),e()})},e.push(d)}return e}.bind(this),[]);o.parallel(r,function(t){e(t)})}else e()}}),e.exports=i},function(e,t,n){var r=n(32).EventEmitter,i=(n(1),n(34),n(4),n(26),function(){var e=new r;e.setMaxListeners(100);var t=e.emit;return e.emit=function(n,r){try{t.call(e,n,r)}catch(i){console.error(i)}},e});e.exports=i},function(e,t,n){function r(e,t,n){if(!e)throw new Error("wtf");i.extend(this,{event:t,context:e,listeners:{}});var r={};r.on=this.on.bind(this),r.once=this.once.bind(this),s.call(this,i.extend(r,n||{}))}var i=(n(24).ArrayObserver,n(1)),s=(n(34),n(4),n(26));r.prototype=Object.create(s.prototype),i.extend(r.prototype,{on:function(e,t){if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var n=t;t=function(t){t=t||{},e?t.type==e&&n(t):n(t)};var r=this.listeners;e&&(r[e]||(r[e]=[]),r[e].push(t))}return this.context.events.on(this.event,t),this._handlerLink({fn:t,type:e,extend:this.proxyChainOpts})},once:function(e,t){var n=this.event;if("function"==typeof e)t=e,e=null;else{"*"==e.trim()&&(e=null);var r=t;t=function(i){i=i||{},e?i.type==e&&(this.context.events.removeListener(n,t),r(i)):r(i)}.bind(this)}return e?this.context.events.on(n,t):this.context.events.once(n,t)},_removeListener:function(e,t){if(t){var n=this.listeners[t],r=n.indexOf(e);n.splice(r,1)}return this.context.events.removeListener(this.event,e)},emit:function(e,t){"object"==typeof e?(t=e,e=null):(t=t||{},t.type=e),this.context.events.emit.call(this.context.events,this.event,t)},_removeAllListeners:function(e){(this.listeners[e]||[]).forEach(function(e){this.context.events.removeListener(this.event,e)}.bind(this)),this.listeners[e]=[]},removeAllListeners:function(e){if(e)this._removeAllListeners(e);else for(e in this.listeners)this.listeners.hasOwnProperty(e)&&this._removeAllListeners(e)}}),e.exports=r},function(e,t,n){function r(e,t){var n=this;if(!e)throw new Error("Collection must have a name");t=t||{},a.extendFromOpts(this,t,{context:null}),a.extend(this,{name:e,_rawModels:{},_models:{},_opts:t,installed:!1}),Object.defineProperties(this,{dirty:{get:function(){if(this.context.storage){var e=this.context._storage._unsavedObjectsByCollection,t=e[n.name]||{};return!!Object.keys(t).length}return void 0},enumerable:!0},models:{get:function(){return Object.keys(this._models).map(function(e){return this._models[e]}.bind(this))}}}),this.context.collections[this.name]=this,o.call(this,this.context,this.name)}{var i=(n(5)("collection"),n(8).InternalSiestaError,n(7)),s=n(23),o=n(12),a=n(1),l=n(8),c=n(34);n(31)}r.prototype=Object.create(o.prototype),a.extend(r.prototype,{_model:function(e,t){if(e){this._rawModels[e]=t,t=s(!0,{},t),t.name=e,t.collection=this;var n=new i(t);return this._models[e]=n,this[e]=n,n}throw new Error("No name specified when creating mapping")},model:c(function(e){if(e.length){if(1==e.length){if(a.isArray(e[0]))return e[0].map(function(e){return this._model(e.name,e)}.bind(this));var t,n;return a.isString(e[0])?(t=e[0],n={}):(n=e[0],t=n.name),this._model(t,n)}return"string"==typeof e[0]?this._model(e[0],e[1]):e.map(function(e){return this._model(e.name,e)}.bind(this))}return null}),_dump:function(e){var t={};return t.installed=this.installed,t.docId=this._docId,t.name=this.name,e?a.prettyPrint(t):t},count:function(e){return a.promise(e,function(e){var t=Object.keys(this._models).map(function(e){var t=this._models[e];return t.count.bind(t)}.bind(this));a.parallel(t,function(t,n){var r;t||(r=n.reduce(function(e,t){return e+t},0)),e(t,r)})}.bind(this))},graph:function(e,t,n){return"function"==typeof t&&(n=t),t=t||{},a.promise(n,function(t){var n,r=[];for(var i in e)if(e.hasOwnProperty(i)){var s=this._models[i];s?!function(e,t){r.push(function(n){e.graph(t,function(t,r){if(!t){var i={};i[e.name]=r}n(t,i)})})}(s,e[i]):n='No such model "'+i+'"'}n?t(l(n,{data:e,invalidModelName:i})):a.series(r,function(e,n){n=e?null:n.reduce(function(e,t){return a.extend(e,t||{})},{}),t(e,n)})}.bind(this))},removeAll:function(e){return a.promise(e,function(e){a.Promise.all(Object.keys(this._models).map(function(e){var t=this._models[e];return t.removeAll()}.bind(this))).then(function(){e(null)})["catch"](e)}.bind(this))}}),e.exports=r},function(e,t,n){function r(e,t){this.model=e,s.extend(this,t||{})}function i(e,t){return t}var s=(n(5),n(1));r.prototype={data:function(e,t){return t=t||{},this.serialise?this.serialise(e,t):this._defaultSerialise(e,t)},_getRelationshipSerialiser:function(e){return this[e.isReverse?e.reverseName:e.forwardName]},_defaultSerialise:function(e,t){var n={},r=void 0!==t.includeNullAttributes?t.includeNullAttributes:!0,o=void 0!==t.includeNullRelationships?t.includeNullRelationships:!0,a=this.model._attributeNames,l=this.model._relationshipNames,c=this.model.id,h=this.serialisableFields||a.concat.apply(a,l).concat(c);a.forEach(function(t){if(h.indexOf(t)>-1){var s=this[t];if(!s){var o=this.serialiseField||i;s=o.bind(this,t)}var a=e[t];if(null===a){if(r){var l=s(a);void 0!==l&&(n[t]=l)}}else void 0!==a&&(l=s(a),void 0!==l&&(n[t]=l))}}.bind(this));var u=this.model.relationships;return l.forEach(function(t){if(h.indexOf(t)>-1){var r=e[t],a=u[t];if(a&&!a.isReverse){var l,c=this._getRelationshipSerialiser(a);if(c)l=c.bind(this);else{var d=this.serialiseField;d||(s.isArray(r)?r=s.pluck(r,this.model.id):r&&(r=r[this.model.id])),d=d||i,l=d.bind(this,t)}if(null===r){if(o){var f=l(r);void 0!==f&&(n[t]=f)}}else s.isArray(r)?(o&&!r.length||r.length)&&(f=l(r),void 0!==f&&(n[t]=f)):void 0!==r&&(f=l(r),void 0!==f&&(n[t]=f))}}}.bind(this)),n}},e.exports=r},function(e,t,n){function r(e){var t;return t="string"==typeof e||e instanceof String?_.concat(y):"number"==typeof e||e instanceof Number?m.concat(b):e.getOwnPropertyNames()}function i(e,t){t in e||Object.defineProperty(e,t,{get:function(){return l(u.pluck(e,t))},set:function(e){if(u.isArray(e)){if(this.length!=e.length)throw f({message:"Must be same length"});for(var n=0;n<e.length;n++)this[n][t]=e[n]}else for(n=0;n<this.length;n++)this[n][t]=e}})}function s(e){return e.then&&e["catch"]}function o(e,t){t in e||(e[t]=function(){var e=arguments,n=this.map(function(n){return n[t].apply(n,e)}),r=!1;return n.length&&(r=s(n[0])),r?d.all(n):l(n)})}function a(e,t){e=u.extend([],e);var n=t._attributeNames,r=t._relationshipNames,s=n.concat(r).concat(a);s.forEach(i.bind(i,e));var a=Object.keys(v.prototype);return a.forEach(o.bind(o,e)),h(e)}function l(e){if(e.length){var t=e[0],n=r(t);n.forEach(function(n){"function"==typeof t[n]?o(e,n,arguments):i(e,n)})}return h(e)}function c(){throw new Error("Cannot modify a filter set")}function h(e){return p.forEach(function(t){e[t]=c}),e.immutable=!0,e.mutableCopy=e.asArray=function(){var e=this.map(function(e){return e});return e.asFilterSet=function(){return l(this)},e.asModelFilterSet=function(e){return a(this,e)},e},e}var u=n(1),d=u.Promise,f=n(8),v=n(9),p=["push","sort","reverse","splice","shift","unshift"],m=["toString","toExponential","toFixed","toPrecision","valueOf"],b=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],_=["charAt","charCodeAt","concat","fromCharCode","indexOf","lastIndexOf","localeCompare","match","replace","search","slice","split","substr","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toString","toUpperCase","trim","valueOf"],y=["length"];e.exports=a},function(e,t,n){function r(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&"__"==r.slice(0,2)&&(n[r.slice(2)]=t[r],delete t[r]);o.extend(this,{model:e,filter:t,opts:n}),n.order=n.order||[],o.isArray(n.order)||(n.order=[n.order])}function i(e){if(!e.invalid){var t=e.object;if(o.isArray(t))n=o.pluck(t,e.field);else var n=t[e.field];if(o.isArray(n)||o.isString(n))return n.indexOf(e.value)>-1}return!1}function s(e){var t,n=e.context.cache._localCacheByType,r=e.name,i=e.collectionName,s=n[i];return s&&(t=s[r]||{}),t}var o=(n(5)("filter"),n(1)),a=n(8),l=(n(9),n(15)),c={e:function(e){return e.object[e.field]==e.value},ne:function(e){return e.object[e.field]!=e.value},lt:function(e){return e.invalid?!1:e.object[e.field]<e.value},gt:function(e){return e.invalid?!1:e.object[e.field]>e.value},lte:function(e){return e.invalid?!1:e.object[e.field]<=e.value},gte:function(e){return e.invalid?!1:e.object[e.field]>=e.value},contains:i,"in":i};o.extend(r,{comparators:c,registerComparator:function(e,t){c[e]||(c[e]=t)}}),o.extend(r.prototype,{execute:function(e){return o.promise(e,function(e){this._executeInMemory(e)}.bind(this))},_dump:function(e){return e?"{}":{}},sortFunc:function(e){for(var t=function(e,t){return function(n,r){var i,s=n[t],o=r[t];return"string"==typeof s||s instanceof String&&"string"==typeof o||o instanceof String?i=e?s.localeCompare(o):o.localeCompare(s):(s instanceof Date&&(s=s.getTime()),o instanceof Date&&(o=o.getTime()),i=e?s-o:o-s),i}},n=o,r=0;r<e.length;r++){var i=e[r];n=n.thenBy(t(i.ascending,i.field))}return n==o?null:n},_sortResults:function(e){var t=this.opts.order;if(e&&t){var n=t.map(function(e){var t=e.split("-"),n=!0,r=null;return t.length>1?(r=t[1],n=!1):r=t[0],{field:r,ascending:n}}.bind(this)),r=this.sortFunc(n);e.immutable&&(e=e.mutableCopy()),r&&e.sort(r)}return e},_getCacheByLocalId:function(){return this.model.descendants.reduce(function(e,t){return o.extend(e,s(t))},o.extend({},s(this.model)))},_executeInMemory:function(e){for(var t,n=this._getCacheByLocalId(),r=Object.keys(n),i=this,s=[],o=0;o<r.length;o++){var c=r[o],h=n[c],u=i.objectMatchesFilter(h);if("string"==typeof u){t=a(u);break}u&&s.push(h)}s=this._sortResults(s),e(t,t?null:l(s,this.model))},clearOrdering:function(){this.opts.order=null},objectMatchesOrFilter:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(this.objectMatchesBaseFilter(e,r))return!0}return!1},objectMatchesAndFilter:function(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(!this.objectMatchesBaseFilter(e,r))return!1}return!0},splitMatches:function(e,t,n){var i="e",s=t.split("."),a=s[s.length-1].split("__");if(2==a.length){var l=a[0];i=a[1]}else l=a[0];s[s.length-1]=l,s.slice(0,s.length-1).forEach(function(t){e=o.isArray(e)?o.pluck(e,t):e[t]});var c=void 0!=e;if(c){if(o.isArray(e));else var h=e[l],u=o.isArray(h)?!1:null===h||void 0===h;var d=r.comparators[i],f={object:e,field:l,value:n,invalid:u};return d?d(f):'No comparator registered for filter operation "'+i+'"'}return!1},objectMatches:function(e,t,n,r){if("$or"==t){var i=r.$or;if(o.isArray(i)||(i=Object.keys(i).map(function(e){var t={};return t[e]=i[e],t})),!this.objectMatchesOrFilter(e,i))return!1}else if("$and"==t){if(!this.objectMatchesAndFilter(e,r.$and))return!1}else{var s=this.splitMatches(e,t,n);if("boolean"!=typeof s)return s;if(!s)return!1}return!0},objectMatchesBaseFilter:function(e,t){for(var n=Object.keys(t),r=0;r<n.length;r++){var i=n[r],s=t[i],o=this.objectMatches(e,i,s,t);if("boolean"!=typeof o)return o;if(!o)return!1}return!0},objectMatchesFilter:function(e){return this.objectMatchesBaseFilter(e,this.filter)}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e),this.related=[],this.relatedCancelListeners={},this.isReverse&&(this.related=[])}var i=n(20),s=n(1),o=n(4),a=o.wrapArray,l=n(24).ArrayObserver,c=o.ModelEventType;r.prototype=Object.create(i.prototype),s.extend(r.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e),r=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splice(r,1)})})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.makeChangesToRelatedWithoutObservations(function(){n.splice(0,0,t.object)})})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=n.removed;t.clearReverse(i),t.setReverseOfAdded(r);var s=t.getForwardModel();s.context.broadcast({collection:s.collectionName,model:s.name,localId:t.object.localId,field:t.getForwardName(),removed:i,added:r,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return s.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){return"[object Array]"!=Object.prototype.toString.call(e)?"Cannot assign scalar to many to many":null},set:function(e,t){this.checkInstalled();var n=this;if(e){var r;if(r=this.validate(e))return r;this.clearReverseRelated(t),n.setIdAndRelated(e,t),this.wrapArray(e),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){i.prototype.install.call(this,e),this.wrapArray(this.related),e["splice"+s.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this)},registerRemovalListener:function(e){this.relatedCancelListeners[e.localId]=e.on("*",function(e){}.bind(this))}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e),this.isReverse&&(this.related=[])}var i=n(20),s=n(1),o=n(4),a=o.wrapArray,l=n(24).ArrayObserver,c=o.ModelEventType;r.prototype=Object.create(i.prototype),s.extend(r.prototype,{clearReverse:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(null)})},setReverseOfAdded:function(e){var t=this;e.forEach(function(e){var n=t.reverseProxyForInstance(e);n.setIdAndRelated(t.object)})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=n.removed;t.clearReverse(i),t.setReverseOfAdded(r);var s=t.getForwardModel();s.context.broadcast({collection:s.collectionName,model:s.name,localId:t.object.localId,field:t.getForwardName(),removed:i,added:r,type:c.Splice,index:n.index,obj:t.object})})};e.arrayObserver.open(n)}},get:function(e){return s.promise(e,function(e){e(null,this.related)}.bind(this))},validate:function(e){var t=Object.prototype.toString.call(e);if(this.isForward){if("[object Array]"==t)return"Cannot assign array forward oneToMany ("+t+"): "+this.forwardName}else if("[object Array]"!=t)return"Cannot scalar to reverse oneToMany ("+t+"): "+this.reverseName;return null},set:function(e,t){this.checkInstalled();var n=this;if(e){var r;if(r=this.validate(e))return r;this.clearReverseRelated(t),n.setIdAndRelated(e,t),n.isReverse&&this.wrapArray(n.related),n.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),n.setIdAndRelated(e,t)},install:function(e){i.prototype.install.call(this,e),this.isReverse&&(e["splice"+s.capitaliseFirstLetter(this.reverseName)]=this.splice.bind(this),this.wrapArray(this.related))}}),e.exports=r},function(e,t,n){function r(e){i.call(this,e)}{var i=n(20),s=n(1);n(9)}r.prototype=Object.create(i.prototype),s.extend(r.prototype,{validate:function(e){return"[object Array]"==Object.prototype.toString.call(e)?"Cannot assign array to one to one relationship":null},set:function(e,t){if(this.checkInstalled(),e){var n;if(n=this.validate(e))return n;this.clearReverseRelated(t),this.setIdAndRelated(e,t),this.setIdAndRelatedReverse(e,t)}else this.clearReverseRelated(t),this.setIdAndRelated(e,t)},get:function(e){return s.promise(e,function(e){e(null,this.related)}.bind(this))}}),e.exports=r},function(e,t,n){function r(e){var t=this;e=e||{},s.extend(this,{object:null,related:null}),Object.defineProperties(this,{isForward:{get:function(){return!t.isReverse},set:function(e){t.isReverse=!e},enumerable:!0}}),s.extendFromOpts(this,e,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null,serialise:null},!1),this.cancelListens={}}var i=n(8).InternalSiestaError,s=n(1),o=(n(16),n(5),n(4)),a=o.wrapArray,l=n(24).ArrayObserver,c=o.ModelEventType;s.extend(r,{}),s.extend(r.prototype,{install:function(e){if(!e)throw new i("No object passed to relationship install");if(this.object)throw new i("Already installed.");this.object=e;var t=this,n=this.getForwardName();e.__proxies[n]||(Object.defineProperty(e,n,{get:function(){return t.related},set:function(e){t.set(e)},configurable:!0,enumerable:!0}),e.__proxies[n]=this,e._proxies.push(this))}}),s.extend(r.prototype,{set:function(e,t){throw new i("Must subclass RelationshipProxy")},get:function(e){throw new i("Must subclass RelationshipProxy")}}),s.extend(r.prototype,{proxyForInstance:function(e,t){var n,r=t?this.getReverseName():this.getForwardName(),o=t?this.reverseModel:this.forwardModel;if(s.isArray(e))n=e.map(function(e){return e.__proxies[r]});else{var a=e.__proxies,l=a[r];if(!l){var c='No proxy with name "'+r+'" on mapping '+o.name;throw new i(c)}n=l}return n},reverseProxyForInstance:function(e){return this.proxyForInstance(e,!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},setIdAndRelated:function(e,t){if(t=t||{},!t.disableevents)var n=this._getOldValueForSetChangeEvent();this.related=e?s.isArray(e)?e:e:null,t.disableevents||this.registerSetChange(e,n)},checkInstalled:function(){if(!this.object)throw new i("Proxy must be installed on an object before can use it.")},splicer:function(e){return e=e||{},function(t,n){if(e=e||{},!e.disableevents)var r=this._getAddedForSpliceChangeEvent(arguments),i=this._getRemovedForSpliceChangeEvent(t,n);var s=Array.prototype.slice.call(arguments,2),o=this.related.splice.bind(this.related,t,n).apply(this.related,s);return e.disableevents||this.registerSpliceChange(t,r,i),o}.bind(this)},clearReverseRelated:function(e){e=e||{};var t=this;if(this.related){var n=this.reverseProxyForInstance(this.related),r=s.isArray(n)?n:[n];r.forEach(function(n){if(s.isArray(n.related)){var r=n.related.indexOf(t.object);n.makeChangesToRelatedWithoutObservations(function(){n.splicer(e)(r,1)})}else n.setIdAndRelated(null,e)})}},setIdAndRelatedReverse:function(e,t){var n=this,r=this.reverseProxyForInstance(e),i=s.isArray(r)?r:[r];i.forEach(function(e){s.isArray(e.related)?e.makeChangesToRelatedWithoutObservations(function(){e.splicer(t)(e.related.length,0,n.object)}):(e.clearReverseRelated(t),e.setIdAndRelated(n.object,t))})},makeChangesToRelatedWithoutObservations:function(e){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,e(),this.wrapArray(this.related)):e()},_getOldValueForSetChangeEvent:function(){var e=this.related;return s.isArray(e)&&!e.length&&(e=null),e},registerSetChange:function(e,t){var n=this.object;if(!n)throw new i("Proxy must have an object associated");var r=n.model,s=r.name,o=n.collectionName;r.context.broadcast({collection:o,model:s,localId:n.localId,field:this.getForwardName(),old:t,"new":e,type:c.Set,obj:n})},_getRemovedForSpliceChangeEvent:function(e,t){return this.related?this.related.slice(e,e+t):null},_getAddedForSpliceChangeEvent:function(e){var t=Array.prototype.slice.call(e,2);return t.length?t:[]},registerSpliceChange:function(e,t,n){var r=this.object.model,i=r.name,s=this.object.collectionName;r.context.broadcast({collection:s,model:i,localId:this.object.localId,field:this.getForwardName(),index:e,removed:n,added:t,type:c.Splice,obj:this.object})},wrapArray:function(e){var t=this;if(a(e,this.reverseName,this.object),!e.arrayObserver){e.arrayObserver=new l(e);var n=function(n){n.forEach(function(n){var r=n.addedCount?e.slice(n.index,n.index+n.addedCount):[],i=t.getForwardModel();i.context.broadcast({collection:i.collectionName,model:i.name,localId:t.object.localId,field:t.getForwardName(),removed:n.removed,added:r,type:c.Splice,obj:t.object})})};e.arrayObserver.open(n)}},splice:function(){this.splicer({}).apply(this,arguments)}}),e.exports=r},function(e,t,n){e.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},function(e,t,n){function r(e,t){if(!window.PouchDB)throw new Error('Cannot enable storage for app "'+n+'" as PouchDB is not present.');t=t||{};var n=e.name;this.context=e,this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},Object.defineProperties(this,{_unsavedObjects:{get:function(){return this.unsavedObjects}},_unsavedObjectsHash:{get:function(){return this.unsavedObjectsHash}},_unsavedObjectsByCollection:{get:function(){return this.unsavedObjectsByCollection}},_pouch:{get:function(){return this.pouch}}}),this.pouch=t.pouch||new PouchDB(n,{auto_compaction:!0})}var i=n(1),s=(n(8),n(5)("storage")),o=/_/g,a=/@/g;r.prototype={save:function(e){return i.promise(e,function(e){this.context._ensureInstalled(function(t){if(t)e(t);else{var n=this.unsavedObjects;this.unsavedObjects=[],this.unsavedObjectsHash={},this.unsavedObjectsByCollection={},this.saveToPouch(n,e)}}.bind(this))}.bind(this))},saveToPouch:function(e,t){var n=[],r=e.map(this._serialise.bind(this));this.pouch.bulkDocs(r).then(function(r){for(var i=0;i<r.length;i++){var o=r[i],a=e[i];o.ok?a._rev=o.rev:409==o.status?n.push(a):s('Error saving object with localId="'+a.localId+'"',o)}n.length?this.saveConflicts(n,t):t()},function(e){t(e)})},saveConflicts:function(e,t){this.pouch.allDocs({keys:i.pluck(e,"localId")}).then(function(n){for(var r=0;r<n.rows.length;r++)e[r]._rev=n.rows[r].value.rev;this.saveToPouch(e,t)})["catch"](function(e){t(e)})},ensureIndexInstalled:function(e,t){function n(n){var r;n.ok||409==n.status&&(r=null,e.indexInstalled=!0),t(r)}this.pouch.put(this.constructIndexDesignDoc(e.collectionName,e.name)).then(n)["catch"](n)},loadModel:function(e,t){var n={},r=e.collectionName,s=e.modelName,o=e.model;o&&(r=o.collectionName,s=o.name);var a=this.fullyQualifiedModelName(r,s),l=this.context.collections[r][s];return l?void this.pouch.query(a).then(function(e){var r=e.rows,s=i.pluck(r,"value").map(function(e){return this._prepareDatum(e,l)}.bind(this));s.map(function(e){var t=e[l.id];t&&(n[t]?console.error("Duplicates detected in storage. You have encountered a serious bug. Please report this."):n[t]=e)}),l._graph(s,{_ignoreInstalled:!0,disableevents:!0,fromStorage:!0},function(e,n){e?console.error("Error loading models",e):(console.log("binding listener"),this._listener=this.listener.bind(this),o.on("*",this._listener)),t(e,n)}.bind(this))}.bind(this))["catch"](function(e){t(e)}):void t('No such model with name "'+s+'" in context.')},_prepareDatum:function(e,t){this._processMeta(e),delete e.collection,delete e.model,e.localId=e._id,delete e._id;var n={};Object.keys(e).forEach(function(t){n[t.replace(a,"_")]=e[t]});var r=t._relationshipNames;return r.forEach(function(e){var t=n[e];t&&(n[e]=siesta.isArray(t)?t.map(function(e){return{localId:e}}):{localId:t})}),n},_processMeta:function(e){var t=e.siesta_meta||this._initMeta();t.dateFields.forEach(function(t){var n=e[t];n instanceof Date||(e[t]=new Date(n))}),delete e.siesta_meta},_initMeta:function(){return{dateFields:[]}},_addMeta:function(e){e.siesta_meta=this._initMeta();for(var t in e)e.hasOwnProperty(t)&&e[t]instanceof Date&&(e.siesta_meta.dateFields.push(t),e[t]=e[t].getTime())},listener:function(e){var t=e.obj,n=t.localId;if(!t)throw new Error("No obj field in notification received by storage extension");if(!(n in this.unsavedObjectsHash)){this.unsavedObjectsHash[n]=t,this.unsavedObjects.push(t);var r=t.collectionName;this.unsavedObjectsByCollection[r]||(this.unsavedObjectsByCollection[r]={});var i=t.model.name;this.unsavedObjectsByCollection[r][i]||(this.unsavedObjectsByCollection[r][i]={}),this.unsavedObjectsByCollection[r][i][n]=t}},_reset:function(e,t){this._listener&&this.context.removeListener("Siesta",this._listener),this.unsavedObjects=[],this.unsavedObjectsHash={};var n=this.pouch;n.allDocs().then(function(n){var r=n.rows.map(function(e){return{_id:e.id,_rev:e.value.rev,_deleted:!0}});this.pouch.bulkDocs(r).then(function(){t&&(this.pouch=t),e()}.bind(this))["catch"](e)}.bind(this))["catch"](e)},_serialise:function(e){var t={},n=e.__values;t=i.extend(t,n),Object.keys(t).forEach(function(e){t[e.replace(o,"@")]=n[e]}),this._addMeta(t),t.collection=e.collectionName,t.model=e.modelName,t._id=e.localId,e.removed&&(t._deleted=!0);var r=e._rev;return r&&(t._rev=r),t=e._relationshipNames.reduce(function(t,n){var r=e[n];return siesta.isArray(r)?t[n]=i.pluck(r,"localId"):r&&(t[n]=r.localId),t},t)},constructIndexDesignDoc:function(e,t){var n=this.fullyQualifiedModelName(e,t),r={};return r[n]={map:function(e){"$1"==e.collection&&"$2"==e.model&&emit(e.collection+"."+e.model,e)}.toString().replace("$1",e).replace("$2",t)},{_id:"_design/"+n,views:r}},fullyQualifiedModelName:function(e,t){return e+"."+t}},e.exports=r},function(e,t,n){var r,i=Object.prototype.hasOwnProperty,s=Object.prototype.toString,o=function(e){"use strict";if(!e||"[object Object]"!==s.call(e)||e.nodeType||e.setInterval)return!1;var t=i.call(e,"constructor"),n=e.constructor&&e.constructor.prototype&&i.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!n)return!1;var o;for(o in e);return o===r||i.call(e,o)};e.exports=function a(){"use strict";var e,t,n,i,s,l,c=arguments[0],h=1,u=arguments.length,d=!1;for("boolean"==typeof c?(d=c,c=arguments[1]||{},h=2):("object"!=typeof c&&"function"!=typeof c||c==r)&&(c={});u>h;++h)if(null!=(e=arguments[h]))for(t in e)n=c[t],i=e[t],c!==i&&(d&&i&&(o(i)||(s=Array.isArray(i)))?(s?(s=!1,l=n&&Array.isArray(n)?n:[]):l=n&&o(n)?n:{},c[t]=a(d,l,i)):i!==r&&(c[t]=i));return c}},function(module,exports,__webpack_require__){(function(global,module){!function(global){"use strict";function detectObjectObserve(){function e(e){t=e}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var t=[],n={},r=[];return Object.observe(n,e),Array.observe(r,e),n.id=1,n.id=2,delete n.id,r.push(1,2),r.length=0,Object.deliverChangeRecords(e),5!==t.length?!1:"add"!=t[0].type||"update"!=t[1].type||"delete"!=t[2].type||"splice"!=t[3].type||"splice"!=t[4].type?!1:(Object.unobserve(n,e),Array.unobserve(r,e),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if(navigator.getDeviceStorage)return!1;try{var e=new Function("","return true;");return e()}catch(t){return!1}}function isIndex(e){return+e===e>>>0&&""!==e}function toNumber(e){return+e}function isObject(e){return e===Object(e)}function areSameValue(e,t){return e===t?0!==e||1/e===1/t:numberIsNaN(e)&&numberIsNaN(t)?!0:e!==e&&t!==t}function getPathCharType(e){if(void 0===e)return"eof";var t=e.charCodeAt(0);switch(t){case 91:case 93:case 46:case 34:case 39:case 48:return e;case 95:case 36:return"ident";case 32:case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return t>=97&&122>=t||t>=65&&90>=t?"ident":t>=49&&57>=t?"number":"else"}function noop(){}function parsePath(e){function t(){if(!(h>=e.length)){var t=e[h+1];return"inSingleQuote"==u&&"'"==t||"inDoubleQuote"==u&&'"'==t?(h++,r=t,d.append(),!0):void 0}}for(var n,r,i,s,o,a,l,c=[],h=-1,u="beforePath",d={push:function(){void 0!==i&&(c.push(i),i=void 0)},append:function(){void 0===i?i=r:i+=r}};u;)if(h++,n=e[h],"\\"!=n||!t(u)){if(s=getPathCharType(n),l=pathStateMachine[u],o=l[s]||l["else"]||"error","error"==o)return;if(u=o[0],a=d[o[1]]||noop,r=void 0===o[2]?n:o[2],a(),"afterPath"===u)return c}}function isIdent(e){return identRegExp.test(e)}function Path(e,t){if(t!==constructorIsPrivate)throw Error("Use Path.get to retrieve path objects");for(var n=0;n<e.length;n++)this.push(String(e[n]));hasEval&&this.length&&(this.getValueFrom=this.compiledGetValueFromFn())}function getPath(e){if(e instanceof Path)return e;if((null==e||0==e.length)&&(e=""),"string"!=typeof e){if(isIndex(e.length))return new Path(e,constructorIsPrivate);e=String(e)}var t=pathCache[e];if(t)return t;var n=parsePath(e);if(!n)return invalidPath;var t=new Path(n,constructorIsPrivate);return pathCache[e]=t,t}function formatAccessor(e){return isIndex(e)?"["+e+"]":'["'+e.replace(/"/g,'\\"')+'"]'}function dirtyCheck(e){for(var t=0;MAX_DIRTY_CHECK_CYCLES>t&&e.check_();)t++;return testingExposeCycleCount&&(global.dirtyCheckCycleCount=t),t>0}function objectIsEmpty(e){for(var t in e)return!1;return!0}function diffIsEmpty(e){return objectIsEmpty(e.added)&&objectIsEmpty(e.removed)&&objectIsEmpty(e.changed)}function diffObjectFromOldObject(e,t){var n={},r={},i={};for(var s in t){var o=e[s];(void 0===o||o!==t[s])&&(s in e?o!==t[s]&&(i[s]=o):r[s]=void 0)}for(var s in e)s in t||(n[s]=e[s]);return Array.isArray(e)&&e.length!==t.length&&(i.length=e.length),{added:n,removed:r,changed:i}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var e=0;e<eomTasks.length;e++)eomTasks[e]();return eomTasks.length=0,!0}function newObservedObject(){function e(e){t&&t.state_===OPENED&&!r&&t.check_(e)}var t,n,r=!1,i=!0;return{open:function(n){if(t)throw Error("ObservedObject in use");i||Object.deliverChangeRecords(e),t=n,i=!1},observe:function(t,r){n=t,r?Array.observe(n,e):Object.observe(n,e)},deliver:function(t){r=t,Object.deliverChangeRecords(e),r=!1},close:function(){t=void 0,Object.unobserve(n,e),observedObjectCache.push(this)}}}function getObservedObject(e,t,n){var r=observedObjectCache.pop()||newObservedObject();return r.open(e),r.observe(t,n),r}function newObservedSet(){function e(t,s){t&&(t===r&&(i[s]=!0),a.indexOf(t)<0&&(a.push(t),Object.observe(t,n)),e(Object.getPrototypeOf(t),s))}function t(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.object!==r||i[n.name]||"setPrototype"===n.type)return!1}return!0}function n(n){if(!t(n)){for(var r,i=0;i<o.length;i++)r=o[i],r.state_==OPENED&&r.iterateObjects_(e);for(var i=0;i<o.length;i++)r=o[i],r.state_==OPENED&&r.check_()}}var r,i,s=0,o=[],a=[],l={object:void 0,objects:a,open:function(t,n){r||(r=n,i={}),o.push(t),s++,t.iterateObjects_(e)},close:function(e){if(s--,!(s>0)){for(var t=0;t<a.length;t++)Object.unobserve(a[t],n),Observer.unobservedCount++;o.length=0,a.length=0,r=void 0,i=void 0,observedSetCache.push(this)}}};return l}function getObservedSet(e,t){return lastObservedSet&&lastObservedSet.object===t||(lastObservedSet=observedSetCache.pop()||newObservedSet(),lastObservedSet.object=t),lastObservedSet.open(e,t),lastObservedSet}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(e){Observer._allObserversCount++,collectObservers&&allObservers.push(e)}function removeFromAll(e){Observer._allObserversCount--}function ObjectObserver(e){Observer.call(this),this.value_=e,this.oldObject_=void 0}function ArrayObserver(e){if(!Array.isArray(e))throw Error("Provided object is not an Array");ObjectObserver.call(this,e)}function PathObserver(e,t){Observer.call(this),this.object_=e,this.path_=getPath(t),this.directObserver_=void 0}function CompoundObserver(e){Observer.call(this),this.reportChangesOnOpen_=e,this.value_=[],this.directObserver_=void 0,this.observed_=[]}function identFn(e){return e}function ObserverTransform(e,t,n,r){this.callback_=void 0,this.target_=void 0,this.value_=void 0,this.observable_=e,this.getValueFn_=t||identFn,this.setValueFn_=n||identFn,this.dontPassThroughSet_=r}function diffObjectFromChangeRecords(e,t,n){for(var r={},i={},s=0;s<t.length;s++){var o=t[s];expectedRecordTypes[o.type]?(o.name in n||(n[o.name]=o.oldValue),"update"!=o.type&&("add"!=o.type?o.name in r?(delete r[o.name],delete n[o.name]):i[o.name]=!0:o.name in i?delete i[o.name]:r[o.name]=!0)):(console.error("Unknown changeRecord type: "+o.type),
console.error(o))}for(var a in r)r[a]=e[a];for(var a in i)i[a]=void 0;var l={};for(var a in n)if(!(a in r||a in i)){var c=e[a];n[a]!==c&&(l[a]=c)}return{added:r,removed:i,changed:l}}function newSplice(e,t,n){return{index:e,removed:t,addedCount:n}}function ArraySplice(){}function calcSplices(e,t,n,r,i,s){return arraySplice.calcSplices(e,t,n,r,i,s)}function intersect(e,t,n,r){return n>t||e>r?-1:t==n||r==e?0:n>e?r>t?t-n:r-n:t>r?r-e:t-e}function mergeSplice(e,t,n,r){for(var i=newSplice(t,n,r),s=!1,o=0,a=0;a<e.length;a++){var l=e[a];if(l.index+=o,!s){var c=intersect(i.index,i.index+i.removed.length,l.index,l.index+l.addedCount);if(c>=0){e.splice(a,1),a--,o-=l.addedCount-l.removed.length,i.addedCount+=l.addedCount-c;var h=i.removed.length+l.removed.length-c;if(i.addedCount||h){var n=l.removed;if(i.index<l.index){var u=i.removed.slice(0,l.index-i.index);Array.prototype.push.apply(u,n),n=u}if(i.index+i.removed.length>l.index+l.addedCount){var d=i.removed.slice(l.index+l.addedCount-i.index);Array.prototype.push.apply(n,d)}i.removed=n,l.index<i.index&&(i.index=l.index)}else s=!0}else if(i.index<l.index){s=!0,e.splice(a,0,i),a++;var f=i.addedCount-i.removed.length;l.index+=f,o+=f}}}s||e.push(i)}function createInitialSplices(e,t){for(var n=[],r=0;r<t.length;r++){var i=t[r];switch(i.type){case"splice":mergeSplice(n,i.index,i.removed.slice(),i.addedCount);break;case"add":case"update":case"delete":if(!isIndex(i.name))continue;var s=toNumber(i.name);if(0>s)continue;mergeSplice(n,s,[i.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(i))}}return n}function projectArraySplices(e,t){var n=[];return createInitialSplices(e,t).forEach(function(t){return 1==t.addedCount&&1==t.removed.length?void(t.removed[0]!==e[t.index]&&n.push(t)):void(n=n.concat(calcSplices(e,t.index,t.index+t.addedCount,t.removed,0,t.removed.length)))}),n}var testingExposeCycleCount=global.testingExposeCycleCount,hasObserve=detectObjectObserve(),hasEval=detectEval(),numberIsNaN=global.Number.isNaN||function(e){return"number"==typeof e&&global.isNaN(e)},createObject="__proto__"in{}?function(e){return e}:function(e){var t=e.__proto__;if(!t)return e;var n=Object.create(t);return Object.getOwnPropertyNames(e).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}),n},identStart="[$_a-zA-Z]",identPart="[$_a-zA-Z0-9]",identRegExp=new RegExp("^"+identStart+"+"+identPart+"*$"),pathStateMachine={beforePath:{ws:["beforePath"],ident:["inIdent","append"],"[":["beforeElement"],eof:["afterPath"]},inPath:{ws:["inPath"],".":["beforeIdent"],"[":["beforeElement"],eof:["afterPath"]},beforeIdent:{ws:["beforeIdent"],ident:["inIdent","append"]},inIdent:{ident:["inIdent","append"],0:["inIdent","append"],number:["inIdent","append"],ws:["inPath","push"],".":["beforeIdent","push"],"[":["beforeElement","push"],eof:["afterPath","push"]},beforeElement:{ws:["beforeElement"],0:["afterZero","append"],number:["inIndex","append"],"'":["inSingleQuote","append",""],'"':["inDoubleQuote","append",""]},afterZero:{ws:["afterElement","push"],"]":["inPath","push"]},inIndex:{0:["inIndex","append"],number:["inIndex","append"],ws:["afterElement"],"]":["inPath","push"]},inSingleQuote:{"'":["afterElement"],eof:["error"],"else":["inSingleQuote","append"]},inDoubleQuote:{'"':["afterElement"],eof:["error"],"else":["inDoubleQuote","append"]},afterElement:{ws:["afterElement"],"]":["inPath","push"]}},constructorIsPrivate={},pathCache={};Path.get=getPath,Path.prototype=createObject({__proto__:[],valid:!0,toString:function(){for(var e="",t=0;t<this.length;t++){var n=this[t];e+=isIdent(n)?t?"."+n:n:formatAccessor(n)}return e},getValueFrom:function(e,t){for(var n=0;n<this.length;n++){if(null==e)return;e=e[this[n]]}return e},iterateObjects:function(e,t){for(var n=0;n<this.length;n++){if(n&&(e=e[this[n-1]]),!isObject(e))return;t(e,this[0])}},compiledGetValueFromFn:function(){var e="",t="obj";e+="if (obj != null";for(var n,r=0;r<this.length-1;r++)n=this[r],t+=isIdent(n)?"."+n:formatAccessor(n),e+=" &&\n     "+t+" != null";e+=")\n";var n=this[r];return t+=isIdent(n)?"."+n:formatAccessor(n),e+="  return "+t+";\nelse\n  return undefined;",new Function("obj",e)},setValueFrom:function(e,t){if(!this.length)return!1;for(var n=0;n<this.length-1;n++){if(!isObject(e))return!1;e=e[this[n]]}return isObject(e)?(e[this[n]]=t,!0):!1}});var invalidPath=new Path("",constructorIsPrivate);invalidPath.valid=!1,invalidPath.getValueFrom=invalidPath.setValueFrom=function(){};var MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var e={pingPong:!0},t=!1;return Object.observe(e,function(){runEOMTasks(),t=!1}),function(n){eomTasks.push(n),t||(t=!0,e.pingPong=!e.pingPong)}}():function(){return function(e){eomTasks.push(e)}}(),observedObjectCache=[],observedSetCache=[],lastObservedSet,UNOPENED=0,OPENED=1,CLOSED=2,RESETTING=3,nextObserverId=1;Observer.prototype={open:function(e,t){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=e,this.target_=t,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)},report_:function(e){try{this.callback_.apply(this.target_,e)}catch(t){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(t.stack||t))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(e,t){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(e){var t=Array.isArray(e)?[]:{};for(var n in e)t[n]=e[n];return Array.isArray(e)&&(t.length=e.length),t},check_:function(e,t){var n,r;if(hasObserve){if(!e)return!1;r={},n=diffObjectFromChangeRecords(this.value_,e,r)}else r=this.oldObject_,n=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(n)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([n.added||{},n.removed||{},n.changed||{},function(e){return r[e]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:!0,copyObject:function(e){return e.slice()},check_:function(e){var t;if(hasObserve){if(!e)return!1;t=projectArraySplices(this.value_,e)}else t=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return t&&t.length?(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t]),!0):!1}}),ArrayObserver.applySplices=function(e,t,n){n.forEach(function(n){for(var r=[n.index,n.removed.length],i=n.index;i<n.index+n.addedCount;)r.push(t[i]),i++;Array.prototype.splice.apply(e,r)})},PathObserver.prototype=createObject({__proto__:Observer.prototype,get path(){return this.path_},connect_:function(){hasObserve&&(this.directObserver_=getObservedSet(this,this.object_)),this.check_(void 0,!0)},disconnect_:function(){this.value_=void 0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},iterateObjects_:function(e){this.path_.iterateObjects(this.object_,e)},check_:function(e,t){var n=this.value_;return this.value_=this.path_.getValueFrom(this.object_),t||areSameValue(this.value_,n)?!1:(this.report_([this.value_,n,this]),!0)},setValue:function(e){this.path_&&this.path_.setValueFrom(this.object_,e)}});var observerSentinel={};CompoundObserver.prototype=createObject({__proto__:Observer.prototype,connect_:function(){if(hasObserve){for(var e,t=!1,n=0;n<this.observed_.length;n+=2)if(e=this.observed_[n],e!==observerSentinel){t=!0;break}t&&(this.directObserver_=getObservedSet(this,e))}this.check_(void 0,!this.reportChangesOnOpen_)},disconnect_:function(){for(var e=0;e<this.observed_.length;e+=2)this.observed_[e]===observerSentinel&&this.observed_[e+1].close();this.observed_.length=0,this.value_.length=0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},addPath:function(e,t){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add paths once started.");var t=getPath(t);if(this.observed_.push(e,t),this.reportChangesOnOpen_){var n=this.observed_.length/2-1;this.value_[n]=t.getValueFrom(e)}},addObserver:function(e){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add observers once started.");if(this.observed_.push(observerSentinel,e),this.reportChangesOnOpen_){var t=this.observed_.length/2-1;this.value_[t]=e.open(this.deliver,this)}},startReset:function(){if(this.state_!=OPENED)throw Error("Can only reset while open");this.state_=RESETTING,this.disconnect_()},finishReset:function(){if(this.state_!=RESETTING)throw Error("Can only finishReset after startReset");return this.state_=OPENED,this.connect_(),this.value_},iterateObjects_:function(e){for(var t,n=0;n<this.observed_.length;n+=2)t=this.observed_[n],t!==observerSentinel&&this.observed_[n+1].iterateObjects(t,e)},check_:function(e,t){for(var n,r=0;r<this.observed_.length;r+=2){var i,s=this.observed_[r],o=this.observed_[r+1];if(s===observerSentinel){var a=o;i=this.state_===UNOPENED?a.open(this.deliver,this):a.discardChanges()}else i=o.getValueFrom(s);t?this.value_[r/2]=i:areSameValue(i,this.value_[r/2])||(n=n||[],n[r/2]=this.value_[r/2],this.value_[r/2]=i)}return n?(this.report_([this.value_,n,this.observed_]),!0):!1}}),ObserverTransform.prototype={open:function(e,t){return this.callback_=e,this.target_=t,this.value_=this.getValueFn_(this.observable_.open(this.observedCallback_,this)),this.value_},observedCallback_:function(e){if(e=this.getValueFn_(e),!areSameValue(e,this.value_)){var t=this.value_;this.value_=e,this.callback_.call(this.target_,this.value_,t)}},discardChanges:function(){return this.value_=this.getValueFn_(this.observable_.discardChanges()),this.value_},deliver:function(){return this.observable_.deliver()},setValue:function(e){return e=this.setValueFn_(e),!this.dontPassThroughSet_&&this.observable_.setValue?this.observable_.setValue(e):void 0},close:function(){this.observable_&&this.observable_.close(),this.callback_=void 0,this.target_=void 0,this.observable_=void 0,this.value_=void 0,this.getValueFn_=void 0,this.setValueFn_=void 0}};var expectedRecordTypes={add:!0,update:!0,"delete":!0},EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;ArraySplice.prototype={calcEditDistances:function(e,t,n,r,i,s){for(var o=s-i+1,a=n-t+1,l=new Array(o),c=0;o>c;c++)l[c]=new Array(a),l[c][0]=c;for(var h=0;a>h;h++)l[0][h]=h;for(var c=1;o>c;c++)for(var h=1;a>h;h++)if(this.equals(e[t+h-1],r[i+c-1]))l[c][h]=l[c-1][h-1];else{var u=l[c-1][h]+1,d=l[c][h-1]+1;l[c][h]=d>u?u:d}return l},spliceOperationsFromEditDistances:function(e){for(var t=e.length-1,n=e[0].length-1,r=e[t][n],i=[];t>0||n>0;)if(0!=t)if(0!=n){var s,o=e[t-1][n-1],a=e[t-1][n],l=e[t][n-1];s=l>a?o>a?a:o:o>l?l:o,s==o?(o==r?i.push(EDIT_LEAVE):(i.push(EDIT_UPDATE),r=o),t--,n--):s==a?(i.push(EDIT_DELETE),t--,r=a):(i.push(EDIT_ADD),n--,r=l)}else i.push(EDIT_DELETE),t--;else i.push(EDIT_ADD),n--;return i.reverse(),i},calcSplices:function(e,t,n,r,i,s){var o=0,a=0,l=Math.min(n-t,s-i);if(0==t&&0==i&&(o=this.sharedPrefix(e,r,l)),n==e.length&&s==r.length&&(a=this.sharedSuffix(e,r,l-o)),t+=o,i+=o,n-=a,s-=a,n-t==0&&s-i==0)return[];if(t==n){for(var c=newSplice(t,[],0);s>i;)c.removed.push(r[i++]);return[c]}if(i==s)return[newSplice(t,[],n-t)];for(var h=this.spliceOperationsFromEditDistances(this.calcEditDistances(e,t,n,r,i,s)),c=void 0,u=[],d=t,f=i,v=0;v<h.length;v++)switch(h[v]){case EDIT_LEAVE:c&&(u.push(c),c=void 0),d++,f++;break;case EDIT_UPDATE:c||(c=newSplice(d,[],0)),c.addedCount++,d++,c.removed.push(r[f]),f++;break;case EDIT_ADD:c||(c=newSplice(d,[],0)),c.addedCount++,d++;break;case EDIT_DELETE:c||(c=newSplice(d,[],0)),c.removed.push(r[f]),f++}return c&&u.push(c),u},sharedPrefix:function(e,t,n){for(var r=0;n>r;r++)if(!this.equals(e[r],t[r]))return r;return n},sharedSuffix:function(e,t,n){for(var r=e.length,i=t.length,s=0;n>s&&this.equals(e[--r],t[--i]);)s++;return s},calculateSplices:function(e,t){return this.calcSplices(e,0,e.length,t,0,t.length)},equals:function(e,t){return e===t}};var arraySplice=new ArraySplice,expose=global;"undefined"!=typeof module&&module.exports&&(expose=exports=module.exports),expose=exports,expose.Observer=Observer,expose.Observer.runEOM_=runEOM,expose.Observer.observerSentinel_=observerSentinel,expose.Observer.hasObjectObserve=hasObserve,expose.ArrayObserver=ArrayObserver,expose.ArrayObserver.calculateSplices=function(e,t){return arraySplice.calculateSplices(e,t)},expose.Platform=global.Platform,expose.ArraySplice=ArraySplice,expose.ObjectObserver=ObjectObserver,expose.PathObserver=PathObserver,expose.CompoundObserver=CompoundObserver,expose.Path=Path,expose.ObserverTransform=ObserverTransform}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window)}).call(exports,function(){return this}(),__webpack_require__(36)(module))},function(e,t,n){function r(e){this.okCallbacks=[],this.errorCallbacks=[],this.resolved=null,this.rejected=null,this.isResolved=!1,this.isRejected=!1;var t=function(e){if(!this.resolved&&!this.rejected){this.resolved=e,this.isResolved=!0;for(var t=0;t<this.okCallbacks.length;t++){var n=this.okCallbacks[t];n(e)}}}.bind(this),n=function(e){if(!this.resolved&&!this.rejected){this.rejected=e,this.isRejected=!0;for(var t=0;t<this.errorCallbacks.length;t++){var n=this.errorCallbacks[t];n(e)}}}.bind(this);e&&e(t,n)}r.all=function(e){return new r(function(t,n){function r(){s+o==i&&(o?n(l):t(a))}var i=e.length;if(i){var s=0,o=0,a=[],l=[];e.forEach(function(e,t){e.then(function(e){a[t]=e,s++,r()},function(e){l[t]=e,o++,r()})})}else t([])})},r.prototype={then:function(e,t){return this.isResolved?e&&e(this.resolved):this.isRejected?t&&t(this.rejected):(e&&this.okCallbacks.push(e),t&&this.errorCallbacks.push(t)),this},"catch":function(e){return this.isRejected?e&&e(this.rejected):e&&this.errorCallbacks.push(e),this}},e.exports=r},function(e,t,n){function r(e){this.opts=e}var i=n(34);r.prototype={_handlerLink:function(e){var t;return t=function(){var n=e.type;e.fn&&this._removeListener(e.fn,n),t._parentLink&&t._parentLink()}.bind(this),Object.keys(this.opts).forEach(function(e){var n=this.opts[e];t[e]=i(function(e){var r=n.apply(n.__siesta_bound_object,e);return r._parentLink=t,r}.bind(this))}.bind(this)),t._parentLink=null,t},_link:function(e,t){var n=this;t=t||function(){};var r;return r=function(){t(),r._parentLink&&r._parentLink()}.bind(this),r.__siesta_isLink=!0,r.opts=e,r.clean=t,Object.keys(e).forEach(function(t){var s=e[t];r[t]=i(function(e){var t=s.apply(s.__siesta_bound_object,e);if(t&&t.__siesta_isLink)var i=t;else{i=n._link(r.opts);for(var o in t)t[o]instanceof Function&&(i[o]=t[o])}i._parentLink=r;for(o in r)r[o]instanceof Function&&(i[o]=r[o].bind(r));return i}.bind(this))}.bind(this)),r._parentLink=null,r}},e.exports=r},function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function i(){var e=arguments,n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var i=0,s=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(s=i))}),e.splice(s,0,r),e}function s(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function o(e){try{null==e?c.removeItem("debug"):c.debug=e}catch(t){}}function a(){var e;try{e=c.debug}catch(t){}return e}function l(){try{return window.localStorage}catch(e){}}t=e.exports=n(35),t.log=s,t.formatArgs=i,t.save=o,t.load=a,t.useColors=r;var c;c="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:l(),t.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],t.formatters.j=function(e){return JSON.stringify(e)},t.enable(a())},function(e,t,n){function r(){this.reset(),Object.defineProperty(this,"_localCacheByType",{get:function(){return this.local}})}var i=n(5)("cache"),s=n(8).InternalSiestaError,o=n(1);r.prototype={reset:function(){this.remote={},this.localById={},this.local={}},getViaLocalId:function(e){return o.isArray(e)?e.map(function(e){return this.localById[e]}.bind(this)):this.localById[e]},getViaRemoteId:function(e,t){var n=(this.remote[t.model.collectionName]||{})[t.model.name]||{};return o.isArray(e)?e.map(function(e){return n[e]}):n[e]},getSingleton:function(e){var t=e.name,n=e.collectionName,r=this.local[n];if(r){var i=r[t];if(i){var o=[];for(var a in i)i.hasOwnProperty(a)&&o.push(i[a]);if(o.length>1){var l="A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.";throw new s(l)}if(o.length)return o[0]}}return null},remoteInsert:function(e,t,n){if(!e){var r="Must pass an object when inserting to cache";throw i(r),new s(r)}var o=e.model.collectionName;if(!o)throw new s("Model has no collection",{model:e.model,obj:e});this.remote[o]||(this.remote[o]={});var a=e.model.name;if(!a)throw new s("Model has no type",{model:e.model,obj:e});this.remote[o][a]||(this.remote[o][a]={}),n&&(this.remote[o][a][n]=null);var l=this.remote[o][a][t];if(l){if(e!=l){var c="Object "+o.toString()+":"+a.toString()+"["+e.model.id+'="'+t+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild';throw i(c,{obj:e,cachedObject:l}),new s(c)}}else this.remote[o][a][t]=e,i("Remote cache insert: "+e._dump(!0))},get:function(e){i("get",e);var t,n,r,s=e.localId;if(s)return t=this.getViaLocalId(s),t?t:e.model?(n=e.model.id,r=e[n],i(n+"="+r),this.getViaRemoteId(r,e)):null;if(e.model){if(n=e.model.id,r=e[n])return this.getViaRemoteId(r,e);if(e.model.singleton)return this.getSingleton(e.model)}else i("Invalid opts to cache",{opts:e});return null},_remoteCache:function(){return this.remote},_localCache:function(){return this.localById},insert:function(e){var t=e.localId;if(t){var n=e.model.collectionName,r=e.model.name;if(this.localById[t]){if(this.localById[t]!=e){var o='Object with localId="'+t.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild';throw i(o),new s(o)}}else this.localById[t]=e,this.local[n]||(this.local[n]={}),this.local[n][r]||(this.local[n][r]={}),this.local[n][r][t]=e}var a=e.idField,l=e[a];l?this.remoteInsert(e,l):i('No remote id ("'+a+'") so wont be placing in the remote cache',e)},contains:function(e){var t={localId:e.localId},n=e.model;return n.id&&e[n.id]&&(t.model=n,t[n.id]=e[n.id]),!!this.get(t)},remove:function(e){if(this.contains(e)){var t=e.model.collectionName,n=e.model.name,r=e.localId;if(!n)throw s("No mapping name");if(!t)throw s("No collection name");if(!r)throw s("No localId");if(delete this.local[t][n][r],delete this.localById[r],e.model.id){var i=e[e.model.id];i&&delete this.remote[t][n][i]}}},count:function(){return Object.keys(this.localById).length}},e.exports=r},function(e,t,n){function r(e){i.extend(this,e||{}),this.isPlaceholder=!0}var i=n(1);e.exports=r},function(e,t,n){function r(e){this.model=e}var i=n(5)("model"),s=n(8).InternalSiestaError,o=n(21),a=(n(16),n(9)),l=n(1),c=l.guid,h=(n(23),n(4)),u=h.wrapArray,d=n(18),f=n(19),v=n(17),p=(n(2),h.ModelEventType);r.prototype={_getLocalId:function(e){var t;return t=e&&e.localId?e.localId:c()},_installAttributes:function(e,t){var n=this.model,r=n._attributeNames,i=r.indexOf(n.id);l.extend(e,{__values:l.extend(n.attributes.reduce(function(e,t){return void 0!==t["default"]&&(e[t.name]=t["default"]),e},{}),t||{})}),i>-1&&r.splice(i,1),r.forEach(function(t){var r=n._attributeDefinitionWithName(t);Object.defineProperty(e,t,{get:function(){var n=e.__values[t];return void 0===n?null:n},set:function(i){r.parse&&(i=r.parse.call(e,i)),n.parseAttribute&&(i=n.parseAttribute.call(e,t,i));var s=e.__values[t],o=this._propertyDependencies[t]||[];o=o.map(function(t){try{var n=this[t]}catch(r){throw console.error('Uncaught error during property access for model "'+e.model.name+'"',r),r}return{prop:t,old:n}}.bind(this)),e.__values[t]=i,o.forEach(function(t){var r=t.prop,i=this[r];n.context.broadcast({collection:n.collectionName,model:n.name,localId:e.localId,"new":i,old:t.old,type:p.Set,field:r,obj:e})}.bind(this));var a={collection:n.collectionName,model:n.name,localId:e.localId,"new":i,old:s,type:p.Set,field:t,obj:e};window.lastEmission=a,n.context.broadcast(a),l.isArray(i)&&u(i,t,e)},enumerable:!0,configurable:!0})})},_installMethods:function(e){var t=this.model;Object.keys(t.methods).forEach(function(n){void 0===e[n]?e[n]=t.methods[n].bind(e):i('A method with name "'+n+'" already exists. Ignoring it.')}.bind(this))},_installProperties:function(e){var t=Object.keys(this.model.properties),n={};t.forEach(function(t){var r=this.model.properties[t],s=r.dependencies||[];s.forEach(function(e){n[e]||(n[e]=[]),n[e].push(t)}),delete r.dependencies,void 0===e[t]?Object.defineProperty(e,t,r):i('A property/method with name "'+t+'" already exists. Ignoring it.')}.bind(this)),e._propertyDependencies=n},_installRemoteId:function(e){var t=this.model,n=t.context.cache,r=t.id;Object.defineProperty(e,r,{get:function(){return e.__values[t.id]||null},set:function(r){var i=e[t.id];e.__values[t.id]=r,t.context.broadcast({collection:t.collectionName,model:t.name,localId:e.localId,"new":r,old:i,type:p.Set,field:t.id,obj:e}),n.remoteInsert(e,r,i)},enumerable:!0,configurable:!0})},_installRelationship:function(e,t){var n,r=e.type;if(r==o.OneToMany)n=new d(e);else if(r==o.OneToOne)n=new f(e);else{if(r!=o.ManyToMany)throw new s("No such relationship type: "+r);n=new v(e)}n.install(t)},_installRelationshipProxies:function(e){var t=this.model;for(var n in t.relationships)if(t.relationships.hasOwnProperty(n)){var r=l.extend({},t.relationships[n]);this._installRelationship(r,e)}},_registerInstance:function(e,t){var n=this.model.context.cache;n.insert(e),t=void 0===t?!0:t,t&&e._emitNew()},_installLocalId:function(e,t){e.localId=this._getLocalId(t)},_instance:function(e,t){var n=new a(this.model);return this._installLocalId(n,e),this._installAttributes(n,e),this._installMethods(n),this._installProperties(n),this._installRemoteId(n),this._installRelationshipProxies(n),this._registerInstance(n,t),n}},e.exports=r},function(e,t,n){function r(e,t){(void 0===t||null===t)&&(this.lazy=!0),this._fn=e||function(e){e()},this.reset()}var i=n(1),s=n(25),o=n(34);r.all=o(function(e){return new r(e)}),r.prototype={_execute:function(){if(!this.executed){var e=i.pluck(this.dependent,"_promise");s.all(e).then(this.fn)["catch"](this.reject.bind(this)),this.dependent.forEach(function(e){e._execute()})}},then:function(e,t){return this._execute(),this._promise.then(e,t),this},"catch":function(e){return this._execute(),this._promise["catch"](e),this},resolve:function(e){this.executed=!0,this._promise.resolve(e)},reject:function(e){this.executed=!0,this._promise.reject(e)},dependentOn:function(e){this.dependent.push(e)},reset:function(){this._promise=new s(function(e,t){this.reject=t,this.resolve=e,this.fn=function(){this.executed=!0;var n=0,r=[],s=[];if(i.isArray(this._fn)){var o=function(){n==this._fn.length&&(s.length?t(s):e(r))}.bind(this);this._fn.forEach(function(e,t){e.then(function(e){r[t]=e,n++,o()}.bind(this))["catch"](function(e){s[t]=e,n++,o()}.bind(this))})}else this._fn(function(n,r){n?t(n):e(r)}.bind(this))}.bind(this)}.bind(this)),this.lazy||this._execute(),this.executed=!1,this.dependent=[]}},e.exports=r},function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function s(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!s(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,s,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];n.apply(this,s)}else if(o(n)){for(r=arguments.length,s=new Array(r-1),l=1;r>l;l++)s[l-1]=arguments[l];for(c=n.slice(),r=c.length,l=0;r>l;l++)c[l].apply(this,s)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],s=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(n)){for(a=s;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},function(e,t,n){(function(e,r){function i(e,t){this._id=e,this._clearFn=t}var s=n(37).nextTick,o=Function.prototype.apply,a=Array.prototype.slice,l={},c=0;t.setTimeout=function(){return new i(o.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(o.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},t.setImmediate="function"==typeof e?e:function(e){var n=c++,r=arguments.length<2?!1:a.call(arguments,1);return l[n]=!0,s(function(){l[n]&&(r?e.apply(null,r):e.call(null),t.clearImmediate(n))}),n},t.clearImmediate="function"==typeof r?r:function(e){delete l[e]}}).call(t,n(33).setImmediate,n(33).clearImmediate)},function(e,t,n){"use strict";function r(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}e.exports=r},function(e,t,n){function r(){return t.colors[h++%t.colors.length]}function i(e){function n(){}function i(){var e=i,n=+new Date,s=n-(c||n);e.diff=s,e.prev=c,e.curr=n,c=n,null==e.useColors&&(e.useColors=t.useColors()),null==e.color&&e.useColors&&(e.color=r());var o=Array.prototype.slice.call(arguments);o[0]=t.coerce(o[0]),"string"!=typeof o[0]&&(o=["%o"].concat(o));var a=0;o[0]=o[0].replace(/%([a-z%])/g,function(n,r){if("%%"===n)return n;a++;var i=t.formatters[r];if("function"==typeof i){var s=o[a];n=i.call(e,s),o.splice(a,1),a--}return n}),"function"==typeof t.formatArgs&&(o=t.formatArgs.apply(e,o));var l=i.log||t.log||console.log.bind(console);l.apply(e,o)}n.enabled=!1,i.enabled=!0;var s=t.enabled(e)?i:n;return s.namespace=e,s}function s(e){t.save(e);for(var n=(e||"").split(/[\s,]+/),r=n.length,i=0;r>i;i++)n[i]&&(e=n[i].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))}function o(){t.enable("")}function a(e){var n,r;for(n=0,r=t.skips.length;r>n;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;r>n;n++)if(t.names[n].test(e))return!0;return!1}function l(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=i,t.coerce=l,t.disable=o,t.enable=s,t.enabled=a,t.humanize=n(38),t.names=[],t.skips=[],t.formatters={};var c,h=0},function(e,t,n){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t,n){function r(){if(!a){a=!0;for(var e,t=o.length;t;){e=o,o=[];for(var n=-1;++n<t;)e[n]();t=o.length}a=!1}}function i(){}var s=e.exports={},o=[],a=!1;s.nextTick=function(e){o.push(e),a||setTimeout(r,0)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=i,
s.addListener=i,s.once=i,s.off=i,s.removeListener=i,s.removeAllListeners=i,s.emit=i,s.binding=function(e){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(e,t,n){function r(e){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"days":case"day":case"d":return n*h;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*l;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}function i(e){return e>=h?Math.round(e/h)+"d":e>=c?Math.round(e/c)+"h":e>=l?Math.round(e/l)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function s(e){return o(e,h,"day")||o(e,c,"hour")||o(e,l,"minute")||o(e,a,"second")||e+" ms"}function o(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,l=60*a,c=60*l,h=24*c,u=365.25*h;e.exports=function(e,t){return t=t||{},"string"==typeof e?r(e):t["long"]?s(e):i(e)}}]);
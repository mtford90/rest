(function e$$0(t,q,g){function n(h,d){if(!q[h]){if(!t[h]){var e="function"==typeof require&&require;if(!d&&e)return e(h,!0);if(p)return p(h,!0);e=Error("Cannot find module '"+h+"'");throw e.code="MODULE_NOT_FOUND",e;}e=q[h]={exports:{}};t[h][0].call(e.exports,function(f){var b=t[h][1][f];return n(b?b:f)},e,e.exports,e$$0,t,q,g)}return q[h].exports}for(var p="function"==typeof require&&require,e=0;e<g.length;e++)n(g[e]);return n})({1:[function(k,t,q){function g(a){n.call(this,a);this.indexAttribute=
"index"}var n=k("./reactiveQuery");q=k("./log");var p=k("./util"),e=k("./error"),h=k("./modelEvents"),d=e.InternalSiestaError,v=k("./querySet"),f=e.errorFactory(e.Components.ArrangedReactiveQuery),b=p._;q.loggerWithName("Query");g.prototype=Object.create(n.prototype);b.extend(g.prototype,{_refreshIndexes:function(){var a=this.results,c=this.indexAttribute;if(!a)throw new d("ArrangedReactiveQuery must be initialised");for(var l=0;l<a.length;l++)a[l][c]=l},_mergeIndexes:function(){for(var a=this.results,
c=[],l=[],m=[],r=0;r<a.length;r++){var y=a[r],f=y[this.indexAttribute];void 0==f?m.push(y):f>a.length?l.push(y):c[f]?m.push(y):c[f]=y}l=b.sortBy(l,function(a){return a[this.indexAttribute]}.bind(this));for(r=0;r<l.length;r++)y=l[r],a=this.results.length-l.length+r,y[this.indexAttribute]=a,c[a]=y;m=this._query._sortResults(m);for(l=0;m.length;){for(y=m.shift();c[l];)l++;c[l]=y;y[this.indexAttribute]=l}this.results=v(c,this.model)},init:function(a){var c=p.defer(a);n.prototype.init.call(this,function(a){a||
(this.model.hasAttributeNamed(this.indexAttribute)?(this._mergeIndexes(),this._query.clearOrdering()):a=f('Model "'+this.model.name+'" does not have an attribute named "'+this.indexAttribute+'"'));c.finish(a,a?null:this.results)}.bind(this));return c.promise},_handleNotif:function(a){a.field!=this.indexAttribute&&(n.prototype._handleNotif.call(this,a),this._refreshIndexes())},validateIndex:function(a){var c=this.results.length-1;if(!(0<=a&&a<=c))throw Error("Index "+a.toString()+" is out of bounds");
},swapObjectsAtIndexes:function(a,c){this.validateIndex(a);this.validateIndex(c);var l=this.results[a],m=this.results[c];if(!l)throw Error('No model at index "'+a.toString()+'"');if(!m)throw Error('No model at index "'+c.toString()+'"');this.results[c]=l;this.results[a]=m;l[this.indexAttribute]=c;m[this.indexAttribute]=a},swapObjects:function(a,c){var l=this.results.indexOf(a),m=this.results.indexOf(c);this.swapObjectsAtIndexes(l,m)},move:function(a,c){this.validateIndex(a);this.validateIndex(c);
var l=this.results.mutableCopy();(function(a,c){if(c>=this.length)for(var l=c-this.length;l--+1;)this.push(void 0)}).call(l,a,c);var m=l.splice(a,1)[0];this.emit("change",this.results=l.asModelQuerySet(this.model),{index:a,removed:[m],type:h.ModelEventType.Splice,obj:this,field:"results"});l.splice(c,0,m);this.emit("change",this.results=l.asModelQuerySet(this.model),{index:c,added:[m],type:h.ModelEventType.Splice,obj:this,field:"results"});this._refreshIndexes()}});t.exports=g},{"./error":11,"./log":14,
"./modelEvents":18,"./querySet":23,"./reactiveQuery":24,"./util":28}],2:[function(k,t,q){function g(d){var f=this;this.model=d;n.subProperties(this,this.model,["collection","collectionName","_attributeNames",{name:"idField",property:"id"},{name:"modelName",property:"name"}]);h.ProxyEventEmitter.call(this);Object.defineProperties(this,{_relationshipNames:{get:function(){var b=p.map(Object.keys(f.__proxies||{}),function(a){return f.__proxies[a]});return p.map(b,function(a){return a.isForward?a.forwardName:
a.reverseName})},enumerable:!0,configurable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return f._id in siesta.ext.storage._unsavedObjectsHash},enumerable:!0},event:{get:function(){return this._id}}});this.removed=!1}k("./log");var n=k("./util"),p=n._;k("./error");var e=k("./modelEvents"),h=k("./events"),d=k("./cache");g.prototype=Object.create(h.ProxyEventEmitter.prototype);p.extend(g.prototype,{get:function(d){var f=n.defer(d);d=f.finish.bind(f);d(null,this);return f.promise},emit:function(d,
f){"object"==typeof d?f=d:f.type=d;f=f||{};p.extend(f,{collection:this.collectionName,model:this.model.name,_id:this._id,obj:this});e.emit(f)},remove:function(h,f){f=null==f?!0:f;var b=n.defer(h);h=b.finish.bind(b);d.remove(this);this.removed=!0;f&&this.emit(e.ModelEventType.Remove,{old:this});var a=this.model.remove;if(a)if(n.paramNames(a).length){var c=this;a.call(this,function(a){h(a,c)})}else a.call(this),h(null,this);else h(null,this);return b.promise},restore:function(h){var f=n.defer(h);h=
f.finish.bind(f);var b=function(a){a||this.emit(e.ModelEventType.New,{"new":this});h(a,this)}.bind(this);if(this.removed){d.insert(this);this.removed=!1;var a=this.model.init;a?n.paramNames(a).length?a.call(this,b):(a.call(this),b()):b()}return f.promise}});p.extend(g.prototype,{getAttributes:function(){return p.extend({},this.__values)},isInstanceOf:function(d){return this.model==d},isA:function(d){return this.model==d||this.model.isDescendantOf(d)}});p.extend(g.prototype,{_dumpString:function(d){return JSON.stringify(this._dump(d,
null,4))},_dump:function(d){d=p.extend({},this.__values);d._rev=this._rev;d._id=this._id;return d}});t.exports=g},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":28}],3:[function(k,t,q){function g(b){n.call(this,b);this.isReverse&&(this.related=[])}var n=k("./RelationshipProxy");k("./store");var p=k("./util"),e=p._;k("./error");var h=k("./modelEvents");k("./modelInstance");var d=k("./events").wrapArray,v=k("../vendor/observe-js/src/observe").ArrayObserver,f=k("./modelEvents").ModelEventType;
g.prototype=Object.create(n.prototype);e.extend(g.prototype,{clearReverse:function(b){var a=this;e.each(b,function(c){a.reverseProxyForInstance(c).setIdAndRelated(null)})},setReverseOfAdded:function(b){var a=this;e.each(b,function(c){a.reverseProxyForInstance(c).setIdAndRelated(a.object)})},wrapArray:function(b){var a=this;d(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new v(b),b.arrayObserver.open(function(c){c.forEach(function(c){var m=c.addedCount?b.slice(c.index,c.index+c.addedCount):
[],r=c.removed;a.clearReverse(r);a.setReverseOfAdded(m);var y=a.getForwardModel();h.emit({collection:y.collectionName,model:y.name,_id:a.object._id,field:a.getForwardName(),removed:r,added:m,type:f.Splice,index:c.index,obj:a.object})})}))},get:function(b){var a=p.defer(b);b=a.finish.bind(a);b(null,this.related);return a.promise},validate:function(b){b=Object.prototype.toString.call(b);if(this.isForward){if("[object Array]"==b)return"Cannot assign array forward oneToMany ("+b+"): "+this.forwardName}else if("[object Array]"!=
b)return"Cannot scalar to reverse oneToMany ("+b+"): "+this.reverseName;return null},set:function(b,a){this.checkInstalled();if(b){var c;if(c=this.validate(b))return c;this.clearReverseRelated(a);this.setIdAndRelated(b,a);this.isReverse&&this.wrapArray(this.related);this.setIdAndRelatedReverse(b,a)}else this.clearReverseRelated(a),this.setIdAndRelated(b,a)},install:function(b){n.prototype.install.call(this,b);this.isReverse&&(b["splice"+p.capitaliseFirstLetter(this.reverseName)]=e.bind(this.splice,
this),this.wrapArray(this.related))}});t.exports=g},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],4:[function(k,t,q){function g(e){n.call(this,e)}var n=k("./RelationshipProxy");k("./store");var p=k("./util");q=p._;k("./error");k("./modelEvents");k("./modelInstance");g.prototype=Object.create(n.prototype);q.extend(g.prototype,{validate:function(e){return"[object Array]"==Object.prototype.toString.call(e)?
"Cannot assign array to one to one relationship":null},set:function(e,h){this.checkInstalled();if(e){var d;if(d=this.validate(e))return d;this.clearReverseRelated(h);this.setIdAndRelated(e,h);this.setIdAndRelatedReverse(e,h)}else this.clearReverseRelated(h),this.setIdAndRelated(e,h)},get:function(e){var h=p.defer(e);e=h.finish.bind(h);e(null,this.related);return h.promise}});t.exports=g},{"./RelationshipProxy":6,"./error":11,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],5:[function(k,
t,q){function g(a,c){var l={},m;for(m in c)c.hasOwnProperty(m)&&"__"==m.slice(0,2)&&(l[m.slice(2)]=c[m],delete c[m]);f.extend(this,{model:a,query:c,opts:l});l.order=l.order||[];e.isArray(l.order)||(l.order=[l.order])}function n(a){var c=a.name;a=p._localCacheByType[a.collectionName];var l;a&&(l=a[c]||{});return l}q=k("./log");var p=k("./cache"),e=k("./util"),h=k("./error"),d=k("./querySet"),v=h.errorFactory(h.Components.Query),f=e._,b=q.loggerWithName("Query");f.extend(g,{comparators:{e:function(a){var c=
a.object[a.field];b.trace&&b.trace(a.field+": "+(null===c?"null":void 0===c?"undefined":c.toString())+" == "+a.value.toString());return c==a.value},lt:function(a){return a.invalid?!1:a.object[a.field]<a.value},gt:function(a){return a.invalid?!1:a.object[a.field]>a.value},lte:function(a){return a.invalid?!1:a.object[a.field]<=a.value},gte:function(a){return a.invalid?!1:a.object[a.field]>=a.value},contains:function(a){return a.invalid?!1:-1<a.object[a.field].indexOf(a.value)}},registerComparator:function(a,
c){this.comparators[a]||(this.comparators[a]=c)}});f.extend(g.prototype,{execute:function(a){var c=e.defer(a);a=c.finish.bind(c);this._executeInMemory(a);return c.promise},_dump:function(a){return a?"{}":{}},sortFunc:function(a){for(var c=function(a,c){return function(r,l){var m=r[c],b=l[c];"string"==typeof m||m instanceof String&&"string"==typeof b||b instanceof String?m=a?m.localeCompare(b):b.localeCompare(m):(m instanceof Date&&(m=m.getTime()),b instanceof Date&&(b=b.getTime()),m=a?m-b:b-m);return m}},
l=e,m=0;m<a.length;m++)var r=a[m],l=l.thenBy(c(r.ascending,r.field));return l==e?null:l},_sortResults:function(a){var c=this.opts.order;a&&c&&(c=f.map(c,function(a){a=a.split("-");var c=!0,r=null;1<a.length?(r=a[1],c=!1):r=a[0];return{field:r,ascending:c}}.bind(this)),c=this.sortFunc(c),a.immutable&&(a=a.mutableCopy()),c&&a.sort(c));return a},_getCacheByLocalId:function(){return f.reduce(this.model.descendants,function(a,c){return f.extend(a,n(c))},f.extend({},n(this.model)))},_executeInMemory:function(a){var c=
function(){for(var c=this._getCacheByLocalId(),m=Object.keys(c),r=[],b,f=0;f<m.length;f++){var h=c[m[f]],e=this.objectMatchesQuery(h);if("string"==typeof e){b=v(e);break}else e&&r.push(h)}r=this._sortResults(r);a(b,b?null:d(r,this.model))}.bind(this);this.opts.ignoreInstalled?c():siesta._afterInstall(c)},clearOrdering:function(){this.opts.order=null},objectMatchesOrQuery:function(a,c){for(var l in c)if(c.hasOwnProperty(l)&&this.objectMatchesBaseQuery(a,c[l]))return!0;return!1},objectMatchesAndQuery:function(a,
c){for(var l in c)if(c.hasOwnProperty(l)&&!this.objectMatchesBaseQuery(a,c[l]))return!1;return!0},splitMatches:function(a,c,l){var m="e",r=c.split("."),b=r[r.length-1].split("__");2==b.length?(c=b[0],m=b[1]):c=b[0];r[r.length-1]=c;f.each(r.slice(0,r.length-1),function(c){a=a[c]});r=a[c];return(b=g.comparators[m])?b({object:a,field:c,value:l,invalid:null===r||void 0===r}):'No comparator registered for query operation "'+m+'"'},objectMatches:function(a,c,b,m){if("$or"==c){if(!this.objectMatchesOrQuery(a,
m.$or))return!1}else if("$and"==c){if(!this.objectMatchesAndQuery(a,m.$and))return!1}else{a=this.splitMatches(a,c,b);if("boolean"!=typeof a)return a;if(!a)return!1}return!0},objectMatchesBaseQuery:function(a,c){for(var b=Object.keys(c),m=0;m<b.length;m++){var r=b[m],r=this.objectMatches(a,r,c[r],c);if("boolean"!=typeof r)return r;if(!r)return!1}return!0},objectMatchesQuery:function(a){return this.objectMatchesBaseQuery(a,this.query)}});t.exports=g},{"./cache":8,"./error":11,"./log":14,"./querySet":23,
"./util":28}],6:[function(k,t,q){function g(b){var a=this;b=b||{};e.extend(this,{object:null,related:null});Object.defineProperties(this,{isForward:{get:function(){return!a.isReverse},set:function(c){a.isReverse=!c},enumerable:!0}});p.extendFromOpts(this,b,{reverseModel:null,forwardModel:null,forwardName:null,reverseName:null,isReverse:null});this.cancelListens={}}var n=k("./error").InternalSiestaError;k("./store");var p=k("./util"),e=p._;k("./query");k("./log");k("./cache");var h=k("./events").wrapArray,
d=k("../vendor/observe-js/src/observe").ArrayObserver,v=k("./modelEvents"),f=v.ModelEventType;e.extend(g,{});e.extend(g.prototype,{install:function(b){if(b){if(this.object)throw new n("Already installed.");this.object=b;var a=this,c=this.getForwardName();Object.defineProperty(b,c,{get:function(){return a.related},set:function(c){a.set(c)},configurable:!0,enumerable:!0});b.__proxies||(b.__proxies={});b.__proxies[c]=this;b._proxies||(b._proxies=[]);b._proxies.push(this)}else throw new n("No object passed to relationship install");
}});e.extend(g.prototype,{set:function(b,a){throw new n("Must subclass RelationshipProxy");},get:function(b){throw new n("Must subclass RelationshipProxy");}});e.extend(g.prototype,{proxyForInstance:function(b,a){var c=a?this.getReverseName():this.getForwardName(),l=a?this.reverseModel:this.forwardModel;if(p.isArray(b))l=e.map(b,function(a){return a.__proxies[c]});else{var m=b.__proxies[c];if(!m)throw new n('No proxy with name "'+c+'" on mapping '+l.name);l=m}return l},reverseProxyForInstance:function(b){return this.proxyForInstance(b,
!0)},getReverseName:function(){return this.isForward?this.reverseName:this.forwardName},getForwardName:function(){return this.isForward?this.forwardName:this.reverseName},getForwardModel:function(){return this.isForward?this.forwardModel:this.reverseModel},clearRemovalListener:function(b){b=b._id;var a=this.cancelListens[b];a&&(a(),this.cancelListens[b]=null)},listenForRemoval:function(b){this.cancelListens[b._id]=b.listen(function(a){a.type==f.Remove&&(p.isArray(this.related)?(a=this.related.indexOf(b),
this.splice(a,1)):this.setIdAndRelated(null),this.clearRemovalListener(b))}.bind(this))},setIdAndRelated:function(b,a){a=a||{};a.disableevents||this.registerSetChange(b);var c=this.related;c&&this.clearRemovalListener(c);b?p.isArray(b)?(this.related=b,b.forEach(function(a){this.listenForRemoval(a)}.bind(this))):(this.related=b,this.listenForRemoval(b)):this.related=null},checkInstalled:function(){if(!this.object)throw new n("Proxy must be installed on an object before can use it.");},splicer:function(b){b=
b||{};return function(a,c){b=b||{};b.disableevents||this.registerSpliceChange.apply(this,arguments);var l=Array.prototype.slice.call(arguments,2);return e.partial(this.related.splice,a,c).apply(this.related,l)}.bind(this)},clearReverseRelated:function(b){b=b||{};var a=this;if(this.related){var c=this.reverseProxyForInstance(this.related),c=p.isArray(c)?c:[c];e.each(c,function(c){if(p.isArray(c.related)){var m=c.related.indexOf(a.object);c.makeChangesToRelatedWithoutObservations(function(){c.splicer(b)(m,
1)})}else c.setIdAndRelated(null,b)})}},setIdAndRelatedReverse:function(b,a){var c=this,l=this.reverseProxyForInstance(b),l=p.isArray(l)?l:[l];e.each(l,function(m){p.isArray(m.related)?m.makeChangesToRelatedWithoutObservations(function(){m.splicer(a)(m.related.length,0,c.object)}):(m.clearReverseRelated(a),m.setIdAndRelated(c.object,a))})},makeChangesToRelatedWithoutObservations:function(b){this.related?(this.related.arrayObserver.close(),this.related.arrayObserver=null,b(),this.wrapArray(this.related)):
b()},registerSetChange:function(b){var a=this.object;if(!a)throw new n("Proxy must have an object associated");var c=a.model.name,l=a.collectionName,m=this.related;p.isArray(m)&&!m.length&&(m=null);v.emit({collection:l,model:c,_id:a._id,field:this.getForwardName(),old:m,"new":b,type:f.Set,obj:a})},registerSpliceChange:function(b,a){var c=Array.prototype.slice.call(arguments,2);v.emit({collection:this.object.collectionName,model:this.object.model.name,_id:this.object._id,field:this.getForwardName(),
index:b,removed:this.related?this.related.slice(b,b+a):null,added:c.length?c:[],type:f.Splice,obj:this.object})},wrapArray:function(b){var a=this;h(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new d(b),b.arrayObserver.open(function(c){c.forEach(function(c){var m=c.addedCount?b.slice(c.index,c.index+c.addedCount):[],r=a.getForwardModel();v.emit({collection:r.collectionName,model:r.name,_id:a.object._id,field:a.getForwardName(),removed:c.removed,added:m,type:f.Splice,obj:a.object})})}))},
splice:function(){this.splicer({}).apply(this,arguments)}});t.exports=g},{"../vendor/observe-js/src/observe":44,"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":22,"./store":26,"./util":28}],7:[function(k,t,q){t.exports={OneToMany:"OneToMany",OneToOne:"OneToOne",ManyToMany:"ManyToMany"}},{}],8:[function(k,t,q){function g(a){var c=a.name;if(a=l[a.collectionName])if(c=a[c]){a=[];for(var m in c)c.hasOwnProperty(m)&&a.push(c[m]);if(1<a.length)throw new f("A singleton model has more than 1 object in the cache! This is a serious error. Either a model has been modified after objects have already been created, or something has gonevery wrong. Please file a bug report if the latter.");
if(a.length)return a[0]}return null}function n(c,b){var l=b.model.name,f=b.model.collectionName;if(m[f]&&(l=m[f][l]))return(l=l[c])?a.debug&&a.debug("Remote cache hit: "+l._dump(!0)):a.debug&&a.debug("Remote cache miss: "+c),l;a.debug&&a.debug("Remote cache miss: "+c);return null}function p(c,b,l){if(c){var d=c.model.collectionName;if(d){m[d]||(m[d]={});var h=c.model.name;if(h)if(m[d][h]||(m[d][h]={}),l&&(m[d][h][l]=null),l=m[d][h][b]){if(c!=l)throw b="Object "+d.toString()+":"+h.toString()+"["+c.model.id+
'="'+b+'"] already exists in the cache. This is a serious error, please file a bug report if you are experiencing this out in the wild',a.error(b,{obj:c,cachedObject:l}),new f(b);a.debug.isEnabled&&a.debug("Object has already been inserted: "+c._dump(!0))}else m[d][h][b]=c,a.debug.isEnabled&&a.debug("Remote cache insert: "+c._dump(!0)),a.trace.isEnabled&&a.trace("Remote cache now looks like: "+e(!0));else throw new f("Model has no type",{model:c.model,obj:c});}else throw new f("Model has no collection",
{model:c.model,obj:c});}else throw a.error("Must pass an object when inserting to cache"),new f("Must pass an object when inserting to cache");}function e(a){var c={},l;for(l in m)if(m.hasOwnProperty(l)){var f={};c[l]=f;var d=m[l],h;for(h in d)if(d.hasOwnProperty(h)){var e={};f[h]=e;var g=d[h],k;for(k in g)g.hasOwnProperty(k)&&g[k]&&(e[k]=g[k]._dump())}}return a?b.prettyPrint((c,null,4)):c}function h(a){var m={},l;for(l in c)c.hasOwnProperty(l)&&(m[l]=c[l]._dump());return a?b.prettyPrint((m,null,
4)):m}function d(b){a.debug.isEnabled&&a.debug("get",b);var m,l;if(m=b._id){(l=c[m])?a.debug.isEnabled&&a.debug("Local cache hit: "+l._dump(!0)):a.debug.isEnabled&&a.debug("Local cache miss: "+m);if(l)return l;if(b.model)return m=b.model.id,l=b[m],a.debug.isEnabled&&a.debug(m+"="+l),n(l,b)}else if(b.model){m=b.model.id;if(l=b[m])return n(l,b);if(b.model.singleton)return g(b.model)}else a.warn("Invalid opts to cache",{opts:b});return null}function v(a){var c={_id:a._id},b=a.model;b.id&&a[b.id]&&(c.model=
b,c[b.id]=a[b.id]);return!!d(c)}t=k("./log");var f=k("./error").InternalSiestaError,b=k("./util"),a=t.loggerWithName("Cache"),c={},l={},m={};q._remoteCache=function(){return m};q._localCache=function(){return c};Object.defineProperty(q,"_localCacheByType",{get:function(){return l}});q.get=d;q.insert=function(b){var m=b._id;if(m){var d=b.model.collectionName,e=b.model.name;a.debug.isEnabled&&a.debug("Local cache insert: "+b._dumpString());if(!c[m])c[m]=b,a.trace.isEnabled&&a.trace("Local cache now looks like: "+
h(!0)),l[d]||(l[d]={}),l[d][e]||(l[d][e]={}),l[d][e][m]=b;else if(c[m]!=b)throw b='Object with _id="'+m.toString()+'" is already in the cache. This is a serious error. Please file a bug report if you are experiencing this out in the wild',a.error(b),new f(b);}m=b.idField;(d=b[m])?p(b,d):a.debug.isEnabled&&a.debug('No remote id ("'+m+'") so wont be placing in the remote cache',b)};q.remoteInsert=p;q.reset=function(){m={};c={};l={}};q._dump=function(a){var c={localCache:h(),remoteCache:e()};return a?
b.prettyPrint((c,null,4)):c};q.contains=v;q.remove=function(a){if(v(a)){var b=a.model.collectionName,d=a.model.name,h=a._id;if(!d)throw f("No mapping name");if(!b)throw f("No collection name");if(!h)throw f("No _id");delete l[b][d][h];delete c[h];a.model.id&&(a=a[a.model.id])&&delete m[b][d][a]}else throw new f("Object was not in cache.");};q.getSingleton=g},{"./error":11,"./log":14,"./util":28}],9:[function(k,t,q){function g(a,c){var b=this;if(!a)throw Error("Collection must have a name");c=c||{};
v.extendFromOpts(this,c,{baseURL:""});f.extend(this,{name:a,_rawModels:{},_models:{},_opts:c,installed:!1});Object.defineProperties(this,{dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection[b.name]||{}).length},enumerable:!0}});n.register(this);d.ProxyEventEmitter.call(this,this.name)}q=k("./log");var n=k("./collectionRegistry").CollectionRegistry,p=k("./error").InternalSiestaError,e=k("./model"),h=k("extend");k("../vendor/observe-js/src/observe");
var d=k("./events"),v=k("./util"),f=v._,b=k("./error"),a=b.errorFactory(b.Components.Collection);k("./cache");var c=["PUT","PATCH","POST","DELETE"],l=q.loggerWithName("Collection");g.prototype=Object.create(d.ProxyEventEmitter.prototype);f.extend(g.prototype,{install:function(a){var c=v.defer(a),b=this;if(this.installed)throw new p('Collection "'+this.name+'" has already been installed');var d=[],h;for(h in this._models)this._models.hasOwnProperty(h)&&d.push(this._models[h]);l.info.isEnabled&&l.info("There are "+
d.length.toString()+" mappings to install");d.length?(a=f.map(d,function(a){return f.bind(a.install,a)}),v.async.parallel(a,function(a){if(a)l.error("Failed to install collection",a);else{b.installed=!0;var m=[];f.each(d,function(a){l.info.isEnabled&&l.info('Installing relationships for mapping with name "'+a.name+'"');(a=a.installRelationships())&&m.push(a)});m.length||f.each(d,function(a){l.info.isEnabled&&l.info('Installing reverse relationships for mapping with name "'+a.name+'"');(a=a.installReverseRelationships())&&
m.push(a)});1==m.length?a=m[0]:m.length&&(a=m)}b._finaliseInstallation(a,c.finish.bind(c))})):b._finaliseInstallation(null,c.finish.bind(c));return c.promise},_finaliseInstallation:function(c,b){c&&(c=a("Errors were encountered whilst setting up the collection",{errors:c}));c||(this.installed=!0,k("./index")[this.name]=this);b(c)},_model:function(a,c){if(a){this._rawModels[a]=c;c=h(!0,{},c);c.name=a;c.collection=this;var b=new e(c);this._models[a]=b;return this[a]=b}throw Error("No name specified when creating mapping");
},model:function(){if(this.installed)throw Error("Cannot create new models once the object graph is established!");var a=this;return arguments.length?1==arguments.length?v.isArray(arguments[0])?f.map(arguments[0],function(c){return a._model(c.name,c)}):this._model(arguments[0].name,arguments[0]):"string"==typeof arguments[0]?this._model(arguments[0],arguments[1]):f.map(arguments,function(c){return a._model(c.name,c)}):null},descriptor:function(a){var b=[];if(siesta.ext.httpEnabled){a.collection=this;
for(var l=siesta.ext.http._resolveMethod(a.method),d=[],f=[],e=0;e<l.length;e++){var g=l[e];-1<c.indexOf(g)?d.push(g):f.push(g)}d.length&&(l=h({},a),l.method=d,l=new siesta.ext.http.RequestDescriptor(l),siesta.ext.http.DescriptorRegistry.registerRequestDescriptor(l),b.push(l));f.length&&(a=h({},a),a.method=f,a=new siesta.ext.http.ResponseDescriptor(a),siesta.ext.http.DescriptorRegistry.registerResponseDescriptor(a),b.push(a))}else throw Error("HTTP module not installed.");return b},_dump:function(a){var c=
{};c.installed=this.installed;c.docId=this._docId;c.name=this.name;c.baseURL=this.baseURL;return a?v.prettyPrint(c):c},count:function(a){var c=v.defer(a);a=f.map(this._models,function(a){return f.bind(a.count,a)});v.async.parallel(a,function(a,b){var l;a||(l=f.reduce(b,function(a,c){return a+c},0));c.finish(a,l)});return c.promise}});t.exports=g},{"../vendor/observe-js/src/observe":44,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./index":13,"./log":14,"./model":17,"./util":28,
extend:42}],10:[function(k,t,q){function g(){if(!this)return new g;this.collectionNames=[]}var n=k("./util")._;n.extend(g.prototype,{register:function(g){var e=g.name;this[e]=g;this.collectionNames.push(e)},reset:function(){var g=this;n.each(this.collectionNames,function(e){delete g[e]});this.collectionNames=[]}});q.CollectionRegistry=new g},{"./util":28}],11:[function(k,t,q){function g(e,h,d){this.message=e;this.context=h;(d=d||arguments.callee)&&Error.captureStackTrace&&Error.captureStackTrace(this,
d)}function n(e,h,d){d=d||{};this.component=e;this.message=h;for(var g in d)d.hasOwnProperty(g)&&(this[g]=d[g]);this.isUserError=!0}g.prototype=Object.create(Error.prototype);g.prototype.name="InternalSiestaError";g.prototype.constructor=g;k={Unknown:0,NoDescriptorMatched:1};var p={Mapping:"Mapping",HTTP:"HTTP",ReactiveQuery:"ReactiveQuery",ArrangedReactiveQuery:"ArrangedReactiveQuery",Collection:"Collection",Query:"Query"};q={};q[k.NoDescriptorMatched]="No descriptor matched the HTTP response/request.";
t.exports={InternalSiestaError:g,SiestaUserError:n,ErrorCode:k,ErrorField:{Message:"message",Code:"code"},Message:q,Components:p,errorFactory:function(e){if(e in p)return function(h,d){return new n(e,h,d)};throw new n('No such component "'+e+'"');}}},{}],12:[function(k,t,q){function g(d){p.extend(this,{event:d,listeners:{}})}q=k("events").EventEmitter;var n=k("../vendor/observe-js/src/observe").ArrayObserver,p=k("./util")._,e=k("./modelEvents"),h=new q;p.extend(g.prototype,{listen:function(d,e){if("function"==
typeof d)e=d,d=null;else{var f=e;e=function(a){a=a||{};d?a.type==d&&f(a):f(a)};var b=this.listeners;d&&(b[d]||(b[d]=[]),b[d].push(e))}h.on(this.event,e);return function(){this._removeListener(e,d)}.bind(this)},listenOnce:function(d,e){var f=this.event;if("function"==typeof d)e=d,d=null;else{var b=e;e=function(a){a=a||{};d?a.type==d&&(h.removeListener(f,e),b(a)):b(a)}}return d?h.on(f,e):h.once(f,e)},_removeListener:function(d,e){if(e){var f=this.listeners[e],b=f.indexOf(d);f.splice(b,1)}return h.removeListener(this.event,
d)},emit:function(d,e){"object"==typeof d?e=d:(e=e||{},e.type=d);h.emit.call(h,this.event,e)},_removeAllListeners:function(d){(this.listeners[d]||[]).forEach(function(d){h.removeListener(this.event,d)}.bind(this));this.listeners[d]=[]},removeAllListeners:function(d){if(d)this._removeAllListeners(d);else for(d in this.listeners)this.listeners.hasOwnProperty(d)&&this._removeAllListeners(d)}});p.extend(g.prototype,{on:g.prototype.listen});p.extend(h,{ProxyEventEmitter:g,wrapArray:function(d,h,f){d.observer||
(d.observer=new n(d),d.observer.open(function(b){-1<f._attributeNames.indexOf(h)&&b.forEach(function(a){e.emit({collection:f.collectionName,model:f.model.name,_id:f._id,index:a.index,removed:a.removed,added:a.addedCount?d.slice(a.index,a.index+a.addedCount):[],type:e.ModelEventType.Splice,field:h,obj:f})})}))}});t.exports=h},{"../vendor/observe-js/src/observe":44,"./modelEvents":18,"./util":28,events:38}],13:[function(k,t,q){var g=k("./util"),n=k("./collectionRegistry").CollectionRegistry,p=k("./collection"),
e=k("./cache");q=k("./model");var h=k("./error"),d=k("./events"),v=k("./RelationshipType"),f=k("./reactiveQuery"),b=k("./manyToManyProxy"),a=k("./oneToOneProxy"),c=k("./oneToManyProxy"),l=k("./relationshipProxy"),m=k("./modelEvents"),r=k("./Query"),y=k("./querySet"),D=k("./log"),z=g._,x=function(a){x.ext||(x.ext={});z.extend(x.ext,a||{});return x};Object.defineProperty(x,"q",{get:function(){return this._q||window.q||window.Q},set:function(a){this._q=a}});z.extend(x,{on:d.on.bind(d),off:d.removeListener.bind(d),
once:d.once.bind(d),removeAllListeners:d.removeAllListeners.bind(d)});z.extend(x,{removeListener:x.off,addListener:x.on});z.extend(x,{RelationshipType:v,ModelEventType:m.ModelEventType,log:D.Level,InsertionPolicy:f.InsertionPolicy,_internal:{log:D,Model:q,error:h,ModelEventType:m.ModelEventType,ModelInstance:k("./modelInstance"),extend:k("extend"),MappingOperation:k("./mappingOperation"),events:d,ProxyEventEmitter:d.ProxyEventEmitter,cache:k("./cache"),modelEvents:m,CollectionRegistry:k("./collectionRegistry").CollectionRegistry,
Collection:p,utils:g,util:g,_:g._,querySet:y,observe:k("../vendor/observe-js/src/observe"),Query:r,Store:k("./store"),ManyToManyProxy:b,OneToManyProxy:c,OneToOneProxy:a,RelationshipProxy:l},_:g._,async:g.async,isArray:g.isArray,isString:g.isString});x.ext={};var w=!1,A=!1;z.extend(x,{reset:function(a){A=w=!1;delete this.queuedTasks;e.reset();n.reset();d.removeAllListeners();x.ext.httpEnabled&&x.ext.http.DescriptorRegistry.reset();x.ext.storageEnabled?x.ext.storage._reset(a):a()},resetData:function(a){var c=
g.defer(a);a=c.finish.bind(c);x.ext.storage._reset(function(){var c=[],b=n.collectionNames.reduce(function(a,b){var l=n[b]._models;c.push(b);Object.keys(l).forEach(function(c){var b=l[c];a.push(function(a){b.all(function(c,b){c||b.remove();a(c)})})});return a},[]);g.async.series([z.partial(g.async.parallel,b)],a)});return c.promise},collection:function(a,c){return new p(a,c)},install:function(a){if(A||w)throw new h.InternalSiestaError("Already installing...");A=!0;var c=g.defer(a);a=c.finish.bind(c);
var b=z.map(n.collectionNames,function(a){return function(c){n[a].install(c)}}),l=this;x.async.series(b,function(c){c?a(c):x.ext.storageEnabled?x.ext.storage._load(function(c){c||(w=!0,l.queuedTasks&&l.queuedTasks.execute());a(c)}):(w=!0,l.queuedTasks&&l.queuedTasks.execute(),a())});return c.promise},_pushTask:function(a){this.queuedTasks||(this.queuedTasks=new function(){this.tasks=[];this.execute=function(){this.tasks.forEach(function(a){a()});this.tasks=[]}.bind(this)});this.queuedTasks.tasks.push(a)},
_afterInstall:function(a){w?a():(A||this.install(function(a){a&&console.error("Error setting up siesta",a);delete this.queuedTasks}.bind(this)),w?a():this._pushTask(a))},setLogLevel:function(a,c){D.loggerWithName(a).setLevel(c)},notify:g.next,registerComparator:r.bind(r)});Object.defineProperties(x,{_canChange:{get:function(){return!(A||w)}}});"undefined"!=typeof window&&(window.siesta=x);t.exports=x;k("../http");k("../storage")},{"../http":33,"../storage":43,"../vendor/observe-js/src/observe":44,
"./Query":5,"./RelationshipType":7,"./cache":8,"./collection":9,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./manyToManyProxy":15,"./mappingOperation":16,"./model":17,"./modelEvents":18,"./modelInstance":19,"./oneToManyProxy":20,"./oneToOneProxy":21,"./querySet":23,"./reactiveQuery":24,"./relationshipProxy":25,"./store":26,"./util":28,extend:42}],14:[function(k,t,q){function g(h){if(!this)return new g(h);this.name=h;e[h]=g.Level.warn;this.trace=n(this,p.bind(console.debug?console.debug:
console.log,console),g.Level.trace);this.debug=n(this,p.bind(console.debug?console.debug:console.log,console),g.Level.debug);this.info=n(this,p.bind(console.info?console.info:console.log,console),g.Level.info);this.log=n(this,p.bind(console.log,console),g.Level.info);this.warn=n(this,p.bind(console.warn?console.warn:console.log,console),g.Level.warning);this.error=n(this,p.bind(console.error?console.error:console.log,console),g.Level.error);this.fatal=n(this,p.bind(console.error?console.error:console.log,
console),g.Level.fatal)}function n(h,d,e){var f=function(b){h.performLog(d,e,b,arguments)};Object.defineProperty(f,"isEnabled",{get:function(){var b=h.currentLevel();return e>=b},enumerable:!0,configurable:!0});f.f=d;f.logger=h;f.level=e;return f}var p=k("./util")._,e={};g.Level={trace:0,debug:1,info:2,warning:3,warn:3,error:4,fatal:5};g.LevelText={};g.LevelText[g.Level.trace]="TRACE";g.LevelText[g.Level.debug]="DEBUG";g.LevelText[g.Level.info]="INFO ";g.LevelText[g.Level.warning]="WARN ";g.LevelText[g.Level.error]=
"ERROR";g.levelAsText=function(e){return this.LevelText[e]};g.loggerWithName=function(e){return new g(e)};g.prototype.currentLevel=function(){var h=e[this.name];return h?h:g.Level.trace};g.prototype.setLevel=function(h){e[this.name]=h};g.prototype.override=function(e,d,k){var f=this[g.levelAsText(e).trim().toLowerCase()].f,b=Array.prototype.slice.call(arguments,3,arguments.length);this.performLog(f,e,k,b,d)};g.prototype.performLog=function(e,d,k,f,b){if((void 0!==b?b:this.currentLevel())<=d){e=p.partial(e,
g.levelAsText(d)+" ["+this.name+"]: "+k);d=[];for(k=0;k<f.length;k++)d[k]=f[k];d.splice(0,1);e.apply(e,d)}};t.exports=g},{"./util":28}],15:[function(k,t,q){function g(b){n.call(this,b);this.related=[];this.relatedCancelListeners={}}var n=k("./RelationshipProxy");k("./store");var p=k("./util"),e=p._;k("./error");var h=k("./modelEvents"),d=k("./events").wrapArray;k("./modelInstance");var v=k("../vendor/observe-js/src/observe").ArrayObserver,f=k("./modelEvents").ModelEventType;g.prototype=Object.create(n.prototype);
e.extend(g.prototype,{clearReverse:function(b){var a=this;e.each(b,function(c){var b=a.reverseProxyForInstance(c),m=b.related.indexOf(a.object);b.makeChangesToRelatedWithoutObservations(function(){b.splice(m,1)})})},setReverseOfAdded:function(b){var a=this;e.each(b,function(c){var b=a.reverseProxyForInstance(c);b.makeChangesToRelatedWithoutObservations(function(){b.splice(0,0,a.object)})})},wrapArray:function(b){var a=this;d(b,this.reverseName,this.object);b.arrayObserver||(b.arrayObserver=new v(b),
b.arrayObserver.open(function(c){c.forEach(function(c){var m=c.addedCount?b.slice(c.index,c.index+c.addedCount):[],r=c.removed;a.clearReverse(r);a.setReverseOfAdded(m);var d=a.getForwardModel();h.emit({collection:d.collectionName,model:d.name,_id:a.object._id,field:a.getForwardName(),removed:r,added:m,type:f.Splice,index:c.index,obj:a.object})})}))},get:function(b){var a=p.defer(b);b=a.finish.bind(a);b(null,this.related);return a.promise},validate:function(b){return"[object Array]"!=Object.prototype.toString.call(b)?
"Cannot assign scalar to many to many":null},set:function(b,a){this.checkInstalled();if(b){var c;if(c=this.validate(b))return c;this.clearReverseRelated(a);this.setIdAndRelated(b,a);this.wrapArray(b);this.setIdAndRelatedReverse(b,a)}else this.clearReverseRelated(a),this.setIdAndRelated(b,a)},install:function(b){n.prototype.install.call(this,b);this.wrapArray(this.related);b["splice"+p.capitaliseFirstLetter(this.reverseName)]=e.bind(this.splice,this)},registerRemovalListener:function(b){this.relatedCancelListeners[b._id]=
b.listen(function(a){}.bind(this))}});t.exports=g},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],16:[function(k,t,q){function g(b){this._opts=b;h.extendFromOpts(this,b,{model:null,data:null,objects:[],disableevents:!1,_ignoreInstalled:!1,callInit:!0});d.extend(this,{errors:[],subTaskResults:{},_newObjects:[]})}var n=k("./store"),p=k("./modelInstance");q=k("./log");k("./error");var e=k("./cache"),
h=k("./util"),d=h._,v=h.async;k("./modelEvents");var f=q.loggerWithName("Mapping");f.setLevel(q.Level.trace);d.extend(g.prototype,{mapAttributes:function(){for(var b=0;b<this.data.length;b++){var a=this.data[b],c=this.objects[b];a!=c&&c&&(d.each(this.model._attributeNames,function(b){void 0!==a[b]&&(this.disableevents?c.__values[b]=a[b]:c[b]=a[b])}.bind(this)),a._rev&&(c._rev=a._rev))}},_map:function(){var b=this,a;this.mapAttributes();var c=d.keys(b.subTaskResults);d.each(c,function(c){for(var m=
b.subTaskResults[c],r=m.indexes,m=m.objects,d=b.getRelatedData(c).relatedData,m=h.unflattenArray(m,d),d=0;d<m.length;d++){var f=r[d],e=b.errors[f];a=e?e[c]:null;if(!a){var e=m[d],g=b.objects[f];g&&(a=g.__proxies[c].set(e,{disableevents:b.disableevents}))&&(b.errors[f]||(b.errors[f]={}),b.errors[f][c]=a)}}})},_lookup:function(b){var a=h.defer(b);b=a.finish.bind(a);for(var c=this,l=[],m=[],r=0;r<this.data.length;r++)if(!this.objects[r]){var g,k=this.data[r];g="string"==typeof k||"number"==typeof k||
k instanceof String;k?g?(g={index:r,datum:{}},g.datum[c.model.id]=k,l.push(g)):k instanceof p?this.objects[r]=k:k._id?m.push({index:r,datum:k}):k[c.model.id]?l.push({index:r,datum:k}):this.objects[r]=c._new():this.objects[r]=null}h.async.parallel([function(a){var b=d.pluck(d.pluck(m,"datum"),"_id");b.length?n.getMultipleLocal(b,function(l,d){if(!l)for(var r=0;r<b.length;r++){var f=d[r],h=b[r],g=m[r];f||(f=e.get({_id:h}))||(f=c._new({_id:h},!c.disableevents));c.objects[g.index]=f}a(l)}):a()},function(a){var b=
d.pluck(d.pluck(l,"datum"),c.model.id);b.length?(f.trace.isEnabled&&f.trace("Looking up remoteIdentifiers: "+h.prettyPrint(b)),n.getMultipleRemote(b,c.model,function(m,d){if(!m){if(f.trace.isEnabled){var g={};for(r=0;r<d.length;r++)g[b[r]]=d[r]?d[r]._id:null;f.trace("Results for remoteIdentifiers: "+h.prettyPrint(g))}for(r=0;r<d.length;r++){var k=d[r],g=l[r];if(k)c.objects[g.index]=k;else{var k=b[r],y={model:c.model};y[c.model.id]=k;(y=e.get(y))?c.objects[g.index]=y:(c.objects[g.index]=c._new(),c.objects[g.index][c.model.id]=
k)}}}a(m)})):a()}],b);return a.promise},_lookupSingleton:function(b){var a=h.defer(b);b=a.finish.bind(a);for(var c=d.pluck(this.data,"_id"),l,m=0;m<c.length;m++)if(c[m]){l={_id:c[m]};break}for(var c=e.getSingleton(this.model)||this._new(l),m=0;m<this.data.length;m++)this.objects[m]=c;b();return a.promise},_new:function(){var b=this.model,b=b._new.apply(b,arguments);this._newObjects.push(b);return b},start:function(b){if(this.data.length){var a=this,c=[];c.push(d.bind(this.model.singleton?this._lookupSingleton:
this._lookup,this));c.push(d.bind(this._executeSubOperations,this));h.async.parallel(c,function(){try{a._map();var c;c=a.callInit?d.reduce(a._newObjects,function(a,c){var l=c.model.init;l&&(h.paramNames(l).length?a.push(d.bind(l,c,b)):l.call(c));return a},[]):[];v.parallel(c,function(){b(a.errors.length?a.errors:null,a.objects)})}catch(m){console.error("caught error",m),b(m)}})}else b(null,[])},getRelatedData:function(b){for(var a=[],c=[],l=0;l<this.data.length;l++){var m=this.data[l];m&&m[b]&&(a.push(l),
c.push(m[b]))}return{indexes:a,relatedData:c}},processErrorsFromTask:function(b,a,c){if(a.length){var l=this.getRelatedData(b).relatedData;a=h.unflattenArray(a,l);for(l=0;l<a.length;l++){var m=c[l],r=a[l],f=r;h.isArray(r)&&(f=d.reduce(r,function(a,c){return a||c},!1));f&&(this.errors[m]||(this.errors[m]={}),this.errors[m][b]=r)}}},_executeSubOperations:function(b){var a=this,c=d.keys(this.model.relationships);c.length?(c=d.reduce(c,function(c,b){var d=a.model.relationships[b],f=d.forwardName==b?d.reverseModel:
d.forwardModel;f.singleton&&!d.isReverse&&this.data.forEach(function(a){a[b]||(a[b]={})});var d=this.getRelatedData(b),e=d.indexes,d=d.relatedData;if(d.length)var d=h.flattenArray(d),k=new g({model:f,data:d,disableevents:a.disableevents,_ignoreInstalled:a._ignoreInstalled,callInit:this.callInit});k&&c.push(function(c){k.start(function(l,d){a.subTaskResults[b]={errors:l,objects:d,indexes:e};a.processErrorsFromTask(b,k.errors,e);c()})});return c}.bind(this),[]),v.parallel(c,function(a){b(a)})):b()}});
t.exports=g},{"./cache":8,"./error":11,"./log":14,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28}],17:[function(k,t,q){function g(a){var c=this;this._opts=a?w.extend({},a):{};f.extendFromOpts(this,a,{methods:{},attributes:[],collection:function(a){f.isString(a)&&(a=n[a]);return a},id:"id",relationships:[],name:null,indexes:[],singleton:!1,statics:this.installStatics.bind(this),properties:{},init:null,remove:null});this.attributes=g._processAttributes(this.attributes);w.extend(this,
{_installed:!1,_relationshipsInstalled:!1,_reverseRelationshipsInstalled:!1,children:[]});Object.defineProperties(this,{_relationshipNames:{get:function(){return Object.keys(c.relationships)},enumerable:!0},_attributeNames:{get:function(){var a=[];c.id&&a.push(c.id);w.each(c.attributes,function(c){a.push(c.name)});return a},enumerable:!0,configurable:!0},installed:{get:function(){return c._installed&&c._relationshipsInstalled&&c._reverseRelationshipsInstalled},enumerable:!0,configurable:!0},descendants:{get:function(){return w.reduce(c.children,
function(a,c){return Array.prototype.concat.call(a,c.descendants)}.bind(c),w.extend([],c.children))},enumerable:!0},dirty:{get:function(){if(siesta.ext.storageEnabled)return!!Object.keys((siesta.ext.storage._unsavedObjectsByCollection[this.collectionName]||{})[this.name]||{}).length},enumerable:!0},collectionName:{get:function(){return this.collection.name},enumerable:!0}});l.ProxyEventEmitter.call(this,this.collectionName+":"+this.name)}q=k("./log");var n=k("./collectionRegistry").CollectionRegistry,
p=k("./error").InternalSiestaError,e=k("./RelationshipType"),h=k("./query"),d=k("./mappingOperation"),v=k("./modelInstance"),f=k("./util"),b=k("./cache");k("./store");var a=k("extend"),c=k("./modelEvents"),l=k("./events"),m=k("./events").wrapArray;k("./RelationshipProxy");var r=k("./OneToManyProxy"),y=k("./OneToOneProxy"),D=k("./manyToManyProxy"),z=k("./reactiveQuery"),x=k("./ArrangedReactiveQuery"),w=f._,A=f.guid,E=c.ModelEventType,B=q.loggerWithName("Model");w.extend(g,{_processAttributes:function(a){return w.reduce(a,
function(a,c){"string"==typeof c?a.push({name:c}):a.push(c);return a},[])}});g.prototype=Object.create(l.ProxyEventEmitter.prototype);w.extend(g.prototype,{installStatics:function(a){a&&w.each(Object.keys(a),function(c){this[c]?B.error('Static method with name "'+c+'" already exists. Ignoring it.'):this[c]=a[c].bind(this)}.bind(this));return a},installRelationships:function(){if(this._relationshipsInstalled)throw new p('Relationships for "'+this.name+'" have already been installed');this._relationships=
[];if(this._opts.relationships)for(var a in this._opts.relationships)if(this._opts.relationships.hasOwnProperty(a)){var c=this._opts.relationships[a];if(!c.isReverse){B.debug.isEnabled&&B.debug(this.name+": configuring relationship "+a,c);c.type||(c.type=this.singleton?e.OneToOne:e.OneToMany);if(this.singleton&&c.type==e.ManyToMany)return"Singleton model cannot use ManyToMany relationship.";if(c.type==e.OneToMany||c.type==e.OneToOne||c.type==e.ManyToMany){var b=c.model;delete c.model;var l;if(b instanceof
g)l=b;else{B.debug.isEnabled&&B.debug("reverseModelName",b);if(!this.collection)throw new p("Model must have collection");var m=this.collection;if(!m)throw new p("Collection "+this.collectionName+" not registered");l=m[b]}if(!l&&(m=b.split("."),2==m.length)){l=m[0];b=m[1];m=n[l];if(!m)return'Collection with name "'+l+'" does not exist.';l=m[b]}B.debug.isEnabled&&B.debug("reverseModel",l);if(l)c.reverseModel=l,c.forwardModel=this,c.forwardName=a,c.reverseName=c.reverse||"reverse_"+a,delete c.reverse,
c.isReverse=!1;else return'Model with name "'+b.toString()+'" does not exist'}else return"Relationship type "+c.type+" does not exist"}}this._relationshipsInstalled=!0;return null},installReverseRelationships:function(){if(this._reverseRelationshipsInstalled)throw new p('Reverse relationships for "'+this.name+'" have already been installed.');for(var c in this.relationships)if(this.relationships.hasOwnProperty(c)){var b=this.relationships[c],b=a(!0,{},b);b.isReverse=!0;var l=b.reverseModel,m=b.reverseName;
if(l.singleton){if(b.type==e.ManyToMany)return"Singleton model cannot be related via reverse ManyToMany";if(b.type==e.OneToMany)return"Singleton model cannot be related via reverse OneToMany"}B.debug.isEnabled&&B.debug(this.name+": configuring  reverse relationship "+m);l.relationships[m]=b}this._reverseRelationshipsInstalled=!0},_query:function(a){return a=new h(this,a||{})},query:function(a,c){if(this.singleton){var b=f.defer(c);c=b.finish.bind(b);this._query({__ignoreInstalled:!0}).execute(function(b,
l){b?c(b):(a=w.extend({},a),a.__ignoreInstalled=!0,l.length?this._query(a).execute(c):this.map({},function(b){b?c(b):this._query(a).execute(c)}.bind(this)))}.bind(this));return b.promise}return this._query(a).execute(c)},reactiveQuery:function(a){return new z(new h(this,a||{}))},arrangedReactiveQuery:function(a){return new x(new h(this,a||{}))},one:function(a,c){"function"==typeof a&&(c=a,a={});var b=f.defer(c);c=b.finish.bind(b);this.query(a,function(a,b){a?c(a):1<b.length?c("More than one instance returned when executing get query!"):
(b=b.length?b[0]:null,c(null,b))});return b.promise},all:function(a,c){"function"==typeof a&&(c=a,a={});a=a||{};return this.query(a,c)},install:function(a){B.info.isEnabled&&B.info("Installing mapping "+this.name);var c=f.defer(a);a=c.finish.bind(c);if(this._installed)throw new p('Model "'+this.name+'" has already been installed');this._installed=!0;a();return c.promise},map:function(a,c,b){"function"==typeof c&&(b=c);c=c||{};var l=f.defer(b);b=function(){var b=c.override;b&&(f.isArray(b)?c.objects=
b:c.objects=[b]);delete c.override;f.isArray(a)?this._mapBulk(a,c,l.finish.bind(l)):this._mapBulk([a],c,function(a,c){var b;c&&c.length&&(b=c[0]);l.finish(a?f.isArray(a)?a[0]:a:null,b)})}.bind(this);c._ignoreInstalled?b():siesta._afterInstall(b);return l.promise},_mapBulk:function(a,c,b){w.extend(c,{model:this,data:a});(new d(c)).start(function(a,c){a?b&&b(a):b(null,c||[])})},_countCache:function(){return w.reduce(Object.keys((b._localCacheByType[this.collectionName]||{})[this.name]||{}),function(a,
c){a[c]={};return a},{})},count:function(a){var c=f.defer(a);a=c.finish.bind(c);var b=this._countCache();a(null,Object.keys(b).length);return c.promise},_new:function(a,l){l=void 0===l?!0:l;if(this.installed){var d=this,g;g=a?a._id?a._id:A():A();var h=new v(this);B.info.isEnabled&&B.info('New object created _id="'+g.toString()+'", type='+this.name,a);h._id=g;g={};h.__values=g;var k=w.reduce(this.attributes,function(a,c){void 0!==c["default"]&&(a[c.name]=c["default"]);return a},{});w.extend(g,k);a&&
w.extend(g,a);g=this._attributeNames;k=g.indexOf(this.id);-1<k&&g.splice(k,1);w.each(g,function(a){Object.defineProperty(h,a,{get:function(){var c=h.__values[a];return void 0===c?null:c},set:function(b){var l=h.__values[a],r=this._propertyDependencies[a],r=w.map(r,function(a){return{prop:a,old:this[a]}}.bind(this));h.__values[a]=b;r.forEach(function(a){var b=a.prop;c.emit({collection:d.collectionName,model:d.name,_id:h._id,"new":this[b],old:a.old,type:E.Set,field:b,obj:h})}.bind(this));l={collection:d.collectionName,
model:d.name,_id:h._id,"new":b,old:l,type:E.Set,field:a,obj:h};window.lastEmission=l;c.emit(l);f.isArray(b)&&m(b,a,h)},enumerable:!0,configurable:!0})});w.each(Object.keys(this.methods),function(a){void 0===h[a]?h[a]=this.methods[a].bind(h):B.error('A method with name "'+a+'" already exists. Ignoring it.')}.bind(this));g=Object.keys(this.properties);var n={};w.each(g,function(a){var c=this.properties[a];(c.dependencies||[]).forEach(function(c){n[c]||(n[c]=[]);n[c].push(a)});delete c.dependencies;
void 0===h[a]?Object.defineProperty(h,a,c):B.error('A property/method with name "'+a+'" already exists. Ignoring it.')}.bind(this));h._propertyDependencies=n;Object.defineProperty(h,this.id,{get:function(){return h.__values[d.id]||null},set:function(a){var l=h[d.id];h.__values[d.id]=a;c.emit({collection:d.collectionName,model:d.name,_id:h._id,"new":a,old:l,type:E.Set,field:d.id,obj:h});b.remoteInsert(h,a,l)},enumerable:!0,configurable:!0});for(var q in this.relationships){var x;if(this.relationships.hasOwnProperty(q))if(x=
w.extend({},this.relationships[q]),g=x.type,delete x.type,g==e.OneToMany)x=new r(x);else if(g==e.OneToOne)x=new y(x);else if(g==e.ManyToMany)x=new D(x);else throw new p("No such relationship type: "+g);x.install(h)}b.insert(h);l&&c.emit({collection:this.collectionName,model:this.name,_id:h._id,"new":h,type:E.New,obj:h});return h}throw new p("Model must be fully installed before creating any models");},_dump:function(a){var c={};c.name=this.name;c.attributes=this.attributes;c.id=this.id;c.collection=
this.collectionName;c.relationships=w.map(this.relationships,function(a){return a.isForward?a.forwardName:a.reverseName});return a?f.prettyPrint(c):c},toString:function(){return"Model["+this.name+"]"}});w.extend(g.prototype,{child:function(a,c){"string"==typeof a?c.name=a:c=name;w.extend(c,{attributes:Array.prototype.concat.call(c.attributes||[],this._opts.attributes),relationships:w.extend(c.relationships||{},this._opts.relationships),methods:w.extend(w.extend({},this._opts.methods)||{},c.methods),
statics:w.extend(w.extend({},this._opts.statics)||{},c.statics),properties:w.extend(w.extend({},this._opts.properties)||{},c.properties),id:c.id||this._opts.id,init:c.init||this._opts.init,remove:c.remove||this._opts.remove});var b=this.collection.model(c.name,c);b.parent=this;this.children.push(b);return b},isChildOf:function(a){return this.parent==a},isParentOf:function(a){return-1<this.children.indexOf(a)},isDescendantOf:function(a){for(var c=this.parent;c;){if(c==a)return!0;c=c.parent}return!1},
isAncestorOf:function(a){return-1<this.descendants.indexOf(a)},hasAttributeNamed:function(a){return-1<this._attributeNames.indexOf(a)}});w.extend(g.prototype,{paginator:function(a){if(siesta.ext.httpEnabled){var c=siesta.ext.http.Paginator;a=a||{};a.model=this;return new c(a)}}});t.exports=g},{"./ArrangedReactiveQuery":1,"./OneToManyProxy":3,"./OneToOneProxy":4,"./RelationshipProxy":6,"./RelationshipType":7,"./cache":8,"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,"./manyToManyProxy":15,
"./mappingOperation":16,"./modelEvents":18,"./modelInstance":19,"./query":22,"./reactiveQuery":24,"./store":26,"./util":28,extend:42}],18:[function(k,t,q){function g(d){this._opts=d||{};Object.keys(d).forEach(function(b){this[b]=d[b]}.bind(this))}function n(d){if(!d.model)throw new e("Must pass a model");if(!d.collection)throw new e("Must pass a collection");if(!d._id)throw new e("Must pass a local identifier");if(!d.obj)throw new e("Must pass the object");}var p=k("./events"),e=k("./error").InternalSiestaError;
t=k("./log");var h=k("./util")._.extend,d=k("./collectionRegistry").CollectionRegistry,v=t.loggerWithName("ModelEvents");g.prototype._dump=function(d){var b={};b.collection="string"==typeof this.collection?this.collection:this.collection._dump();b.model="string"==typeof this.model?this.model:this.model.name;b._id=this._id;b.field=this.field;b.type=this.type;this.index&&(b.index=this.index);this.added&&(b.added=_.map(this.added,function(a){return a._dump()}));this.removed&&(b.removed=_.map(this.removed,
function(a){return a._dump()}));this.old&&(b.old=this.old);this["new"]&&(b["new"]=this["new"]);return d?util.prettyPrint(b):b};h(q,{ModelEvent:g,emit:function(f){n(f);var b=f.collection,a=f.model;f=new g(f);v.trace.isEnabled&&v.trace('Sending notification "'+b+'" of type '+f.type);p.emit(b,f);var c=b+":"+a;v.trace.isEnabled&&v.trace('Sending notification "'+c+'" of type '+f.type);p.emit(c,f);v.trace.isEnabled&&v.trace('Sending notification "Siesta" of type '+f.type);p.emit("Siesta",f);c=f._id;v.trace.isEnabled&&
v.trace('Sending notification "'+c+'" of type '+f.type);p.emit(c,f);c=d[b];if(!c)throw b='No such collection "'+b+'"',v.error(b,d),new e(b);c=c[a];if(!c)throw b='No such model "'+a+'"',v.error(b,d),new e(b);c.id&&f.obj[c.id]&&(b=b+":"+a+":"+f.obj[c.id],v.trace.isEnabled&&v.trace('Sending notification "'+b+'" of type '+f.type),p.emit(b,f));return f},validateEventOpts:n,ModelEventType:{Set:"Set",Splice:"Splice",New:"New",Remove:"Remove"}})},{"./collectionRegistry":10,"./error":11,"./events":12,"./log":14,
"./util":28}],19:[function(k,t,q){t.exports=k(2)},{"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./util":28,"/Users/mtford/Playground/rest/core/ModelInstance.js":2}],20:[function(k,t,q){t.exports=k(3)},{"../vendor/observe-js/src/observe":44,"./RelationshipProxy":6,"./error":11,"./events":12,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/OneToManyProxy.js":3}],21:[function(k,t,q){t.exports=k(4)},{"./RelationshipProxy":6,
"./error":11,"./modelEvents":18,"./modelInstance":19,"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/OneToOneProxy.js":4}],22:[function(k,t,q){t.exports=k(5)},{"./cache":8,"./error":11,"./log":14,"./querySet":23,"./util":28,"/Users/mtford/Playground/rest/core/Query.js":5}],23:[function(k,t,q){function g(a){return"string"==typeof a||a instanceof String?D.concat(z):"number"==typeof a||a instanceof Number?r.concat(y):a.getOwnPropertyNames()}function n(c,m){m in c||Object.defineProperty(c,
m,{get:function(){return d(l.pluck(c,m))},set:function(c){if(b.isArray(c)){if(this.length!=c.length)throw new a({message:"Must be same length"});for(var l=0;l<c.length;l++)this[l][m]=c[l]}else for(l=0;l<this.length;l++)this[l][m]=c}})}function p(a){return a.then&&a["catch"]}function e(a,c){c in a||(a[c]=function(){var a=arguments,b=this.map(function(b){return b[c].apply(b,a)}),l=!1;b.length&&(l=p(b[0]));return l?siesta.q.all(b):d(b)})}function h(a,b){a=l.extend([],a);b._attributeNames.concat(b._relationshipNames).concat(m).forEach(l.partial(n,
a));var m=Object.keys(c.prototype);m.forEach(l.partial(e,a));return f(a)}function d(a){if(a.length){var c=a[0];g(c).forEach(function(b){"function"==typeof c[b]?e(a,b,arguments):n(a,b)})}return f(a)}function v(){throw Error("Cannot modify a query set");}function f(a){m.forEach(function(c){a[c]=v});a.immutable=!0;a.mutableCopy=a.asArray=function(){var a=l.map(this,function(a){return a});a.asQuerySet=function(){return d(this)};a.asModelQuerySet=function(a){return h(this,a)};return a};return a}var b=
k("./util"),a=k("./error").SiestaUserError,c=k("./ModelInstance"),l=k("./util")._,m="push sort reverse splice shift unshift".split(" "),r=["toString","toExponential","toFixed","toPrecision","valueOf"],y=["MAX_VALUE","MIN_VALUE","NEGATIVE_INFINITY","NaN","POSITIVE_INFINITY"],D="charAt charCodeAt concat fromCharCode indexOf lastIndexOf localeCompare match replace search slice split substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim valueOf".split(" "),z=["length"];
t.exports=h},{"./ModelInstance":2,"./error":11,"./util":28}],24:[function(k,t,q){function g(a){var c=this;n.call(this);f.extend(this,{_query:a,results:d([],a.model),insertionPolicy:g.InsertionPolicy.Back,initialised:!1});Object.defineProperties(this,{initialized:{get:function(){return this.initialised}},model:{get:function(){return c._query.model}},collection:{get:function(){return c.model.collectionName}}})}q=k("./log");k("./query");var n=k("events").EventEmitter,p=k("./events"),e=k("./modelEvents"),
h=k("./error").InternalSiestaError,d=k("./querySet"),v=k("./util"),f=v._,b=q.loggerWithName("Query");g.prototype=Object.create(n.prototype);f.extend(g,{InsertionPolicy:{Front:"Front",Back:"Back"}});f.extend(g.prototype,{init:function(a){b.trace&&b.trace("init");var c=v.defer(a);a=c.finish.bind(c);this.initialised?a(null,this.results):this._query.execute(function(c,m){if(c)a(c);else{this.results=m;if(!this.handler){var d=this._constructNotificationName(),f=function(a){this._handleNotif(a)}.bind(this);
this.handler=f;p.on(d,f)}b.trace&&b.trace("Listening to "+d);this.initialised=!0;a(null,this.results)}}.bind(this));return c.promise},insert:function(a){var c=this.results.mutableCopy();a=this.insertionPolicy==g.InsertionPolicy.Back?c.push(a):c.unshift(a);this.results=c.asModelQuerySet(this.model);return a},_handleNotif:function(a){b.trace&&b.trace("_handleNotif",a);if(a.type==e.ModelEventType.New){var c=a["new"];if(this._query.objectMatchesQuery(c)){b.trace&&b.trace("New object matches",c._dumpString());
var l=this.insert(c);this.emit("change",this.results,{index:l,added:[c],type:e.ModelEventType.Splice,obj:this})}else b.trace&&b.trace("New object does not match",c._dumpString())}else if(a.type==e.ModelEventType.Set){var c=a.obj,l=this.results.indexOf(c),m=-1<l,r=this._query.objectMatchesQuery(c);r&&!m?(b.trace&&b.trace("Updated object now matches!",c._dumpString()),l=this.insert(c),this.emit("change",this.results,{index:l,added:[c],type:e.ModelEventType.Splice,obj:this})):!r&&m?(b.trace&&b.trace("Updated object no longer matches!",
c._dumpString()),m=this.results.mutableCopy(),a=m.splice(l,1),this.results=m.asModelQuerySet(this.model),this.emit("change",this.results,{index:l,obj:this,"new":c,type:e.ModelEventType.Splice,removed:a})):r||m?r&&m&&(b.trace&&b.trace("Matches but already contains",c._dumpString()),this.emit("change",this.results,a)):b.trace&&b.trace("Does not contain, but doesnt match so not inserting",c._dumpString())}else if(a.type==e.ModelEventType.Remove)c=a.obj,m=this.results.mutableCopy(),l=m.indexOf(c),-1<
l?(b.trace&&b.trace("Removing object",c._dumpString()),a=m.splice(l,1),this.results=d(m,this.model),this.emit("change",this.results,{index:l,obj:this,type:e.ModelEventType.Splice,removed:a})):b.trace&&b.trace("No modelEvents neccessary.",c._dumpString());else throw new h('Unknown change type "'+a.type.toString()+'"');this.results=d(this._query._sortResults(this.results),this.model)},_constructNotificationName:function(){return this.model.collectionName+":"+this.model.name},terminate:function(){this.handler&&
p.removeListener(this._constructNotificationName(),this.handler);this.handler=this.results=null},listen:function(a){this.on("change",a);return function(){this.removeListener("change",a)}.bind(this)},listenOnce:function(a){this.once("change",a)}});t.exports=g},{"./error":11,"./events":12,"./log":14,"./modelEvents":18,"./query":22,"./querySet":23,"./util":28,events:38}],25:[function(k,t,q){t.exports=k(6)},{"../vendor/observe-js/src/observe":44,"./cache":8,"./error":11,"./events":12,"./log":14,"./modelEvents":18,
"./query":22,"./store":26,"./util":28,"/Users/mtford/Playground/rest/core/RelationshipProxy.js":6}],26:[function(k,t,q){function g(f,b){var a=e.defer(b);b=a.finish.bind(a);v.debug.isEnabled&&v.debug("get",f);var c;if(f._id)if(e.isArray(f._id))n(h.map(f._id,function(a){return{_id:a}}),b);else if(c=d.get(f))v.debug.isEnabled&&v.debug("Had cached object",{opts:f,obj:c}),b&&b(null,c);else if(e.isArray(f._id))n(h.map(f._id,function(a){return{_id:a}}),b);else{if(b)if(c=siesta.ext.storage)c.store.getFromPouch(f,
b);else throw Error("Storage module not installed");}else if(f.model)if(e.isArray(f[f.model.id]))n(h.map(f[f.model.id],function(a){var c={};c[f.model.id]=a;c.model=f.model;return c}),b);else if(c=d.get(f))v.debug.isEnabled&&v.debug("Had cached object",{opts:f,obj:c}),b&&b(null,c);else if(c=f.model,c.singleton)c.one(b);else{var l=c.id,m=f[l],r={};if(r[l]=m)c.one(r,function(a,c){a?b(a):c?b(null,c):b(null,null)});else throw new p('Invalid options given to store. Missing "'+l.toString()+'."');}else throw new p("Invalid options given to store",
{opts:f});return a.promise}function n(d,b){var a=e.defer(b);b=a.finish.bind(a);var c=[],l=[];h.each(d,function(a){g(a,function(a,m){a?l.push(a):c.push(m);c.length+l.length==d.length&&b&&(l.length?b(l):b(null,c))})});return a.promise}var p=k("./error").InternalSiestaError;q=k("./log");var e=k("./util"),h=e._,d=k("./cache"),v=q.loggerWithName("Store");t.exports={get:g,getMultiple:n,getMultipleLocal:function(f,b){var a=e.defer(b);b=a.finish.bind(a);var c=h.reduce(f,function(a,c){var b=d.get({_id:c});
b?a.cached[c]=b:a.notCached.push(c);return a},{cached:{},notCached:[]});(function(a){b&&(a?b(a):b(null,h.map(f,function(a){return c.cached[a]})))})();return a.promise},getMultipleRemote:function(f,b,a){var c=e.defer(a);a=c.finish.bind(c);var l=h.reduce(f,function(a,c){var l={model:b};l[b.id]=c;(l=d.get(l))?a.cached[c]=l:a.notCached.push(c);return a},{cached:{},notCached:[]});(function(c){a&&(c?a(c):a(null,h.map(f,function(a){return l.cached[a]})))})();return c.promise}}},{"./cache":8,"./error":11,
"./log":14,"./util":28}],27:[function(k,t,q){function g(a,c){if(a.map)return a.map(c);var b=[];h(a,function(a,l,m){b.push(c(a,l,m))});return b}function n(a,c,b,l){c=g(c,function(a,c){return{index:c,value:a}});if(l){var d=[];a(c,function(a,c){b(a.value,function(b,l){d[a.index]=l;c(b)})},function(a){l(a,d)})}else a(c,function(a,c){b(a.value,function(a){c(a)})})}function p(a,c,b){b=b||function(){};if(!a.length)return b();var l=0,d=function(){c(a[l],function(c){c?(b(c),b=function(){}):(l+=1,l>=a.length?
b():d())})};d()}function e(a,c){if(a.forEach)return a.forEach(c);for(var b=0;b<a.length;b+=1)c(a[b],b,a)}function h(a,c,b){function l(c){c?(b(c),b=function(){}):(f+=1,f>=a.length&&b())}b=b||function(){};if(!a.length)return b();var f=0;e(a,function(a){c(a,d(l))})}function d(c){var b=!1;return function(){if(b)throw Error("Callback was already called.");b=!0;c.apply(a,arguments)}}var v=k("./misc"),f=k("./underscore"),b=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,
[h].concat(c))}}(n),a,c=function(a){return function(){var c=Array.prototype.slice.call(arguments);return a.apply(null,[p].concat(c))}}(n),l=function(a,c,b){b=b||function(){};if(v.isArray(c))a.map(c,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},b);else{var l={};a.each(Object.keys(c),function(a,b){c[a](function(c){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);l[a]=d;b(c)})},function(a){b(a,l)})}};t.exports=
{series:function(a,b){b=b||function(){};if(v.isArray(a))c(a,function(a,c){a&&a(function(a){var b=Array.prototype.slice.call(arguments,1);1>=b.length&&(b=b[0]);c.call(null,a,b)})},b);else{var l={};p(f.keys(a),function(c,b){a[c](function(a){var d=Array.prototype.slice.call(arguments,1);1>=d.length&&(d=d[0]);l[c]=d;b(a)})},function(a){b(a,l)})}},parallel:function(a,c){l({map:b,each:h},a,c)}}},{"./misc":29,"./underscore":30}],28:[function(k,t,q){q=k("./underscore");var g=k("./async");k=k("./misc");q.extend(t.exports,
{_:q,async:g});q.extend(t.exports,k)},{"./async":27,"./misc":29,"./underscore":30}],29:[function(k,t,q){var g=k("../../vendor/observe-js/src/observe").Platform,n=k("./underscore"),p=k("./../error").InternalSiestaError,e=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,h=/,/,d=/^\s*(_?)(.+?)\1\s*$/,v=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;k=function(a){return"[object Array]"===n.toString.call(a)};var f=Array.isArray||k,b=function(a){return"string"==typeof a||a instanceof String};n.extend(t.exports,{next:function(a){g.performMicrotaskCheckpoint();
setTimeout(a)},cb:function(a,c){return function(b){a&&a.apply(a,arguments);c&&(b?c.reject(b):c.resolve.apply(c,Array.prototype.slice.call(arguments,1)))}},guid:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),assert:function(a,c,b){if(!a)throw b=b||{},new p(c||"Assertion failed",b);},thenBy:function(){function a(a){a.thenBy=c;return a}function c(c){var b=this;return a(function(a,
d){return b(a,d)||c(a,d)})}return a}(),defer:function(a){var c;a=a||function(){};if(siesta.q){c=siesta.q.defer();var b=c.reject,d=c.resolve;n.extend(c,{reject:function(c){a(c);b.call(this,c)},resolve:function(c){a(null,c);d.call(this,c)},finish:function(c,f){a(c,f);c?b.call(this,c):d.call(this,f)}})}else c={promise:void 0,reject:function(c){a(c)},resolve:function(c){a(null,c)},finish:function(c,b){a(c,b)}};return c},defineSubProperty:function(a,c,b){return Object.defineProperty(this,a,{get:function(){return b?
c[b]:c[a]},set:function(d){b?c[b]=d:c[a]=d},enumerable:!0,configurable:!0})},defineSubPropertyNoSet:function(a,c,b){return Object.defineProperty(this,a,{get:function(){return b?c[b]:c[a]},enumerable:!0,configurable:!0})},subProperties:function(a,c,l){f(l)||(l=Array.prototype.slice.call(arguments,2));for(var d=0;d<l.length;d++)(function(l){var d={set:!1,name:l,property:l};b(l)||n.extend(d,l);l={get:function(){return c[d.property]},enumerable:!0,configurable:!0};d.set&&(l.set=function(a){c[d.property]=
a});Object.defineProperty(a,d.name,l)})(l[d])},capitaliseFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},extendFromOpts:function(a,c,b,d){if(void 0==d||d){var f=Object.keys(b);d=Object.keys(c).filter(function(a){return-1==f.indexOf(a)});if(d.length)throw Error("Unknown options: "+d.toString());}n.each(Object.keys(b),function(a){var d=b[a];"function"==typeof d&&(b[a]=d(c[a]),delete c[a])});n.extend(b,c);n.extend(a,b)},isString:b,isArray:f,prettyPrint:function(a){return JSON.stringify(a,
null,4)},flattenArray:function(a){return n.reduce(a,function(a,b){f(b)?a=a.concat(b):a.push(b);return a},[])},unflattenArray:function(a,c){for(var b=0,d=[],e=0;e<c.length;e++)if(f(c[e])){var h=[];d[e]=h;for(var g=0;g<c[e].length;g++)h.push(a[b]),b++}else d[e]=a[b],b++;return d},paramNames:function(a){var c=[];a.toString().replace(v,"").match(e)[1].split(h).forEach(function(a){a.replace(d,function(a,b,l){c.push(l)})});return c}})},{"../../vendor/observe-js/src/observe":44,"./../error":11,"./underscore":30}],
30:[function(k,t,q){var g={};k=Array.prototype;var n=k.forEach,p=k.map,e=k.reduce,h=Function.prototype.bind,d=k.slice,v={},f=function(){};g.keys=function(a){if(Object.keys)return Object.keys(a);var b=[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d);return b};g.each=g.forEach=function(a,b,d){if(null==a)return a;if(n&&a.forEach===n)a.forEach(b,d);else if(a.length===+a.length)for(var f=0,e=a.length;f<e;f++){if(b.call(d,a[f],f,a)===v)return}else for(var h=g.keys(a),f=0,e=h.length;f<e;f++)if(b.call(d,a[h[f]],
h[f],a)===v)return;return a};g.map=g.collect=function(a,b,d){var f=[];if(null==a)return f;if(p&&a.map===p)return a.map(b,d);g.each(a,function(a,c,e){f.push(b.call(d,a,c,e))});return f};var b=function(a,b,d){if(void 0===b)return a;switch(null==d?3:d){case 1:return function(d){return a.call(b,d)};case 2:return function(d,m){return a.call(b,d,m)};case 3:return function(d,m,f){return a.call(b,d,m,f)};case 4:return function(d,m,f,e){return a.call(b,d,m,f,e)}}return function(){return a.apply(b,arguments)}};
g.times=function(a,d,m){var f=Array(Math.max(0,a));d=b(d,m,1);for(m=0;m<a;m++)f[m]=d(m);return f};g.partial=function(a){var b=d.call(arguments,1);return function(){for(var d=0,f=b.slice(),e=0,h=f.length;e<h;e++)f[e]===g&&(f[e]=arguments[d++]);for(;d<arguments.length;)f.push(arguments[d++]);return a.apply(this,f)}};g.pluck=function(a,b){return g.map(a,g.property(b))};g.reduce=g.foldl=g.inject=function(a,b,d,f){var h=2<arguments.length;null==a&&(a=[]);if(e&&a.reduce===e)return f&&(b=g.bind(b,f)),h?
a.reduce(b,d):a.reduce(b);g.each(a,function(a,c,e){h?d=b.call(f,d,a,c,e):(d=a,h=!0)});if(!h)throw new TypeError("Reduce of empty array with no initial value");return d};g.property=function(a){return function(b){return b[a]}};"function"!==typeof/./&&(g.isFunction=function(a){return"function"===typeof a});g.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a};var a=function(a){return null==a?g.identity:g.isFunction(a)?a:g.property(a)};g.sortBy=function(c,b,d){b=a(b);return g.pluck(g.map(c,
function(a,c,f){return{value:a,index:c,criteria:b.call(d,a,c,f)}}).sort(function(a,c){var b=a.criteria,d=c.criteria;if(b!==d){if(b>d||void 0===b)return 1;if(b<d||void 0===d)return-1}return a.index-c.index}),"value")};g.bind=function(a,b){var m,e;if(h&&a.bind===h)return h.apply(a,d.call(arguments,1));if(!g.isFunction(a))throw new TypeError;m=d.call(arguments,2);return e=function(){if(!(this instanceof e))return a.apply(b,m.concat(d.call(arguments)));f.prototype=a.prototype;var h=new f;f.prototype=
null;u;var g=a.apply(h,m.concat(d.call(arguments)));return Object(g)===g?g:h}};g.identity=function(a){return a};g.zip=function(a){if(null==a)return[];for(var b=g.max(arguments,"length").length,d=Array(b),f=0;f<b;f++)d[f]=g.pluck(arguments,f);return d};g.max=function(a,b,d){var f=-Infinity,e=-Infinity,h;if(null==b&&null!=a){a=a.length===+a.length?a:g.values(a);for(var k=0,p=a.length;k<p;k++)d=a[k],d>f&&(f=d)}else b=g.iteratee(b,d),g.each(a,function(a,c,d){h=b(a,c,d);if(h>e||-Infinity===h&&-Infinity===
f)f=a,e=h});return f};g.iteratee=function(a,d,f){return null==a?g.identity:g.isFunction(a)?b(a,d,f):g.isObject(a)?g.matches(a):g.property(a)};g.pairs=function(a){for(var b=g.keys(a),d=b.length,f=Array(d),e=0;e<d;e++)f[e]=[b[e],a[b[e]]];return f};g.matches=function(a){var b=g.pairs(a),d=b.length;return function(a){if(null==a)return!d;a=Object(a);for(var c=0;c<d;c++){var f=b[c],e=f[0];if(f[1]!==a[e]||!(e in a))return!1}return!0}};g.some=function(a,b,d){if(null==a)return!1;b=g.iteratee(b,d);d=a.length!==
+a.length&&g.keys(a);var f=(d||a).length,e,h;for(e=0;e<f;e++)if(h=d?d[e]:e,b(a[h],h,a))return!0;return!1};g.extend=function(a){if(!g.isObject(a))return a;for(var b,d,f=1,e=arguments.length;f<e;f++)for(d in b=arguments[f],b)hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};t.exports=g},{}],31:[function(k,t,q){function g(a){a?"*"==a||-1<a.indexOf("*")?a=c:e.isArray(a)||(a=[a]):a=["GET"];return b.map(a,function(a){return a.toUpperCase()})}function n(a){if(!this)return new n(a);this._rawOpts=f(!0,{},a);
this._opts=a;var c=function(a){a instanceof RegExp||(a=new RegExp(a,"g"));return a}.bind(this);if(this._opts.path){var h=this._opts.path;e.isArray(h)||(h=[h]);this._opts.path=[];b.each(h,function(a){this._opts.path.push(c.call(this,a))}.bind(this))}else this._opts.path=[""];this._opts.method=g(this._opts.method);if(this._opts.model){if("string"==typeof this._opts.model)if(this._opts.collection)if(h="string"==typeof this._opts.collection?v[this._opts.collection]:this._opts.collection)if(h=h[this._opts.model])this._opts.model=
h;else throw Error("Model "+this._opts.model+" does not exist",{opts:a,descriptor:this});else throw Error("Collection "+this._opts.collection+" does not exist",{opts:a,descriptor:this});else throw Error("Passed model as string, but did not specify the collection it belongs to",{opts:a,descriptor:this});}else throw Error("Descriptors must be initialised with a model",{opts:a,descriptor:this});if((a=this._opts.data)&&a.length){h=a.split(".");if(1==h.length)a=h[0];else{var k={};a=k;for(var p=h[0],q=
1;q<h.length;q++){var t=h[q];if(q==h.length-1)k[p]=t;else var w={},k=k[p]=w,p=t}}this._opts.data=a}d.call(this,"path",this._opts);d.call(this,"method",this._opts);d.call(this,"model",this._opts);d.call(this,"data",this._opts);d.call(this,"transforms",this._opts)}k=siesta._internal;var p=k.error.InternalSiestaError,e=k.util,h=e.assert,d=e.defineSubProperty,v=k.CollectionRegistry,f=k.extend,b=e._,a=k.log.loggerWithName("Descriptor"),c="POST PATCH PUT HEAD GET DELETE OPTIONS TRACE CONNECT".split(" ");
b.extend(n.prototype,{httpMethods:c,_matchPath:function(c){var b;for(b=0;b<this._opts.path.length;b++){var d=this._opts.path[b];a.trace.isEnabled&&a.trace("Matching path",c,d.toString());var f=d.exec(c);a.trace.isEnabled&&(f?a.trace("Matched path successfully",c,d.toString()):a.trace("Failed to match path",c,d.toString()));if(f)return!0}return!1},_matchMethod:function(a){for(var c=0;c<this.method.length;c++)if(a.toUpperCase()==this.method[c])return!0;return!1},bury:function(a,c){var b=Object.keys(c);
h(1==b.length);for(var b=b[0],d=c;"string"!=typeof d[b];)d=d[b],b=Object.keys(d),h(1==b.length),b=b[0];var f=d[b],e={};d[b]=e;e[f]=a;return c},_embedData:function(a){if(this.data){var b;"string"==typeof this.data?(b={},b[this.data]=a):b=this.bury(a,f(!0,{},this.data));return b}return a},_extractData:function(b){a.debug.isEnabled&&a.debug("_extractData",b);if(this.data){if("string"==typeof this.data)return b[this.data];var c=Object.keys(this.data);h(1==c.length);for(var d=this.data;"string"!=typeof d&&
(c=Object.keys(d),h(1==c.length),c=c[0],d=d[c],b=b[c],b););return b?b[d]:null}return b},_matchConfig:function(a){var b=a.type?this._matchMethod(a.type):{};b&&(b=a.url?this._matchPath(a.url):{});return b},_matchData:function(a){var b=null;this.data?a&&(b=this._extractData(a)):b=a;return b},match:function(a,b){var c=!1;this._matchConfig(a)&&(c=this._matchData(b));return c},_transformData:function(a){var b=this.transforms;if("function"==typeof b)a=b(a);else for(var c in b)if(b.hasOwnProperty(c)&&a[c]){var d=
b[c],f=a[c];if("string"==typeof d)if(d=d.split("."),delete a[c],1==d.length)a[d[0]]=f;else{a[d[0]]={};for(var h=a[d[0]],g=1;g<d.length-1;g++){var k=d[g];h[k]={};h=h[k]}h[d[d.length-1]]=f}else if("function"==typeof d)f=d(f),e.isArray(f)?(delete a[c],a[f[0]]=f[1]):a[c]=f;else throw new p("Invalid transformer");}return a}});q.Descriptor=n;q.resolveMethod=g},{}],32:[function(k,t,q){function g(){if(!this)return new g(opts);this.requestDescriptors={};this.responseDescriptors={}}function n(e,d){var g=d.model.collectionName;
e[g]||(e[g]=[]);e[g].push(d)}function p(e,d){return"string"==typeof d?e[d]||[]:e[d.name]||[]}k=siesta._internal;t=k.util._;var e=k.log.loggerWithName("Descriptor");t.extend(g.prototype,{registerRequestDescriptor:function(e){n(this.requestDescriptors,e)},registerResponseDescriptor:function(h){e.trace.isEnabled&&e.trace("registerResponseDescriptor");n(this.responseDescriptors,h)},requestDescriptorsForCollection:function(e){return p(this.requestDescriptors,e)},responseDescriptorsForCollection:function(h){h=
p(this.responseDescriptors,h);h.length||e.debug.isEnabled&&e.debug("No response descriptors for collection ",this.responseDescriptors);return h},reset:function(){this.requestDescriptors={};this.responseDescriptors={}}});q.DescriptorRegistry=new g},{}],33:[function(k,t,q){function g(a,b,c){if(C.debug.isEnabled){var d=C.debug;a=a.type+" "+b.status+" "+a.url;C.trace.isEnabled&&c&&(d=C.trace,a+=": "+z.prettyPrint(c));d(a)}}function n(a){if(C.debug.isEnabled){var b=C.debug;a=a.type+" "+a.url;C.trace.isEnabled&&
(b=C.trace);b(a)}}function p(a,b,c,d){var f=this,e=Array.prototype.slice.call(arguments,2),h={},l=this.name;"function"==typeof e[0]?d=e[0]:"object"==typeof e[0]&&(h=e[0],d=e[1]);e=z.defer();h.type=a;h.url||(h.url=this.baseURL+b);void 0===h.parseResponse&&(h.parseResponse=!0);h.success=function(a,b,c){g(h,c,a);var e={data:a,status:b,xhr:c};if(h.parseResponse){b=B.responseDescriptorsForCollection(f);var k,m;for(c=0;c<b.length;c++){var p=b[c];if(m=p.match(h,a)){k=p;break}}if(k)C.trace.isEnabled&&C.trace("Model _constructSubOperation data: "+
z.prettyPrint(m)),"object"==typeof m?k.model.map(m,{override:h.obj},function(a,b){d&&d(a,b,e)}):d(null,!0,e);else if(d)if(l)a={},k=x.ErrorCode.NoDescriptorMatched,a[x.ErrorField.Code]=k,a[x.ErrorField.Message]=x.Message[k],d(a,null,e);else throw new E("Unnamed collection");}else d(null,null,e)};h.error=function(a,b,c){a={xhr:a,status:b,error:c};d&&d(a,null,a)};n(h);siesta.ext.http.ajax(h);return e.promise}function e(a,b,c){this._serialise(b,function(b,d){var f=d;a.fields&&(f={},w.each(a.fields,function(a){f[a]=
d[a]}));c(b,f)})}function h(a,b,c){var d=this,f=Array.prototype.slice.call(arguments,3),h,g={};"function"==typeof f[0]?h=f[0]:"object"==typeof f[0]&&(g=f[0],h=f[1]);var l=z.defer(h);h=l.finish.bind(l);var f=Array.prototype.slice.call(f,2),k=B.requestDescriptorsForCollection(this),m;g.type=a;g.url=this.baseURL+b;for(var n=0;n<k.length;n++){var v=k[n];if(v._matchConfig(g)){m=v;break}}m?(C.trace.isEnabled&&C.trace("Matched descriptor: "+m._dump(!0)),e.call(m,c,g,function(e,l){C.trace.isEnabled&&C.trace("_serialise",
{err:e,data:l});e?h&&h(e,null,null):(g.data=l,g.obj=c,w.partial(p,a,b,g,h).apply(d,f))})):h&&(C.trace.isEnabled&&C.trace("Did not match descriptor"),h("No descriptor matched",null,null));return l.promise}function d(a,b){var c=Array.prototype.slice.call(arguments,2),d={},f;"function"==typeof c[0]?f=c[0]:"object"==typeof c[0]&&(d=c[0],f=c[1]);var e=z.defer(f),h=d.deletionMode||"restore";void 0===d.parseResponse&&(d.parseResponse=!1);p.call(this,"DELETE",a,d,function(a,c,d,g){a?"restore"==h&&b.restore():
"success"==h&&b.remove();f(a,c,d,g);e.finish(a,{x:c,y:d,z:g})});"now"!=h&&"restore"!=h||b.remove();return e.promise}function v(a,b){var c=Array.prototype.slice.call(arguments,2);return w.partial(a?h:p,b).apply(this,c)}function f(){return w.partial(v,!1,"GET").apply(this,arguments)}function b(){return w.partial(v,!1,"OPTIONS").apply(this,arguments)}function a(){return w.partial(v,!1,"TRACE").apply(this,arguments)}function c(){return w.partial(v,!1,"HEAD").apply(this,arguments)}function l(){return w.partial(v,
!0,"POST").apply(this,arguments)}function m(){return w.partial(v,!0,"PUT").apply(this,arguments)}function r(){return w.partial(v,!0,"PATCH").apply(this,arguments)}if("undefined"==typeof siesta&&"undefined"==typeof t)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var y=siesta._internal;q=y.Collection;var D=y.log,z=y.util,x=y.error,w=z._,A=k("./descriptor"),E=y.error.InternalSiestaError,B=k("./descriptorRegistry").DescriptorRegistry,C=D.loggerWithName("HTTP");
k={RequestDescriptor:k("./requestDescriptor").RequestDescriptor,ResponseDescriptor:k("./responseDescriptor").ResponseDescriptor,Descriptor:A.Descriptor,_resolveMethod:A.resolveMethod,Serialiser:k("./serialiser"),DescriptorRegistry:k("./descriptorRegistry").DescriptorRegistry,_httpResponse:p,_httpRequest:h,DELETE:d,HTTP_METHOD:v,GET:f,TRACE:a,OPTIONS:b,HEAD:c,POST:l,PUT:m,PATCH:r,_serialiseObject:e,Paginator:k("./paginator")};Object.defineProperty(k,"ajax",{get:function(){var a=H||($?$.ajax:null)||
(jQuery?jQuery.ajax:null);if(!a)throw new E("ajax has not been defined and could not find $.ajax or jQuery.ajax");return a},set:function(a){H=a}});w.extend(q.prototype,{DELETE:d,GET:f,TRACE:a,OPTIONS:b,HEAD:c,POST:l,PUT:m,PATCH:r});siesta.ext||(siesta.ext={});siesta.ext.http=k;Object.defineProperties(siesta.ext,{httpEnabled:{get:function(){return void 0!==siesta.ext._httpEnabled?siesta.ext._httpEnabled:!!siesta.ext.http},set:function(a){siesta.ext._httpEnabled=a},enumerable:!0}});var H;q={};w.extend(siesta,
{setAjax:function(a){H=a},getAjax:function(){return siesta.ext.http.ajax},serialisers:q,serializers:q});Object.defineProperties(q,{id:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.idSerialiser:null}},depth:{get:function(){return siesta.ext.httpEnabled?siesta.ext.http.Serialiser.depthSerializer:null}}});"undefined"!=typeof t&&(t.exports=k)},{"./descriptor":31,"./descriptorRegistry":32,"./paginator":34,"./requestDescriptor":35,"./responseDescriptor":36,"./serialiser":37}],
34:[function(k,t,q){function g(d){this.opts={};p.extendFromOpts(this.opts,d,{path:"/",model:null,page:"page",queryParams:!0,pageSize:"pageSize",numPages:"numPages",dataPath:"data",count:"count",type:"GET",dataType:"json"},!1);e.extend(this,{numPages:null,count:null});this.validate()}q=siesta._internal;var n=q.error.InternalSiestaError,p=q.util,e=p._,h=k("querystring");e.extend(g.prototype,{_extract:function(d,e,f){if(d)if("function"==typeof d)e=d(e,f);else for(d=d.split("."),f=0;f<d.length;f++)e=
e[d[f]];return e},_extractData:function(d,e){return this._extract(this.opts.dataPath,d,e)},_extractNumPages:function(d,e){return this._extract(this.opts.numPages,d,e)},_extractCount:function(d,e){return this._extract(this.opts.count,d,e)},_parseURL:function(d){var e=document.createElement("a");e.href=d;return e},page:function(d,g){var f=this,b={};"function"==typeof d?g=d:d&&(b=d);var a=p.defer(g),c=b.page,b=b.pageSize;g=a.finish.bind(a);var l=siesta.ext.http.ajax,k=e.extend({},this.opts),n=this.opts.model.collection.baseURL+
this.opts.path;if(this.opts.queryParams){var n=this._parseURL(n),q=n.search,t=q.split("?");1<t.length&&(q=t[1]);q=h.parse(q);c&&(q[this.opts.page]=c);b&&(q[this.opts.pageSize]=b);Object.keys(q).length&&(n.search="?"+h.stringify(q));n=n.href}else q={},c&&(q[this.opts.page]=c),b&&(q[this.opts.pageSize]=b),k.data=q;e.extend(k,{url:n,success:function(a,b,c){var d=f._extractData(a,c),e=f._extractCount(a,c),h=f._extractNumPages(a,c);f.opts.model.map(d,function(d,l){d?g(d):(f.count=e,f.numPages=h,g(null,
l,{data:a,textStatus:b,jqXHR:c}))})},fail:g});l(k);return a.promise},validate:function(){if(!this.opts.model)throw new n("Paginator must have a model");}});t.exports=g},{querystring:41}],35:[function(k,t,q){function g(d){if(!this)return new g(d);n.call(this,d);this._opts.serializer&&(this._opts.serialiser=this._opts.serializer);this._opts.serialiser||(this._opts.serialiser=p.depthSerializer(0));h.call(this,"serialiser",this._opts);h.call(this,"serializer",this._opts,"serialiser")}var n=k("./descriptor").Descriptor,
p=k("./serialiser");k=siesta._internal;var e=k.util;t=e._;var h=e.defineSubProperty,d=k.log.loggerWithName("Descriptor");g.prototype=Object.create(n.prototype);t.extend(g.prototype,{_serialise:function(h,f){var b=e.defer(f);f=b.finish.bind(b);var a=this;d.trace.isEnabled&&d.trace("_serialise");var c,g=this.serialiser(h,function(b,d){c||(d=a._transformData(d),f&&f(b,a._embedData(d)))});void 0!==g?(d.trace.isEnabled&&d.trace("serialiser doesnt use a callback"),c=!0,g=a._transformData(g),f&&f(null,a._embedData(g))):
d.trace.isEnabled&&d.trace("serialiser uses a callback",this.serialiser);return b.promise},_dump:function(d){var f={};f.methods=this.method;f.model=this.model.name;f.path=this._rawOpts.path;f.serialiser="function"==typeof this._rawOpts.serialiser?"function () { ... }":this._rawOpts.serialiser;var b={},a;for(a in this.transforms)this.transforms.hasOwnProperty(a)&&(b[a]="function"==typeof this.transforms[a]?"function () { ... }":this.transforms[a]);f.transforms=b;return d?e.prettyPrint(f):f}});q.RequestDescriptor=
g},{"./descriptor":31,"./serialiser":37}],36:[function(k,t,q){function g(k){if(!this)return new g(k);n.call(this,k)}var n=k("./descriptor").Descriptor;k=siesta._internal.util._;g.prototype=Object.create(n.prototype);k.extend(g.prototype,{_extractData:function(g){(g=n.prototype._extractData.call(this,g))&&(g=this._transformData(g));return g},_matchData:function(g){(g=n.prototype._matchData.call(this,g))&&(g=this._transformData(g));return g},_dump:function(g){var e={};e.methods=this.method;e.model=
this.model.name;e.path=this._rawOpts.path;var h={},d;for(d in this.transforms)this.transforms.hasOwnProperty(d)&&(h[d]="function"==typeof this.transforms[d]?"function () { ... }":this.transforms[d]);e.transforms=h;return g?util.prettyPrint(e):e}});q.ResponseDescriptor=g},{"./descriptor":31}],37:[function(k,t,q){function g(e){var d=e.model.id;if(d)return e[d]?e[d]:null;p.debug.isEnabled&&p.debug("No idfield")}function n(h,d,g){g=g||function(){};p.trace.isEnabled&&p.trace("depthSerialiser");var f={};
e.each(d._attributeNames,function(a){p.trace.isEnabled&&p.trace("field",a);d[a]&&(f[a]=d[a])});var b=[],a=[],c={},l=[];e.each(d._relationshipNames,function(e){p.trace.isEnabled&&p.trace("relationshipField",e);var k=d.__proxies[e];k.isForward&&(p.debug.isEnabled&&p.debug(e),b.push(e),k.get(function(k,q){p.trace.isEnabled&&p.trace("proxy.get",e);p.debug.isEnabled&&p.debug(e,q);k?(a.push(k),l.push(e),c[e]={err:k,v:q}):q?h?n(h-1,q,function(d,h,k){d?a.push(d):f[e]=h;l.push(e);c[e]={err:d,v:q,resp:k};b.length==
l.length&&g&&g(a.length?a:null,f,c)}):(l.push(e),f[e]=q[d.__proxies[e].forwardModel.id],c[e]={err:k,v:q},b.length==l.length&&g&&g(a.length?a:null,f,c)):(p.debug.isEnabled&&p.debug("no value for "+e),l.push(e),c[e]={err:k,v:q},b.length==l.length&&g&&g(a.length?a:null,f,c))}))});b.length||g(null,f,{})}k=siesta._internal;t=k.util;var p=k.log.loggerWithName("Serialisation"),e=t._;q.depthSerialiser=function(h){return e.partial(n,h)};q.depthSerializer=function(h){return e.partial(n,h)};q.idSerializer=g;
q.idSerialiser=g},{}],38:[function(k,t,q){function g(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function n(e){return"function"===typeof e}function p(e){return"object"===typeof e&&null!==e}t.exports=g;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._maxListeners=void 0;g.defaultMaxListeners=10;g.prototype.setMaxListeners=function(e){if("number"!==typeof e||0>e||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};g.prototype.emit=
function(e){var h,d,g,f;this._events||(this._events={});if("error"===e&&(!this._events.error||p(this._events.error)&&!this._events.error.length)){h=arguments[1];if(h instanceof Error)throw h;throw TypeError('Uncaught, unspecified "error" event.');}d=this._events[e];if(void 0===d)return!1;if(n(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:h=arguments.length;g=Array(h-1);for(f=1;f<h;f++)g[f-1]=
arguments[f];d.apply(this,g)}else if(p(d)){h=arguments.length;g=Array(h-1);for(f=1;f<h;f++)g[f-1]=arguments[f];d=d.slice();h=d.length;for(f=0;f<h;f++)d[f].apply(this,g)}return!0};g.prototype.addListener=function(e,h){var d;if(!n(h))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",e,n(h.listener)?h.listener:h);this._events[e]?p(this._events[e])?this._events[e].push(h):this._events[e]=[this._events[e],h]:this._events[e]=
h;p(this._events[e])&&!this._events[e].warned&&(d=void 0!==this._maxListeners?this._maxListeners:g.defaultMaxListeners)&&0<d&&this._events[e].length>d&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===typeof console.trace&&console.trace());return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(e,h){function d(){this.removeListener(e,
d);g||(g=!0,h.apply(this,arguments))}if(!n(h))throw TypeError("listener must be a function");var g=!1;d.listener=h;this.on(e,d);return this};g.prototype.removeListener=function(e,h){var d,g,f;if(!n(h))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;d=this._events[e];f=d.length;g=-1;if(d===h||n(d.listener)&&d.listener===h)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,h);else if(p(d)){for(;0<f--;)if(d[f]===h||d[f].listener&&
d[f].listener===h){g=f;break}if(0>g)return this;1===d.length?(d.length=0,delete this._events[e]):d.splice(g,1);this._events.removeListener&&this.emit("removeListener",e,h)}return this};g.prototype.removeAllListeners=function(e){var h;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(h in this._events)"removeListener"!==h&&this.removeAllListeners(h);this.removeAllListeners("removeListener");
this._events={};return this}h=this._events[e];if(n(h))this.removeListener(e,h);else for(;h.length;)this.removeListener(e,h[h.length-1]);delete this._events[e];return this};g.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]};g.listenerCount=function(e,h){return e._events&&e._events[h]?n(e._events[h])?1:e._events[h].length:0}},{}],39:[function(k,t,q){t.exports=function(k,p,e,h){e=e||"=";var d={};if("string"!==typeof k||
0===k.length)return d;var q=/\+/g;k=k.split(p||"&");p=1E3;h&&"number"===typeof h.maxKeys&&(p=h.maxKeys);h=k.length;0<p&&h>p&&(h=p);for(p=0;p<h;++p){var f=k[p].replace(q,"%20"),b=f.indexOf(e),a;0<=b?(a=f.substr(0,b),f=f.substr(b+1)):(a=f,f="");a=decodeURIComponent(a);f=decodeURIComponent(f);Object.prototype.hasOwnProperty.call(d,a)?g(d[a])?d[a].push(f):d[a]=[d[a],f]:d[a]=f}return d};var g=Array.isArray||function(g){return"[object Array]"===Object.prototype.toString.call(g)}},{}],40:[function(k,t,q){function g(e,
d){if(e.map)return e.map(d);for(var g=[],f=0;f<e.length;f++)g.push(d(e[f],f));return g}var n=function(e){switch(typeof e){case "string":return e;case "boolean":return e?"true":"false";case "number":return isFinite(e)?e:"";default:return""}};t.exports=function(h,d,k,f){d=d||"&";k=k||"=";null===h&&(h=void 0);return"object"===typeof h?g(e(h),function(b){var a=encodeURIComponent(n(b))+k;return p(h[b])?g(h[b],function(b){return a+encodeURIComponent(n(b))}).join(d):a+encodeURIComponent(n(h[b]))}).join(d):
f?encodeURIComponent(n(f))+k+encodeURIComponent(n(h)):""};var p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},e=Object.keys||function(e){var d=[],g;for(g in e)Object.prototype.hasOwnProperty.call(e,g)&&d.push(g);return d}},{}],41:[function(k,t,q){q.decode=q.parse=k("./decode");q.encode=q.stringify=k("./encode")},{"./decode":39,"./encode":40}],42:[function(k,t,q){var g=Object.prototype.hasOwnProperty,n=Object.prototype.toString,p=function(e){if(!e||"[object Object]"!==
n.call(e)||e.nodeType||e.setInterval)return!1;var h=g.call(e,"constructor"),d=e.constructor&&e.constructor.prototype&&g.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!h&&!d)return!1;for(var k in e);return void 0===k||g.call(e,k)};t.exports=function h(){var d,g,f,b,a,c=arguments[0],k=1,m=arguments.length,n=!1;if("boolean"===typeof c)n=c,c=arguments[1]||{},k=2;else if("object"!==typeof c&&"function"!==typeof c||void 0==c)c={};for(;k<m;++k)if(null!=(d=arguments[k]))for(g in d)f=c[g],
b=d[g],c!==b&&(n&&b&&(p(b)||(a=Array.isArray(b)))?(a?(a=!1,f=f&&Array.isArray(f)?f:[]):f=f&&p(f)?f:{},c[g]=h(n,f,b)):void 0!==b&&(c[g]=b));return c}},{}],43:[function(k,t,q){if("undefined"==typeof siesta&&"undefined"==typeof t)throw Error("Could not find window.siesta. Make sure you include siesta.core.js first.");var g=siesta._internal,n=g.CollectionRegistry,p=g.util,e=p._,h=g.events,d=[],v={},f={};k={};var b=g.log.loggerWithName("Storage");if("undefined"==typeof PouchDB)siesta.ext.storageEnabled=
!1,console.log("PouchDB is not present therefore storage is disabled.");else{q=function(c){var g=p.defer(c);siesta._afterInstall(function(){c=c||function(){};var h=d;d=[];v={};f={};b.trace&&b.trace("Saving objects",e.map(h,function(a){return a._dump()}));a(h,c,g)});return g.promise};var a=function(a,d,f){var g=[];y.bulkDocs(e.map(a,r)).then(function(e){for(var h=0;h<e.length;h++){var k=e[h],l=a[h];k.ok?l._rev=k.rev:409==k.status?g.push(l):b.error('Error saving object with _id="'+l._id+'"',k)}g.length?
c(g,d,f):(d(),f&&f.resolve())},function(a){d(a);f&&f.reject(a)})},c=function(b,c,d){y.allDocs({keys:e.pluck(b,"_id")}).then(function(e){for(var f=0;f<e.rows.length;f++)b[f]._rev=e.rows[f].value.rev;a(b,c,d)})["catch"](function(a){d.reject(a)})},l=function(a,c){var d=a.collectionName,e=a.modelName;if(b.trace){var f=d+"."+e;b.trace("Loading instances for "+f)}var g=n[d][e],d=function(a){"$1"==a.model&&"$2"==a.collection&&emit(a._id,a)}.toString().replace("$1",e).replace("$2",d);b.trace.isEnabled&&b.trace("Querying pouch");
y.query({map:d}).then(function(a){b.trace.isEnabled&&b.trace("Queried pouch succesffully");a=siesta._.map(siesta._.pluck(a.rows,"value"),function(a){return m(a,g)});b.trace.isEnabled&&b.trace("Mapping data",a);g.map(a,{disableevents:!0,_ignoreInstalled:!0,callInit:!1},function(a,d){a?b.error("Error loading models",a):b.trace.isEnabled&&b.trace("Loaded "+d?d.length.toString():"0 instances for "+f);c(a,d)})})["catch"](function(a){c(a)})},m=function(a,b){delete a.collection;delete a.model;e.each(b._relationshipNames,
function(b){var c=a[b];siesta.isArray(c)?a[b]=e.map(c,function(a){return{_id:a}}):a[b]={_id:c}});return a},r=function(a){var b=siesta._.extend({},a.__values);b.collection=a.collectionName;b.model=a.modelName;b._id=a._id;a.removed&&(b._deleted=!0);var c=a._rev;c&&(b._rev=c);return b=e.reduce(a._relationshipNames,function(b,c){var d=a[c];siesta.isArray(d)?b[c]=e.pluck(d,"_id"):d&&(b[c]=d._id);return b},b)},y=new PouchDB("siesta"),D=function(a){a=a.obj;var b=a._id;if(!a)throw new g.error.InternalSiestaError("No obj field in notification received by storage extension");
if(!(b in v)){v[b]=a;d.push(a);var c=a.collectionName;f[c]||(f[c]={});var e=a.model.name;f[c][e]||(f[c][e]={});f[c][e][b]=a}};siesta.on("Siesta",D);e.extend(k,{_load:function(a){if(x)throw Error("not loaded yet how can i save");var c=p.defer(a);if(siesta.ext.storageEnabled){var d=[];e.each(n.collectionNames,function(a){var b=Object.keys(n[a]._models);e.each(b,function(b){d.push(function(c){l({collectionName:a,modelName:b},c)})})});siesta.async.parallel(d,function(a,d){if(!a){var e=[];siesta._.each(d,
function(a){e.concat(a)});b.trace&&b.trace("Loaded "+e.length.toString()+" instances")}c.finish(a)})}else c.finish();return c.promise},save:q,_serialise:r,_reset:function(a){siesta.removeListener("Siesta",D);d=[];v={};y.destroy(function(c){c||(y=new PouchDB("siesta"));siesta.on("Siesta",D);b.warn("Reset complete");a(c)})}});Object.defineProperties(k,{_unsavedObjects:{get:function(){return d}},_unsavedObjectsHash:{get:function(){return v}},_unsavedObjectsByCollection:{get:function(){return f}},_pouch:{get:function(){return y}}});
siesta.ext||(siesta.ext={});siesta.ext.storage=k;Object.defineProperties(siesta.ext,{storageEnabled:{get:function(){return void 0!==siesta.ext._storageEnabled?siesta.ext._storageEnabled:!!siesta.ext.storage},set:function(a){siesta.ext._storageEnabled=a},enumerable:!0}});var z,x,w=1E3;Object.defineProperties(siesta,{autosave:{get:function(){return!!z},set:function(a){a?z||(z=setInterval(function(){x||(x=!0,siesta.save(function(a){a||h.emit("saved");x=!1}))},siesta.autosaveInterval)):z&&(clearInterval(z),
z=null)}},autosaveInterval:{get:function(){return w},set:function(a){w=a;z&&(siesta.autosave=!1,siesta.autosave=!0)}},dirty:{get:function(){return!!Object.keys(siesta.ext.storage._unsavedObjectsByCollection).length},enumerable:!0}});e.extend(siesta,{save:q,setPouch:function(a){if(siesta._canChange)y=a;else throw Error("Cannot change PouchDB instance when an object graph exists.");}})}t.exports=k},{}],44:[function(k,t,q){(function(g){(function(g){function k(a){for(var b=0;1E3>b&&a.check_();)b++;x&&
(g.dirtyCheckCycleCount=b);return 0<b}function e(a){for(var b in a)return!1;return!0}function h(a){return e(a.added)&&e(a.removed)&&e(a.changed)}function d(a,b){var c={},d={},e={},f;for(f in b){var g=a[f];if(void 0===g||g!==b[f])f in a?g!==b[f]&&(e[f]=g):d[f]=void 0}for(f in a)f in b||(c[f]=a[f]);Array.isArray(a)&&a.length!==b.length&&(e.length=a.length);return{added:c,removed:d,changed:e}}function v(){if(!B.length)return!1;for(var a=0;a<B.length;a++)B[a]();B.length=0;return!0}function f(){function a(c){b&&
b.state_===F&&!d&&b.check_(c)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.deliverChangeRecords(a);b=c;e=!1},observe:function(b,d){c=b;d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b;Object.deliverChangeRecords(a);d=!1},close:function(){b=void 0;Object.unobserve(c,a);H.push(this)}}}function b(){this.state_=L;this.value_=this.directObserver_=this.target_=this.callback_=void 0;this.id_=M++}function a(a){b.call(this);this.value_=a;this.oldObject_=
void 0}function c(b){if(!Array.isArray(b))throw Error("Provided object is not an Array");a.call(this,b)}function l(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];O[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"==g.type?g.name in e?delete e[g.name]:d[g.name]=!0:g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(h in e)e[h]=void 0;b={};for(h in c)h in d||h in
e||(f=a[h],c[h]!==f&&(b[h]=f));return{added:d,removed:e,changed:b}}function m(a,b,c){return{index:a,removed:b,addedCount:c}}function r(){}function y(a,b,c,d){b=m(b,c,d);d=!1;for(var e=0,f=0;f<a.length;f++){var g=a[f];g.index+=e;if(!d){c=b.index;var h=b.index+b.removed.length,k=g.index,l=g.index+g.addedCount;c=h<k||l<c?-1:h==k||l==c?0:c<k?h<l?h-k:l-k:l<h?l-c:h-c;0<=c?(a.splice(f,1),f--,e-=g.addedCount-g.removed.length,b.addedCount+=g.addedCount-c,c=b.removed.length+g.removed.length-c,b.addedCount||
c?(c=g.removed,b.index<g.index&&(h=b.removed.slice(0,g.index-b.index),Array.prototype.push.apply(h,c),c=h),b.index+b.removed.length>g.index+g.addedCount&&(h=b.removed.slice(g.index+g.addedCount-b.index),Array.prototype.push.apply(c,h)),b.removed=c,g.index<b.index&&(b.index=g.index)):d=!0):b.index<g.index&&(d=!0,a.splice(f,0,b),f++,c=b.addedCount-b.removed.length,g.index+=c,e+=c)}}d||a.push(b)}function D(a,b){for(var c=[],d=0;d<b.length;d++){var e=b[d];switch(e.type){case "splice":y(c,e.index,e.removed.slice(),
e.addedCount);break;case "add":case "update":case "delete":var f=e.name;if(+f!==f>>>0||""===f)continue;f=+e.name;if(0>f)continue;y(c,f,[e.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(e))}}return c}function z(a,b){var c=[];D(a,b).forEach(function(b){1==b.addedCount&&1==b.removed.length?b.removed[0]!==a[b.index]&&c.push(b):c=c.concat(K.calcSplices(a,b.index,b.index+b.addedCount,b.removed,0,b.removed.length))});return c}var x=g.testingExposeCycleCount,w=function(){function a(c){b=
c}if("function"!==typeof Object.observe||"function"!==typeof Array.observe)return!1;var b=[],c={},d=[];Object.observe(c,a);Array.observe(d,a);c.id=1;c.id=2;delete c.id;d.push(1,2);d.length=0;Object.deliverChangeRecords(a);if(5!==b.length||"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type)return!1;Object.unobserve(c,a);Array.unobserve(d,a);return!0}(),A=function(){if("undefined"!==typeof chrome&&chrome.app&&chrome.app.runtime||navigator.getDeviceStorage)return!1;
try{return(new Function("","return true;"))()}catch(a){return!1}}(),E="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))});return c},B=[],C=w?function(){var a={pingPong:!0},b=!1;Object.observe(a,function(){v();b=!1});return function(c){B.push(c);b||(b=!0,a.pingPong=!a.pingPong)}}():function(){return function(a){B.push(a)}}(),H=[],
L=0,F=1,M=1;b.prototype={open:function(a,c){if(this.state_!=L)throw Error("Observer has already been opened.");b._allObserversCount++;I&&G.push(this);this.callback_=a;this.target_=c;this.connect_();this.state_=F;return this.value_},close:function(){this.state_==F&&(b._allObserversCount--,this.disconnect_(),this.target_=this.callback_=this.value_=void 0,this.state_=2)},deliver:function(){this.state_==F&&k(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(c){b._errorThrownDuringCallback=
!0,console.error("Exception caught during observer callback: "+(c.stack||c))}},discardChanges:function(){this.check_(void 0,!0);return this.value_}};var I=!w,G;b._allObserversCount=0;I&&(G=[]);var J=!1,N=w&&A&&function(){try{return eval("%RunMicrotasks()"),!0}catch(a){return!1}}();g.Platform=g.Platform||{};g.Platform.performMicrotaskCheckpoint=function(){if(!J)if(N)eval("%RunMicrotasks()");else if(I){J=!0;var a=0,b,c;do{a++;c=G;G=[];b=!1;for(var d=0;d<c.length;d++){var e=c[d];e.state_==F&&(e.check_()&&
(b=!0),G.push(e))}v()&&(b=!0)}while(1E3>a&&b);x&&(g.dirtyCheckCycleCount=a);J=!1}};I&&(g.Platform.clearObservers=function(){G=[]});a.prototype=E({__proto__:b.prototype,arrayObserve:!1,connect_:function(a,b){if(w){var c=this.value_,d=this.arrayObserve,e=H.pop()||f();e.open(this);e.observe(c,d);this.directObserver_=e}else this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{},c;for(c in a)b[c]=a[c];Array.isArray(a)&&(b.length=a.length);return b},check_:function(a,
b){var c,e;if(w){if(!a)return!1;e={};c=l(this.value_,a,e)}else e=this.oldObject_,c=d(this.value_,this.oldObject_);if(h(c))return!1;w||(this.oldObject_=this.copyObject(this.value_));this.report_([c.added||{},c.removed||{},c.changed||{},function(a){return e[a]}]);return!0},disconnect_:function(){w?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==F&&(w?this.directObserver_.deliver(!1):k(this))},discardChanges:function(){this.directObserver_?
this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_);return this.value_}});c.prototype=E({__proto__:a.prototype,arrayObserve:!0,copyObject:function(a){return a.slice()},check_:function(a){if(w){if(!a)return!1;a=z(this.value_,a)}else a=K.calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);if(!a||!a.length)return!1;w||(this.oldObject_=this.copyObject(this.value_));this.report_([a]);return!0}});c.applySplices=function(a,b,c){c.forEach(function(c){for(var d=
[c.index,c.removed.length],e=c.index;e<c.index+c.addedCount;)d.push(b[e]),e++;Array.prototype.splice.apply(a,d)})};var O={add:!0,update:!0,"delete":!0};r.prototype={calcEditDistances:function(a,b,c,d,e,f){f=f-e+1;c=c-b+1;for(var g=Array(f),h=0;h<f;h++)g[h]=Array(c),g[h][0]=h;for(var k=0;k<c;k++)g[0][k]=k;for(h=1;h<f;h++)for(k=1;k<c;k++)if(this.equals(a[b+k-1],d[e+h-1]))g[h][k]=g[h-1][k-1];else{var l=g[h-1][k]+1,m=g[h][k-1]+1;g[h][k]=l<m?l:m}return g},spliceOperationsFromEditDistances:function(a){for(var b=
a.length-1,c=a[0].length-1,d=a[b][c],e=[];0<b||0<c;)if(0==b)e.push(2),c--;else if(0==c)e.push(3),b--;else{var f=a[b-1][c-1],g=a[b-1][c],h=a[b][c-1],k;k=g<h?g<f?g:f:h<f?h:f;k==f?(f==d?e.push(0):(e.push(1),d=f),b--,c--):k==g?(e.push(3),b--,d=g):(e.push(2),c--,d=h)}e.reverse();return e},calcSplices:function(a,b,c,d,e,f){var g=0,h=0,k=Math.min(c-b,f-e);0==b&&0==e&&(g=this.sharedPrefix(a,d,k));c==a.length&&f==d.length&&(h=this.sharedSuffix(a,d,k-g));b+=g;e+=g;c-=h;f-=h;if(0==c-b&&0==f-e)return[];if(b==
c){for(a=m(b,[],0);e<f;)a.removed.push(d[e++]);return[a]}if(e==f)return[m(b,[],c-b)];f=this.spliceOperationsFromEditDistances(this.calcEditDistances(a,b,c,d,e,f));a=void 0;c=[];for(g=0;g<f.length;g++)switch(f[g]){case 0:a&&(c.push(a),a=void 0);b++;e++;break;case 1:a||(a=m(b,[],0));a.addedCount++;b++;a.removed.push(d[e]);e++;break;case 2:a||(a=m(b,[],0));a.addedCount++;b++;break;case 3:a||(a=m(b,[],0)),a.removed.push(d[e]),e++}a&&c.push(a);return c},sharedPrefix:function(a,b,c){for(var d=0;d<c;d++)if(!this.equals(a[d],
b[d]))return d;return c},sharedSuffix:function(a,b,c){for(var d=a.length,e=b.length,f=0;f<c&&this.equals(a[--d],b[--e]);)f++;return f},calculateSplices:function(a,b){return this.calcSplices(a,0,a.length,b,0,b.length)},equals:function(a,b){return a===b}};var K=new r,A=g;"undefined"!==typeof q&&("undefined"!==typeof t&&t.exports&&(A=q=t.exports),A=q);A.Observer=b;A.Observer.runEOM_=C;A.Observer.observerSentinel_={};A.Observer.hasObjectObserve=w;A.ArrayObserver=c;A.ArrayObserver.calculateSplices=function(a,
b){return K.calculateSplices(a,b)};A.Platform=g.Platform;A.ArraySplice=r;A.ObjectObserver=a})("undefined"!==typeof g&&g&&"undefined"!==typeof t&&t?g:this||window)}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}]},{},[13]);
